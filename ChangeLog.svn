2014-11-07  Ludovic Rousseau

	* [r7036] ChangeLog, configure.ac: Release 1.8.13
	* [r7035] src/auth.c: Fix compiler warnings
	  
	  auth.c: In function ‘IsClientAuthorized’: auth.c:151:33: warning:
	  unused parameter ‘socket’ [-Wunused-parameter] unsigned
	  IsClientAuthorized(int socket, const char* action, const char*
	  reader) ^ auth.c:151:53: warning: unused parameter ‘action’
	  [-Wunused-parameter] unsigned IsClientAuthorized(int socket,
	  const char* action, const char* reader) ^ auth.c:151:73: warning:
	  unused parameter ‘reader’ [-Wunused-parameter] unsigned
	  IsClientAuthorized(int socket, const char* action, const char*
	  reader)
	* [r7034] src/Makefile.am, src/auth.c: Fix compiler warning
	  
	  auth.c:150:10: warning: no previous prototype for
	  ‘IsClientAuthorized’ [-Wmissing-prototypes] unsigned
	  IsClientAuthorized(int socket, const char* action, const char*
	  reader) ^
	* [r7033] src/hotplug_libudev.c: Fix again libudev hotplug
	  
	  The change in revision 7028 broke the fix introduced in revision
	  6951.
	  
	  Thanks again to Stefani Seibold for the new fix
	  http://lists.alioth.debian.org/pipermail/pcsclite-muscle/Week-of-Mon-20141103/000226.html

2014-11-06  Ludovic Rousseau

	* [r7029] src/hotplug_libusb.c: Do not access pipefd[] after use
	  
	  It is NOT safe to pass to a thread a pointer to a locally
	  allocated array. When the caller exits the scope of the array
	  then the memory is reused. So any reference to the array becomes
	  illegal memory access.
	  
	  Thanks to Maximilian Stein for the patch
	  http://lists.alioth.debian.org/pipermail/pcsclite-muscle/Week-of-Mon-20141103/000218.html
	* [r7028] src/hotplug_libudev.c: Scan the USB bus at least once
	  before accepting client connections
	  
	  The bug was introduced in pcsc-lite version 1.8.12 with revision
	  6951.
	  
	  Closes Alioth bug [#314869] pcscd: Socket activation not working
	  on first try
	  https://alioth.debian.org/tracker/index.php?func=detail&aid=314869&group_id=30105&atid=410085
	* [r7027] src/spy/install_spy.sh, src/spy/uninstall_spy.sh: Use
	  ldconfig(8) to find the directory containing libpcsclite.so.1
	  
	  On a Debian system (using multiarch) the directory is no more
	  /usr/lib but /usr/lib/x86_64-linux-gnu on a 64-bits Intel system.
	* [r7026] src/pcscdaemon.c: Do not log an error when pcscd is
	  started by systemd
	  
	  If pcscd is started by systemd then /var/run/pcscd/pcscd.comm
	  exists but /var/run/pcscd/pcscd.pid do not exists yet. So an
	  error was logged: pcscd[2536]: 00000000 utils.c:87:GetDaemonPid()
	  Can't open /var/run/pcscd/pcscd.pid: No such file or directory
	  
	  Now /var/run/pcscd/pcscd.pid is used only if pcscd is NOT started
	  by systemd.
	  
	  Close Alioth bug [#314862] Should not log an error Can't open
	  /var/run/pcscd/pcscd.pid when started by systemd
	  https://alioth.debian.org/tracker/index.php?func=detail&aid=314862&group_id=30105&atid=410085

2014-10-22  Ludovic Rousseau

	* [r7016] doc/pcscd.8.in: Use \- for -
	* [r7015] doc/pcscd.8.in: Add documentation for
	  --reader-name-no-interface
	* [r7014] doc/pcscd.8.in: dd documentation for
	  --reader-name-no-serial
	* [r7013] doc/pcscd.8.in: Add documentation for --auto-exit

2014-10-02  Ludovic Rousseau

	* [r7007] COPYING: Add licenses for files from other projects
	  
	  src/auth.c and src/auth.h are from Red Hat src/sd-daemon.c and
	  src/sd-daemon.h are from systemd src/simclist.c and
	  src/simclist.h are from SimCList src/strlcpy.3, src/strlcat.c and
	  src/strlcpy.c are from OpenBSD
	* [r7006] src/pcscd.h.in: Add missing 3-clause BSD license
	* [r7005] COPYING: Add GNU GPL v3 license header
	* [r7004] COPYING, UnitaryTests/SCardBlockingBehaviourTest.py,
	  UnitaryTests/SCardExclusiveBehaviour.py, src/PCSC/debuglog.h,
	  src/PCSC/ifdhandler.h, src/PCSC/pcsclite.h.in, src/PCSC/reader.h,
	  src/PCSC/winscard.h, src/PCSC/wintypes.h, src/atrhandler.c,
	  src/atrhandler.h, src/configfile.h, src/configfile.l,
	  src/debug.c, src/debuglog.c, src/dyn_generic.h, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/error.c,
	  src/eventhandler.c, src/eventhandler.h, src/hotplug.h,
	  src/hotplug_generic.c, src/hotplug_libudev.c,
	  src/hotplug_libusb.c, src/hotplug_linux.c, src/hotplug_macosx.c,
	  src/ifdwrapper.c, src/ifdwrapper.h, src/lassert.h, src/misc.h,
	  src/parser.h, src/pcsc-wirecheck-gen.c, src/pcscdaemon.c,
	  src/powermgt_generic.c, src/powermgt_generic.h,
	  src/prothandler.c, src/prothandler.h, src/readerfactory.c,
	  src/readerfactory.h, src/strlcpycat.h, src/sys_generic.h,
	  src/sys_unix.c, src/testpcsc.c, src/tokenparser.l, src/utils.c,
	  src/utils.h, src/utils/formaticc.c, src/utils/installifd.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_msg_srv.c, src/winscard_svc.c,
	  src/winscard_svc.h: Make the license more 3-clause BSD like
	  
	  The line "Changes to this license can be made only by the
	  copyright author with explicit written consent." was present in
	  the pcsc-lite license from the origin of the project (at least
	  since the initial version of COPYING in the VCS in March 2002).
	  
	  This line is not present in the 3-clause BSD license
	  http://en.wikipedia.org/wiki/BSD_licenses
	  
	  The change has been approved by David Corcoran, initial author of
	  pcsc-lite.
	  
	  The change was requested by Oracle about the headers files
	  winscard.h and pcsclite.h " To include in OpenJDK, Oracle needs
	  the right to relicense under other terms."

2014-09-24  Ludovic Rousseau

	* [r7001] Makefile.am, doc/example/Makefile.am: The GPL license has
	  been moved to the root directory
	  
	  And version is now 3.0 instead of 2.
	* [r6999] ChangeLog, configure.ac: Release 1.8.12

2014-09-19  Ludovic Rousseau

	* [r6997] UnitaryTests/SCardConnect_DIRECT2.py: Fix pyflakes
	  warning
	  
	  SCardConnect_DIRECT2.py:36: 'sys' imported but unused
	* [r6996] UnitaryTests/SCardGetAttrib.py: Fix pyflakes warning
	  
	  SCardGetAttrib.py:25: 'sys' imported but unused
	* [r6995] UnitaryTests/SCardBlockingBehaviourTest.py: Fix pyflakes
	  warning
	  
	  SCardBlockingBehaviourTest.py:234: local variable 'hresult' is
	  assigned to but never used
	* [r6994] UnitaryTests/SCardBlockingBehaviourTest.py: Fix pyflakes
	  warning
	  
	  SCardBlockingBehaviourTest.py:249: local variable 'hresult' is
	  assigned to but never useX
	* [r6993] UnitaryTests/control_get_firmware.py: Fix stupid bug

2014-09-17  Ludovic Rousseau

	* [r6991] doc/doxygen.conf.in: Do not use FreeSans.ttf anymore
	  
	  Warning: doxygen no longer ships with the FreeSans font. You may
	  want to clear or change DOT_FONTNAME.
	* [r6990] doc/doxygen.conf.in: Update from Doxygen 1.8.1.1 to 1.8.7
	  
	  Used "doxygen -u"
	* [r6989] src/winscard_clnt.c: Fix Doxygen for
	  SCardGetStatusChange()
	  
	  A value of 0 for dwTimeout is not equivalent of INFINITE but of 0
	  ms.
	  
	  Thanks to helpcrypto for the bug report.
	  http://lists.alioth.debian.org/pipermail/pcsclite-muscle/Week-of-Mon-20140915/000141.html
	* [r6987] doc/pcscd.8.in: Update driver web page
	  
	  http://www.musclecard.com/drivers.html is no more available. A
	  copy is available at
	  http://pcsclite.alioth.debian.org/musclecard.com/drivers.html

2014-09-15  Ludovic Rousseau

	* [r6986] src/strlcpy.c, src/tokenparser.l: Use <config.h> instead
	  of "config.h"
	  
	  https://www.gnu.org/software/autoconf/manual/autoconf-2.65/html_node/Configuration-Headers.html
	  With the appropriate -I option, you can use #include <config.h>.
	  Actually, it's a good habit to use it, because in the rare case
	  when the source directory contains another config.h, the build
	  directory should be searched first.
	* [r6985] src/spy/pcsc-spy: Fix error reported by flake8
	  
	  pcsc-spy:795:20: E711 comparison to None should be 'if cond is
	  None:'

2014-09-09  Ludovic Rousseau

	* [r6979] UnitaryTests/Makefile, UnitaryTests/exec.c: Unitary Test
	  for change in revision 6978
	* [r6978] src/winscard_msg.c: Create the libpcsclite/pcscd socket
	  with the SOCK_CLOEXEC flag
	  
	  The communication socket between libpcsclite and pcscd is created
	  with the SOCK_CLOEXEC flag added so the socket is automatically
	  closed when the process (or its childs) calls exec().
	  
	  The problem happens when an application does exec() without
	  cleaning its use of libpcsclite using SCardReleaseContext(). I
	  could not reproduce a real problem but it has been reported on
	  the field with a closed source application.
	  
	  Thanks to Stefani Seibold for the bug report and patch.

2014-09-01  Ludovic Rousseau

	* [r6965] src/PCSC/debuglog.h, src/PCSC/ifdhandler.h,
	  src/PCSC/pcsclite.h.in, src/auth.h: Remove extra spaces at end of
	  lines

2014-08-07  Ludovic Rousseau

	* [r6953] src/hotplug_libudev.c: Udev is a global variable
	  
	  Rename udev as Udev to make it more explicit it is a global
	  variable.
	* [r6952] src/hotplug_libudev.c: Add a missing break;
	  
	  I removed the line when testing the code. This bug is mine, not
	  Stefani's
	* [r6951] src/hotplug_libudev.c: Revamp libudev hotplug
	  
	  " Hi,
	  
	  this is a complete revamp of src/hotplug_libudev.c hotplug
	  handling. This patch fix a lot of race conditions and make the
	  code a bit cleaner.
	  
	  The following benefits will be achieved:
	  
	  - udev events will be handled seperatly, a "add" event will only
	  add a device and a "remove" will now only remove the device. So
	  the whole bookkeeping is now done by the udev daemon, there is no
	  more need to track the state of the device. Also it fix a race
	  where udev had yet not finished the plug event and the device is
	  not full accessible.
	  
	  - fix the race gap between the coldplug scan and the activating
	  of the monitoring hotplug events. Now the monitoring will be
	  first activated and the the coldplug scan will be done. So there
	  is a small change that a device will be added during the coldplug
	  scan. For this the HPAddDevice() function needs to check for
	  duplicate adds of a device. But that is common design of libudev
	  usage.
	  
	  - No more mutex needed since there is no more concurrency,
	  because the coldplug scan will be no done inside the thread. - Do
	  not start the thread detached since there is no way to do a
	  synchronized stop of the thread. The HPStopHotPluggables() will
	  now wait until the thread is gone. So it is save to free memory
	  of structures since no one is access them.
	  
	  - Remove the cooperative thread cancellation by AraKiriHotPlug.
	  Despite the non political correctness it will not work as
	  expected, because the select() system call will block infinitly.
	  Using the pthread_cancel() mechanism will do a better and safer
	  job.
	  
	  - Add signal safety to the select() system call. A EINTR should
	  not lead in a termination of the thread.
	  
	  - Fix a typo: pluggble > plugable
	  
	  - Make less error prone for unexpected libudev return values.
	  Check all return values of udev_...() functions against NULL.
	  
	  - Fix resource leak in hotplug thread. The udev_device_unref()
	  was never called on event "remove".
	  
	  - Cleanup HPStopHotPluggables() function, which release now all
	  allocated resources, including udev. It also will not crash when
	  in HPRegisterForHotplugEvents() was not able to acquire
	  resources.
	  
	  - Replace the prehistoric select() by poll(), which is faster and
	  consumes less memory.
	  
	  Changlog:
	  
	  V1 4-Aug-2014 first release V2 5-Aug-2014 Fix coding style.
	  Optimize HPRemoveDevice() Cleanup HPStopHotPluggables() Fix a
	  resource leak not calling udev_device_unref() in case of "add" or
	  "remove" event. V3 5-Aug-2014 Fix resource leak in
	  HPStopHotPluggables(), release udev Fix error handling in
	  HPRegisterForHotplugEvents() and HPStopHotPluggables() Revert
	  unneeded RFRemoveReader() in HPRegisterForHotplugEvents()
	  
	  - Stefani
	  
	  Signed-off-by: Stefani Seibold <stefani at seibold.net> "
	  
	  Thanks to Stefani Seibold for the patch
	  http://lists.alioth.debian.org/pipermail/pcsclite-muscle/Week-of-Mon-20140804/000093.html

2014-08-06  Ludovic Rousseau

	* [r6950] src/utils.c: Adjust the thread stack size
	  
	  The size of 4 MB is not needed and too big (see revision 6948).
	  By default the thread stack size is: - 8 MB on Debian GNU/Linux -
	  256 KB on Mac OS X 10.9 - 80 KB on musl, but it is not enough for
	  pcsc-lite
	  
	  256 KB (like on Mac OS X 10.9) is enough for musl.
	* [r6949] src/utils.c: Factorize error code
	* [r6948] src/utils.c: Increase the thread stack size to at least 4
	  MB
	  
	  " Recently I tried to run it on a non-glibc system using musl
	  instead. Turns out musl has a default stacksize of 80KB instead
	  of the multi-megabyte we are used to in glibc. This leads to
	  segfaults when pcscd tries to allocate buffers on the stack. To
	  fix this i applied the following patch:
	  https://github.com/stef/aports/blob/master/main/pcsc-lite/musl-stacksize.patch
	  
	  I would be very thankful if you would incorporate this "upstream"
	  so that other musl users can happily enjoy pcsc and friends. "
	  
	  Thanks to Stefan Marsiske for the patch

2014-07-29  Ludovic Rousseau

	* [r6944] src/configfile.l: Add ReiserFS support (and maybe some
	  other strange file systems)
	  
	  "the attached patch fixes incorrect use of the dirent::d_type
	  field. As documented in readdir(3) d_type may be set to
	  DT_UNKNOWN, which applications must handle properly.
	  
	  The effect of the bug is that config files are skipped in case
	  the config directory is located on a file system that doesn't
	  support d_type (e.g. ReiserFS)."
	  
	  Thanks to Ingo Weinhold for the patch

2014-06-13  Ludovic Rousseau

	* [r6918] src/auth.c: Change return value of IsClientAuthorized()
	  
	  The version of IsClientAuthorized() when PolicyKit is not used
	  was not similar to the other version.
	  
	  Fixes Debian bug #751517

2014-06-05  Ludovic Rousseau

	* [r6911] src/hotplug_libudev.c: Check udev functions for errors
	  
	  Prevent the crash reported at:
	  https://bugzilla.redhat.com/show_bug.cgi?id=1071243
	  
	  Thanks to Nikos Mavrogiannopoulos for the patch
	  http://lists.alioth.debian.org/pipermail/pcsclite-muscle/Week-of-Mon-20140602/000039.html

2014-04-18  Ludovic Rousseau

	* [r6888] GPL-3.0.txt, doc/example/GPL-3.0.txt: Move the GNU GPL v3
	  license in the project root directory
	* [r6887] COPYING: Some files are under GNU GPL v3+ license
	* [r6886] doc/example/GPL-2, doc/example/GPL-3.0.txt: Replase GNU
	  GPL v2 by GPL v3 license text
	  
	  Since revision 6003 (2011-10-05) pcsc_demo.c moved from GNU GPL
	  v2+ to GNU GPL v3+

2014-02-26  Ludovic Rousseau

	* [r6861] NEWS: Remove reference about "new MuscleCard" applet

2014-02-20  Ludovic Rousseau

	* [r6859] configure.ac: Make --disable-polkit
	  
	  Thanks to Diego Elio Pettenò for the bug report

2014-02-14  Ludovic Rousseau

	* [r6853] ChangeLog, configure.ac: Release 1.8.11
	* [r6852] HELP: Replace old linuxnet.com domaine name
	  
	  Mailing list moved from sclinux@linuxnet.com to
	  muscle@lists.musclecard.com
	* [r6851] AUTHORS, COPYING, DRIVERS, README,
	  UnitaryTests/BufferOverflow.c, doc/example/pcsc_demo.c,
	  src/PCSC/debuglog.h, src/PCSC/ifdhandler.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/reader.h, src/PCSC/winscard.h,
	  src/PCSC/wintypes.h, src/atrhandler.c, src/atrhandler.h,
	  src/auth.c, src/auth.h, src/configfile.h, src/configfile.l,
	  src/debug.c, src/debuglog.c, src/dyn_generic.h, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/error.c,
	  src/eventhandler.c, src/eventhandler.h, src/hotplug.h,
	  src/hotplug_generic.c, src/hotplug_libudev.c,
	  src/hotplug_libusb.c, src/hotplug_linux.c, src/hotplug_macosx.c,
	  src/ifdwrapper.c, src/ifdwrapper.h, src/misc.h, src/parser.h,
	  src/pcscd.h.in, src/pcscdaemon.c, src/powermgt_generic.c,
	  src/powermgt_generic.h, src/prothandler.c, src/prothandler.h,
	  src/readerfactory.c, src/readerfactory.h, src/strlcpycat.h,
	  src/sys_generic.h, src/sys_unix.c, src/testpcsc.c,
	  src/tokenparser.l, src/utils.c, src/utils.h, src/utils/README,
	  src/utils/formaticc.c, src/utils/installifd.c, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_msg.h,
	  src/winscard_msg_srv.c, src/winscard_svc.c, src/winscard_svc.h:
	  Replace old linuxnet.com domaine name
	  
	  web site moved from http://www.linuxnet.com to
	  http://pcsclite.alioth.debian.org/pcsclite.html
	  
	  David email moved tom corcoran@linuxnet.com to
	  David Corcoran@musclecard.com
	* [r6850] src/auth.c, src/auth.h: Fix Muscle URL

2014-02-11  Ludovic Rousseau

	* [r6842] configure.ac, doc/Makefile.am, doc/README.polkit,
	  doc/org.debian.pcsc-lite.policy, src/Makefile.am, src/auth.c,
	  src/auth.h, src/winscard_svc.c: Add polkit support
	  
	  See doc/README.polkit
	  
	  Thanks to Nikos Mavrogiannopoulos for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2013-q4/0097.html
	* [r6841] src/winscard_svc.c: SCARD_CONNECT: force a NUL byte to
	  terminate the reader name
	  
	  The client part may send us anything. So we must enfore the
	  reader name is a NUL-byte terminated C-string.
	  
	  Thanks to Nikos Mavrogiannopoulos for the patch

2014-02-08  Ludovic Rousseau

	* [r6838] src/spy/pcsc-spy.pod: Reformat for a better HTML output

2014-01-13  Ludovic Rousseau

	* [r6822] src/PCSC/debuglog.h, src/PCSC/ifdhandler.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/reader.h, src/PCSC/winscard.h,
	  src/PCSC/wintypes.h, src/atrhandler.c, src/atrhandler.h,
	  src/configfile.h, src/configfile.l, src/debug.c, src/debuglog.c,
	  src/dyn_generic.h, src/dyn_hpux.c, src/dyn_macosx.c,
	  src/dyn_unix.c, src/error.c, src/eventhandler.c,
	  src/eventhandler.h, src/hotplug.h, src/hotplug_generic.c,
	  src/hotplug_libudev.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/ifdwrapper.c, src/ifdwrapper.h,
	  src/lassert.h, src/misc.h, src/parser.h,
	  src/pcsc-wirecheck-gen.c, src/pcscdaemon.c,
	  src/powermgt_generic.c, src/powermgt_generic.h,
	  src/prothandler.c, src/prothandler.h, src/readerfactory.c,
	  src/readerfactory.h, src/strlcpycat.h, src/sys_generic.h,
	  src/sys_unix.c, src/testpcsc.c, src/tokenparser.l, src/utils.c,
	  src/utils.h, src/utils/formaticc.c, src/utils/installifd.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_msg_srv.c, src/winscard_svc.c,
	  src/winscard_svc.h: Include the COPYING file in header of file
	  
	  It will be easier to know the licence used by a file when used
	  outside of pcsc-lite.

2013-12-20  Ludovic Rousseau

	* [r6810] src/winscard_clnt.c: SCardListReaders(): fix a memory
	  leak in case of error
	  
	  Check mszReaders is valid before allocating memory.
	  
	  Thanks to Ignacio Casal for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2013-q4/0084.html

2013-12-03  Ludovic Rousseau

	* [r6804] splint.sh: Add header directory for sys/types.h
	* [r6803] make-dirs: Remove very old files used to build on Solaris
	  
	  " Adding make-dirs plus Makefiles for certain configurations when
	  people don't want to try and fix autoconf "

2013-12-02  Ludovic Rousseau

	* [r6802] src/dyn_generic.h, src/dyn_hpux.c, src/dyn_macosx.c,
	  src/dyn_unix.c, src/readerfactory.c: Do not log a critical error
	  if symbol IFDHCreateChannelByName is not found in a driver.
	  
	  Drivers using API v2 of IFDHandler (like openct-ifd.bundle) do
	  not provide a IFDHCreateChannelByName symbol. A critical error
	  should not be logged since it is a normal behavior.
	  
	  DYN_GetAddress() has a new parameter: mayfail, to indicate if
	  dlsym(3) may fail or not.

2013-10-24  Ludovic Rousseau

	* [r6785] src/configfile.l: CHANNELID and DEVICENAME are both
	  optional but not at the same time
	  
	  If the driver uses DEVICENAME you can ignore/unset CHANNELID. If
	  the driver uses CHANNELID you can ignore/unset DEVICENAME. But
	  you shall configure at least one of the two parameters.

2013-10-19  Ludovic Rousseau

	* [r6779] ChangeLog, configure.ac: Release 1.8.10
	* [r6778] src/pcscdaemon.c: Fix typo in log message

2013-10-18  Ludovic Rousseau

	* [r6775]
	  UnitaryTests/FEATURE_CCID_ESC_COMMAND_Gemalto_features.py:
	  Display the reader name, Pid and Vid
	* [r6773]
	  UnitaryTests/FEATURE_CCID_ESC_COMMAND_Gemalto_features.py: Update
	  the error message if FEATURE_CCID_ESC_COMMAND is not available
	* [r6772]
	  UnitaryTests/FEATURE_CCID_ESC_COMMAND_Gemalto_features.py: Add
	  more feature parsing

2013-10-17  Ludovic Rousseau

	* [r6771] src/debug.c: Do not export log_msg() symbol
	  
	  PCSC_API must be undefined so that log_msg() declaration in
	  PCSC/debuglog.h is not external but internal.
	  
	  Fix alioth bug [#314494] log_msg should NOT be exported by
	  libpscslite.so.1
	  https://alioth.debian.org/tracker/index.php?func=detail&aid=314494&group_id=30105&atid=410085

2013-10-16  Ludovic Rousseau

	* [r6769] ChangeLog, configure.ac: Release 1.8.9

2013-10-01  Ludovic Rousseau

	* [r6759] src/debug.c, src/debuglog.c, src/hotplug_linux.c: Use the
	  COUNT_OF macro
	* [r6758] src/misc.h: Add COUNT_OF macro
	  
	  This macro returns the number of elements in an array.
	  
	  See http://stackoverflow.com/questions/1598773

2013-09-12  Ludovic Rousseau

	* [r6750] src/hotplug_libudev.c, src/hotplug_libusb.c,
	  src/pcscdaemon.c: Add support of --reader-name-no-serial and
	  --reader-name-no-interface
	  
	  It is now possible to NOT add the USB serial number of the reader
	  using --reader-name-no-serial
	  
	  It is now possible to NOT add the CCID interface name of the
	  reader using --reader-name-no-interface
	  
	  See also "What is in a PC/SC reader name?"
	  http://ludovicrousseau.blogspot.fr/2010/05/what-is-in-pcsc-reader-name.html
	  
	  Closes Alioth bug [#314338] Add an option to remove serial number
	  and interface name from the PC/CS reader name
	  https://alioth.debian.org/tracker/index.php?func=detail&aid=314338&group_id=30105&atid=410088

2013-09-10  Ludovic Rousseau

	* [r6749] UnitaryTests/SCardEndTransaction_extra_call.py: Unitary
	  test for the correction in revision 6748
	  
	  SCardEndTransaction() should return SCARD_E_NOT_TRANSACTED if
	  called more times than SCardBeginTransaction()
	* [r6748] src/readerfactory.c, src/winscard.c: Return an error if
	  SCardEndTransaction() is called with no corresponding
	  SCardBeginTransaction()
	  
	  This is done in two steps: - RFUnlockSharing() returns an error
	  if a reader is unlocked when it was not (or no more) previously
	  locked - SCardEndTransaction() checks the value returned by
	  RFUnlockSharing() and returns an error if RFUnlockSharing()
	  failed
	  
	  Thanks to Markus Heintel for the initial patch

2013-08-26  Ludovic Rousseau

	* [r6744] doc/pcscd.8.in: Document --max-thread,
	  --max-card-handle-per-thread and --max-card-handle-per-reader
	  
	  Closes bug [#314308] "Document --max-thread,
	  --max-card-handle-per-thread and --max-card-handle-per-reader in
	  pcscd(8)"
	* [r6743] doc/pcscd.8.in: Document --force-reader-polling
	* [r6742] doc/pcscd.8.in: Document short options -e, --error and
	  -C, --critical
	* [r6741] doc/pcscd.8.in: Add documentation for -T, --color

2013-08-23  Ludovic Rousseau

	* [r6734] src/winscard_clnt.c: Fix a memory leak in case of error
	  
	  When SCARD_AUTOALLOCATE is used we check the parameter is valid
	  and return in case it is not _before_ calling malloc.
	  
	  Detected by "clang --analyze" winscard_clnt.c:1566:9: warning:
	  Potential leak of memory pointed to by 'bufReader' rv =
	  SCARD_E_INVALID_PARAMETER; ^~~~~~~~~~~~~~~~~~~~~~~~~
	  
	  winscard_clnt.c:1594:9: warning: Potential leak of memory pointed
	  to by 'bufAtr' rv = SCARD_E_INVALID_PARAMETER;
	  ^~~~~~~~~~~~~~~~~~~~~~~~~
	  
	  winscard_clnt.c:3141:9: warning: Potential leak of memory pointed
	  to by 'buf' rv = SCARD_E_INVALID_PARAMETER;
	  ^~~~~~~~~~~~~~~~~~~~~~~~~

2013-08-12  Ludovic Rousseau

	* [r6727] src/utils/formaticc.c: Display SCardTransmit() error code
	  (if any)
	* [r6726] src/utils/formaticc.c: Allow comments starting with #
	* [r6725] src/utils/formaticc.c: Display APDU sent and data
	  received
	* [r6724] src/utils/formaticc.c: Add more error code management
	* [r6723] src/utils/formaticc.c: Mac OS X port

2013-08-07  Ludovic Rousseau

	* [r6719] src/configfile.l: Fix compiler warning
	  
	  configfile.l: In function ‘evaluatetoken’: configfile.l:186:
	  warning: initialization discards qualifiers from pointer target
	  type

2013-08-05  Ludovic Rousseau

	* [r6712] src/configfile.l, src/tokenparser.l: Fix memory leak
	  
	  Call yylex_destroy() after the lexer is used.
	  
	  Thanks to Alan Kozlay for the patch
	* [r6711] src/eventhandler.c, src/eventhandler.h, src/pcscdaemon.c:
	  Create and use EHDeinitializeEventStructures(): fix memory leak
	  
	  The structures allocated in EHInitializeEventStructures() were
	  never released.
	  
	  Thanks to Alan Kozlay for the patch
	* [r6710] src/pcscdaemon.c: SVCServiceRunLoop(): be able to quit
	  earlier
	  
	  The daemon is now able to quit (test the arakiri flag) even
	  before SVCServiceRunLoop() has been called.
	  
	  Thanks to Alan Kozlay for the patch
	* [r6709] src/winscard_svc.c: ContextsDeinitialize(): fix a memory
	  leak
	  
	  Thanks to Alan Kozlay for the patch
	* [r6708] src/readerfactory.c: RFCleanupReaders(): fix a memory
	  leak
	  
	  Free the ConfigFile C-string if needed
	  
	  Thanks to Alan Kozlay for the patch
	* [r6707] src/readerfactory.c: RFCleanupReaders(): fix a memory
	  leak
	  
	  The sReadersContexts[i] structure allocated in
	  RFAllocateReaderSpace() was never released on exit.
	  
	  This is not really a problem unless you embedd pcscd in another
	  process and do init/deinit pcscd without exiting the process (as
	  maybe used on Android or iOS).
	  
	  Thanks to Alan Kozlay for the patch

2013-08-01  Ludovic Rousseau

	* [r6703] src/configfile.l: Fix memory leaks
	  
	  Free the malloc-ed strings.
	  
	  The strings are only allocated _once_ when the config files in
	  /etc/reader.conf.d/ are parsed. This is not really a problem
	  unless you embedd pcscd in another process and do init/deinit
	  pcscd without exiting the process (as maybe used on Android or
	  iOS).
	  
	  Thanks to Alan Kozlay for the patch

2013-07-31  Ludovic Rousseau

	* [r6702] src/pcscdaemon.c: Fix compiler warnings
	  
	  pcscdaemon.c: In function ‘main’: pcscdaemon.c:547:12: attention
	  : declaration of ‘r’ shadows a previous local [-Wshadow]
	  pcscdaemon.c:152:6: attention : shadowed declaration is here
	  [-Wshadow] pcscdaemon.c:637:11: attention : declaration of ‘r’
	  shadows a previous local [-Wshadow] pcscdaemon.c:152:6: attention
	  : shadowed declaration is here [-Wshadow]

2013-07-30  Ludovic Rousseau

	* [r6701] src/atrhandler.c: Fix compiler warning
	  
	  atrhandler.c: In function ‘ATRDecodeAtr’: atrhandler.c:88:19:
	  warning: variable ‘TCi’ set but not used
	  [-Wunused-but-set-variable] atrhandler.c:88:14: warning: variable
	  ‘TBi’ set but not used [-Wunused-but-set-variable]
	  
	  We don't use TBi and TCi but we must calculate them because of
	  the p++ in the formulae.
	  
	  See revision 5808 to know why these values are important.
	* [r6700] src/testpcsc.c: Check returned value of fgets(3)
	  
	  Fix compiler warning: testpcsc.c: In function ‘main’:
	  testpcsc.c:190:4: warning: ignoring return value of ‘fgets’,
	  declared with attribute warn_unused_result [-Wunused-result]
	* [r6699] src/pcscdaemon.c: Check returned value of write(2) on
	  synchronization socket
	  
	  Fix compiler warnings: pcscdaemon.c: In function ‘main’:
	  pcscdaemon.c:639:3: warning: ignoring return value of ‘write’,
	  declared with attribute warn_unused_result [-Wunused-result]
	  pcscdaemon.c: In function ‘at_exit’: pcscdaemon.c:661:3: warning:
	  ignoring return value of ‘write’, declared with attribute
	  warn_unused_result [-Wunused-result]
	* [r6698] src/pcscdaemon.c: Check returned value from chdir(2)
	  
	  Fix compiler warning: pcscdaemon.c: In function ‘main’:
	  pcscdaemon.c:401:2: warning: ignoring return value of ‘chdir’,
	  declared with attribute warn_unused_result [-Wunused-result]
	* [r6697] src/pcscdaemon.c: Add the terminating \0 in pcscd.pid
	  file
	* [r6696] src/pcscdaemon.c, src/utils.c: Check read(2) and write(2)
	  returned value for pcscd.pid file
	  
	  Fix compiler warnings: utils.c: In function `GetDaemonPid':
	  utils.c:45:3: warning: ignoring return value of `read', declared
	  with attribute warn_unused_result [-Wunused-result] pcscdaemon.c:
	  In function ‘main’: pcscdaemon.c:543:4: warning: ignoring return
	  value of ‘write’, declared with attribute warn_unused_result
	  [-Wunused-result]
	* [r6695] src/spy/libpcscspy.c: Ignore the write(2) returned value
	  
	  Using (void)write(...) is not enough to fool the compiler. I
	  still get: libpcscspy.c: In function `spy_line':
	  libpcscspy.c:200:2: warning: ignoring return value of `write',
	  declared with attribute warn_unused_result [-Wunused-result]
	  libpcscspy.c:201:2: warning: ignoring return value of `write',
	  declared with attribute warn_unused_result [-Wunused-result]
	  libpcscspy.c:202:2: warning: ignoring return value of `write',
	  declared with attribute warn_unused_result [-Wunused-result]
	  libpcscspy.c: In function `spy_line_direct': libpcscspy.c:173:2:
	  warning: ignoring return value of `write', declared with
	  attribute warn_unused_result [-Wunused-result]
	  libpcscspy.c:174:2: warning: ignoring return value of `write',
	  declared with attribute warn_unused_result [-Wunused-result]
	  libpcscspy.c:175:2: warning: ignoring return value of `write',
	  declared with attribute warn_unused_result [-Wunused-result]
	  
	  The new code now uses: ssize_t r; r = write(...) (void)r;
	* [r6694] src/spy/libpcscspy.c: Update Copyright date

2013-07-01  Ludovic Rousseau

	* [r6680] src/winscard_clnt.c: Do not use pthread_atfork() any more
	  
	  pthread_atfork() was used to invalidate all the handles after a
	  fork. The problem is that the handler function was still called
	  after the libpcsclite library was unloaded on FreeBSD. This
	  caused a crash of the application.
	  
	  The invalidation of the handles is not mandatory. After a fork
	  the application may still use the PC/SC handles and may get a
	  SCARD_F_COMM_ERROR error if the handle has been closed and in the
	  pcscd logs: winscard_svc.c:908:MSGCheckHandleAssociation() Client
	  failed to authenticate
	  
	  Closes Alioth bug [#314078] Do not use pthread_atfork() in a
	  library
	  https://alioth.debian.org/tracker/index.php?func=detail&aid=314078&group_id=30105&atid=410085

2013-06-27  Ludovic Rousseau

	* [r6671] src/hotplug_macosx.c: Fix compiler warning
	  
	  hotplug_macosx.c:298: warning: format ‘%s’ expects type ‘char *’,
	  but argument 6 has type ‘struct HPDriver *’ hotplug_macosx.c:298:
	  warning: too many arguments for format
	* [r6670] src/hotplug_macosx.c: List found USB devices (when in
	  debug mode)

2013-06-25  Ludovic Rousseau

	* [r6669] UnitaryTests/SCard_fork.py: Fix copy-paster in log
	  message
	* [r6668] src/readerfactory.c: RFAddReader(): correctly manage
	  thread safe multi-slot readers
	  
	  If the driver declares it is TAG_IFD_SLOT_THREAD_SAFE then pcscd
	  can access each slots simultanously.
	  
	  In this case some data must be duplicated at RFAddReader() step
	  since they will be destroyed at the removeReader() step.
	  
	  Thanks to Frank Morgner for the bug report Closes Alioth bug
	  [#314315] "double free corruption when unloading serial driver
	  with multiple slots"

2013-06-18  Ludovic Rousseau

	* [r6663] configure.ac, src/libpcsclite.pc.in: Add support of
	  serialconfdir pkg-config variable
	  
	  It is now possible to use pkg-config to get the directory used by
	  pcscd to fetch serial drivers configurations.
	  
	  $ pkg-config libpcsclite --variable=serialconfdir
	  /etc/reader.conf.d
	  
	  Closes alioth bug [#314300] Add pkg-config confdir option Thanks
	  to Frank Morgner for the idea

2013-06-10  Ludovic Rousseau

	* [r6654] src/winscard.c: SCardGetAttrib(): Add support of
	  SCARD_ATTR_DEVICE_SYSTEM_NAME
	  
	  Thanks to Rafael Ugalde Beriain
	* [r6653] src/winscard.c: SCardGetAttrib(): Fix bug in
	  SCARD_ATTR_DEVICE_FRIENDLY_NAME
	  
	  Affect the real length _after_ checking the buffer is large
	  enough.
	  
	  Thanks to Rafael Ugalde Beriain for the bug report.

2013-06-06  Ludovic Rousseau

	* [r6649] src/spy/pcsc-spy: Fix PEP8 warnings
	  
	  E128 continuation line under-indented for visual indent
	* [r6648] src/spy/pcsc-spy: Fix PEP8 warning
	  
	  pcsc-spy:34:13: E128 continuation line under-indented for visual
	  indent
	* [r6647] src/spy/pcsc-spy: Add SCARD_ATTR_DEVICE_SYSTEM_NAME
	  
	  Add _A and _W versions

2013-05-30  Ludovic Rousseau

	* [r6639] src/winscard_clnt.c: Unlock the mutex if hCard has been
	  invalidated by SCardDisconnect()
	  
	  SCardBeginTransaction() was not correctly releasing a mutex when
	  the hCard handle was invalidated. The problem is that hCard can
	  be invalidated by: - SCardReleaseContext and all the context is
	  invalid - SCardDisconnect and only the hCard is invalid, not the
	  mutex
	  
	  The problem was that SCardGetStatusChange() was blocked because
	  SCardBeginTransaction() had not released the context mutex.
	  
	  Thanks to Fredrik Axelsson for the bug report
	  https://bugzilla.redhat.com/show_bug.cgi?id=956530

2013-05-28  Ludovic Rousseau

	* [r6638] src/PCSC/reader.h: Use C99 flexible array member
	  
	  The structures PIN_MODIFY_STRUCTURE and PIN_VERIFY_STRUCTURE now
	  use a C99 flexible array member when available for abData field.
	  
	  uint8_t abData[];

2013-05-27  Ludovic Rousseau

	* [r6637] src/winscard_clnt.c: mMutex is now directly inside the
	  _psContextMap structure and no more a pointer
	  
	  The mutex was dynamically allocated at runtime using malloc(3)
	  and referenced using a pointer. This was introduced in revision
	  572 (Dec 2003) by Damien Sauveron.
	  
	  Using a direct pthread_mutex_t structure will save memory (one
	  pointer removed per context), improve performances (one
	  malloc/free removed) and make the code safer (one malloc failure
	  removed).

2013-05-08  Ludovic Rousseau

	* [r6625] src/pcscdaemon.c: Explicitely ignore write() return value
	  
	  pcscdaemon.c:626:3: warning: ignoring return value of function
	  declared with warn_unused_result attribute [-Wunused-result]
	  write(pipefd[1], &buf, 1); ^~~~~ ~~~~~~~~~~~~~~~~~~
	  pcscdaemon.c:648:3: warning: ignoring return value of function
	  declared with warn_unused_result attribute [-Wunused-result]
	  write(pipefd[1], &buf, 1); ^~~~~ ~~~~~~~~~~~~~~~~~~ 2 warnings
	  generated.
	  
	  We don't have much to do if write() on the interprocess pipe
	  fails.

2013-05-05  Ludovic Rousseau

	* [r6621] src/hotplug_libudev.c: Fix a memory leak in case of error
	  
	  Coverity: leaked_storage: Variable "hpDir" going out of scope
	  leaks the storage it points to.

2013-03-29  Ludovic Rousseau

	* [r6582] src/spy/pcsc-spy: Try to display the thread in the order
	  they appear in the log
	  
	  The idea is to schedule another thread when a thread change is
	  detected in the log. Then the other threads should have time to
	  empty their queues and display what they have to display. The
	  order is then respected between the logs recorded and the logs
	  displayed.
	* [r6581] src/spy/pcsc-spy: Check the first line format
	  
	  This could happen if the trace file first lines are removed.
	* [r6580] src/Makefile.am: Do not explicitly include the .in files
	  in Makefile.am
	  
	  These files are automatically included.
	  
	  Thanks to Anthony Foiani for the patch
	  http://sourceforge.net/mailarchive/message.php?msg_id=30653233
	* [r6579] src/spy/Makefile.am: Use $(srcdir) to locate pcsc-spy.pod
	  
	  Without the patch it is not possible to build pcsc-lite out of
	  the source tree like:
	  
	  mkdir build cd build ../configure make
	  
	  Thanks to Anthony Foiani for the bug report
	  http://sourceforge.net/mailarchive/message.php?msg_id=30653233

2013-03-16  Ludovic Rousseau

	* [r6574] src/spy/Makefile.am: $^ not supported on FreeBSD make
	* [r6573] src/spy/Makefile.am: Do not use GNU make extension
	  
	  src/spy/Makefile.am:11: `%'-style pattern rules are a GNU make
	  extension
	  
	  Thanks to Martin Paljak for the patch
	  http://lists.alioth.debian.org/pipermail/pcsclite-muscle/Week-of-Mon-20130311/000016.html
	* [r6572] configure.ac, src/Makefile.am, src/spy/Makefile.am: Fix
	  OpenBSD 5.2 compilation regarding dlopen
	  
	  1) dlopen search in configure.ac, as guided in [1]. Removes this
	  warning: * Warning: linker path does not have real file for
	  library -ldl. * I have the capability to make that library
	  automatically link in when * you link to this library. But I can
	  only do this if you have a * shared version of the library, which
	  you do not appear to have * because I did check the linker path
	  looking for a file starting * with libdl but no candidates were
	  found. (...for regex pattern test) * The inter-library
	  dependencies that have been dropped here will be * automatically
	  added whenever a program is linked with this library * or is
	  declared to -dlopen it.
	  
	  [1]
	  http://www.flameeyes.eu/autotools-mythbuster/autoconf/finding.html
	  
	  Thanks to Martin Paljak for the patch
	  http://lists.alioth.debian.org/pipermail/pcsclite-muscle/Week-of-Mon-20130311/000016.html

2013-03-06  Ludovic Rousseau

	* [r6558] src/ifdwrapper.c: cppcheck: Variable 'rv' is reassigned a
	  value before the old one has been used.
	  
	  This is a (minor) performance issue. I guess the compiler can
	  optimize the code as needed.
	* [r6557] src/hotplug_libusb.c: cppcheck: The scope of the variable
	  'fullname' can be reduced.
	* [r6556] src/hotplug_libusb.c: cppcheck: The scope of the variable
	  'serialNumber' can be reduced.
	* [r6555] src/winscard_svc.c: cppcheck: The scope of the variable
	  'lrv' can be reduced.
	* [r6554] src/utils/formaticc.c: cppcheck: Resource leak: fp
	  
	  Same problem with FILE descriptor fo
	* [r6553] src/eventhandler.c: cppcheck: Variable 'readerState' is
	  assigned a value that is never used.
	* [r6552] src/eventhandler.c: cppcheck: Unused variable: dwAtrLen
	  
	  dwAtrLen is used only if DISABLE_AUTO_POWER_ON is not set
	  (default case)
	* [r6551] src/debug.c, src/debuglog.c: cppcheck: The scope of the
	  variable 'terms' can be reduced.
	* [r6550] UnitaryTests/BufferOverflow.c: cppcheck: The scope of the
	  variable 'i' can be reduced.

2013-03-04  Ludovic Rousseau

	* [r6549] src/winscard_msg.h: Update PROTOCOL_VERSION_MINOR from 2
	  to 3
	  
	  We broke the API between version 1.8.3 and 1.8.4 by changing the
	  value of MAX_READERNAME.
	  
	  This change should have been made before releasing version 1.8.4
	  to make mix of versions clearly non working instead of failing
	  with strange errors.
	  
	  This may be the source of the bug reported at
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q3/0065.html

2013-02-19  Ludovic Rousseau

	* [r6536] src/winscard.c: Remove duplicated line found by
	  scan-build(1)
	  
	  Assigned value is always the same as the existing value
	  
	  The same line is also present in the case (rv == SCARD_S_SUCCESS)
	* [r6535] src/winscard_svc.c: Fix a bug reported by scan-build(1)
	  
	  Value stored to 'retval' is never read
	  
	  An else statement was missing
	* [r6534] src/testpcsc.c: Initialize iList[] to fix a error
	  reported by scan-build(1)
	  
	  scan-build(1) from clang reported a problem that iList[iReader]
	  migth be used uninitialized.

2013-02-13  Ludovic Rousseau

	* [r6527] UnitaryTests/SCard_fork.py: Add some debug logs

2013-01-28  Ludovic Rousseau

	* [r6519] src/hotplug_libudev.c: Check the Info.plist file is (a
	  minimum) correct
	  
	  The number of products, manufacturers and reader names should be
	  the same. Otherwise the Info.plist file is corrupted and bad
	  things may happen, like a crash of pcscd.
	  
	  Thanks to Nikita Bige for the bug report
	  https://bugzilla.redhat.com/show_bug.cgi?id=904932

2013-01-21  Ludovic Rousseau

	* [r6511] src/spy/libpcscspy.c: Explicitly ignore the result of
	  write(2)
	  
	  Even if write(2) fails the show must go on. The spy log may get
	  corrupted but we can't do much better.

2013-01-16  Ludovic Rousseau

	* [r6505] ChangeLog, configure.ac: Release 1.8.8
	* [r6504] src/tokenparser.l: Convert all the &amp; in &, not just
	  the first occurence
	  
	  Reader names may use more than one "&" character.
	* [r6503] src/tokenparser.l: Correctly terminate reader names
	  containing a & sign
	  
	  The & is a &amp; in the Info.plist XML file and converted back to
	  & by the Lexer. Unfortunately the string was not correctly
	  terminated and the 4 last characters of the reader name were
	  duplicated.
	  
	  Thanks to Philippe Teuwen for the bug report.

2013-01-15  Ludovic Rousseau

	* [r6502] src/tokenparser.l: Fix a typo in comment
	* [r6501] src/configfile.l: Correctly calculate the FRIENDLYNAME
	  field string size
	  
	  If the FRIENDLYNAME field is NOT delimited by " then the string
	  length was wrong and a buffer overflow occured.
	  
	  Thanks to Alan Kozlay for the bug report and patch
	* [r6500] src/configfile.l: Move the variable declaration near
	  there use site
	  
	  Also - change the type from int to size_t for strlen() results -
	  initialize the values in the for() loop

2012-11-28  Ludovic Rousseau

	* [r6490] ChangeLog, configure.ac: Release 1.8.7
	* [r6489] ChangeLog: Fix typos

2012-10-22  Ludovic Rousseau

	* [r6477] .: Ignore some new files
	  
	  svn propedit svn:ignore .
	* [r6476] etc, m4, src/spy: Ignore some new files
	  
	  svn propedit svn:ignore .

2012-10-04  Ludovic Rousseau

	* [r6468] configure.ac, configure.in: Rename configure.in in
	  configure.ac
	  
	  aclocal: warning: autoconf input should be named 'configure.ac',
	  not 'configure.in'

2012-09-13  Ludovic Rousseau

	* [r6463] src/readerfactory.c: FCreateReaderHandle(): unref a
	  reader when needed
	  
	  We should call UNREF_READER() only if RFReaderInfoById() returned
	  with success. Fix a bug introduced in revision 6459.
	* [r6462] src/winscard_svc.c: MSGRemoveContext(): Unref the reader
	  
	  RFReaderInfoById() is called and implicitely increase the reader
	  reference count. So we shall call UNREF_READER() before exiting.
	* [r6461] src/readerfactory.c: RFCreateReaderHandle(): reorganize
	  code
	  
	  Move a variable declaration to the inner block using the
	  variable.
	* [r6460] src/readerfactory.c: Remove extra ;
	  
	  UNREF_READER() is a { } block in a macro
	* [r6459] src/readerfactory.c: RFCreateReaderHandle(): Unref the
	  reader is the handle is already used
	  
	  The function RFCreateReaderHandle() checks if a handle is already
	  used by calling RFReaderInfoById() to find the associated reader.
	  
	  So if RFReaderInfoById() returns with success then the handle is
	  valid and can't be used. A new random handle must be generated.
	  
	  But since RFReaderInfoById() called REF_READER() internally we
	  must call UNREF_READER() to decrement the reference counter.
	* [r6458] src/readerfactory.h: Make hLockId field volatile
	  
	  The ReaderContext structure is accessed from different pcscd
	  threads. To prevent the compiler to optimise read access to the
	  hLockId field we make it volatile.
	  
	  That may be the source of a problem when a reader is removed but
	  pcscd do not behave correctly.
	  
	  Thanks to Torsten Hilbrich for the idea.
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q3/0086.html

2012-08-30  Ludovic Rousseau

	* [r6451] Makefile.am, configure.in, m4/acx_pthread.m4,
	  m4/ax_pthread.m4: USe ax_pthread.m4 instead of acx_pthread.m4
	  
	  Fix "autoreconf -vis -Wall" warnings: configure.in:75: warning:
	  The macro `AC_LANG_SAVE' is obsolete. configure.in:75: You should
	  run autoupdate. ../../lib/autoconf/lang.m4:128: AC_LANG_SAVE is
	  expanded from... m4/acx_pthread.m4:275: ACX_PTHREAD is expanded
	  from... configure.in:75: the top level configure.in:75: warning:
	  The macro `AC_LANG_C' is obsolete. configure.in:75: You should
	  run autoupdate. ../../lib/autoconf/c.m4:72: AC_LANG_C is expanded
	  from... m4/acx_pthread.m4:275: ACX_PTHREAD is expanded from...
	* [r6450] ChangeLog, configure.in: Release 1.8.6

2012-08-24  Ludovic Rousseau

	* [r6447] src/readerfactory.c: RFCreateReaderHandle(): fix compiler
	  warning
	  
	  readerfactory.c: In function ‘RFCreateReaderHandle’:
	  readerfactory.c:1054: warning: unused parameter ‘rContext’
	  
	  Maybe the rContext will be used one day.
	* [r6446] src/pcscdaemon.c: Fix redirection of stdin, stdout and
	  stderr to /dev/null
	  
	  The file descriptors for stdin, stdout and stderr were closed so
	  any library (like libusb) sending debug log to stderr was
	  confusing pcscd since file descriptor 2 (ex stderr) was re-used
	  for something else.
	  
	  Now the file descriptor 3 is really redirected to /dev/null
	* [r6445] src/debuglog.c: Increase DEBUG_BUF_SIZE to avoid log
	  lines truncations
	  
	  Increase the value from 160 to 2048. Some "long" log lines where
	  truncated.
	  
	  Example: Aug 24 10:22:39 neo pcscd:
	  readerfactory.c:978:RFInitializeReader() Attempting startup of
	  Gemalto PC Twin Reader (70D7E2EE) 00 00 using
	  /usr/lib/pcsc/drivers/ifd-ccid.bundle/Contents/Lin
	* [r6444] src/readerfactory.c, src/winscard_clnt.c,
	  src/winscard_svc.c: Remove useless parenthesis
	  
	  Replace the constructions &(structure->field) by
	  &structure->field since that is equivalent.
	* [r6443] src/winscard_svc.c: MSGAddHandle(): Add mutex lock/unlock
	  around cardsList list
	  
	  A lock/unlock pair of mutex was missing.
	  
	  Thanks to Dmitry Torokhov <dtor@vmware.com> for the patch
	* [r6442] src/winscard_svc.c: CreateContextThread(): Use only one
	  lock/unlock pair
	  
	  It is quite often useless to lock a resource, perform
	  calculation, unlock the resource and then act conditionally upon
	  the result of the calculation, because as soon as shared resource
	  is unlocked the condition may change and the previous calculation
	  will become obsolete.
	  
	  Signed-off-by: Dmitry Torokhov <dtor@vmware.com>
	* [r6441] src/winscard_msg.c: ClientSetupSession(): use fcntl() to
	  make the socket non blocking
	  
	  ioctl(fd, FIONBIO. ...) is not the standard way of marking
	  sockets and other objects nonblocking, fcntl(fd, F_SETFL, flags |
	  O_NONBLOCK) is.
	  
	  Signed-off-by: Dmitry Torokhov <dtor@vmware.com>

2012-08-23  Ludovic Rousseau

	* [r6440] Makefile.am, configure.in, m4/Makefile.am: Integrate
	  m4/Makefile.am into Makefile.am
	  
	  The idea is to remove a Makefile files to speed up compilation.
	  
	  Thanks to Diego Elio Pettenò for the idea.
	* [r6439] Makefile.am: Reformat

2012-08-13  Ludovic Rousseau

	* [r6434] src/spy/pcsc-spy.pod: opensc-tool is not a good example
	  
	  opensc-tool is no more linked to libpcsclite.so.1. Use pcsc_scan
	  as an example instead.

2012-08-12  Ludovic Rousseau

	* [r6430] doc/update.sh: Script to uppload the Doxygen doc on the
	  web server

2012-08-08  Ludovic Rousseau

	* [r6419] src/spy/Makefile.am: Add -I$(top_builddir)/src/PCSC to
	  find the generated pcsclite.h
	  
	  Thanks to Dmitry Torokhov for the bug report and patch.
	* [r6414] src/winscard_clnt.c: Doxygen: fix warning: missing title
	  after \defgroup API
	* [r6413] src/PCSC/ifdhandler.h: Doxygen: fix warning: missing
	  title after \defgroup IFDHandler
	* [r6412] doc/doxygen.conf.in: Make doxygen quiet to only have
	  warnings and errors

2012-08-05  Ludovic Rousseau

	* [r6402] src/pcscdaemon.c: Exit if no hotplug (USB) drivers are
	  found _and_ serial drivers are not in use
	  
	  If only a serial driver is used and not drivers are present in
	  PCSCLITE_HP_DROPDIR then pcscd exited after logging:
	  hotplug_libudev.c:96:HPReadBundleValues() Cannot open PC/SC
	  drivers directory: /usr/lib64/readers/usb
	  
	  pcscd will now exit only if USE_SERIAL is not defined.
	  
	  Thanks to Oliver Schinagl for the bug report.

2012-08-04  Ludovic Rousseau

	* [r6401] ChangeLog, configure.in: Release 1.8.5
	* [r6400] src/winscard_clnt.c: Doxygen: Fix dwControlCode code
	  
	  Thanks to Marcin Cieslak for the bug report

2012-08-02  Ludovic Rousseau

	* [r6397] src/readerfactory.c, src/readerfactory.h: Merge
	  RFReaderInfoNamePort() into RFRemoveReader() since that is the
	  only user. Also improve RFRemoveReader() to remove all the slots
	  of a reader.
	  
	  Closes [#313708] Multi-slot support is broken
	  https://alioth.debian.org/tracker/index.php?func=detail&aid=313708&group_id=30105&atid=410085

2012-07-26  Ludovic Rousseau

	* [r6391] src/eventhandler.c, src/winscard.c: Fix typo in log
	  message

2012-07-05  Ludovic Rousseau

	* [r6389] src/readerfactory.h: REF_READER/UNREF_READER: Change log
	  level from CRITICAL to DEBUG
	  
	  No need to use the PCSC_LOG_CRITICAL level on a production
	  system.
	* [r6388] src/readerfactory.c, src/readerfactory.h, src/winscard.c:
	  Add a reader reference count to be used as a Garbage Collector
	  
	  A reader should be removed only when no one is using it, not just
	  when the reader is unplugged.
	  
	  An application may be in the middle of using the reader when the
	  reader is unplugged. If the reader is removed right when
	  unplugged then pcscd may use a no more existing reader structure
	  and crash.
	  
	  Thanks to Martin Vogt for the bug report.
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0041.html

2012-07-03  Ludovic Rousseau

	* [r6386] src/readerfactory.c: RFRemoveReader(): only remove one
	  reader
	  
	  We should not need to loop over every matching reader and remove
	  them all. Or I am missing something.
	  
	  This code is present since the first version of RFRemoveReader()
	  back in 2002.

2012-07-01  Ludovic Rousseau

	* [r6385] src/winscard_clnt.c: SCardBeginTransaction(): remove an
	  extra line
	  
	  The loop could be an infinite loop in case rv ==
	  SCARD_E_SHARING_VIOLATION but we get out of the for (;;) loop
	  exactly when rv != SCARD_E_SHARING_VIOLATION
	  
	  The bug was introduced in revision 6358.
	* [r6384] src/readerfactory.c: RFAddReader(): fix a off-by-one bug
	  
	  strlen() returnd the number of characters without the final NUL
	  byte.
	  
	  The bugs was introduced in revision 6354.
	* [r6383] src/pcscdaemon.c: Fix a TOCTOU problem
	  
	  Do not check for PCSCLITE_IPC_DIR presence before creating it.
	  Just create it and manage the case it already existed.
	  
	  Coverity: Time of check time of use (TOCTOU)
	* [r6382] src/spy/libpcscspy.c: spy_line(): move the call to
	  va_end(args); earlier
	  
	  In case the buffer is too small we exit the function without
	  calling va_end().
	  
	  Coverity: Missing varargs init or cleanup (VARARGS)

2012-06-29  Ludovic Rousseau

	* [r6380] src/hotplug_libudev.c: HPAddDevice(): check
	  udev_device_get_sysattr_value() is not NULL
	  
	  The value returned by udev_device_get_sysattr_value(dev,
	  "bInterfaceNumber") may be NULL (maybe the reader has been
	  removed just after been inserted). And atoi() do not like to work
	  on NULL.
	* [r6379] src/readerfactory.h: Fix comment
	* [r6378] src/winscard.c: SCardTransmit(): use an exit block
	  
	  goto exit; instead of a direct return rv;
	  
	  This will allow to factorize exit code.
	* [r6377] src/winscard.c: SCardSetAttrib(): use an exit block
	  
	  goto exit; instead of a direct return rv;
	  
	  This will allow to factorize exit code.
	* [r6376] src/winscard.c: SCardGetAttrib(): use an exit block
	  
	  goto exit; instead of a direct return.
	  
	  This will allow to factorize exit code.
	* [r6375] src/winscard.c: SCardControl(): use an exit block
	  
	  goto exit; instead of a direct return.
	  
	  This will allow to factorize exit code.
	* [r6374] src/winscard.c: SCardStatus(): use an exit block
	  
	  goto exit; instead of a direct return rv;
	  
	  This will allow to factorize exit code.
	* [r6373] src/winscard.c: SCardEndTransaction(): use an exit block
	  
	  goto exit; instead of a direct return rv;
	  
	  This will allow to factorize exit code.
	* [r6372] src/winscard.c: SCardBeginTransaction(): use an exit
	  block
	  
	  goto exit; instead of a direct return SCARD_E_*;
	  
	  This will allow to factorize exit code.
	* [r6371] src/winscard.c: SCardDisconnect(): use an exit block
	  
	  goto exit; instead of a direct return SCARD_E_*;
	  
	  This will allow to factorize exit code.
	* [r6370] src/winscard.c: SCardReconnect(): code reformat
	* [r6369] src/winscard.c: SCardReconnect(): use an exit block
	  
	  goto exit; instead of a direct return SCARD_E_*;
	  
	  This will allow to factorize exit code.
	* [r6368] src/winscard.c: SCardConnect(): use an exit bloc
	  
	  goto exit; instead of a direct return SCARD_E_*;
	  
	  This will allow to factorize exit code.
	* [r6367] src/winscard.c: SCardDisconnect(): check the parameters
	  before anything
	  
	  Do not lose time finding the rContext if the dwDisposition
	  parameter is wrong. Exit early.

2012-06-26  Ludovic Rousseau

	* [r6366] doc/doxygen.conf.in: Update to Doxygen 1.8.1.1
	* [r6364] ChangeLog, configure.in: Release 1.8.4
	* [r6363] UnitaryTests/SCardBeginTransaction_deadlock.py: Unitary
	  test for locking in SCardBeginTransaction, SCardTransmit,
	  SCardStatus and SCardReconnect
	* [r6362] src/winscard_clnt.c: With changes in revisions 6358 to
	  6361 it is now possible to use the same SCARDCONTEXT in different
	  threads (same as on Windows)
	  
	  With one context per thread the locking was controlled by the
	  daemon. With the same context for 2 threads the locking is
	  controlled (first) on the client side since the 2 threads uses
	  the same mutex.
	* [r6361] src/winscard_clnt.c: Similar patch as in revision 6358
	  but for SCardReconnect()
	  
	  Thanks to Aleksey Samsonov for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0109.html
	* [r6360] src/winscard_clnt.c: Similar patch as in revision 6358
	  but for SCardBeginTransaction()
	  
	  Thanks to Aleksey Samsonov for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0109.html
	* [r6359] src/winscard_clnt.c: SCardStatus(): Similar patch as in
	  revision 6358 but for SCardStatus()
	  
	  Thanks to Aleksey Samsonov for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0109.html
	* [r6358] src/winscard_clnt.c: SCardTransmit(): do not hold the
	  mutex when waiting in a SCARD_E_SHARING_VIOLATION loop
	  
	  If SCardTransmit() is waiting because the reader is used by
	  another thread/process then we release the
	  currentContextMap->mMutex, sleep, and try to acquire the mutex
	  again. This will allow another thread using the same hContext to
	  call SCardEndTransaction() otherwise the mutex is already held by
	  SCardTransmit() and SCardEndTransaction() can't get it to finish
	  the transaction => dead lock
	  
	  Thanks to Aleksey Samsonov for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0109.html

2012-06-25  Ludovic Rousseau

	* [r6357] src/PCSC/ifdhandler.h: Update Doxygen: document
	  "libusb-1.0" scheme
	  
	  the "libusb" (for libusb-0.1) scheme has been updated to a
	  "libusb-1.0" scheme (for libusb-1.0). The device name now
	  contains the interface number. The bus and device are now
	  integers instead of paths.
	  
	  The change has been done in revision 5044 (June 2010) but the API
	  was not updated at the same time.
	* [r6356] src/readerfactory.c: RFReaderInfoNamePort(): Compare only
	  the significant part of the reader name
	  
	  Since revision 6354 the reader name may be truncated. Only the
	  part in readerState->readerName (managed by RFAddReader()) is
	  truntacted. The reader name stored the hotplug_*.c
	  readerTracker[] structures is NOT truncated. So we must use a
	  truncated compare function to find the reader name.
	* [r6355] src/PCSC/pcsclite.h.in: Increase MAX_READERNAME from 100
	  to 128
	  
	  It is not a perfect solution but it should limit the truncations
	  of reader names as introduced in revision 6354.
	* [r6354] src/readerfactory.c: RFAddReader(): truncates the reader
	  name if too long
	  
	  The reader name size is limited to a total of MAX_READERNAME
	  characters (100 by default). But some reader names are very long
	  like: "SCM Microsystems Inc. SCR3340 - ExpressCard54 Smart Card
	  Reader" and also provide a serial number and an interface name.
	  So the name constructed by hotplug_libudev.c can be very long and
	  longer than the 100 caracters.
	  
	  Closes: [#313684] "Reader name too long" error
	  https://alioth.debian.org/tracker/?func=detail&atid=410085&aid=313684&group_id=30105
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0113.html
	* [r6353] src/hotplug_libudev.c: HPRescanUsbBus(): Display the full
	  name of the removed reader

2012-06-06  Ludovic Rousseau

	* [r6325] src/tokenparser.l: Add [ and ] in the list of accepted
	  characters for a reader name
	  
	  Readers with these characters caused a crash in libccid without
	  any error message. This is because the reader entry was skiped
	  and a reader name was then missing in the list. NULL is not a
	  valid reader name :-)
	  
	  Thanks to Philippe Teuwen for the bug report.

2012-06-05  Ludovic Rousseau

	* [r6323] src/pcscd.h.in: Remove now useless PCSCLITE_SVC_IDENTITY
	  
	  PCSCLITE_SVC_IDENTITY is no more used since revision 6322.
	* [r6322] src/winscard.c: SCardEstablishContext(): Use a full
	  32-bits random value
	  
	  Use a full int range (32-bits) value instead of a 16-bits value.
	  
	  Note: this value is (still) not used/checked on the server side.
	* [r6321] src/readerfactory.c, src/readerfactory.h: remove
	  dwIdentity field from ReaderContext structure
	  
	  Since revision 6320 dwIdentity is no more used. So we can remove
	  it.
	* [r6320] src/readerfactory.c: RFCreateReaderHandle(): generates a
	  32-bits random for hCard
	  
	  Since the change in revision 6316 dwIdentity is no more used to
	  identify a hCard -> reader relation. So we can just generate a
	  hCard as a full 32-bits random.
	  
	  The security should be improved with a change from 16-bits random
	  to a 32-bits random. It will be more difficult for a rogue client
	  to guess a valid hCard value.
	* [r6319] src/sys_unix.c: SYS_RandomInt(): extend range if fEnd ==
	  -1
	  
	  If fEnd parameter is set to -1 then the result of rand() is not
	  truncated. This is usefull to get 32-bits of random with no
	  constraint on the values.
	* [r6318] src/readerfactory.c, src/readerfactory.h: Remove now
	  unused function RFFindReaderHandle()
	  
	  Since revision 6317 this function is no more used.
	* [r6317] src/winscard.c: Calls to RFFindReaderHandle() are now
	  useless
	  
	  RFFindReaderHandle() was used to check the hCard is valid. Since
	  revision 6316 the algorithm used in RFFindReaderHandle() is
	  already used in RFReaderInfoById().
	  
	  So calling RFFindReaderHandle() after RFReaderInfoById() (as it
	  was done) is now useless.
	* [r6316] src/readerfactory.c, src/readerfactory.h: Use handlesList
	  to find a hCard -> reader link
	  
	  hCard handles are stored in the handlesList list of readers. The
	  use of dwIdentity just duplicate the information and is no more
	  needed.
	  
	  The algorithm is the same as in RFFindReaderHandle()

2012-06-02  Ludovic Rousseau

	* [r6315] src/ifdwrapper.c: Fix compiler failure for static driver
	  
	  CFLAGS="-DPCSCLITE_STATIC_DRIVER -DIFDHANDLERv3" ./configure make
	  [...] ifdwrapper.c: In function ‘IFDOpenIFD’:
	  ifdwrapper.c:125:15: error: ‘READER_CONTEXT’ has no member named
	  ‘lpcDevice’ ifdwrapper.c:126:57: error: ‘READER_CONTEXT’ has no
	  member named ‘lpcDevice’

2012-05-28  Ludovic Rousseau

	* [r6312] src/ifdwrapper.c: IFDPowerICC(): check the value returned
	  by IFDStatusICC()
	  
	  The reader may be gone at this step. See
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0041.html

2012-05-18  Ludovic Rousseau

	* [r6302] src/PCSC/ifdhandler.h: Remove an extra '.' at the end of
	  the URL
	  
	  Thanks to "helpcrypto" for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q2/0036.html
	* [r6299] configure.in: warning: 'libpcsclite.la': linking libtool
	  libraries using a non-POSIX archiver requires 'AM_PROG_AR' in
	  'configure.in'
	* [r6298] configure.in: autoupdated using autoupdate (GNU Autoconf)
	  2.69

2012-04-05  Ludovic Rousseau

	* [r6261] UnitaryTests/FEATURE_GET_TLV_PROPERTIES.py: Unitary test
	  for FEATURE_GET_TLV_PROPERTIES

2012-04-04  Ludovic Rousseau

	* [r6256]
	  UnitaryTests/FEATURE_CCID_ESC_COMMAND_Gemalto_features.py: Catch
	  control() exception
	  
	  If the driver is not configured with
	  DRIVER_OPTION_CCID_EXCHANGE_AUTHORIZED then the control() will
	  fail with a SmartcardException() exception.

2012-03-30  Ludovic Rousseau

	* [r6253] ChangeLog, configure.in: Release 1.8.3

2012-03-25  Ludovic Rousseau

	* [r6249] UnitaryTests/FEATURE_CCID_ESC_COMMAND.py: This file is
	  now more or less a duplicate of
	  FEATURE_CCID_ESC_COMMAND_Xiring.py
	  
	  So remove it.
	* [r6248] UnitaryTests/FEATURE_CCID_ESC_COMMAND_Xiring.py: Add
	  GET_SN command and some documentation

2012-03-24  Ludovic Rousseau

	* [r6247] UnitaryTests/FEATURE_CCID_ESC_COMMAND_Xiring.py: Unitary
	  test for FEATURE_CCID_ESC_COMMAND and Xiring Leo readers
	* [r6246] UnitaryTests/FEATURE_CCID_ESC_COMMAND2.py,
	  UnitaryTests/FEATURE_CCID_ESC_COMMAND_Gemalto_features.py: Rename
	  FEATURE_CCID_ESC_COMMAND2.py in
	  FEATURE_CCID_ESC_COMMAND_Gemalto_features.p

2012-03-23  Ludovic Rousseau

	* [r6244] UnitaryTests/control_get_firmware.py: Use
	  getTlvProperties() and PCSCv2_PART10_PROPERTY_wIdVendor
	  
	  We now check the reader is a Gemalto one before sending an escape
	  code

2012-03-20  Ludovic Rousseau

	* [r6241] src/PCSC/reader.h: Add new properties for
	  FEATURE_GET_TLV_PROPERTIES
	  
	  dwMaxAPDUDataSize, wIdVendor and wIdProduct are/will be defined
	  in PCSC v2 part 10 release 2.02.09

2012-02-28  Ludovic Rousseau

	* [r6236] src/spy/pcsc-spy: _SCardControl(): parse the received
	  buffer only on success
	  
	  The received buffer (answer) is valid only if the command
	  execution succeeded.
	* [r6235] src/spy/pcsc-spy: Add support of SCardControl132 for OS X
	* [r6234] src/spy/libpcscspy.c: Fix compiler warning on OS X
	  
	  libpcscspy.c:580: warning: no previous prototype for
	  'SCardControl132'

2012-02-21  Ludovic Rousseau

	* [r6229] src/debuglog.c: log_xxd(): do not log with negative
	  length
	  
	  Thanks to Godfrey Chung for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2012-q1/0043.html

2012-02-04  Ludovic Rousseau

	* [r6215] src/configfile.l: Skip non regular or "hidden" config
	  files
	  
	  Closes Debian bug #658322 "pcscd: fails to start if config
	  directory contains subdirectories"

2012-01-24  Ludovic Rousseau

	* [r6201] src/spy/pcsc-spy.pod: Document usage on Mac OS X
	* [r6200] src/spy/libpcscspy.c: Mac OS X uses SCardControl132
	  instead of SCardControl
	  
	  On Mac OS X SCardControl() is used for the old version of the API
	  (without the dwControlCode) and SCardControl132() for the new
	  API.
	  
	  From /System/Library/Frameworks/PCSC.framework/Headers/winscard.h
	  /* To support the newer version of SCardControl, we define it as
	  follows. The old version number was 1.1.2, the new call appears
	  in 1.3.2 of pcsc-lite (or perhaps earlier). */
	  
	  #if !defined(USE_SCARD_CONTROL_112) #define SCardControl
	  SCardControl132 #endif /* USE_SCARD_CONTROL_112 */
	* [r6199] src/spy/Makefile.am: Generate a Mac OS X PCSC.framework
	  hierarchy
	  
	  Mac OS X uses a framework and not just a library. The hiearchy is
	  simple: PCSC.framework PCSC.framework/PCSC ->
	  Versions/Current/PCS PCSC.framework/Versions
	  PCSC.framework/Versions/A PCSC.framework/Versions/A/PCSC
	  PCSC.framework/Versions/Current -> A
	* [r6198] src/spy/libpcscspy.c: Add Mac OS X support
	* [r6197] src/spy/libpcscspy.c: Use ULONG * instead of unsigned
	  long *
	  
	  See comment in revision 6195
	* [r6196] src/spy/libpcscspy.c: Reformat
	* [r6195] src/spy/libpcscspy.c: Use LONG/ULONG instead of
	  long/unsigned long
	  
	  The problem is that PCSC on Mac OS X do not use long but
	  uint32_t. So a (LONG * or LPDWORD *) parameter (like pcchReaders
	  in SCardListReaders) is not the same on Linux and Mac OS X for
	  64-bits CPUs.
	  
	  LONG is correctly defined on both Linux and Mac OS X so we use it
	  instead.
	* [r6194] src/spy/libpcscspy.c: load_lib(): check dlsym() return
	  correct values
	  
	  If the pointer returned by dlsym("SCardEstablishContext") is our
	  own SCardEstablishContext() function then we will finish in a
	  endless recursion. Something went wrong and we stop immediatly
	  instead of crashing when the call stack is full.
	* [r6193] src/spy/libpcscspy.c: Use an internal
	  pcsc_stringify_error() by default
	  
	  If the loading of the PCSC library fails all the functions are
	  set to use internal_error(). The only expection is now
	  pcsc_stringify_error() because the return value is not a LONG
	  error code but a C-string.
	  
	  This change fixes a crash when the application called printf() to
	  display the "string" returned by pcsc_stringify_error() if
	  SCardEstablishContext() failed in the spying library.

2012-01-18  Ludovic Rousseau

	* [r6185] ChangeLog, configure.in: Release 1.8.2
	* [r6184] src/spy/pcsc-spy, src/spy/pcsc-spy.pod: Add support of
	  --version to pcsc-spy
	* [r6183] src/spy/Makefile.am, src/spy/pcsc-spy.1,
	  src/spy/pcsc-spy.pod: Use POD format for pcsc-spy manpage
	  
	  Writting nroff manpage directly is not easy. The Perl POD (plain
	  old documentation) is much more friendly to read/write and
	  pod2man is your friend.
	* [r6182] src/spy/pcsc-spy: print_usage(): display command name
	* [r6181] src/spy/pcsc-spy: Document [-h|--help] argument

2012-01-15  Ludovic Rousseau

	* [r6178] src/spy/Makefile.am: Use dist_man_MANS to distribute the
	  manpage
	  
	  The pcsc-spy.1 manpage is now included in the .tar.bz2 archive
	* [r6177] src/spy/Makefile.am, src/spy/libpcscspy.c,
	  src/spy/pcsc-spy.c: Rename pcsc-spy.c to libpcscspy.c
	  
	  We have a pcsc-spy Python binary so pcsc-spy.c is not a correct
	  filename for a different library. Make is trying to generate
	  pcsc-spy from pcsc-spy.c and that fails.
	* [r6176] src/spy/Makefile.am: Remove pcsc-spy.py from EXTRA_DIST
	  
	  The command is now named pcsc-spy and is distributed by default
	* [r6175] src/spy/Makefile.am, src/spy/README.txt,
	  src/spy/pcsc-spy.1: Convert README.txt into pcsc-spy.1
	  
	  Since we now provide the pcsc-spy binary we must also provide a
	  manpage for the command.
	* [r6174] src/spy/pcsc-spy: Update copyright date
	* [r6173] src/spy/pcsc-spy: Change Shebang to /usr/bin/python
	  
	  Comply with Debian Python Policy 3.1 Programs using the default
	  python
	  http://www.debian.org/doc/packaging-manuals/python-policy/ch-programs.html
	* [r6172] src/spy/Makefile.am: Install pcsc-spy as a normal binary
	  
	  By default the command is installed in $(prefix)/bin/pcsc-spy
	* [r6171] src/spy/pcsc-spy, src/spy/pcsc-spy.py: Rename the
	  pcsc-spy command without the .py extension
	  
	  Comply to Debian Policy 10.4 Scripts
	  http://www.debian.org/doc/debian-policy/ch-files.html#s-scripts

2012-01-01  Ludovic Rousseau

	* [r6156] src/PCSC/ifdhandler.h: Add Doxygen documentation for
	  TAG_IFD_SLOTNUM, TAG_IFD_STOP_POLLING_THREAD and
	  TAG_IFD_POLLING_THREAD_WITH_TIMEOUT

2011-12-15  Ludovic Rousseau

	* [r6139] src/spy/pcsc-spy.c: spy_line(): use return instead of
	  exit().
	  
	  A library should not use exit() but return an error code instead.
	  Reported by Debian lintian.

2011-12-05  Ludovic Rousseau

	* [r6132] src/tokenparser.l: bundleRelease(): fix a memory leak
	  
	  We must also free the key of the element.
	* [r6131] src/tokenparser.l: eval_value(): avoid a buffer read
	  overflow in &amp; management
	  
	  We shall stop the loop when we find a \0 in the source, not in
	  the destination (4 characters later)
	* [r6130] src/hotplug_libudev.c: HPReadBundleValues(): remove extra
	  free()
	  
	  Do not free memory allocated for CFBundleName since we use this
	  value directly in driverTracker[listCount].CFBundleName =
	  CFBundleName; (line 180) instead of using a strdup(), because the
	  string is the same for many entries
	* [r6129] src/readerfactory.c: RFRemoveReader(): add 2 missing
	  pthread_mutex_destroy()
	  
	  Mutexes for powerState_lock and handlesList_lock were never
	  destroyed.
	  
	  It was not a real problem since from manpage
	  pthread_mutex_destroy(3): In the LinuxThreads implementation, no
	  resources are associated with mutex objects, thus
	  pthread_mutex_destroy actually does nothing except checking that
	  the mutex is unlocked.
	* [r6128] src/readerfactory.c: RFRemoveReader(): fix a bug with a
	  multi-slot reader
	  
	  The value sContext->mMutex must be reset to NULL only for the
	  last slot.

2011-11-26  Ludovic Rousseau

	* [r6120] etc/pcscd.service.in: StandardOutput=syslog is now the
	  default since at least systemd 37

2011-11-25  Ludovic Rousseau

	* [r6118] ChangeLog, configure.in: Release 1.8.1
	* [r6117] src/spy/Makefile.am: Also distribute pcsc-spy.py
	  install_spy.sh uninstall_spy.sh README.txt

2011-11-19  Ludovic Rousseau

	* [r6111] ChangeLog, configure.in: Release 1.8.0
	* [r6110] src/PCSC/reader.h: Add FEATURE_EXECUTE_PACE from PCSC v2
	  Part 10 Amendment 1 2011-06-03

2011-11-18  Ludovic Rousseau

	* [r6109] UnitaryTests/FEATURE_CCID_ESC_COMMAND2.py: Proprietary
	  commands for Gemalto readers This is implemented by the Gemalto
	  Pinpad v2 and C200 readers
	* [r6108] src/spy/pcsc-spy.py: Terminate the process with Ctrl-C
	  
	  Thanks to Martin Paljak for the patch
	* [r6107] src/spy/README.txt: Typo

2011-11-14  Ludovic Rousseau

	* [r6105] configure.in, src/pcscdaemon.c, src/winscard_clnt.c:
	  Remove pcscd autostart feature
	  
	  The auto start feature (launch pcscd from the library if not
	  already running) was a fragile code with some issues. This
	  service is far better implemented by systemd.
	  
	  Thanks to Kalev Lember for pushing the systemd patches.

2011-11-11  Ludovic Rousseau

	* [r6104] src/winscard_clnt.c: Do not try to autostart if the
	  system was booted using systemd
	  
	  The --disable-autostart configure option should now be useless on
	  systems using systemd.

2011-11-10  Ludovic Rousseau

	* [r6102] src/pcscdaemon.c: Revert revision 6045
	  
	  We must fork+exit in autoexit and foreground mode or the
	  application will not continue its execution and will wait for the
	  end of pcscd

2011-10-31  Ludovic Rousseau

	* [r6095] src/spy/pcsc-spy.py: Add support of -d|--diffable to
	  generate logs without too much variable parts so 2 logs can be
	  compared using diff(1)
	  
	  Variable parts are replaced by "????". They are: - execution time
	  - hCard - hContext
	* [r6094] src/spy/pcsc-spy.py: Fix cut-n-paste error
	* [r6093] src/spy/pcsc-spy.py: Add support of --nocolor command
	  line argument
	* [r6092] src/spy/install_spy.sh: Make the script idempotent
	  
	  The symbolic links are repared if needed. They were broken after
	  the sequence: $ spy/install_spy.sh $ make install
	* [r6091] src/spy/pcsc-spy.py: Exit in exception if the application
	  exited in the middle of SCardGetStatusChange() like it is the
	  case for pcsc_scan

2011-10-30  Ludovic Rousseau

	* [r6090] src/tokenparser.l: Convert the firt &amp; into & in a
	  
	  Allow to use names like Giesecke &amp; Devrient
	* [r6089] src/tokenparser.l: Add ';' in the list of valid caracters
	  
	  Allow to use "&amp;" for "&" like in "Giesecke &amp; Devrient"
	  See revision 6088

2011-10-25  Ludovic Rousseau

	* [r6083] UnitaryTests/ThreadSafe.py: Start loops at 0 instead of 1
	  to have the correct count
	* [r6082] src/spy/pcsc-spy.py: Give statistics per thread
	* [r6081] .gitignore: Update for spy/ directory
	* [r6080] src/spy/pcsc-spy.py: Use a 4 spaces indentation for each
	  thread
	* [r6079] src/spy/pcsc-spy.py: Display statistics sorted by
	  total_time

2011-10-24  Ludovic Rousseau

	* [r6078] src/spy/pcsc-spy.py: Parse FEATURE_VERIFY_PIN_DIRECT
	  structure
	* [r6077] src/spy/pcsc-spy.py: The byte buffer do not contain the
	  ASCII dump any more. So no need to remove it.
	* [r6076] src/spy/pcsc-spy.py: Parse FEATURE_IFD_PIN_PROPERTIES
	* [r6073] src/spy/pcsc-spy.py: Remove debug line
	* [r6072] src/pcscdaemon.c: main(): do not fail if pcscd.comm is
	  already present but pcscd.pid is not present.
	  
	  This is the case if pcscd has been configured in systemd but has
	  been stoped. When launched by hand (for a debug session for
	  example) the pcscd.comm file is still present but not used
	  anymore.
	  
	  The pcscd.comm file will be removed when pcscd manually started
	  will exit but the file will be recreated by "systemctl start
	  pcscd.service"
	* [r6071] src/pcscd.h.in: Update copyright date
	* [r6070] src/pcscd.h.in: propset svn:keywords "Id"
	* [r6069] src/pcscd.h.in: MAX_BUFFER_SIZE and
	  MAX_BUFFER_SIZE_EXTENDED are already defined in
	  PCSC/pcsclite.h.in

2011-10-22  Ludovic Rousseau

	* [r6063] src/PCSC/pcsclite.h.in: Update MAX_BUFFER_SIZE_EXTENDED
	  by adding 2 bytes for the status word
	* [r6062] etc/pcscd.service.in: Remove WantedBy=multi-user.target
	  
	  The purpose of using systemd is to start pcscd on demand. So no
	  need to always start it at boot.
	* [r6061] etc/pcscd.service.in: Start pcscd in autoexit mode to: -
	  free RAM and CPU ressources - enable the USB selective suspend
	  http://ludovicrousseau.blogspot.com/2011/04/libccid-and-usb-selective-suspend.html
	* [r6060] etc/pcscd.service.in: Remove now useless
	  After=syslog.target line for recent systemd

2011-10-21  Ludovic Rousseau

	* [r6059] src/spy/pcsc-spy.py: support -n | --nocolor command line
	  argument to remove colorization
	* [r6058] src/spy/pcsc-spy.py: Remove debug line
	* [r6057] src/simclist.c, src/simclist.h: Upgrade from simclist 1.5
	  to 1.6

2011-10-20  Ludovic Rousseau

	* [r6056] src/winscard_clnt.c: Remove DO_CHECK_SAME_PROCESS code
	  since we now use pthread_atfork() since revision 6055
	* [r6055] src/winscard_clnt.c: SCardEstablishContext(): Invalidate
	  all the handles in the son after a fork
	  
	  The Unitary Test UnitaryTests/SCard_fork.py now works
	  
	  We now use pthread_atfork() instead of the DO_CHECK_SAME_PROCESS
	  hack (disabled by default)
	* [r6054] src/spy/pcsc-spy.py: log_out_n_str(): add special case
	  for a null string length
	* [r6053] src/spy/README.txt: Documentation file
	* [r6052] src/spy/pcsc-spy.c, src/spy/pcsc-spy.py: Add support of
	  SCardCancel() and multi-threaded applications
	  
	  The pcsc-spy.py client is now a demultiplexer with one thread and
	  data queue per applicatin thread. Each log line contains the
	  application threadID.
	* [r6051] src/spy/install_spy.sh, src/spy/uninstall_spy.sh: Use set
	  -e to exit on first error
	* [r6050] src/spy/install_spy.sh: Fail if libpcsclite_nospy.so.1
	  already exists

2011-10-15  Ludovic Rousseau

	* [r6045] src/pcscdaemon.c: main(): do not fork+exit if we are in
	  autoexit mode and also in foreground mode
	* [r6044] src/pcscdaemon.c: signal_trap(): if we exit after a
	  SIGALRM then exit with EXIT_SUCCESS
	  
	  systemd should be happier with a process exiting normally
	* [r6043] src/winscard_msg_srv.c: InitializeSocket(): use a union
	  for sockaddr structsas suggested by systemd sample code at
	  http://0pointer.de/blog/projects/socket-activation.html
	* [r6042] src/spy/pcsc-spy.c: Use a global symbol for the library
	  handle
	  
	  Make coverity more happy leaked_storage: Variable "handle" going
	  out of scope leaks the storage it points to. noescape: Variable
	  "handle" is not freed or pointed-to in function "dlsym".

2011-10-11  Ludovic Rousseau

	* [r6029] src/pcscdaemon.c: main(): do not fork+exit if started in
	  --auto-exit mode by systemd
	  
	  systemd should restart the daemon again if needed
	* [r6028] src/debuglog.c: log_line(): flush stdout after each line
	  so that debug messages are immediately available for systemd
	* [r6027] src/pcscdaemon.c: main(): store the pid _after_ any fork
	  
	  Revision 6019 moved the AutoExit fork+exit later in the code. We
	  now must move the pcscd.pid file creation after the fork+exit.
	* [r6026] src/pcscdaemon.c: main(): log a message when pcscd is
	  started by systemd

2011-10-07  Ludovic Rousseau

	* [r6019] src/pcscdaemon.c: main(): move AutoExit fork+exit later
	  in the code
	  
	  We should be able to return with an error code if something went
	  wrong in the pcscd initialization so that the client get the
	  error code and do not wait for 5 seconds.
	  
	  See Red Hat Bug 653903 - elinks takes 10 seconds to start
	* [r6018] src/winscard_clnt.c: SCardEstablishContext(): check the
	  return value of pcscd
	  
	  In auto-start mode the client check the value returned by pcscd.
	  If pcscd failed to start then we just return SCARD_E_NO_SERVICE
	  without waiting for 5 seconds.
	  
	  See Red Hat Bug 653903 - elinks takes 10 seconds to start
	* [r6017] src/pcscdaemon.c: print_usage(): reformat output
	* [r6016] src/winscard_clnt.c: SCardEstablishContext(): If the
	  daemon is not present then just fail without waiting.
	  
	  See Red Hat Bug 653903 - elinks takes 10 seconds to start
	  https://bugzilla.redhat.com/show_bug.cgi?id=653903
	* [r6015] src/spy/pcsc-spy.py: log_buffer(): display NULL if the
	  buffer is a NULL pointer
	  
	  This is used to differentiate a NULL buffer from an empty buffer.
	* [r6014] src/spy/pcsc-spy.py: log_buffer(): use upper case for
	  hexadecimal dump
	* [r6013] src/spy/pcsc-spy.py: log_buffer(): use '.' also for
	  values >= 127
	* [r6012] src/spy/pcsc-spy.py: log_buffer(): check for an empty
	  buffer
	* [r6011] src/spy/pcsc-spy.py: If the field to log starts with a
	  "0x" we also log the decimal value
	* [r6010] src/spy/pcsc-spy.c: spy_buffer(): use spy_line_direct()
	  to log a line without formatting and size limit
	* [r6009] src/spy/pcsc-spy.c: spy_line(): Emergency exit if the
	  buffer is too small
	  
	  The line is limited to 256 characters. Dumping a buffer of more
	  than 256/3 = 85 bytes wil overflow the line buffer.
	* [r6008] src/spy/install_spy.sh, src/spy/pcsc-spy.c,
	  src/spy/uninstall_spy.sh: Allow to replace the real library by
	  the spy one
	  
	  This is isefull for interpreted languages like Python and Perl
	  with the PC/SC wrapper.
	  
	  The scripts install_spy.sh and uninstall_spy.sh do the files
	  changes in /usr/lib
	* [r6007] src/spy/pcsc-spy.py: Remove trailing space
	* [r6006] src/spy/pcsc-spy.py: Use a text instead of numerical
	  constant to specify the direction
	* [r6005] src/spy/pcsc-spy.c, src/spy/pcsc-spy.py: Dump bytes
	  buffer in a formatted ASCII + Hex dump

2011-10-05  Ludovic Rousseau

	* [r6003] doc/example/pcsc_demo.c: Move from GNU GPL v2+ to v3+
	* [r6002] UnitaryTests/MCT_ReaderDirect.py,
	  UnitaryTests/SCardBeginTransaction_Disconnect.py,
	  UnitaryTests/SCardBeginTransaction_ExclusiceMode.py,
	  UnitaryTests/SCardCancel.py, UnitaryTests/SCardCancel2.py,
	  UnitaryTests/SCardConnect_DIRECT.py,
	  UnitaryTests/SCardConnect_DIRECT2.py,
	  UnitaryTests/SCardGetAttrib.py,
	  UnitaryTests/SCardGetStatusChange.py,
	  UnitaryTests/SCardGetStatusChange2.py,
	  UnitaryTests/SCardReconnect.py, UnitaryTests/SCardStatus.py,
	  UnitaryTests/SCard_fork.py, UnitaryTests/ThreadSafe.py,
	  UnitaryTests/ThreadSafeConnect.py,
	  UnitaryTests/control_get_firmware.py,
	  UnitaryTests/control_switch_interface.py,
	  UnitaryTests/getAttrib.py, UnitaryTests/reset_card.py,
	  UnitaryTests/stress_apdu.py, UnitaryTests/stress_get_firmware.py,
	  UnitaryTests/transmit_loop.py: Move from GPL v2+ to GPL v3+
	* [r6001] UnitaryTests/FEATURE_CCID_ESC_COMMAND.py: Unitary test
	  for FEATURE_CCID_ESC_COMMAND

2011-10-04  Ludovic Rousseau

	* [r5999] src/spy/Makefile.am: The winscard.h is in the srcdir not
	  builddir
	  
	  Fix compiler warning (when using make distcheck):
	  ../../../src/spy/pcsc-spy.c:32:22: fatal error: winscard.h: No
	  such file or directory
	* [r5997] src/spy/pcsc-spy.py: Use the command line argument (if
	  any) as the log file
	  
	  If a command argument is passed we use it instead of the default
	  ~/pcsc-spy FIFO file. It is then possible to record an execution
	  log and use pcsc-spy.py multiple times on the same log.
	  
	  To create the log file just do: $ mkfifo ~/pcsc-spy $ cat
	  ~/pcsc-spy > logfile and run your PC/SC application
	* [r5996] src/spy/pcsc-spy.py: Make pep8 happy
	* [r5995] src/spy/pcsc-spy.py: Parse FEATURE_GET_TLV_PROPERTIES
	  results
	* [r5994] src/spy/pcsc-spy.py: Parse tge
	  CM_IOCTL_GET_FEATURE_REQUEST results
	  
	  The parsing will also learn the values associate to tags for
	  future calls.
	* [r5993] src/hotplug_linux.c: Use %zd instead of %ld for a size_t
	  integer
	  
	  Fix a warning when compiling on a 32-bits system:
	  hotplug_linux.c: In function 'HPReadBundleValues':
	  hotplug_linux.c:188: warning: format '%ld' expects type 'long
	  int', but argument 6 has type 'unsigned int'

2011-10-02  Ludovic Rousseau

	* [r5992] src/readerfactory.c: Use %zd instead of %ld for a size_t
	  integer
	  
	  Fix 2 compiler warnings: readerfactory.c: In function
	  `RFAddReader': readerfactory.c:124:3: warning: format `%ld'
	  expects argument of type `long int', but argument 6 has type
	  `size_t' [-Wformat] readerfactory.c:124:3: warning: format `%ld'
	  expects argument of type `long int', but argument 7 has type
	  `unsigned int' [-Wformat]

2011-09-29  Ludovic Rousseau

	* [r5988] src/spy/pcsc-spy.py: Log SCardControl() dwControlCode in
	  a human form
	* [r5987] src/spy/pcsc-spy.py: Remove duplicate 0x00090303 key
	* [r5986] src/spy/pcsc-spy.py: Fix some pylint warnings
	* [r5985] src/spy/pcsc-spy.c, src/spy/pcsc-spy.py: Convert return
	  value from hexa to text
	  
	  SCARD_E_NOT_TRANSACTED is more human friendly than 0x80100016
	* [r5984] src/spy/pcsc-spy.py: log_in2() & log_out2(): return the
	  data line read by the method
	  
	  This will allow to do some data processing on the debug data in
	  the caller method.

2011-09-27  Ludovic Rousseau

	* [r5983] src/spy/pcsc-spy.c: Fix compiler warning
	  
	  pcsc-spy.c: In function 'SCardGetAttrib': pcsc-spy.c:635:6:
	  warning: pointer targets in assignment differ in signedness
	  [-Wpointer-sign]
	* [r5982] src/spy/pcsc-spy.c: Display the ASCII equivalent of a
	  "binary" buffer
	* [r5981] src/spy/pcsc-spy.c: SCardGetAttrib(): manage
	  SCARD_AUTOALLOCATE case
	* [r5980] src/spy/pcsc-spy.py: Display dwCurrentState &
	  dwEventState parameter in human form
	* [r5979] src/spy/pcsc-spy.py: log_out_dwActiveProtocol():
	  correctly display UNKNOWN protocol
	* [r5978] src/spy/pcsc-spy.py: Display dwActiveProtocol parameter
	  in human form
	* [r5977] src/spy/pcsc-spy.py: Display dwPreferredProtocols
	  parameter in human form
	* [r5976] src/spy/pcsc-spy.py: Fix 2 pep8 issues
	* [r5975] src/spy/pcsc-spy.py: Display dwShareMode parameter in
	  human form
	* [r5974] src/spy/pcsc-spy.py: Display dwAttrId parameter in human
	  form
	* [r5973] src/spy/pcsc-spy.py: Display dwDisposition parameter in
	  human form
	* [r5972] src/spy/pcsc-spy.c, src/spy/pcsc-spy.py: Add support of
	  SCardBeginTransaction() and SCardEndTransaction()
	* [r5971] src/spy/pcsc-spy.py: Add a missing space for a correct
	  formatting
	* [r5970] src/spy/pcsc-spy.c: spy_quit(): rv is a LONG not int
	  
	  The problem occurs on 64-bits systems with sign extension from
	  0x80100016 to 0xFFFFFFFF80100016
	* [r5969] src/spy/pcsc-spy.c: Add support of pcsc_stringify_error()
	* [r5968] src/spy/pcsc-spy.c: load_lib(): handle dlsym() errors
	  
	  log an error and return SCARD_F_INTERNAL_ERROR if dlopen() or
	  dlsym() fails.
	* [r5967] src/spy/pcsc-spy.c: load_lib(): do not call dlclose()
	  
	  Stupuid bug. We still need to access the symbols after the
	  library is loaded. dlclose() should be closed only when the
	  library is not used anymore (i.e. we don't know when).

2011-09-24  Ludovic Rousseau

	* [r5965] doc/doxygen.conf.in: Update for Doxygen 1.7.4
	* [r5964] src/error.c, src/winscard_clnt.c: Doxygen: fixes and
	  English improvement
	* [r5963] src/winscard_clnt.c: Doxygen: remove a note about
	  SCardControl() API change
	  
	  Between pcsc-lite 1.2.0 (Oct 2003) and 1.2.9-beta1 (May 2004) the
	  API changed and the new parameter dwControlCode was added.
	* [r5962] src/PCSC/winscard.h, src/atrhandler.c, src/atrhandler.h,
	  src/winscard.c, src/winscard_clnt.c: fix typo: smartcard -> smart
	  card
	* [r5961] src/error.c: Doxygen: fix a bug in the doc

2011-09-13  Ludovic Rousseau

	* [r5955] configure.in: Generate src/spy/Makefile
	* [r5954] src/Makefile.am, src/pcsc-spy.c, src/pcsc-spy.py,
	  src/spy, src/spy/Makefile.am, src/spy/pcsc-spy.c,
	  src/spy/pcsc-spy.py: Move spy tools into the spy/ directory
	* [r5953] src/pcsc-spy.py: Remove debug line
	* [r5951] src/pcsc-spy.c, src/pcsc-spy.py: Add Timing information

2011-09-09  Ludovic Rousseau

	* [r5949] src/pcsc-spy.c: Fix compiler warning
	  
	  pcsc-spy.c:243:28: warning: comparison between signed and
	  unsigned integer expressions [-Wsign-compare]
	* [r5948] src/pcsc-spy.c, src/pcsc-spy.py: Fix issues caused by
	  changes of spy_buffer() in the previous commit
	* [r5947] src/pcsc-spy.c, src/pcsc-spy.py: Log
	  SCardGetStatusChange() reader array
	* [r5946] src/pcsc-spy.py: Use a PCSCspy class
	* [r5945] src/pcsc-spy.py: Make pylint happier
	* [r5944] src/pcsc-spy.py: Make pep8 happy

2011-09-06  Ludovic Rousseau

	* [r5943] src/pcsc-spy.c, src/pcsc-spy.py: Add support of multi
	  entries text output
	  
	  This is used for SCardListReaders() and SCardListReaderGroups()
	* [r5942] src/pcsc-spy.c: load_lib(): Do not use an absolut
	  pathname
	  
	  Use "libpcsclite.so.1" instead of "/usr/lib/libpcsclite.so.1" to
	  let the dynamic linker ld.so search for the lib.
	* [r5941] src/pcsc-spy.c, src/pcsc-spy.py: Set $Id$ keyword

2011-09-04  Ludovic Rousseau

	* [r5940] configure.in: check for mq_getattr() in -lrt
	  
	  In old versions of libudev the -lrt link flags is not added. This
	  library is required for mq_getattr() used by sd-daemon.c
	  
	  On Ubuntu 10.04: $ pkg-config --libs libudev -ludev $ dpkg -l
	  libudev-dev ii libudev-dev 151-12.3 udev library (development
	  files)
	  
	  On Debian wheery: $ pkg-config --libs libudev -ludev -lrt $ dpkg
	  -l libudev-dev ii libudev-dev 172-1 libudev development files
	* [r5939] UnitaryTests/getAttrib.py: Add
	  SCARD_ATTR_VENDOR_IFD_VERSION and SCARD_ATTR_VENDOR_IFD_SERIAL_NO

2011-09-03  Ludovic Rousseau

	* [r5938] src/hotplug_libusb.c, src/pcscdaemon.c,
	  src/winscard_clnt.c: Remove extra spaces characters
	* [r5937] src/pcscdaemon.c: print_usage(): fix typo in argument
	  documentation
	  
	  The correct option is --auto-exit
	* [r5936] .gitignore: Add new files to .gitignore
	* [r5935] etc/pcscd.service.in: Use long arguments to pcscd command
	  
	  --foreground and --hotplug are easier to understand than -f and
	  -H
	* [r5934] configure.in: Add --with-systemdsystemunitdir=DIR comment
	* [r5933] Makefile.am, configure.in, etc, etc/Makefile.am,
	  etc/pcscd.service.in, etc/pcscd.socket.in: Install systemd
	  service files
	  
	  Thanks to Kalev Lember for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2011-q2/0139.html
	* [r5932] src/winscard_clnt.c: Fix compiler warning when autostart
	  is not used
	  
	  winscard_clnt.c: In function `SCardEstablishContext':
	  winscard_clnt.c:455:1: warning: label `again' defined but not
	  used [-Wunused-label]
	* [r5931] configure.in, src/winscard_clnt.c: Add
	  --disable-autostart option
	  
	  This option disables pcscd autostarting code in the libpcsclite
	  library.
	  
	  With systemd socket activation in place, pcscd can be started
	  automatically by systemd when a request arrives on the IPC
	  socket. That makes starting the service as a fork from user
	  library unnecessary.
	  
	  Thanks to Kalev Lember for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2011-q2/0137.html
	* [r5930] src/Makefile.am: Use curl -O instead of a redirection
	  
	  This avoids a name duplication (less error-prone)
	* [r5929] src/Makefile.am, src/pcscdaemon.c, src/sd-daemon.c,
	  src/sd-daemon.h, src/winscard_msg.h, src/winscard_msg_srv.c:
	  Support systemd socket activation
	  
	  Add systemd socket-based activation support to pcscd as an
	  alternative to the existing autostart code which used forking
	  from the user space library. Systemd socket activation makes it
	  possible to start pcscd on demand by systemd when a request is
	  sent on the IPC socket.
	  
	  The implementation uses the $LISTEN_FDS/$LISTEN_PID env var
	  parsing code from systemd's sd-daemon.[ch] copy library.
	  
	  Thanks to Kalev Lember for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2011-q2/0140.html
	* [r5928] UnitaryTests/getAttrib.py: Unitary test for
	  SCardGetAttrib()

2011-09-02  Ludovic Rousseau

	* [r5927] .gitignore: Create .gitignore files

2011-08-28  Ludovic Rousseau

	* [r5919] src/debuglog.c: DebugLogSetLogType(): xterm-256color is
	  also a color terminal
	  
	  xterm-256color is used by the Terminal application on Mac OS X
	  (Lion)

2011-08-25  Ludovic Rousseau

	* [r5910] src/Makefile.am, src/pcsc-spy.c, src/pcsc-spy.py: PC/SC
	  function spy layer

2011-08-21  Ludovic Rousseau

	* [r5901] src/debuglog.c: log_xxd_always(): Use a variable-length
	  array
	  
	  The debug message buffer is no more with a fixed size (around 600
	  bytes of buffer to log) but uses a variable-length array.
	  
	  It is now possible to log extended APDU of 64kB.
	  
	  The variable-length array feature is available in GCC in C90 mode
	  and is mandatory in C99 standard.
	* [r5900] src/readerfactory.c, src/readerfactory.h:
	  RFSetReaderName(): remove useless parameter slot
	  
	  RFSetReaderName() is only called in one place with slot set to 0.
	  This parameter is then useless and can be removed.
	* [r5899] src/debuglog.c: Use sizeof instead of a hard coded value
	* [r5898] src/debug.c: Remove log_xxd() implementation
	  
	  debug.c is use to log from the client side (libpcsclite).
	  log_xxd() is not used in the client library so is just dead code.
	* [r5896] src/debuglog.c: log_line(): correctly calculate delta
	  time when no color is used
	  
	  The update of last_time was only done in case of colorization
	  (LogDoColor). So on unsupported consoles the time was wrong.

2011-08-09  Ludovic Rousseau

	* [r5887] src/hotplug_libudev.c: HPReadBundleValues(): use strtol()
	  instead of the unsafe sscanf()
	* [r5886] src/hotplug_linux.c: HPEstablishUSBNotifications(): use
	  atoi() instead of the unsafe sscanf()
	* [r5885] src/testpcsc.c: Use atoi() instead of the unsafe sscanf()

2011-08-08  Ludovic Rousseau

	* [r5882] UnitaryTests/SCardGetStatusChange2.py: Check the return
	  value of SCardGetStatusChange() for unknown readers
	* [r5881] src/winscard_clnt.c: SCardGetStatusChange(): check all
	  the readers are already known and return SCARD_E_UNKNOWN_READER
	  if a reader name is not present.
	  
	  Windows XP has this behavior.

2011-07-19  Ludovic Rousseau

	* [r5875] src/hotplug_linux.c: Use safer snprintf() instead of
	  sprintf()
	  
	  coverity: Event secure_coding: [VERY RISKY]. Using "sprintf" can
	  cause a buffer overflow when done incorrectly. Because sprintf()
	  assumes an arbitrarily long string, callers must be careful not
	  to overflow the actual space of the destination. Use snprintf()
	  instead, or correct precision specifiers.
	* [r5874] src/hotplug_linux.c: Fix compiler warning
	  
	  hotplug_linux.c: In function 'HPReadBundleValues':
	  hotplug_linux.c:188: warning: format '%d' expects type 'int', but
	  argument 6 has type 'long unsigned int'

2011-07-18  Ludovic Rousseau

	* [r5873] UnitaryTests/SCardGetStatusChange.py: Unitary test for
	  SCardGetStatusChange()

2011-07-09  Ludovic Rousseau

	* [r5869] src/PCSC/wintypes.h: Define PUCHAR using UCHAR instead of
	  "unsigned char". Same for PDWORD and PULONG.
	  
	  We now have less lines to change to redefine types.
	* [r5868] src/hotplug_macosx.c: Fix compiler warnings
	  
	  hotplug_macosx.c: In function 'HPDriversGetFromDirectory':
	  hotplug_macosx.c:245: warning: format '%d' expects type 'int',
	  but argument 7 has type 'CFIndex' hotplug_macosx.c:253: warning:
	  format '%d' expects type 'int', but argument 7 has type 'CFIndex'
	* [r5867] src/winscard_msg.c, src/winscard_msg.h:
	  MessageReceiveTimeout(): change timeOut parameter type to fix a
	  compiler warning
	  
	  winscard_msg.c: In function `MessageReceiveTimeout':
	  winscard_msg.c:186:13: warning: comparison between signed and
	  unsigned integer expressions [-Wsign-compare]
	* [r5866] src/tokenparser.l: Silence compiler warnings
	  
	  tokenparser.l: In function `eval_key': tokenparser.l:62:6:
	  warning: variable `r' set but not used
	  [-Wunused-but-set-variable]
	  
	  tokenparser.l: In function `eval_value': tokenparser.l:92:6:
	  warning: variable `r' set but not used
	  [-Wunused-but-set-variable]
	  
	  tokenparser.l: In function `bundleParse': tokenparser.l:162:6:
	  warning: variable `r' set but not used
	  [-Wunused-but-set-variable]
	* [r5865] src/tokenparser.l: bundleParse(): fix a compilation error
	  if NDEBUG is not definef (i.e. DEBUG is ON)
	* [r5864] src/winscard_svc.c: Fix compiler warnings
	  
	  winscard_svc.c: In function `contextsListhContext_seeker':
	  winscard_svc.c:86:3: warning: format `%X' expects argument of
	  type `unsigned int', but argument 6 has type `const void *'
	  [-Wformat] winscard_svc.c:86:3: warning: format `%X' expects
	  argument of type `unsigned int', but argument 7 has type `const
	  void *' [-Wformat]
	  
	  winscard_svc.c: In function `ContextThread':
	  winscard_svc.c:296:2: warning: format `%X' expects argument of
	  type `unsigned int', but argument 7 has type `struct SCONTEXT *'
	  [-Wformat]
	  
	  winscard_svc.c: In function `MSGAddHandle': winscard_svc.c:836:4:
	  warning: format `%X' expects argument of type `unsigned int', but
	  argument 6 has type `struct SCONTEXT *' [-Wformat]
	  
	  winscard_svc.c: In function `MSGCleanupClient':
	  winscard_svc.c:916:2: warning: format `%X' expects argument of
	  type `unsigned int', but argument 7 has type `struct SCONTEXT *'
	  [-Wformat] winscard_svc.c:924:2: warning: format `%X' expects
	  argument of type `unsigned int', but argument 6 has type `struct
	  SCONTEXT *' [-Wformat]
	* [r5863] src/winscard.c: Fix compiler warnings
	  
	  winscard.c: In function `SCardEstablishContext':
	  winscard.c:193:2: warning: format `%X' expects argument of type
	  `unsigned int', but argument 6 has type `SCARDCONTEXT' [-Wformat]
	  
	  winscard.c: In function `SCardReleaseContext': winscard.c:204:2:
	  warning: format `%X' expects argument of type `unsigned int', but
	  argument 6 has type `SCARDCONTEXT' [-Wformat]
	  
	  winscard.c: In function `SCardConnect': winscard.c:234:2:
	  warning: format `%d' expects argument of type `int', but argument
	  7 has type `DWORD' [-Wformat] winscard.c:315:5: warning: format
	  `%d' expects argument of type `int', but argument 6 has type
	  `LONG' [-Wformat] winscard.c:315:5: warning: format `%X' expects
	  argument of type `unsigned int', but argument 7 has type `LONG'
	  [-Wformat] winscard.c:410:5: warning: format `%d' expects
	  argument of type `int', but argument 6 has type `DWORD'
	  [-Wformat] winscard.c:422:2: warning: format `%x' expects
	  argument of type `unsigned int', but argument 6 has type
	  `SCARDHANDLE' [-Wformat]
	  
	  winscard.c: In function `SCardReconnect': winscard.c:693:5:
	  warning: format `%d' expects argument of type `int', but argument
	  6 has type `DWORD' [-Wformat]
	  
	  winscard.c: In function `SCardDisconnect': winscard.c:821:2:
	  warning: format `%d' expects argument of type `int', but argument
	  6 has type `DWORD' [-Wformat]
	  
	  winscard.c: In function `SCardBeginTransaction':
	  winscard.c:1051:2: warning: format `%X' expects argument of type
	  `unsigned int', but argument 6 has type `LONG' [-Wformat]
	  
	  winscard.c: In function `SCardEndTransaction': winscard.c:1188:2:
	  warning: format `%X' expects argument of type `unsigned int', but
	  argument 6 has type `LONG' [-Wformat]
	  
	  winscard.c: In function `SCardTransmit': winscard.c:1539:2:
	  warning: format `%d' expects argument of type `int', but argument
	  6 has type `DWORD' [-Wformat]
	* [r5862] src/readerfactory.c: Fix compiler warnings
	  
	  readerfactory.c: In function `RFInitializeReader':
	  readerfactory.c:941:3: warning: format `%X' expects argument of
	  type `unsigned int', but argument 6 has type `LONG' [-Wformat]
	  readerfactory.c:950:3: warning: format `%X' expects argument of
	  type `unsigned int', but argument 6 has type `LONG' [-Wformat]
	  readerfactory.c: In function `RFRemoveReaderHandle':
	  readerfactory.c:1135:3: warning: format `%X' expects argument of
	  type `unsigned int', but argument 6 has type `SCARDHANDLE'
	  [-Wformat] readerfactory.c: In function
	  `RFCheckReaderEventState': readerfactory.c:1198:3: warning:
	  format `%X' expects argument of type `unsigned int', but argument
	  6 has type `SCARDHANDLE' [-Wformat] readerfactory.c: In function
	  `RFCleanupReaders': readerfactory.c:1274:5: warning: format `%X'
	  expects argument of type `unsigned int', but argument 6 has type
	  `LONG' [-Wformat]
	* [r5861] src/prothandler.c: Fix compiler warning
	  
	  prothandler.c: In function `PHSetProtocol': prothandler.c:102:5:
	  warning: format `%d' expects argument of type `int', but argument
	  6 has type `LONG' [-Wformat]
	* [r5860] src/ifdwrapper.c: Fix compiler warning
	  
	  ifdwrapper.c: In function `IFDControl': ifdwrapper.c:455:3:
	  warning: format `%LX' expects argument of type `long long
	  unsigned int', but argument 6 has type `DWORD' [-Wformat]
	* [r5859] src/eventhandler.c: Fix compiler warning
	  
	  eventhandler.c: In function `EHStatusHandlerThread':
	  eventhandler.c:272:4: warning: format `%d' expects argument of
	  type `int', but argument 6 has type `LONG' [-Wformat]
	  eventhandler.c:272:4: warning: format `%X' expects argument of
	  type `unsigned int', but argument 7 has type `LONG' [-Wformat]
	* [r5858] src/winscard_clnt.c: Fix compiler warnings
	  
	  winscard_clnt.c: In function 'CHANNEL_MAP_seeker':
	  winscard_clnt.c:282: warning: format '%X' expects type 'unsigned
	  int', but argument 6 has type 'const void *' winscard_clnt.c:282:
	  warning: format '%X' expects type 'unsigned int', but argument 7
	  has type 'const void *' winscard_clnt.c: In function
	  'SCONTEXTMAP_seeker': winscard_clnt.c:317: warning: format '%X'
	  expects type 'unsigned int', but argument 6 has type 'const void
	  *' winscard_clnt.c:317: warning: format '%X' expects type
	  'unsigned int', but argument 7 has type 'const void *'
	  winscard_clnt.c: In function 'SCardAddContext':
	  winscard_clnt.c:3385: warning: format '%X' expects type 'unsigned
	  int', but argument 6 has type 'struct SCONTEXTMAP *'
	  winscard_clnt.c:3393: warning: format '%X' expects type 'unsigned
	  int', but argument 6 has type 'struct SCONTEXTMAP *'
	* [r5857] src/readerfactory.c: Fix compiler warnings
	  
	  readerfactory.c: In function 'RDR_CLIHANDLES_seeker':
	  readerfactory.c:68: warning: format '%X' expects type 'unsigned
	  int', but argument 6 has type 'const void *' readerfactory.c:68:
	  warning: format '%X' expects type 'unsigned int', but argument 7
	  has type 'const void *'
	* [r5856] src/readerfactory.c: Fix compiler warnings
	  
	  readerfactory.c: In function 'RFAddReader': readerfactory.c:124:
	  warning: format '%d' expects type 'int', but argument 6 has type
	  'size_t' readerfactory.c:124: warning: format '%d' expects type
	  'int', but argument 7 has type 'long unsigned int'
	* [r5855] src/readerfactory.c: Fix a bug detected thanks to
	  revision 5854 and a compiler warning
	  
	  readerfactory.c: In function 'RFSetReaderEventState':
	  readerfactory.c:1167: warning: format '%s' expects type 'char *',
	  but argument 6 has type 'int'
	* [r5854] src/PCSC/debuglog.h: log_msg(): use
	  __attribute__((format(printf, ..))) to check the parameters
	  passed corresponds to the format string

2011-07-08  Ludovic Rousseau

	* [r5853] src/hotplug_libusb.c: HPRegisterForHotplugEvents(): add a
	  log call for info
	* [r5852] src/hotplug_libusb.c: HPRescanUsbBus(): check
	  libusb_init() return value
	  
	  Thanks to Dwi Sasongko Supriyadi for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2011-q3/0014.html

2011-07-06  Ludovic Rousseau

	* [r5850] src/debug.c: log_xxd(): use safer snprintf() instead of
	  sprintf()
	  
	  Event secure_coding: [VERY RISKY]. Using "sprintf" can cause a
	  buffer overflow when done incorrectly. Because sprintf() assumes
	  an arbitrarily long string, callers must be careful not to
	  overflow the actual space of the destination. Use snprintf()
	  instead, or correct precision specifiers.
	* [r5849] src/debuglog.c: log_xxd_always(): use safer snprintf()
	  instead of sprintf()
	  
	  coverity: Event secure_coding: [VERY RISKY]. Using "sprintf" can
	  cause a buffer overflow when done incorrectly. Because sprintf()
	  assumes an arbitrarily long string, callers must be careful not
	  to overflow the actual space of the destination. Use snprintf()
	  instead, or correct precision specifiers.
	* [r5848] src/readerfactory.c: RFAddReader(): use safer snprintf()
	  instead of sprintf()
	  
	  coverity: Event secure_coding: [VERY RISKY]. Using "sprintf" can
	  cause a buffer overflow when done incorrectly. Because sprintf()
	  assumes an arbitrarily long string, callers must be careful not
	  to overflow the actual space of the destination. Use snprintf()
	  instead, or correct precision specifiers.
	* [r5847] src/hotplug_libudev.c: HPReadBundleValues(): fix a memory
	  leak
	  
	  coverity: Event leaked_storage: Variable "hpDir" going out of
	  scope leaks the storage it points to.
	* [r5846] src/hotplug_libudev.c: HPRescanUsbBus(): Move the
	  lock/unlock _around_ the loop so that the values are constant
	  between check and use.
	  
	  coverity: Event use: Using an unreliable value of
	  "readerTracker[i].fullName" inside the second locked section. If
	  the data that "readerTracker[i].fullName" depends on was changed
	  by another thread, this use might be incorrect.
	* [r5845] src/winscard_clnt.c: SCardConnect(): use safer strlcpy()
	  instead of strncpy()
	  
	  coverity: Event buffer_size_warning: Calling strncpy with a
	  maximum size argument of 100 bytes on destination array
	  "scConnectStruct.szReader" of size 100 bytes might leave the
	  destination string unterminated.
	* [r5844] src/winscard_clnt.c: SCardConnect(): use sizeof instead
	  of a hardcoded value
	* [r5843] src/winscard.c: SCardStatus(): remove dead code
	  
	  coverity: Event dead_error_condition: On this path, the condition
	  "rv != 0L" cannot be true.
	* [r5842] src/winscard_clnt.c: Reformat 4 spaces with 1 tab
	* [r5841] src/hotplug_libudev.c: Fix a memory leak
	  
	  coverity: Event leaked_storage: Variable "CFBundleName" going out
	  of scope leaks the storage it points to.
	* [r5840] src/hotplug_libudev.c, src/hotplug_libusb.c: Fix a memory
	  leak
	  
	  coverity: Event leaked_storage: Variable "hpDir" going out of
	  scope leaks the storage it points to.

2011-07-05  Ludovic Rousseau

	* [r5831] src/testpcsc.c: Fix compiler warnings
	  
	  testpcsc.c: In function 'main': testpcsc.c:222: warning:
	  assignment discards qualifiers from pointer target type
	  testpcsc.c:225: warning: assignment discards qualifiers from
	  pointer target type testpcsc.c:228: warning: assignment discards
	  qualifiers from pointer target type
	* [r5830] src/testpcsc.c: pioRecvPci really need to be allocated by
	  the caller since it is filled by SCardTransmit() as a return
	  parameter.
	* [r5826] src/readerfactory.c: Fix a REVERSE_INULL coverity error
	  
	  sContext->pFeeds is checked for NULL _after_ being dereferenced
	  in RFUnloadReader() called by RFUnInitializeReader(). We now
	  check before dereferencing.
	* [r5825] src/testpcsc.c: Initialize pioRecvPci
	  
	  Make coverity scan happy
	* [r5824] src/testpcsc.c: Use pointers for pioRecvPci and
	  pioSendPci to better match with the variable names

2011-07-04  Ludovic Rousseau

	* [r5822] src/pcscdaemon.c: print_usage(): update arguments
	  documentation
	* [r5821] src/pcscdaemon.c: main(): do not use atexit() since our
	  at_exit() function will be called upon signal receipt from our
	  signal_trap() function.
	  
	  The problem was that at_exit() was called a second time on the
	  process exit and gerenarted error messages: 00000006
	  pcscdaemon.c:634:at_exit() cleaning /var/run/pcscd 00001328
	  pcscdaemon.c:634:at_exit() cleaning /var/run/pcscd 00000033
	  pcscdaemon.c:658:clean_temp_files() Cannot remove
	  /var/run/pcscd/pcscd.comm: No such file or directory 00000013
	  pcscdaemon.c:663:clean_temp_files() Cannot remove
	  /var/run/pcscd/pcscd.pid: No such file or directory

2011-07-01  Ludovic Rousseau

	* [r5818] UnitaryTests/SCardReconnect.py: Improve comments

2011-06-29  Ludovic Rousseau

	* [r5814] configure.in: Enable silent build by default

2011-06-28  Ludovic Rousseau

	* [r5813] src/prothandler.c, src/prothandler.h: Remove now unused
	  PHGetDefaultProtocol() and PHGetAvailableProtocols()
	* [r5812] src/winscard.c: SCardConnect(), SCardReconnect(): use
	  ATRDecodeAtr() directly instead of PHGetDefaultProtocol() and
	  PHGetAvailableProtocols()
	* [r5811] src/atrhandler.c, src/atrhandler.h, src/prothandler.c:
	  ATRDecodeAtr(): use only two out parameters availableProtocols
	  and currentProtocol instead of struct SMARTCARD_EXTENSION
	  
	  Remove some unused code from ATRDecodeAtr().

2011-06-23  Ludovic Rousseau

	* [r5809] ChangeLog, configure.in: release 1.7.4
	* [r5808] src/atrhandler.c: ATRDecodeAtr(): revert revision 5804
	  
	  T=1 cards were no more recognized. Brown paper bag bug.

2011-06-22  Ludovic Rousseau

	* [r5806] ChangeLog, configure.in: release 1.7.3
	* [r5805] src/ifdwrapper.c: IFDSetPTS() and IFDPowerICC(): remove
	  useless variable ucValue[]
	  
	  ifdwrapper.c: In function `IFDSetPTS': ifdwrapper.c:50:8:
	  warning: variable `ucValue' set but not used
	  [-Wunused-but-set-variable] ifdwrapper.c: In function
	  `IFDPowerICC': ifdwrapper.c:252:8: warning: variable `ucValue'
	  set but not used [-Wunused-but-set-variable]
	* [r5804] src/atrhandler.c: ATRDecodeAtr(): only use TBi and TCi in
	  ATR_DEBUG mode
	  
	  atrhandler.c: In function `ATRDecodeAtr': atrhandler.c:106:19:
	  warning: variable `TCi' set but not used
	  [-Wunused-but-set-variable] atrhandler.c:106:14: warning:
	  variable `TBi' set but not used [-Wunused-but-set-variable]
	* [r5803] src/atrhandler.c: Remove unused variable
	  
	  atrhandler.c: In function `ATRDecodeAtr': atrhandler.c:48:11:
	  warning: variable `TCK' set but not used
	  [-Wunused-but-set-variable]
	* [r5802] doc/example/pcsc_demo.c: SCARD_PCI_T0 and SCARD_PCI_T1
	  and now const values
	  
	  Fix compiler warnings: pcsc_demo.c: In function `main':
	  pcsc_demo.c:161:24: warning: assignment discards `const'
	  qualifier from pointer target type [enabled by default]
	  pcsc_demo.c:164:24: warning: assignment discards `const'
	  qualifier from pointer target type [enabled by default]

2011-06-21  Ludovic Rousseau

	* [r5801] src/PCSC/reader.h: Remove the deprecated
	  FEATURE_MCT_READERDIRECT

2011-06-16  Ludovic Rousseau

	* [r5797] src/winscard_clnt.c: SCardGetStatusChange(): add a cast
	  to fix a compiler warning
	  
	  winscard_clnt.c:1890: warning: comparison between signed and
	  unsigned integer expressions
	* [r5796] src/winscard_msg.c, src/winscard_msg.h:
	  MessageReceiveTimeout(): change timeOut type from int32_t to
	  unsigned long to avoid overflows with a timeout of 1000000000.
	  
	  The bug was that MessageReceiveTimeout() timeouts immediatly when
	  it should not. So a _lot_ of exchanges with pcscd occurs.
	  
	  Tested on 64-bits CPU only.
	* [r5795] src/winscard_clnt.c: SCardGetStatusChange(): catch
	  possible sign extension problems from 32 to 64-bits integers
	  
	  Storing INFINITE (0xFFFFFFFF) into an int parameter and then
	  passing it to SCardGetStatusChange() will expand the int into a
	  DWORD (unsigned long). On 64-bits architecture it will become
	  0xFFFFFFFFFFFFFFFF (-1).
	  
	  See OpenSC bug at
	  http://www.opensc-project.org/pipermail/opensc-devel/2011-June/016848.html

2011-06-15  Ludovic Rousseau

	* [r5793] src/hotplug_libudev.c: HPEstablishUSBNotifications():
	  wait for a udev event before calling
	  udev_monitor_receive_device()
	  
	  Fix Alioth bug [#313165] "libudev-support broken with udev-171:
	  udev_monitor_receive_device() error"

2011-06-14  Ludovic Rousseau

	* [r5790] src/winscard_clnt.c: API_TRACE_IN: use %ld instead of %d
	  for DWORD and LONG types.
	  
	  The timeout in SCardGetStatusChange() is now correctly displayed
	  4294967295 instead of -1 on 64-bits systems.

2011-06-11  Ludovic Rousseau

	* [r5786] src/hotplug_macosx.c: Remove useless cast for calloc()
	  (we are not in C++)
	* [r5780] COPYING: Add my name as copyright holder

2011-05-30  Ludovic Rousseau

	* [r5769] src/eventhandler.c: EHStatusHandlerThread(): always sleep
	  if the driver card event function returns an error (and not just
	  in the case of IFD_NO_SUCH_DEVICE)
	  
	  This avoids to loop too fast in case of a problem. This happens
	  after activating a smart card reader in vmware workstation for
	  example.
	  
	  See
	  https://bugs.launchpad.net/ubuntu/+source/pcsc-lite/+bug/787451
	  "pcscd spams to syslog and kern.log after enabling smartcard
	  reader in VMWare Workstation"

2011-05-25  Ludovic Rousseau

	* [r5766] src/winscard.c: SCardConnect(): log at level
	  PCSC_LOG_DEBUG instead of PCSC_LOG_ERROR if no card is inserted
	  
	  Thanks to Kalev Lember for the patch
	  https://bugzilla.redhat.com/show_bug.cgi?id=707412#c2

2011-05-22  Ludovic Rousseau

	* [r5765] src/winscard_svc.c: WRITE_BODY_WITH_COMMAND(): always log
	  with level PCSC_LOG_DEBUG even in case of error to avoid filling
	  the system log file.
	  
	  Thanks to Kalev Lember for the patch. See
	  https://bugzilla.redhat.com/show_bug.cgi?id=657658

2011-05-18  Ludovic Rousseau

	* [r5764] src/pcscdaemon.c: print_usage(): document -x,
	  --auto-exits
	* [r5763] configure.in: Use AC_LANG_SOURCE as requested by autoconf
	  2.68

2011-05-17  Ludovic Rousseau

	* [r5759] doc/doxygen.conf.in: Do not generate call and include
	  graphs

2011-05-12  Ludovic Rousseau

	* [r5736] src/PCSC/pcsclite.h.in, src/winscard_clnt.c: Define
	  g_rgSCardT?Pci as const structures to be more Windows like
	  
	  I do not expect a regression or compilation problem in WinSCard
	  API users but how knows...
	* [r5735] configure.in: No need to define host_to_ccid_16 and
	  host_to_ccid_32 any more since they were removed in revision 5255
	  from src/PCSC/reader.h
	* [r5734] configure.in: Do not check for libusb or libudev is USB
	  support is disabled.
	  
	  See Debian bug #626201: pcsc-lite: FTBFS on hurd-i386

2011-05-11  Ludovic Rousseau

	* [r5732] src/winscard_svc.c: ContextThread(): in
	  CMD_GET_READERS_STATE call RFWaitForReaderInit only if USE_USB is
	  defined.
	  
	  Fix a link failure if --disable-usb is used.
	  
	  See Debian bug #626201: pcsc-lite: FTBFS on hurd-i386

2011-05-05  Ludovic Rousseau

	* [r5714] src/PCSC/debuglog.h, src/PCSC/ifdhandler.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/wintypes.h: Update copyright
	  date
	* [r5713] src/PCSC/debuglog.h, src/debuglog.c, src/pcscdaemon.c:
	  Add command line option -T, --color: force use of colored logs
	  
	  The idea is to have colored logs even if they are redirected to a
	  file or a pipe.
	* [r5712] src/debuglog.c: log_line(): display the delta time
	  between two log lines even if stdout is not a tty (redirected to
	  a file)
	  
	  The information may be usefull to detect problems from a log file
	  with this time information.
	* [r5711] src/atrhandler.c, src/debuglog.c, src/eventhandler.c,
	  src/hotplug_generic.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/ifdwrapper.c, src/pcscdaemon.c,
	  src/prothandler.c, src/readerfactory.c, src/readerfactory.h,
	  src/utils.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_svc.c: Update copyright date
	* [r5710] src/PCSC/debuglog.h, src/debuglog.c, src/pcscdaemon.c:
	  Send logs to stdout instead of stderr
	  
	  It is now possible to use tee(1) to redirect logs in a file
	  without first redirecting stderr to stdout
	* [r5709] src/pcscdaemon.c: at_exit(): use exit() instead of
	  _exit() to properly close stderr and stdout and other libC
	  cleanup

2011-05-04  Ludovic Rousseau

	* [r5708] src/PCSC/debuglog.h, src/debuglog.c: Remove support of
	  DebugLogSuppress()
	  
	  This function is not used anywhere in pcsc-lite.

2011-05-03  Ludovic Rousseau

	* [r5707] src/hotplug_libusb.c: HPRescanUsbBus(): fix a memory leak
	  
	  Call libusb_free_config_descriptor() to free the memory allocated
	  by libusb_get_active_config_descriptor()
	  
	  Thanks to Roland Troka for the patch Closes Alioth bug: [313036]
	  alto uso della ram da pcscd versione 1.6.7 e 1.7.0

2011-04-22  Ludovic Rousseau

	* [r5705] TODO: Fix: "start pcscd only when a reader is connected"
	  and "do not open the reader USB device if no client is using the
	  reader"
	  
	  Now that pcscd is auto started it will be started only if an
	  appication is using the PC/SC API. This is the case since release
	  1.6.0: - SCardEstablishContext(): try to start the pcscd daemon
	  if not already running. . pcscd will suicide itself after 60
	  seconds of inactivity if it is started using --auto-exit. This is
	  the default behavior when pcscd is started by libpcsclite . Set
	  PCSCLITE_PCSCD_ARGS with the argument you want to pass to pcscd
	  in autostart Only one argument is passed. The space character is
	  not a separator. example: export PCSCLITE_PCSCD_ARGS=-dfa
	* [r5704] TODO: Fix: "start pcscd as an normal user daemon (as id
	  smartcard?) instead as root"
	  
	  This is the case since release 1.6.5: - Install pcscd as sgid
	  pcscd instead of suid root See
	  http://ludovicrousseau.blogspot.com/2010/09/pcscd-auto-start.html
	* [r5703] TODO: Fix: "use static driver instead of reader polling
	  and dynamic driver loading"
	  
	  This is the case since release 1.6.0: - Better handling of
	  PCSCLITE_STATIC_DRIVER as can be used on platforms using
	  <B5>Clinux (without dynamic loader). This is used to statically
	  link the reader driver to pcscd. Since the link is static you
	  must define the IFDHandler API version at compilation time.
	  Either define IFDHANDLERv1, IFDHANDLERv2 or IFDHANDLERv3

2011-04-05  Ludovic Rousseau

	* [r5692] src/pcscdaemon.c: signal_trap(): exit immediatly in case
	  of SIGTERM
	  
	  Closes Debian bug #620305 "pcscd slows down sutdown/restart"

2011-03-31  Ludovic Rousseau

	* [r5684] ChangeLog, configure.in: release 1.7.2
	* [r5683] src/hotplug_libudev.c: HPAddDevice(): avoids a crash if a
	  specific driver fails to work and no class driver is available
	  
	  Fix Debian bug #620232: pcscd fails to work with REINER SCT
	  cyberJack

2011-03-30  Ludovic Rousseau

	* [r5679] ChangeLog, configure.in: release 1.7.1

2011-03-27  Ludovic Rousseau

	* [r5676] src/hotplug_libudev.c: Log an error if
	  udev_device_get_devnode() fails

2011-03-26  Ludovic Rousseau

	* [r5675] src/hotplug_libudev.c: Try to use a (CCID) class driver
	  if a specific driver fails to use the reader.
	  
	  This may happen if openct ifd-handler and libccid are both
	  installed.
	* [r5674] src/utils.c: CheckForOpenCT(): Log openct control file
	  found
	* [r5673] src/hotplug_libudev.c: Check the
	  udev_device_get_devnode() return value (and avoids a crash)
	  
	  Fix Debian bug #619241

2011-03-16  Ludovic Rousseau

	* [r5659] src/winscard_clnt.c: CardControl(): initialize all the
	  fields of the struct control_struct to avoid valgrind warning:
	  
	  ==14600== Syscall param socketcall.sendto(msg) points to
	  uninitialised byte(s) ==14600== at 0x5042532: send (send.c:28)
	  ==14600== by 0x4E2FDF9: MessageSend (winscard_msg.c:355)
	  ==14600== by 0x4E2FEE2: MessageSendWithHeader
	  (winscard_msg.c:294) ==14600== by 0x4E2C05C: SCardControl
	  (winscard_clnt.c:2375) ==14600== by 0x4008D4: main
	  (scontrol.c:49) ==14600== Address 0x7fefffc60 is on thread 1's
	  stack
	  
	  Thanks to Martin Vogt for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2011-q1/0088.html

2011-03-13  Ludovic Rousseau

	* [r5655] configure.in: Use libudev only for Linux by default
	* [r5653] configure.in: PCSC_ARCH: convert / in _ to have
	  GNU_kFreeBSD instead of GNU/kFreeBSD

2011-03-09  Ludovic Rousseau

	* [r5650] ChangeLog: Typo caused by autocompletion without check
	* [r5649] ChangeLog, configure.in: release 1.7.0

2011-02-25  Ludovic Rousseau

	* [r5638] configure.in, src/Makefile.am, src/PCSC/ifdhandler.h,
	  src/hotplug_generic.c, src/hotplug_libhal.c,
	  src/hotplug_libudev.c, src/hotplug_linux.c: Use libudev instead
	  of (deprecated) libhal for the USB hotplug mechanism.

2011-02-24  Ludovic Rousseau

	* [r5636] src/hotplug_libusb.c: Remove debug printf()

2011-02-22  Ludovic Rousseau

	* [r5628] ChangeLog, configure.in: release 1.6.7

2011-02-21  Ludovic Rousseau

	* [r5621] src/hotplug_libusb.c: If a device has more than one CCID
	  interface the "libhal:" naming scheme (with the interface number
	  included) is used instead of "libusb:".
	  
	  The new mechanism allows to use multi-interfaces devices like the
	  Gemalto ProxDU also with hotplug_libusb. libhal is deprecated and
	  may not be available everywhere.
	  
	  Thanks to Diego Elio Pettenò for the patch (for Gentoo)

2011-02-10  Ludovic Rousseau

	* [r5589] src/winscard_clnt.c: Move the definition of DO_TRACE,
	  DO_PROFILE, and DO_CHECK_SAME_PROCESS at the top of the file, and
	  add documentation.

2011-02-09  Ludovic Rousseau

	* [r5587] src/Makefile.am: Do not create empty directories
	  .../pcsc/drivers and .../pcsc/services any more. The needed
	  directory is created by the driver instead.

2011-02-04  Ludovic Rousseau

	* [r5584] UnitaryTests/ThreadSafe.py, UnitaryTests/stress_apdu.py:
	  Fix PEP8 warnings
	* [r5583] UnitaryTests/ThreadSafe.py: Display the thread id and
	  iterations
	* [r5582] UnitaryTests/SCard_fork.py: Better documentation and
	  debug
	* [r5581] src/winscard_clnt.c: Add a missing variable declaration
	  used if DO_CHECK_SAME_PROCESS is defined
	* [r5580] UnitaryTests/SCardConnect_DIRECT.py: Test the behavior as
	  documented in revision 5579
	* [r5579] src/winscard_clnt.c: Doxygen: CardConnect() &
	  SCardReconnect() pdwActiveProtocol is not set to
	  SCARD_PROTOCOL_UNDEFINED if SCARD_SHARE_DIRECT is used but the
	  card has already negociated its protocol

2011-02-01  Ludovic Rousseau

	* [r5575] UnitaryTests/SCardBeginTransaction_ExclusiceMode.py:
	  Unitary test for Alioth bug [#312960] SCardDisconnect when other
	  context has transaction
	* [r5574] src/winscard.c: SCardDisconnect(): RFUnlockAllSharing()
	  may fail with SCARD_E_SHARING_VIOLATION if a transaction is on
	  going on another card context and dwDisposition ==
	  SCARD_LEAVE_CARD. We should not stop and continue disconnecting
	  the card.
	  
	  Fixes Alioth bug [#312960] SCardDisconnect when other context has
	  transaction
	* [r5573] UnitaryTests/SCardConnect_DIRECT2.py: Use the protocol
	  negociated by SCardConnect() instead of hard coding SCARD_PCI_T1
	* [r5572] src/winscard_clnt.c: SCardDisconnect(): remove the card
	  handle only if SCARD_DISCONNECT command succeeded on the server
	  
	  Related to alioth bug [#312960] SCardDisconnect when other
	  context has transaction If a first SCardDisconnect() fails with
	  SCARD_E_SHARING_VIOLATION it is now possible to try again
	  SCardDisconnect(). Before the patch the second call to
	  SCardDisconnect() returned SCARD_E_INVALID_HANDLE but the
	  connection was still "in use".

2011-01-29  Ludovic Rousseau

	* [r5569] src/PCSC/ifdhandler.h, src/readerfactory.h: Revert
	  revision 5568 since it has side effect on driver compilation
	  (like libccid fails to build)
	* [r5568] src/PCSC/ifdhandler.h, src/readerfactory.h: Move #include
	  "pcsclite.h" from PCSC/ifdhandler.h to readerfactory.h so that
	  ifdhandler.h can be used as-is on Mac OS X (for handler_test.c)
	* [r5567] src/eventhandler.c, src/ifdwrapper.c, src/prothandler.c,
	  src/readerfactory.c: Remove useless #include "ifdhandler.h"

2011-01-27  Ludovic Rousseau

	* [r5560] src/winscard_clnt.c: SCardSetAttrib(): add profiling
	  calls
	* [r5559] src/winscard_clnt.c: SCardGetSetAttrib(): remove a call
	  to PROFILE_END() since this is already done in SCardGetAttrib()
	* [r5558] src/winscard_clnt.c: profiling: compare threads using
	  pthread_equal() instead of == to make the code more portable.
	* [r5557] src/winscard_clnt.c: SCardGetAttrib(): Always exit from
	  the same point so that profiling does work even in case of error
	* [r5556] src/winscard_clnt.c: profile_end(): add a missing \n in
	  the warning message
	* [r5555] src/winscard_clnt.c: Send API traces do stderr instead of
	  stdout

2011-01-25  Ludovic Rousseau

	* [r5550] src/winscard_clnt.c: SCardReleaseContext(): Always exit
	  from the same point so that profiling does work even in case of
	  error
	* [r5549] src/winscard_clnt.c: SCardCancel(): Always exit from the
	  same point so that profiling does work even in case of error
	* [r5548] src/winscard_clnt.c: Profiling: allow to support up to
	  MAX_THREADS simultaneous calls
	  
	  For example SCardCancel() is called from another thread when
	  SCardGetStatusChange() is running. This was not supported.
	* [r5547] src/winscard_clnt.c: Use color names macros
	* [r5546] src/winscard_clnt.c: Add API tracing with arguments
	  display
	* [r5545] src/winscard_clnt.c: SCardGetStatusChange(): Always exit
	  from the same point so that profiling does work even in case of
	  error
	* [r5544] src/winscard_clnt.c: SCardDisconnect(): Always exit from
	  the same point so that profiling does work even in case of error

2011-01-21  Ludovic Rousseau

	* [r5543] src/configfile.l: Display the correct line number if
	  garbage is found in the configuration file

2011-01-20  Ludovic Rousseau

	* [r5539] src/winscard_svc.c: contextsListhContext_seeker(): avoid
	  a potential crash if NULL values are used
	  
	  src/winscard_svc.c:90:22: warning: Dereference of null pointer if
	  (currentContext->hContext == *(int32_t *)key) ^
	  src/winscard_svc.c:90:34: warning: Dereference of null pointer if
	  (currentContext->hContext == *(int32_t *)key) ^
	* [r5538] src/winscard_clnt.c: SCardStatus(): initialize a dummy
	  variable to avoid warnings
	  
	  src/winscard_clnt.c:1451:2: warning: Assigned value is garbage or
	  undefined dwReaderLen = *pcchReaderLen; ^ ~~~~~~~~~~~~~~
	  src/winscard_clnt.c:1452:2: warning: Assigned value is garbage or
	  undefined dwAtrLen = *pcbAtrLen; ^ ~~~~~~~~~~
	* [r5537] src/winscard_clnt.c: Avoid a potential crash if NULL
	  values are used
	  
	  src/winscard_clnt.c:226:27: warning: Dereference of null pointer
	  if (channelMap->hCard == *(SCARDHANDLE *)key) ^
	  src/winscard_clnt.c:226:18: warning: Dereference of null pointer
	  if (channelMap->hCard == *(SCARDHANDLE *)key) ^
	  src/winscard_clnt.c:260:18: warning: Dereference of null pointer
	  if (contextMap->hContext == *(SCARDCONTEXT *) key) ^
	  src/winscard_clnt.c:260:30: warning: Dereference of null pointer
	  if (contextMap->hContext == *(SCARDCONTEXT *) key) ^
	* [r5536] src/winscard_clnt.c: SCardEstablishContext(): remove
	  useless affectation
	  
	  src/winscard_clnt.c:439:5: warning: Value stored to 'ret' is
	  never read ...ret = execl(PCSCD_BINARY, "pcscd", "--auto-exit",
	  param, ^ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	* [r5535] src/winscard_clnt.c: SCardEndTransaction(): remove
	  useless code
	  
	  src/winscard_clnt.c:1269:2: warning: Value stored to 'randnum' is
	  never read randnum = 0; ^
	* [r5534] src/winscard.c: remove unused affectations
	  
	  src/winscard.c:565:4: warning: Value stored to 'rv' is never read
	  rv = IFDPowerICC(rContext, IFD_POWER_DOWN, NULL, NULL); ^
	  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	  src/winscard.c:835:4: warning: Value stored to 'rv' is never read
	  rv = IFDPowerICC(rContext, IFD_POWER_DOWN, NULL, NULL); ^
	  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	  src/winscard.c:1095:4: warning: Value stored to 'rv' is never
	  read rv = IFDPowerICC(rContext, IFD_POWER_DOWN, NULL, NULL); ^
	  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	* [r5533] clang-analyze.sh: Do not analyze tokenparser.c since it
	  is generated by flex
	* [r5532] src/readerfactory.c: RDR_CLIHANDLES_seeker(): avoid a
	  potential crash if NULL values are used
	  
	  src/readerfactory.c:72:30: warning: Dereference of null pointer
	  if (rdrCliHandles->hCard == *(SCARDHANDLE *)key) ^
	  src/readerfactory.c:72:21: warning: Dereference of null pointer
	  if (rdrCliHandles->hCard == *(SCARDHANDLE *)key) ^
	* [r5531] src/readerfactory.c: RFAddReader(): remove unused
	  affectation
	  
	  src/readerfactory.c:344:4: warning: Value stored to 'rv' is never
	  read rv = RFRemoveReader(readerName, port); ^
	  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	* [r5530] src/readerfactory.c: RFAddReaderHandle(): return the
	  error code if any
	  
	  src/readerfactory.c:1116:3: warning: Value stored to 'rv' is
	  never read rv = SCARD_E_NO_MEMORY; ^ ~~~~~~~~~~~~~~~~~
	  src/readerfactory.c:1103:3: warning: Value stored to 'rv' is
	  never read rv = SCARD_E_NO_MEMORY; ^ ~~~~~~~~~~~~~~~~~
	  src/readerfactory.c:1095:3: warning: Value stored to 'rv' is
	  never read rv = SCARD_E_NO_MEMORY; ^ ~~~~~~~~~~~~~~~~~

2011-01-18  Ludovic Rousseau

	* [r5525] src/pcscdaemon.c: Remove useless code
	  
	  src/pcscdaemon.c:85:2: warning: Value stored to 'rv' is never
	  read rv = 0; ^ ~ src/pcscdaemon.c:175:2: warning: Value stored to
	  'rv' is never read rv = 0; ^ ~
	* [r5524] src/ifdwrapper.c: IFDPowerICC(): remove useless code
	  
	  src/ifdwrapper.c:294:2: warning: Value stored to 'ret' is never
	  read ret = ATRDecodeAtr(&sSmartCard, pucAtr, *pdwAtrLen); ^
	  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	  src/ifdwrapper.c:268:2: warning: Value stored to 'rv' is never
	  read rv = IFD_SUCCESS; ^ ~~~~~~~~~~~
	* [r5523] src/eventhandler.c: EHStatusHandlerThread(): check the
	  return value of IFDStatusICC()
	  
	  Thanks to clang(1) for the warning src/eventhandler.c:235:2:
	  warning: Value stored to 'rv' is never read rv =
	  IFDStatusICC(rContext, &dwStatus); ^
	  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	* [r5522] src/eventhandler.c: EHStatusHandlerThread(): remove
	  unused code
	  
	  src/eventhandler.c:233:2: warning: Value stored to
	  'dwCurrentState' is never read dwCurrentState = 0; ^ ~
	  src/eventhandler.c:232:2: warning: Value stored to
	  'readerSharing' is never read readerSharing = 0; ^ ~
	* [r5521] src/atrhandler.c: ATRDecodeAtr(): remove unused code
	  
	  src/atrhandler.c:55:2: warning: Value stored to 'p' is never read
	  p = K = TCK = Y1i = T = 0; ^ ~~~~~~~~~~~~~~~~~~~~~
	  src/atrhandler.c:55:6: warning: Although the value stored to 'K'
	  is used in the enclosing expression, the value is never actually
	  read from 'K' p = K = TCK = Y1i = T = 0; ^ ~~~~~~~~~~~~~~~~~
	  src/atrhandler.c:55:10: warning: Although the value stored to
	  'TCK' is used in the enclosing expression, the value is never
	  actually read from 'TCK' p = K = TCK = Y1i = T = 0; ^ ~~~~~~~~~~~
	  src/atrhandler.c:55:16: warning: Although the value stored to
	  'Y1i' is used in the enclosing expression, the value is never
	  actually read from 'Y1i' p = K = TCK = Y1i = T = 0; ^ ~~~~~
	  src/atrhandler.c:55:22: warning: Although the value stored to 'T'
	  is used in the enclosing expression, the value is never actually
	  read from 'T' p = K = TCK = Y1i = T = 0; ^ ~
	* [r5520] clang-analyze.sh: script to call clang --analyze
	* [r5519] splint.sh: No more scf files since revision 4486
	* [r5518] src/winscard_clnt.c: SCardGetStatusChange(): avoids a
	  compiler warning
	  
	  winscard_clnt.c:1875:33: warning: comparison of integers of
	  different signs: 'uint32_t' (aka 'unsigned int') and 'int'
	  [-Wsign-compare] ...if (rContext->eventCounter != currentCounter)
	  ~~~~~~~~~~~~~~~~~~~~~~ ^ ~~~~~~~~~~~~~~
	* [r5517] src/readerfactory.c: Add an explicit cast to avoid a
	  compiler warning
	  
	  readerfactory.c:1033:45: warning: comparison of integers of
	  different signs: 'unsigned long' and 'SCARDHANDLE' (aka 'long')
	  [-Wsign-compare] if ((rContext->dwIdentity + randHandle) ==
	  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ ^

2011-01-14  Ludovic Rousseau

	* [r5509]
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange_PnP.py:
	  Also initialize the state of the PnP special reader (For Mac OS
	  X)
	* [r5508] src/hotplug_macosx.c: HPSearchHotPluggables(): use the
	  same naming convention as used by Apple PC/SC layer on Leopard
	  (and later). The reader friendly name is used instead of
	  "usb:%04x/%04x" as documented in IFDHandler v3 API at
	  http://pcsclite.alioth.debian.org/api/group__IFDHandler.html#gabb9fe35a68fa080ce9397f0b830b1e7e
	  
	  The same driver source code can be used by Apple PC/SC layer and
	  by this pcsc-lite.
	* [r5507] src/hotplug_macosx.c: Fix compiler warning
	  
	  hotplug_macosx.c: In function ‘HPDriversGetFromDirectory’:
	  hotplug_macosx.c:150: warning: comparison between signed and
	  unsigned
	* [r5506] c.sh: Remove commented CFLAGS definition
	* [r5505] src/PCSC/pcsclite.h.in, src/PCSC/wintypes.h: Mac OS X
	  "port" - Define Windows types as they are defined on Mac OS X in
	  /System/Library/Frameworks/PCSC.framework/Headers/wintypes.h -
	  Pack structures as they are packed on Mac OS X in
	  /System/Library/Frameworks/PCSC.framework/Headers/pcsclite.h
	  
	  With these changes it is possible to build this pcsc-lite on Mac
	  OS X and use it with an application built using the PCSC
	  Framework headers provided by Apple.
	  
	  One application is to temporarily replace the Apple PCSC layer by
	  a better/working one.
	* [r5504] src/PCSC/pcsclite.h.in: Use LONG instead of long for
	  SCARDCONTEXT and SCARDHANDLE so that the exact type can be easily
	  changed by editing PCSC/wintypes.h
	  
	  By default: typedef long LONG; so no change

2011-01-13  Ludovic Rousseau

	* [r5501] doc/pcscd.8.in: Remove references to a init.d/pcscd
	  script since pcscd is autostarted by default now.
	* [r5500] doc/reader.conf.5.in: Use @confdir_exp@ instead of
	  (removed) @confdir@

2011-01-12  Ludovic Rousseau

	* [r5498] doc/pcscd.8.in: Use @confdir_exp@ instead of
	  @sysconfdir_exp@
	  
	  Closes [#312929] @sysconfdir_exp@ not expanded in manual page

2011-01-07  Ludovic Rousseau

	* [r5496] src/readerfactory.c: RFAddReader(): correctly initialize
	  the pthCardEvent field for the other slots. The bug occured with
	  a multi slot reader and a driver with no
	  TAG_IFD_POLLING_THREAD_WITH_TIMEOUT function (as is the case with
	  my CCID driver since revision 5495)

2011-01-06  Ludovic Rousseau

	* [r5491] UnitaryTests/SCardConnect_DIRECT2.py: Add comments
	* [r5490] src/winscard.c: SCardDisconnect(): Switch to
	  POWER_STATE_GRACE_PERIOD unless the card was not powered
	  
	  In the previous implementation the state was changed to
	  POWER_STATE_GRACE_PERIOD only if the previous state was
	  POWER_STATE_INUSE. So if a SCARD_SHARE_DIRECT connection was used
	  the card state was not set POWER_STATE_INUSE and a power off
	  action was immediate at the SCardDisconnect(). Not nice if the
	  card is reused just after.

2011-01-04  Ludovic Rousseau

	* [r5478] src/winscard_svc.c: ContextThread(): in command
	  CMD_GET_READERS_STATE, wait until all the readers are ready (ATR
	  available) before sending the reader states.
	  
	  The problem arrives when you connect two readers at the same time
	  (and one of them is slow to get the ATR). SCardGetStatusChange()
	  must not exit with one reader in state READER_NOT_INITIALIZED (as
	  implemented in revision 5217)

2010-12-12  Ludovic Rousseau

	* [r5442] ChangeLog, configure.in: release 1.6.6
	* [r5441] src/simclist.c: Reapply change in revision 4986 since the
	  problem was not corrected in version 1.5 of simclist.

2010-12-11  Ludovic Rousseau

	* [r5440] src/winscard_msg.c: Use LONG instead of int to store
	  PC/SC return codes like SCARD_E_*
	  
	  The problem comes from sign extenstion from int to LONG int rv =
	  SCARD_E_TIMEOUT; /* 0x8010000A */ is (sign) extended into a LONG
	  = 0xFFFFFFFF8010000A
	  
	  So the line in winscard_clnt.c if (SCARD_E_TIMEOUT == rv) is
	  never true on a 64-bits system because rv has been extended from
	  int to LONG. The comparison is then between 0x8010000A and
	  0xFFFFFFFF8010000A

2010-12-08  Ludovic Rousseau

	* [r5434] src/PCSC/debuglog.h, src/PCSC/ifdhandler.h,
	  src/atrhandler.h, src/dyn_generic.h, src/eventhandler.h,
	  src/hotplug.h, src/ifdwrapper.h, src/misc.h, src/parser.h,
	  src/powermgt_generic.h, src/prothandler.h, src/readerfactory.h,
	  src/sys_generic.h, src/winscard_msg.h, src/winscard_svc.h: Do not
	  use extern "C" since we are in C and not C++
	  
	  Follow rule 13 of "On C Library Implementation" by Rusty Russell
	  http://rusty.ozlabs.org/?p=140

2010-12-03  Ludovic Rousseau

	* [r5429] src/configfile.l: Fix configfile.l: In function
	  'evaluatetoken': configfile.l:205: warning: assignment discards
	  qualifiers from pointer target type
	* [r5427] ChangeLog, configure.in: release 1.6.5

2010-11-26  Ludovic Rousseau

	* [r5420] src/simclist.c: From SimCList version 1.5
	  http://mij.oltrelinux.com/devel/simclist/

2010-11-23  Ludovic Rousseau

	* [r5415] src/eventhandler.c, src/readerfactory.c,
	  src/readerfactory.h, src/winscard.c: Add a mutex to make the test
	  and set of the powerState field atomic.

2010-11-22  Ludovic Rousseau

	* [r5414] src/eventhandler.c, src/winscard.c: Log the new
	  powerState value at DEBUG level
	* [r5412] src/readerfactory.c: Remove dead code

2010-11-16  Ludovic Rousseau

	* [r5402] src/winscard.c: SCardDisconnect(): change powerState to
	  POWER_STATE_GRACE_PERIOD only if the previous state was
	  POWER_STATE_INUSE
	  
	  If the powerState was POWER_STATE_UNPOWERED then do NOT change to
	  POWER_STATE_GRACE_PERIOD. POWER_STATE_GRACE_PERIOD indicates that
	  the card is powered on. That is the case if mode is
	  SCARD_SHARE_DIRECT at SCardConnect()
	* [r5401] src/winscard.c: SCardConnect(): change the power state to
	  POWER_STATE_INUSE only if the card has been powered on. The card
	  is NOT powered on if mode is SCARD_SHARE_DIRECT
	* [r5400] src/eventhandler.c, src/readerfactory.c: Move the zeroing
	  of the reader context from EHDestroyEventHandler() to
	  RFUnInitializeReader() where it is more appropriate.
	  
	  The reader context shall be valid until the reader is
	  uninitialized in RFUnInitializeReader() and most importantly
	  after IFDCloseIFD() is called.
	* [r5399] src/readerfactory.c: RFInitializeReader(): if
	  IFDOpenIFD() fails just mark the reader as "not correctly
	  started". This will present a call to IFDCloseIFD() in
	  RFUnInitializeReader() (revision 5393)

2010-11-09  Ludovic Rousseau

	* [r5393] src/readerfactory.c: RFUnInitializeReader(): Do not close
	  a reader if IFDOpenIFD() failed in RFInitializeReader()
	* [r5392] src/readerfactory.c: RFRemoveReader(): destroy the event
	  handler only if it exists already

2010-11-08  Ludovic Rousseau

	* [r5391] src/winscard_msg_srv.c: ProcessCommonChannelRequest(): no
	  need to define serv_adr as static. Free a few bytes of memory.
	* [r5390] src/winscard_msg.c, src/winscard_msg.h,
	  src/winscard_msg_srv.c: Remove CleanupSharedSegment() and do not
	  call it anymore
	  
	  The function is not about shared segment any more The file
	  PCSCLITE_CSOCK_NAME will be removed in clean_temp_files() at exit
	  anyway
	* [r5388] src/winscard_msg.c: MessageSend(): return
	  SCARD_E_NO_SERVICE instead of SCARD_F_COMM_ERROR if the daemon
	  died and we reveice a EPIPE error.
	* [r5387] src/winscard_msg.c: MessageSendWithHeader(): do not send
	  a 0 length buffer.
	  
	  Some commands only have a header and no data like
	  CMD_GET_READERS_STATE
	* [r5386] src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_svc.c: MessageReceiveTimeout(),
	  MessageSendWithHeader(), MessageSend() and MessageReceive() now
	  returns a PC/SC error code instead of an internal value. So the
	  callers can just return the error code to the application with no
	  transcoding.
	* [r5385] src/winscard_clnt.c: Move SCardInvalidateHandles() in the
	  same #ifdef DO_CHECK_SAME_PROCESS as SCardCheckSameProcess()
	  since it is only used in this case.
	* [r5384] src/winscard_clnt.c: No need to check the server pid
	  anymore. If the server is restarted the socket communication will
	  fail and an "RPC transport error" SCARD_F_COMM_ERROR error will
	  be returned
	  
	  This check was needed when the readers state was stored in
	  /var/run/pcscd/pcscd.pub. But that is no more the case. Every
	  command now uses the client/server Unix socket.

2010-11-05  Ludovic Rousseau

	* [r5379] src/winscard_msg.h: InitializeSocket() and
	  ProcessEventsServer() are used by the server side so must be
	  declared in the #ifdef PCSCD part of the header file
	* [r5378] src/winscard_msg.h: Add missing getSocketName()
	  declaration used by winscard_clnt.c and winscard_msg.c
	* [r5377] src/winscard_msg.h: Reorder the function definitions as
	  they are in winscard_msg.c in revision 5371
	* [r5376] src/readerfactory.h: Remove definition of FctMap_V1 now
	  useless since revision 5321
	* [r5375] src/atrhandler.c, src/atrhandler.h: Remove typedef of
	  PSMARTCARD_EXTENSION and use SMARTCARD_EXTENSION * instead

2010-11-04  Ludovic Rousseau

	* [r5373] src/winscard_clnt.c, src/winscard_msg.c: It is now
	  possible to configure the local socket name to use using the
	  environment variable PCSCLITE_CSOCK_NAME
	  
	  This is used by Estobuntu LTSP to redirect the smart card reader
	  on the light terminal display to the application running on the
	  server. They use a patched SSH version to redirect
	  /var/run/pcscd/pcscd.comm on the client to ~/.pcscd.comm on the
	  server.
	* [r5372] src/winscard_msg.c: MessageReceiveTimeout(): remove pcscd
	  specific code inside a function used only by libpcsclite
	* [r5371] src/winscard_msg.c: reorganize the functions in 3
	  categories: - functions used by pcscd only:
	  CleanupSharedSegment() - functions used by libpcsclite only:
	  ClientSetupSession(), ClientCloseSession(),
	  MessageReceiveTimeout(), MessageSendWithHeader() - functions used
	  by pcscd and libpcsclite: MessageSend(), MessageReceive()
	  
	  We gain on the code size: 1104 bytes for pcscd and 101 bytes for
	  libpcsclite

2010-11-03  Ludovic Rousseau

	* [r5370] src/atrhandler.c: ATRDecodeAtr(): avoids a buffer
	  overflow with badly formed ATR like 3B FF 11 22 33 F0 11 22 33 F0
	  11 22 33 F0 11 22 33 F0 11 22 33 F0 11 22 33 F0 11 22 33 00 11 22
	  33
	  
	  Thanks to Rafael Dominguez Vega for the bug report

2010-10-28  Ludovic Rousseau

	* [r5368] src/winscard.c: Move declaration of dwAtrLen closer to
	  where it is used.
	* [r5367] src/winscard.c: SCardConnect(): log the ATR in case of
	  auto power on
	  
	  The ATR may be different from the previous one if the card has a
	  cold and a warm ATR.

2010-10-26  Ludovic Rousseau

	* [r5364] src/winscard.c: SCardDisconnect(): check for card removal
	  in case DISABLE_AUTO_POWER_ON
	* [r5359] src/winscard.c: Doxygen documentation is done on the
	  client side (winscard_clnt.c) so remove documentation of
	  SCardEstablishContext()
	* [r5358] src/winscard.c: SCardTransmit(): do not check for NULL
	  pointers since we are called from ContextThread() with correct
	  values
	* [r5357] src/winscard.c: SCardReconnect(): do not check for
	  pdwActiveProtocol NULL pointer since we are called from
	  ContextThread() with a correct value
	* [r5356] src/winscard.c: SCardConnect(): do not check for NULL
	  pointers since we are called from ContextThread() with correct
	  values
	* [r5355] src/winscard.c: SCardEstablishContext(): do not check for
	  phContext NULL pointer since we are called from ContextThread()
	  with a correct value

2010-10-25  Ludovic Rousseau

	* [r5354] src/winscard.c: SCardConnect(): test for not
	  SCARD_POWERED instead of SCARD_SWALLOWED
	* [r5351] src/hotplug_linux.c: Use the new bundle parser code
	* [r5350] src/winscard.c: SCardConnect(): log an error if auto
	  power on failed
	* [r5349] Makefile.am: Add a fix-rights rule at the top level to
	  call the fix-rights rule in src/

2010-10-23  Ludovic Rousseau

	* [r5348] src/winscard.c: SCardConnect(): check the returned value
	  of IFDPowerICC() to change the readerState if power up succeeded
	* [r5347] src/winscard.c: SCardConnect(): power up the card before
	  checking for its SCARD_SWALLOWED state.
	  
	  If a card fails to power up on card insertion a new power up will
	  be tried on SCardConnect().

2010-10-22  Ludovic Rousseau

	* [r5346] src/winscard_clnt.c: Remove the "This function " in the
	  Doxygen brief line
	* [r5345] UnitaryTests/SCardCancel2.py: SCardCancel() should do
	  nothing if no cancellable call is ongoing bug fixed in revision
	  5344
	* [r5344] src/winscard_clnt.c: Only SCardGetStatusChange() can be
	  cancelled using SCardCancel()
	  
	  Thanks to Jan Rochat for the bug report
	  https://bugs.launchpad.net/ubuntu/+source/pcsc-lite/+bug/647545
	* [r5343] src/eventhandler.c, src/eventhandler.h,
	  src/hotplug_libhal.c, src/hotplug_macosx.c, src/ifdwrapper.c,
	  src/misc.h, src/pcscdaemon.c, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.c: Remove spaces and tabs
	  at end of line
	* [r5342] src/winscard_svc.c: Reformat
	* [r5341] src/PCSC/winscard.h, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.h, src/winscard_svc.c: SCardCancelTransaction()
	  is no more provided. This function is not provided by Microsoft
	  and is deprecated since 2005 in pcsc-lite.
	* [r5340] src/winscard.c: Reindent
	* [r5339] src/winscard_clnt.c: Reformat
	* [r5338] src/PCSC/winscard.h, src/winscard_clnt.c:
	  SCardSetTimeout() is no more provided. This function is not
	  provided by Microsoft and is deprecated since 2004 in pcsc-lite.
	* [r5337] src/winscard.c: SCardSetTimeout() is implemented (and
	  deprecated) on the client side
	* [r5336] src/winscard.c: SCardListReaders() and SCardCancel() are
	  implemented on the client side
	* [r5335] src/winscard.c: SCardDisconnect(): if
	  DISABLE_AUTO_POWER_ON is defined then do not power on the card if
	  SCARD_UNPOWER_CARD is used.
	* [r5334] src/eventhandler.c, src/pcscd.h.in: Move
	  DISABLE_ON_DEMAND_POWER_ON and DISABLE_AUTO_POWER_ON defines from
	  eventhandler.c to pcscd.h.in so they are visible by all the .c
	  files
	* [r5333] src/winscard.c: SCardConnect(): remove debug log

2010-10-21  Ludovic Rousseau

	* [r5332] src/eventhandler.c: If DISABLE_AUTO_POWER_ON is defined
	  then do not automatically power on the card. The card will be
	  powered on on the first SCardConnect()
	* [r5331] src/readerfactory.c: Remove extra parenthesis We are
	  using C not Lisp :-)
	* [r5328] TODO, src/PCSC/ifdhandler.h, src/eventhandler.c,
	  src/eventhandler.h, src/pcscd.h.in, src/readerfactory.c,
	  src/readerfactory.h, src/winscard.c: Power on the card _only_ if
	  an application requests a connection see Alioth bug #301965
	  
	  You can disable the feature using DISABLE_ON_DEMAND_POWER_ON in
	  src/eventhandler.c

2010-10-17  Ludovic Rousseau

	* [r5324] src/Makefile.am: PCSC/reader.h is no more generated from
	  PCSC/reader.h.in Directly use the filename in
	  nobase_include_HEADERS

2010-10-15  Ludovic Rousseau

	* [r5323] UnitaryTests/SCardStatus.py: Add a call to
	  SCardDisconnect() before SCardReleaseContext()
	* [r5322] src/eventhandler.h, src/winscard.c, src/winscard_clnt.c:
	  Rename the sharing states unsing the PCSCLITE_SHARING_ prefix
	  Doxygen: document the READER_STATE structure
	* [r5321] src/PCSC/ifdhandler.h, src/eventhandler.c,
	  src/ifdwrapper.c, src/ifdwrapper.h, src/readerfactory.c,
	  src/readerfactory.h: Remove the support of IFDHandler v1 API. I
	  don't know any driver using this API.
	  
	  We can now simplify the API of IFDStatusICC() and remove the ATR
	  related parameters. These paremeters were only used by the
	  IFDHandler v1 API.
	  
	  diffstat says: 6 files changed, 51 insertions(+), 335
	  deletions(-)

2010-10-14  Ludovic Rousseau

	* [r5317] src/hotplug_libhal.c: ifdCapabilities driver feature is
	  not used with libhal (and has never been). Remove dead/unused
	  code.

2010-10-13  Ludovic Rousseau

	* [r5316] src/winscard.c: Reformat
	* [r5315] src/readerfactory.c, src/winscard.c: Use the simpler form
	  of IFDPowerICC(..., IFD_POWER_DOWN, ...) introduced in revision
	  5314
	* [r5314] src/ifdwrapper.c: IFDPowerICC(): allow to use NULL for
	  pucAtr and pdwAtrLen to make power down easy with
	  IFDPowerICC(rContext, IFD_POWER_DOWN, NULL, NULL);
	* [r5313] src/winscard.c: Correctly set dwAtrLen to the sizeof the
	  ATR array before calling IFDPowerICC().
	  
	  Some drivers do not write more that dwAtrLen bytes in cardAtr
	  array.

2010-10-12  Ludovic Rousseau

	* [r5308] src/winscard_msg.h: Doxygen: SCARD_GET_STATUS_CHANGE is
	  not used anymore
	* [r5307] src/winscard.c: Remove SCardStatus() (dead code) on the
	  server side.
	* [r5306] src/winscard.c: SCardEndTransaction(): use the same code
	  to reset a card as in revision 5301
	* [r5305] src/winscard.c: SCardReconnect(), SCardDisconnect() and
	  SCardEndTransaction(): reset the value of dwAtrLen before the
	  second call to IFDPowerICC() so that the driver gets a correct
	  value if the first call to IFDPowerICC(IFD_POWER_DOWN) set
	  dwAtrLen=0
	  
	  Thanks to Frank Morgner for the bug report Closes: [#312754]
	  IFDHPowerICC is called with IFD_POWER_UP and *AtrLength==0
	* [r5304] src/pcsc-wirecheck-gen.c, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.h, src/winscard_svc.c: A
	  large part of SCardStatus() is done on the client side using
	  readerStates[]. So remove a few lines of dead code on the server
	  side.
	* [r5303] UnitaryTests/SCardStatus.py: Call SCardStatus() a second
	  time after a keypress
	* [r5302] UnitaryTests/SCardStatus.py: Unit test for SCardStatus()
	* [r5301] src/winscard.c: SCardReconnect(): Reorganize the code to
	  manage ATR and readerState after a power up. Remove a call to
	  IFDStatusICC() to know if a card is present or not since
	  IFDPowerICC() already gives us this information.
	  
	  SCardDisconnect(): Use the same code as above
	* [r5300] src/eventhandler.c, src/winscard.c, src/winscard_clnt.c:
	  Use uint32_t readerState instead of DWORD dwStatus to store the
	  state of the reader. DWORD and uint32_t may be different.
	* [r5299] src/winscard.c: SCardReconnect(): return
	  SCARD_E_NO_SMARTCARD when card is removed and
	  SCARD_W_UNRESPONSIVE_CARD when card is unresponsive instead of
	  SCARD_E_PROTO_MISMATCH
	* [r5298] src/winscard_msg.h: Increment minor version because of
	  changes in revision 5290
	* [r5297] doc/Makefile.am, doc/ifdhandler-3.tex: Remove the
	  deprecated LaTeX version of IFDHandler documentation

2010-10-11  Ludovic Rousseau

	* [r5296] src/configfile.l: evaluatetoken(): the CHANNELID
	  parameter can also be a decimal number.
	* [r5294] src/PCSC/ifdhandler.h, src/configfile.l: reader.conf
	  configuration: If you want to use IFDHCreateChannel() instead of
	  IFDHCreateChannelByName() then do not use any DEVICENAME line in
	  the configuration file. IFDHCreateChannel() will then be called
	  with the CHANNELID parameter.
	  
	  Closes: [#312749] Should call IFDHCreateChannel for serial driver
	  with DEVICENAME /dev/null
	* [r5293] src/readerfactory.c, src/winscard_clnt.c,
	  src/winscard_svc.c: list_* functions return an decimal integer so
	  use %d insteaf of %X to log the error value.
	* [r5292] src/readerfactory.c: Add a "0x" before hex displays

2010-10-10  Ludovic Rousseau

	* [r5291] src/winscard_clnt.c: Doxygen SCardStatus(): *pdwState
	  also contains a number of events
	* [r5290] src/eventhandler.c, src/eventhandler.h,
	  src/winscard_clnt.c: Split the card event counter out of the card
	  event state on the pcscd side to simplify the code in
	  EHStatusHandlerThread()
	  
	  The two information are combined on the client side in
	  SCardGetStatusChange() and SCardStatus()
	* [r5289]
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange_loop.py:
	  Exit the endless loop in case of error
	* [r5288] src/PCSC/pcsclite.h.in: struct SCARD_READERSTATE: use
	  "DWORD" instead of "unsigned long" type for the fields
	  dwCurrentState, dwEventState and cbAtr
	  
	  This is compliant to the Windows definition and allows to
	  redefine DWORD to something other than unsigned long, like
	  uint32_t
	* [r5287] src/PCSC/pcsclite.h.in, src/error.c:
	  pcsc_stringify_error(): Use "LONG" instead of "long" as parameter
	  type to reflect the return type from winscard.h
	  
	  The LONG type may be redefined in PCSC/wintypes.h to int32_t for
	  example

2010-10-05  Ludovic Rousseau

	* [r5281] src/winscard_clnt.c: Doxygen: do not document unused
	  SCARD_STATE_ATRMATCH and SCARD_STATE_PRESENT states in
	  SCardGetStatusChange()
	  
	  Thanks to Martin Paljak for the patch
	* [r5280]
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange_loop.py:
	  Call SCardGetStatusChange() in a endless loop
	* [r5279] src/tokenparser.l: Doxygen: fix documentation of
	  LTPBundleFindValueWithKey()
	* [r5278] src/winscard_clnt.c: SCardGetStatusChange(): include the
	  event counter in dwEventState even if dwCurrentState contains a
	  counter at 0 (default).
	* [r5277] doc/doxygen.conf.in: Update from Doxygen 1.5.5 to 1.7.1
	  
	  warning: Tag `DETAILS_AT_TOP' at line 163 of file
	  doc/doxygen.conf has become obsolete. To avoid this warning
	  please update your configuration file using "doxygen -u"

2010-10-01  Ludovic Rousseau

	* [r5275] src/pcscdaemon.c: main(): do not limit rights if run as
	  root

2010-09-19  Ludovic Rousseau

	* [r5262] src/Makefile.am: Do not change the access rights of pcscd
	  in the install rule but in another one. This is needed when
	  building the package in a system without the pcscd group.

2010-09-14  Ludovic Rousseau

	* [r5256] configure.in: Do not generate src/PCSC/reader.h from
	  src/PCSC/reader.h.in any more
	* [r5255] src/PCSC/reader.h: HOST_TO_CCID_16() and
	  HOST_TO_CCID_32() are now identity functions
	  
	  Since CCID 1.4.1 (revision 5252) the byte order is no more
	  important
	* [r5254] src/PCSC/reader.h, src/PCSC/reader.h.in: Rename
	  reader.h.in in reader.h

2010-09-04  Ludovic Rousseau

	* [r5245] src/Makefile.am: Install pcscd as sgid pcscd instead of
	  suid root
	* [r5241] src/hotplug_libhal.c: HPReadBundleValues(): do not fail
	  if the key "CFBundleName" is not found in a driver Info.plist.
	  This key should only be defined for the CCID class driver.

2010-09-03  Ludovic Rousseau

	* [r5231] src/winscard_msg.c: Doxygen: remove documentation about
	  the (now removed) timeOut parameter of MessageSend() and
	  MessageSendWithHeader()

2010-09-02  Ludovic Rousseau

	* [r5227] src/winscard_clnt.c: Doxygen: clarify the use of one
	  different SCARDCONTEXT per thread and the expection for
	  SCardCancel()
	* [r5226] src/winscard_svc.c: Remove protocol_major, protocol_minor
	  fields from struct _psContext since they are not used.
	* [r5225] src/winscard_msg.h: update PROTOCOL_VERSION_MINOR since
	  struct pubReaderStatesList changed (readerID removed)
	* [r5224] src/winscard_svc.c: ContextThread(): check that the
	  procotol major.minor is the same for the daemon and lib. If not
	  just fail. We are not backward compatible.
	* [r5219] src/winscard_clnt.c: Complete change in revision 5212
	  
	  SCardGetStatusChange() and SCardListReaders() were broken.
	* [r5218] src/ifdwrapper.c, src/readerfactory.c,
	  src/readerfactory.h: Rename lpcLibrary in library and lpcDevice
	  in device
	* [r5217] src/eventhandler.c, src/eventhandler.h, src/pcscdaemon.c,
	  src/readerfactory.c, src/readerfactory.h: Wait until all
	  connected readers have a chance to power up a possibly inserted
	  card.
	  
	  This is needed when auto start is used and a card is already
	  present in a USB reader. The reader presence is correctly
	  reported to libpcsclite but the power up has not yet happen. So
	  the ATR is not yet available.
	* [r5216] src/eventhandler.c, src/readerfactory.c,
	  src/readerfactory.h, src/winscard_clnt.c: Rename lpcReaderName in
	  readerName and use (char *) instead of LPSTR
	* [r5215] src/eventhandler.c, src/readerfactory.c,
	  src/readerfactory.h, src/winscard.c: Get rid of the lpcReader[]
	  field in struct ReaderContext
	  
	  The reader name is already present in readerState->readerName
	  linked from struct ReaderContext
	  
	  Gain: MAX_READERNAME*PCSCLITE_MAX_READERS_CONTEXTS = 100*16 =
	  1600 bytes fo RAM on pcscd
	* [r5214] src/winscard.c: SCardStatus(): remove a useless test
	  
	  lpcReader can't be larger than MAX_BUFFER_SIZE (264) since its
	  buffer is only MAX_READERNAME (100) bytes long. And I don't see
	  why we need this test anyway.
	* [r5213] src/eventhandler.c, src/winscard.c: Complete change
	  started in revision 5212
	  
	  rContext->readerState is never NULL now. So do not even check its
	  value.
	* [r5212] src/eventhandler.c, src/eventhandler.h,
	  src/pcsc-wirecheck-gen.c, src/readerfactory.c,
	  src/winscard_clnt.c: Get rid of the readerID field in struct
	  pubReaderStatesList
	* [r5211] src/readerfactory.c, src/readerfactory.h: Remove unused
	  RFSuspendAllReaders() and RFAwakeAllReaders()

2010-08-31  Ludovic Rousseau

	* [r5204] src/eventhandler.c: Reformat

2010-08-30  Ludovic Rousseau

	* [r5202] src/winscard_msg_srv.c: InitializeSocket(): do not set
	  the execution bit on the socket file. It is useless.

2010-08-27  Ludovic Rousseau

	* [r5196] src/debug.c, src/error.c, src/utils.c, src/utils.h: svn
	  propset svn:keywords 'Author Date Id Revision'
	* [r5195] src/utils.c: GetDaemonPid(): use open(3) instead of
	  fopen(3) to avoid an internal malloc() call and gain some CPU
	  cycles
	* [r5194] src/hotplug_libhal.c: HPAddDevice(): wait 1 millisecond
	  instead of 1 second until the device is visible to libusb/etc.

2010-08-25  Ludovic Rousseau

	* [r5183] src/winscard_clnt.c: Doxygen:
	  SCardCheckDaemonAvailability() do not invalidate handles after a
	  fork() any more

2010-08-23  Ludovic Rousseau

	* [r5179] src/hotplug_libusb.c: HPReadBundleValues(): use the new
	  Info.plist parsing API.
	  
	  Parsing the CCID Info.plist (159 readers supported) was on a ARM9
	  machine 13193049 µs and is now 258262 µs => gain x51 or 5008%
	* [r5178] src/readerfactory.c: RFBindFunctions(): rename rv in rvl
	  to avoid warnings warning: declaration of ‘rv’ shadows a previous
	  local
	  
	  Also change type from DWORD to int since DYN_GetAddress() returns
	  an int
	* [r5177] src/readerfactory.c: RFLoadReader(): optimize the
	  detection of Ifd Handler version by checking for
	  "IFDHCreateChannelByName", "IFDHCreateChannel" and then
	  "IO_Create_Channel" instead of the 3 symbols at once.
	  
	  Also suppress the error message suppression. Ifd handler v2 or v1
	  will display one or two errors for symbols not found.
	* [r5175] src/hotplug_libhal.c: HPReadBundleValues(): duplicate the
	  readerName and CFBundleName strings since the originals are
	  destroyed by bundleRelease() later
	  
	  The reader names were corrupted.

2010-08-18  Ludovic Rousseau

	* [r5160] ChangeLog: Fix typo

2010-08-17  Ludovic Rousseau

	* [r5157] src/hotplug_libhal.c: HPReadBundleValues(): use the new
	  Info.plist parsing API.
	  
	  Parsing the CCID Info.plist (159 readers supported) was on a i386
	  machine 264306 µs and is now 5547 µs => gain x47 or 4600%
	* [r5156] src/parser.h, src/tokenparser.l: parse the Info.plist
	  file only once and generate a list of key/values
	* [r5152] src/hotplug_libusb.c: HPSearchHotPluggables(): create the
	  synchronisation pipe only if the HPEstablishUSBNotifications
	  thread is created. Avoids to leak resources.
	* [r5151] src/hotplug_libusb.c: HPSearchHotPluggables(): wait for
	  initial readers to setup only if HPEstablishUSBNotifications is
	  created. Otherwise the process is blocked for ever.
	* [r5150] src/hotplug_libhal.c: HPRegisterForHotplugEvents():
	  having no bundle for USB readers is not an error. USB
	  support/hotplug is just disabled.
	* [r5149] src/pcscdaemon.c: main(): Log a message if
	  HPRegisterForHotplugEvents() fails
	* [r5148] src/hotplug_libusb.c: Do not hardcode the libusb-1.0
	  include header path (remove the libusb-1.0/ part)

2010-08-16  Ludovic Rousseau

	* [r5147] configure.in: Do not hardcode the libusb.h path.
	  
	  See Debian bug #591782 ccid: FTBFS on kfreebsd-*: configure:
	  error: libusb.h not found
	* [r5146] c.sh: add --sysconfdir=/etc
	* [r5145] src/pcscdaemon.c: Do not allow restricting defaults
	  values of --max-thread, --max-card-handle-per-thread or
	  --max-card-handle-per-reader when restricted
	* [r5144] src/pcscdaemon.c: Do not allow APDU logging when
	  restricted
	* [r5143] src/pcscdaemon.c: If the process is setuid or setgid it
	  may have some restrictions
	  
	  Do not allow to specify a configuration file when restricted

2010-08-15  Ludovic Rousseau

	* [r5138] ChangeLog, configure.in: release 1.6.4
	* [r5137] configure.in: Do not use sysconfdir as configuration
	  directory but ${sysconfdir}/reader.conf.d instead.
	  
	  Use --enable-confdir=DIR if you want to set a specific value
	  without the reader.conf.d appended.
	  
	  Thanks to Kalev Lember for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q3/0150.html
	* [r5135] ChangeLog, configure.in: release 1.6.3
	* [r5134] src/PCSC/pcsclite.h.in, src/PCSC/winscard.h: Define
	  LPSCARD_READERSTATE since this is used in the MSDN prototype.
	  
	  Use LPSCARD_READERSTATE in winscard.h instead of
	  (SCARD_READERSTATE *) to mimic the MSDN API.
	  
	  This partly reverts changeset 5096

2010-08-13  Ludovic Rousseau

	* [r5130] UnitaryTests/SCard_fork.py: Also call SCardDisconnect()
	  and SCardReleaseContext() in the forked process
	* [r5129] src/winscard_svc.c: ContextThread(): goto exit if
	  MSGCheckHandleAssociation() fails instead of just returning no
	  error.
	  
	  Something wrong happened on the client side (like a fork) and the
	  client needs to call SCardEstablishContext() to create a new
	  connection.
	* [r5128] src/winscard_svc.c: ContextThread(): fix goto label when
	  it _is_ an overflow
	* [r5127] src/winscard_svc.c: ContextThread(): fix goto label when
	  it is not an overflow
	* [r5126] src/winscard_clnt.c: Revert changeset 5102 to add
	  profiling on the client side again.
	  
	  ltrace(1) can't be used with a dynamically loaded (dlopen(3))
	  library like it is the case with the majority of PKCS#11 client
	  application.
	* [r5125] src/simclist.c: Reset mid field when the list is empty to
	  avoid assert() errors
	* [r5124] src/winscard_svc.c: MSGCheckHandleAssociation(): check
	  that the context handle is still valid. Calling a PC/SC function
	  after SCardReleaseContext() is not supported.
	* [r5123] src/eventhandler.c: Fix typo in comment

2010-08-05  Ludovic Rousseau

	* [r5118] configure.in: remove debug line
	* [r5117] configure.in: "/reader.conf.d" is only appended to
	  sysconfdir if no value of sysconfdir is provided
	  
	  Thanks to Patrice Angelini for the bug report
	* [r5114] src/hotplug_libusb.c: HPAddHotPluggable(): do not use
	  libusb_strerror() since it is not yet available in current stable
	  libusb (1.0.8)
	* [r5113] src/ifdwrapper.c: Fix compilation warnings
	  ifdwrapper.c:166:7: warning: "IFDHANDLERv2" is not defined
	  ifdwrapper.c:589:7: warning: "IFDHANDLERv2" is not defined
	  ifdwrapper.c:640:7: warning: "IFDHANDLERv3" is not defined
	* [r5112] src/ifdwrapper.c: Check that either IFDHANDLERv1,
	  IFDHANDLERv2 or IFDHANDLERv3 is defined if PCSCLITE_STATIC_DRIVER
	  is used
	* [r5111] c.sh: No need to use -D_REENTRANT. It was needed for
	  LinuxThreads but we do not use LinuxThreads since a long time.
	  
	  See Debian bug #475101 "Remove obsolete -D_REENTRANT requirement"

2010-08-04  Ludovic Rousseau

	* [r5107] ChangeLog, configure.in: release 1.6.2
	* [r5106] src/Makefile.am: Remove useless $(COREFOUNDATION) from
	  libpcsclite_la_LIBADD The library has no Mac OS X specific code.
	* [r5105] src/Makefile.am: Remove undefined $(LIBSMARTCARD) from
	  libpcsclite_la_LIBADD
	* [r5104] src/Makefile.am: libpcsclite does not use dlopen() so no
	  need to link with $(LIBDL)

2010-08-03  Ludovic Rousseau

	* [r5102] src/winscard_clnt.c: Remove client side profiling since
	  we can use ltrace(1) with better results
	* [r5098] configure.in: Remove 2 debug traces

2010-08-02  Ludovic Rousseau

	* [r5097] src/PCSC/winscard.h, src/winscard.c, src/winscard_clnt.c:
	  Use "SCARD_IO_REQUEST *" instead of LPSCARD_IO_REQUEST and "const
	  SCARD_IO_REQUEST *" instead of "LPCSCARD_IO_REQUEST
	  
	  Should make the code more easy to read
	* [r5096] doc/example/pcsc_demo.c, src/PCSC/pcsclite.h.in,
	  src/PCSC/winscard.h, src/testpcsc.c, src/utils/formaticc.c,
	  src/winscard.c, src/winscard_clnt.c: Use SCARD_READERSTATE
	  instead of SCARD_READERSTATE_A
	  
	  Remove definitions of SCARD_READERSTATE_A PSCARD_READERSTATE_A
	  and LPSCARD_READERSTATE_A types
	* [r5093] configure.in: Use $libdir instead of $prefix/lib to set
	  the default value of usbdropdir
	  
	  " Fedora uses /usr/lib on 32 bit and /usr/lib64 on 64 bit
	  multilib platforms. "
	  
	  Thanks to Kalev Lember for the idea.
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q3/0108.html
	* [r5092] c.sh: sysconfdir=/etc by default if prefix=/usr so remove
	  the --sysconfdir line
	* [r5091] UnitaryTests/SCardBeginTransaction_Disconnect.py,
	  UnitaryTests/SCardConnect_DIRECT.py,
	  UnitaryTests/SCardConnect_DIRECT2.py,
	  UnitaryTests/SCardExclusiveBehaviour.py,
	  UnitaryTests/SCardReconnect.py, UnitaryTests/reset_card.py: Do
	  not duplicate the reader index to avoids problems when I want to
	  change it.

2010-08-01  Ludovic Rousseau

	* [r5082] configure.in: Set sysconfdir to /etc if prefix=/usr
	  
	  You should have a default working configuration only with
	  --prefix=/usr

2010-07-31  Ludovic Rousseau

	* [r5081] c.sh: --enable-muscledropdir is no more supported by
	  pcsc-lite since a long time. So remove the line.
	* [r5080] c.sh: --enable-usbdropdir=/usr/lib/pcsc/drivers is now
	  the default value. So remove the line.
	* [r5079] configure.in: Default value of usbdropdir is now
	  $prefix/lib/pcsc/drivers instead of $prefix/pcsc/drivers
	  
	  The new path is the path used on Debian (with prefix-/usr). So no
	  need to change the default value.

2010-07-27  Ludovic Rousseau

	* [r5073] src/Makefile.am: Create empty directories used by drivers
	  
	  Thanks to Kalev Lember for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q3/0065.html

2010-07-26  Ludovic Rousseau

	* [r5071] src/hotplug_libhal.c, src/pcscdaemon.c, src/utils.c,
	  src/winscard.c: Do not affect and check a variable on the same
	  line
	* [r5070] src/readerfactory.c: reformat
	* [r5069] src/winscard.c: Get the value of rContext before its use.
	  A simple call to SCardTransmit() crashed with a NULL pointer.

2010-07-08  Ludovic Rousseau

	* [r5066] src/readerfactory.c: fix crash with empty config dir
	  
	  Thanks to Kalev Lember for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q3/0017.html
	  
	  pcscd attempts to read uninitialized memory and free an invalid
	  pointer when its configuration directory is empty.
	  
	  The patch fixes this by initializing reader_list to NULL.
	  
	  ==2658== Conditional jump or move depends on uninitialised
	  value(s) ==2658== at 0x40A2EF: RFStartSerialReaders
	  (readerfactory.c:1324) ==2658== by 0x40743F: main
	  (pcscdaemon.c:522) ==2658== ==2658== Use of uninitialised value
	  of size 8 ==2658== at 0x40A2F5: RFStartSerialReaders
	  (readerfactory.c:1327) ==2658== by 0x40743F: main
	  (pcscdaemon.c:522) ==2658== ==2658== Conditional jump or move
	  depends on uninitialised value(s) ==2658== at 0x4C26D25: free
	  (vg_replace_malloc.c:325) ==2658== by 0x40A404:
	  RFStartSerialReaders (readerfactory.c:1348) ==2658== by 0x40743F:
	  main (pcscdaemon.c:522) ==2658== ==2658== Invalid free() / delete
	  / delete[] ==2658== at 0x4C26D72: free (vg_replace_malloc.c:325)
	  ==2658== by 0x40A404: RFStartSerialReaders (readerfactory.c:1348)
	  ==2658== by 0x40743F: main (pcscdaemon.c:522) ==2658== Address
	  0x4222148 is not stack'd, malloc'd or (recently) free'd
	  
	  --- pcsc-lite-1.6.1/src/readerfactory.c.orig2010-07-04
	  23:42:14.000000000 +0300 +++
	  pcsc-lite-1.6.1/src/readerfactory.configuration2010-07-04
	  23:42:23.000000000 +0300 @@ -1312,7 +1312,7 @@ void
	  RFCleanupReaders(void) #ifdef USE_SERIAL int
	  RFStartSerialReaders(const char *readerconf) {
	  -readerconfSerialReader *reader_list; +reader_listSerialReader
	  *reader_list = NULL; int i, rv; /* remember the configuration
	  filename for * RFReCheckReaderConf() */
	* [r5065] c.sh, configure.in, src/pcscd.h.in: more idiomatic
	  sysconfdir usage
	  
	  Thanks to Kalev Lember for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q3/0015.html
	  
	  > URL: http://svn.debian.org/wsvn/pcsclite/?sc=1&rev=5060 > Log:
	  set --sysconfdir=/etc/reader.conf.d so that we parse any file in
	  > this directory > > [...] > - --sysconfdir=/etc \ > +
	  --sysconfdir=/etc/reader.conf.d \
	  
	  It's more common to set sysconfdir to /etc and have configure
	  script figure out the subdirectory. The configure script should
	  always default to sane values when no arguments are specified.
	  The default value for sysconfdir is /usr/local/etc; so the
	  configure script should just append /reader.conf.d to that. Right
	  now if the user doesn't override sysconfdir, pcsc will try to go
	  through every .conf file in /usr/local/etc, and I don't think
	  anything good will come out of that.
	  
	  I have a patch attached which should make it more idiomatic:
	  default to $sysconfdir/reader.conf.d directory.

2010-07-02  Ludovic Rousseau

	* [r5062] src/pcscd.h.in: remove PCSCLITE_READER_CONFIG now useless
	* [r5061] src/pcscdaemon.c: main(): use PCSCLITE_CONFIG_DIR instead
	  of PCSCLITE_READER_CONFIG to use the directory configured using
	  --sysconfdir=...
	* [r5060] c.sh: set --sysconfdir=/etc/reader.conf.d so that we
	  parse any file in this directory
	* [r5059] src/configfile.l: DBGetReaderListDir(): add a log line
	  when parsing a directory (containing config files)
	* [r5058] src/readerfactory.c, src/readerfactory.h, src/winscard.c:
	  RFCheckSharing(), RFLockSharing(), RFUnlockSharing() &
	  RFUnlockAllSharing(): add the READER_CONTEXT * rContext parameter
	  to avoid recomputing it internally (gain a few CPU cycles)

2010-06-29  Ludovic Rousseau

	* [r5047] src/configfile.h, src/configfile.l, src/debuglog.c,
	  src/dyn_hpux.c, src/dyn_macosx.c, src/dyn_unix.c,
	  src/eventhandler.c, src/eventhandler.h, src/hotplug_generic.c,
	  src/hotplug_libhal.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/ifdwrapper.c, src/ifdwrapper.h,
	  src/pcscdaemon.c, src/readerfactory.c, src/readerfactory.h,
	  src/sys_generic.h, src/sys_unix.c, src/testpcsc.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.h,
	  src/winscard_svc.c, src/winscard_svc.h: update copyright date
	* [r5046] src/hotplug_libusb.c: Remove declaration of 3 static
	  functions since they are defined before use. Declaration is then
	  useless.
	* [r5045] configure.in: check for libusb-1.0 instead of libusb-0.1
	* [r5044] src/hotplug_libusb.c: port from libusb-0.1 to libusb-1.0

2010-06-25  Ludovic Rousseau

	* [r5040] UnitaryTests/MCT_ReaderDirect.py,
	  UnitaryTests/control_get_firmware.py,
	  UnitaryTests/control_switch_interface.py,
	  UnitaryTests/stress_get_firmware.py: use readers() from
	  smartcard.System instead of smartcard.pcsc.PCSCReader
	  
	  readers() method is now a staticmethod of the PCSCReader class
	  since pyscard subversion revision 500.

2010-06-24  Ludovic Rousseau

	* [r5039] src/pcscdaemon.c: signal_trap(): implement a "Forced
	  suicide" mechanism.
	  
	  After 3 Ctrl-C without much reaction from pcscd (in fact the
	  drivers) we force the suicide. Sometimes libusb is blocked in a
	  kind of dead-lock and kill -9 was the only option.
	* [r5038] UnitaryTests/stress_apdu.py,
	  UnitaryTests/stress_get_firmware.py: - better display the list of
	  available readers - display the command duration and log to
	  stderr if the duration is more than 1 second indicating a problem
	* [r5037] UnitaryTests/stress_get_firmware.py: get firmware version
	  of Gemalto readers in loop
	* [r5036] UnitaryTests/stress_apdu.py: send an apdu in loop

2010-06-22  Ludovic Rousseau

	* [r5032] src/PCSC/debuglog.h: Add Log5() function
	* [r5031] src/PCSC/ifdhandler.h: fix a comment
	* [r5029] src/PCSC/ifdhandler.h, src/eventhandler.c: Add support of
	  TAG_IFD_STOP_POLLING_THREAD to request the stop of the driver
	  polling function.

2010-06-21  Ludovic Rousseau

	* [r5023] configure.in: Use AC_CHECK_FUNCS() instead of
	  AC_CHECK_FUNC() to have HAVE_PTHREAD_CANCEL defined when needed.
	  
	  AC_CHECK_FUNC() defined nothing so HAVE_PTHREAD_CANCEL was not
	  defined even if pthread_cancel() was available.

2010-06-17  Ludovic Rousseau

	* [r5009] src/pcscdaemon.c: main(): in case of auto exit create a
	  new session so that Ctrl-C on the application will not also quit
	  pcscd
	  
	  Thanks to Thierry Fabre for reporting the bug

2010-06-13  Ludovic Rousseau

	* [r4992] src/winscard_msg.h: typo in comment

2010-06-12  Ludovic Rousseau

	* [r4991] UnitaryTests/SCardBeginTransaction_Disconnect.py,
	  UnitaryTests/SCardBlockingBehaviourTest.py,
	  UnitaryTests/SCardCancel.py, UnitaryTests/SCardConnect_DIRECT.py,
	  UnitaryTests/SCardConnect_DIRECT2.py,
	  UnitaryTests/SCardExclusiveBehaviour.py,
	  UnitaryTests/SCardGetAttrib.py, UnitaryTests/SCardReconnect.py,
	  UnitaryTests/SCard_fork.py, UnitaryTests/ThreadSafe.py,
	  UnitaryTests/ThreadSafeConnect.py, UnitaryTests/reset_card.py:
	  return exception from smartcard.pcsc.PCSCExceptions when
	  appropriate

2010-06-09  Ludovic Rousseau

	* [r4986] src/simclist.c: Avoid a division by 0. Closes [#312555]
	  simclist bug in pcsc-lite
	* [r4985] src/simclist.c, src/simclist.h: update to version version
	  1.4.4rc4 Apr 2010

2010-06-07  Ludovic Rousseau

	* [r4983] src/winscard_clnt.c: SCardEstablishContext(): if pcscd is
	  stared by libpcsclite then close all file handles except stdin,
	  stdout and stderr so that pcscd does not confiscate ressources
	  allocated by the application
	  
	  Thanks to Thierry Fabre for the bug report

2010-06-04  Ludovic Rousseau

	* [r4978] configure.in: release 1.6.1
	* [r4977] ChangeLog: release 1.6.1

2010-06-01  Ludovic Rousseau

	* [r4974] src/misc.h, src/strlcpycat.h, src/tokenparser.l: update
	  copyright date
	* [r4969] src/pcscdaemon.c, src/sys_unix.c: pcscd: do not return
	  before most of the initialisation are done correctly. The idea is
	  that pcscd can return an error code if the daemon fails to start
	  correctly (hald not started for example).
	  
	  Before the patch pcscd became a daemon, then returned 0 (success)
	  and then continued with the initialisation. If the initialisation
	  failed it was too late to return an error code. The
	  /etc/init.d/pcscd script was not aware of the failure.
	  
	  Closes https://bugzilla.redhat.com/show_bug.cgi?id=580321
	  "/usr/sbin/pcscd exit codes broken"

2010-05-31  Ludovic Rousseau

	* [r4968] src/pcscdaemon.c: main(): return EXIT_FAILURE instead of
	  EXIT_SUCCESS if a unknown argument is passed

2010-05-29  Ludovic Rousseau

	* [r4967] src/winscard_msg.h, src/winscard_svc.c: Avoids a crash if
	  a client sends a unknown command.
	  
	  Thanks to Martin Vogt for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q2/0096.html

2010-05-27  Ludovic Rousseau

	* [r4964] src/winscard.c: SCardControl(): do not check for card
	  events since we are talking to the reader not the card. A smart
	  card removal should not make SCardControl() fail with
	  SCARD_W_REMOVED_CARD

2010-05-20  Ludovic Rousseau

	* [r4957] UnitaryTests/SCardGetAttrib.py: get
	  SCARD_ATTR_VENDOR_IFD_SERIAL_NO PC/SC attribute

2010-05-18  Ludovic Rousseau

	* [r4954] src/PCSC/reader.h.in: Add
	  PCSCv2_PART10_PROPERTY_bPPDUSupport
	* [r4953]
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange.py,
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange_PnP.py:
	  Also display the return value of SCardReleaseContext()
	* [r4952] src/pcscd.h.in, src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_svc.c: MessageSend(),
	  MessageReceive() & MessageSendWithHeader() do not timeout any
	  more. If the other side of the socket dies we will get an error
	  from the kernel.
	  
	  Add a new MessageReceiveTimeout() to implement
	  SCardGetStatusChange() with a timeout.
	  
	  The constants PCSCLITE_WRITE_TIMEOUT & PCSCLITE_READ_TIMEOUT are
	  now also removed.
	  
	  The problem was that if a client does nothing during
	  PCSCLITE_READ_TIMEOUT (120 seconds by default) then pcscd
	  considers it as a dead client and closes the connection. I guess
	  this problem was present since the first version of pcsc-lite but
	  nobody complained before.
	  
	  Thanks to Thierry Fabre for the bug report.
	* [r4951] src/pcscdaemon.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_msg.h, src/winscard_msg_srv.c,
	  src/winscard_svc.c: rename SHMfoobar() functions in foobar()
	  since we do not use shared memory (SHM) anymore

2010-05-17  Ludovic Rousseau

	* [r4949] src/hotplug_libusb.c: Add a synchronisation so that if
	  pcscd is auto started the initial reader list is available before
	  the server takes commands from clients.
	  
	  Before the change early calls of SCardListReaders() returned an
	  empty list of readers even if a reader was connected.
	  
	  Thanks to Patrice Angelini for the bug report
	* [r4948] etc: Remove etc directory completely - serial readers are
	  rare => no need for /etc/reader.conf.d/ - pcscd now autostarts =>
	  no need for /etc/init.d/pcscd script or equivalent
	* [r4947] Makefile.am, configure.in: Do not install files in /etc
	  any more. Serial drivers are rare now.
	* [r4946] etc/Makefile.am: Use $(sysconfdir_exp) instead of
	  (removed) $(confdir_exp)
	  
	  Fixes [#312498] Wrong installation path for reader.conf.d

2010-05-11  Ludovic Rousseau

	* [r4941] UnitaryTests/SCardConnect_DIRECT2.py: Unitary test for
	  bug fixed in revision 4940
	* [r4940] src/winscard.c: SCardConnect() & SCardReconnect(): do not
	  reset the cardProtocol in SCARD_SHARE_DIRECT case since the card
	  have _not_ been reseted. A new PPS negociation would fail.
	  
	  See SCardConnect_DIRECT2.py for a Unitary Test

2010-05-05  Ludovic Rousseau

	* [r4921] ChangeLog: update date and release for 1.6.0
	* [r4920] ChangeLog, configure.in: release 1.6.0

2010-05-04  Ludovic Rousseau

	* [r4918] src/pcscdaemon.c: ExitValue default value is now
	  EXIT_FAILURE instead of EXIT_SUCCESS
	* [r4917] src/pcscdaemon.c: main(): remove dead code "used" when no
	  reader.conf file is found

2010-05-03  Ludovic Rousseau

	* [r4913] src/winscard_clnt.c: SCardEstablishContext(): also log
	  the binary name if execl() fails
	* [r4912] src/eventhandler.c: EHDestroyEventHandler(): use
	  pthread_cancel() only if it is present (not the case on Android)
	* [r4911] configure.in: Add a check for pthread_cancel() (not
	  present on Android)
	* [r4910] src/readerfactory.h: Add missing #include <pthread.h>
	  
	  Compilation failed on Android but not on my Debian as the libC is
	  different on the two systems. On Debian sys/types.h defines
	  pthread types

2010-04-29  Ludovic Rousseau

	* [r4906] src/strlcpycat.h: #include <string.h> on plateform that
	  have strlcpy() to avoid a warning (Mac OS X and Android)
	  
	  error.c: In function ‘pcsc_stringify_error’: error.c:64: warning:
	  implicit declaration of function ‘strlcpy’ error.c:64: warning:
	  nested extern declaration of ‘strlcpy’
	* [r4905] src/hotplug_linux.c: #include <pthread.h>
	  
	  Declare pthread_mutex_* functions
	* [r4904] src/hotplug_linux.c: #include "utils.h"
	  
	  Fix hotplug_linux.c:391: error: ‘THREAD_ATTR_DETACHED’ undeclared
	  (first use in this function)
	* [r4903] src/hotplug_libusb.c: HPEstablishUSBNotifications(): do
	  not call RFReCheckReaderConf if USE_SERIAL is defined. The
	  function is not defined in this case.
	* [r4901] configure.in, src/Makefile.am, src/hotplug_libhal.c,
	  src/pcscdaemon.c, src/readerfactory.c: Add --disable-serial and
	  --disable-usb options
	  
	  --disable-serial removes support of /etc/reader.conf gain: 8.0kB
	  of .text (12%) and 160 bytes of .bss (4%) for pcscd
	  
	  --disable-usb removes support of USB hotplug gain: 9.7kB of .text
	  (14%) and 960 bytes of .bss (23%) for pcscd
	  
	  If you use both options (and use a static driver configuration)
	  gain: 17.7kB of .text (26%) and 1152 bytes of .bss (28%) for
	  pcscd
	* [r4900] src/error.c: Define a minimal pcsc_stringify_error() if
	  NO_LOG is defined. Only the error code in hex is displayed in
	  this case.
	  
	  Gain: 2kB of .text (10%) for libpcsclite
	* [r4899] src/pcscdaemon.c: main(): fork() only in case of auto
	  exit to not detach from the terminal if launched in stand alone
	  forground mode ("pcscd -fda" for example)

2010-04-22  Ludovic Rousseau

	* [r4889] src/pcscdaemon.c: main(): always fork() so that pcscd
	  always return in --auto-exit mode but do not close stdout yet
	  since we may need to send logs
	* [r4888] src/winscard_clnt.c: SCardEstablishContext(): call
	  waitpid() to avoid having a defunct pcscd process when pcscd is
	  auto started by the client.
	  
	  The process becomes defunct because pcscd calls daemon() and
	  daemon() does fork() and exit() in the father. The father death
	  must then be reclaimed by libpcsclite.
	  
	  Thanks to Patrice Angelini for the bug report

2010-04-18  Ludovic Rousseau

	* [r4885] src/Makefile.am, src/eventhandler.c,
	  src/hotplug_libhal.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/ifdwrapper.c, src/pcscdaemon.c, src/readerfactory.c,
	  src/readerfactory.h, src/thread_generic.h, src/thread_unix.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_svc.c: Directly
	  use pthread_mutex_* fucntions instead of using wrappers Remove
	  thread_unix.c and thread_generic.h now useless
	* [r4884] src/hotplug_libhal.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c, src/hotplug_macosx.c, src/readerfactory.h,
	  src/utils.c, src/winscard_svc.c: Use pthread_t instead of
	  PCSCLITE_THREAD_T
	* [r4883] src/thread_generic.h, src/utils.h: move thread related
	  definition from thread_generic.h to utils.h
	* [r4882] src/eventhandler.c, src/hotplug_libhal.c,
	  src/hotplug_libusb.c, src/hotplug_linux.c, src/hotplug_macosx.c,
	  src/thread_generic.h, src/thread_unix.c, src/utils.c,
	  src/utils.h, src/winscard_svc.c: Directly use pthread_* instead
	  of SYS_Thread* indirection
	  
	  Move SYS_ThreadCreate in utils.c. This function is not just one
	  pthread_* call

2010-04-16  Ludovic Rousseau

	* [r4877] src/thread_unix.c: SYS_ThreadExit(): remove dead code
	  
	  From Sun Studio CC "thread_unix.c", line 108: warning: statement
	  not reached
	* [r4875] bootstrap: update versions of autotools used

2010-04-15  Ludovic Rousseau

	* [r4874] src/simclist.c: remove ; at end of a { } block defined by
	  a macro. The Solaris compiler complains with: "simclist.c", line
	  1317: warning: syntax error: empty declaration
	  
	  Thanks to Jörg Schilling for the bug report
	* [r4873] src/sys_unix.c: use fork(), close() and chdir() instead
	  of SYS_Fork(), SYS_CloseFile() and SYS_Chdir() in SYS_Daemon() if
	  HAVE_DAEMON is not defined (Solaris)
	  
	  Thanks to Jörg Schilling for the bug report

2010-04-09  Ludovic Rousseau

	* [r4867] src/winscard_svc.c: Log the command return code using
	  DEBUG (SCARD_S_SUCCESS) or ERROR (every thing else) level

2010-04-08  Ludovic Rousseau

	* [r4866] UnitaryTests/reset_card.py: reset a card using
	  SCardDisconnect (default) or SCardReconnect (if an argument is
	  passed)
	* [r4865] UnitaryTests/transmit_loop.py: call SCardTransmit in an
	  endless loop
	* [r4864] src/winscard.c: SCardReconnect(): mimic the code from
	  SCardDisconnect() regarding card event state notifications
	  (changed in revision 4862).
	* [r4863] UnitaryTests/Makefile: no more pcsc_demo target
	* [r4862] src/winscard.c: SCardDisconnect(): Set the card event
	  state to SCARD_RESET _before_ doing the reset.
	  
	  This will avoid an SCardTransmit from another application between
	  the card reset and the card event state change. In the
	  problematic case the SCardTransmit was sending an APDU in T=1 to
	  a reseted card but not yet configured (IFDHSetProtocolParameters
	  was not yet called) and still in T=0 (default)
	* [r4861] src/winscard.c: SCardConnect() & SCardReconnect():
	  correctly log SCARD_PROTOCOL_RAW protocol instead of "unknown"

2010-04-07  Ludovic Rousseau

	* [r4859] src/winscard_msg.c, src/winscard_msg_srv.c: Fix copyright
	  name and date
	* [r4858] src/winscard_msg.c: Doxygen: document SHMMessageReceive()
	  command argument added in revision 4718
	* [r4857] src/winscard_clnt.c: Doxygen:
	  SCARD_ATTR_DEVICE_FRIENDLY_NAME is implemented by
	  SCardGetAttrib() if the IFD Handler (driver) returns
	  IFD_ERROR_TAG. pcsc-lite then returns the same reader name as
	  returned by SCardListReaders.

2010-04-01  Ludovic Rousseau

	* [r4851] src/PCSC/reader.h.in: Add PCSCv2_PART10_PROPERTY_*
	  defines

2010-03-30  Ludovic Rousseau

	* [r4845] src/winscard_clnt.c: SCardEstablishContext(): try to
	  relaunch pcscd if SCardCheckDaemonAvailability() succeeds but
	  SCardEstablishContextTH() fails. This happens if pcscd crashed
	  without cleaning /var/run/pcscd/pcscd.comm

2010-03-26  Ludovic Rousseau

	* [r4843] src/PCSC/reader.h.in: add FEATURE_GET_TLV_PROPERTIES and
	  FEATURE_CCID_ESC_COMMAND from PC/SC part 10 v2.02.07 March 2010

2010-03-22  Ludovic Rousseau

	* [r4839] src/pcscdaemon.c: Call at_exit() instead of exit() since
	  the libC of Android is bogus and atexit() does not work as it
	  should.
	  
	  Thanks to Patrice Angelini for the bug report.
	* [r4838] src/winscard_clnt.c: SCardCheckDaemonAvailability(): use
	  stat(2) instead of the now removed SYS_Stat()

2010-03-19  Ludovic Rousseau

	* [r4836] src/configfile.l, src/pcscdaemon.c, src/sys_generic.h,
	  src/sys_unix.c, src/winscard_msg.c, src/winscard_msg_srv.c,
	  src/winscard_svc.c: Remove the one line wrappers from sys_unix.c
	  and use directly the POSIX functions instead.

2010-03-16  Ludovic Rousseau

	* [r4825] src/Makefile.am: Install pcscd as suid so that autostart
	  works correctly (as root)
	* [r4824] TODO: done: remove as much text messages (logs) as
	  possible
	* [r4823] configure.in: Display PCSCLITE_FEATURES
	* [r4822] configure.in: Add --enable-embedded (default is no) to
	  build pcsc-lite for an embedded system. This will activate the
	  NO_LOG option to disable logging and limit RAM and disk
	  consumption.
	* [r4821] src/PCSC/debuglog.h, src/debug.c, src/debuglog.c,
	  src/hotplug_libhal.c, src/winscard_svc.c: If NO_LOG is defined
	  then no log are displayed. The idea is to limit the binaries size
	  on disk and RAM consumption at execution time.
	  
	  With NO_LOG defined we gain 26% (17 kB) for the .text segment of
	  pcscd and 15% (4 kB) for the .text segment of libpcsclite.so (for
	  i386)
	* [r4820] src/utils.c: Include config.h before the other header
	  files so the configuration set in config.h can be used in the
	  other header files (NO_LOG for example)
	* [r4819] src/configfile.l: Include config.h before the other
	  header files so the configuration set in config.h can be used in
	  the other header files (NO_LOG for example)
	* [r4818] src/Makefile.am, src/debug.c, src/debug.h,
	  src/dyn_hpux.c, src/dyn_macosx.c, src/dyn_unix.c, src/sys_unix.c,
	  src/tokenparser.l, src/utils.c, src/winscard_clnt.c,
	  src/winscard_msg.c: Remove debug.h and use debuglog.h instead.
	  They both define the same log API.

2010-03-12  Ludovic Rousseau

	* [r4813] UnitaryTests/ThreadSafe.py,
	  UnitaryTests/ThreadSafeConnect.py: revert change in revision 4812
	  since the problem is now solved in pyscard (revision 382)
	* [r4812] UnitaryTests/ThreadSafe.py,
	  UnitaryTests/ThreadSafeConnect.py: do not initialise the library
	  in a thread as it crashed on Mac OS X

2010-03-09  Ludovic Rousseau

	* [r4809] src/winscard_svc.c: read only accesses to contextsList
	  list shall also be protected by a mutex
	* [r4808] src/readerfactory.c: read only accesses to handlesList
	  list shall also be protected by a mutex
	* [r4807] src/readerfactory.c, src/readerfactory.h: manipulations
	  of handlesList field of ReaderContext should now be thread safe
	* [r4806] src/winscard_svc.c: MSGRemoveContext(): correctly indent
	  a line
	* [r4805] src/winscard_svc.c: manipulations of cardsList should now
	  be thread safe
	* [r4804] src/winscard_svc.c: remove extra tab
	* [r4803] UnitaryTests/ThreadSafeConnect.py: add more logging
	* [r4802] UnitaryTests/ThreadSafeConnect.py: stress thread safeness
	  of SCardConnect/SCardDisconnect
	* [r4801] src/winscard_svc.c: manipulations of contextsList should
	  now be thread safe
	* [r4800] UnitaryTests/ThreadSafe.py: stress thread safeness

2010-03-04  Ludovic Rousseau

	* [r4793] UnitaryTests/SCardBlockingBehaviourTest.py,
	  UnitaryTests/SCardExclusiveBehaviour.py: make pylint happier
	* [r4792] UnitaryTests/MCT_ReaderDirect.py: make pylint happier
	* [r4791] UnitaryTests/control_get_firmware.py: make pylint happy
	* [r4790] UnitaryTests/control_get_firmware.py: remove useless
	  import
	* [r4789] UnitaryTests/MCT_ReaderDirect.py,
	  UnitaryTests/control_get_firmware.py,
	  UnitaryTests/control_switch_interface.py: use list comprehension
	  instead of map() (more efficient and pylint does not like map())

2010-03-03  Ludovic Rousseau

	* [r4788] UnitaryTests/control_switch_interface.py: make pylint
	  happier

2010-03-02  Ludovic Rousseau

	* [r4784] src/debuglog.c: debuglog.c is only used by pcscd. So no
	  need to use #ifdef PCSCD

2010-03-01  Ludovic Rousseau

	* [r4783] TODO: fix typo

2010-02-26  Ludovic Rousseau

	* [r4779] configure.in, doc/Makefile.am,
	  doc/update-reader.conf.8.in, etc/Makefile.am,
	  etc/update-reader.conf.in, src/configfile.h, src/configfile.l,
	  src/readerfactory.c: Add the ability to parse all the
	  configuration files of a directory instead of just one
	  configuration file. update-reader.conf is then now obsolete.
	  
	  See Debian bug #565896 http://bugs.debian.org/565896

2010-02-25  Ludovic Rousseau

	* [r4778] src/pcscdaemon.c: update copyright

2010-02-23  Ludovic Rousseau

	* [r4769] src/winscard_clnt.c: SCardEstablishContextTH() &
	  SCardGetStatusChange(): completly initialize structures sent to
	  the daemon to avoid a valgrind warning: Syscall param
	  socketcall.send(msg) points to uninitialised byte(s)
	* [r4768] UnitaryTests/SCardBlockingBehaviourTest.py: As of
	  revision r4719 Linux is now Windows "compatible"

2010-02-21  Ludovic Rousseau

	* [r4766] src/misc.h: " The gcc on Solaris 10 combined with the Sun
	  loader appears to not handle the gcc visibility attribute
	  correctly. The sparc version says it is ignored, the x86 version
	  gives linker error. The attached patch sun.gcc.1.5.6-svn-477.txt
	  tries to test for gcc on Sun and not use the visibility
	  attribute. If on a sun and the compiler is not GCC, try and use
	  the Sun __global and __hidden instead. (I did not try the Sun
	  Studio compiler with this.) "
	  
	  Thanks to Douglas E. Engert for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q1/0127.html
	* [r4765] doc/pcscd.8.in: use @sysconfdir_exp@ instead of (removed)
	  @confdir@

2010-02-12  Ludovic Rousseau

	* [r4758] src/readerfactory.c: RFStartSerialReaders(): typo in
	  comment
	* [r4756] src/configfile.l, src/tokenparser.l: Fix 2 compilation
	  warnings
	  
	  configfile.c:1151: warning: ‘input’ defined but not used
	  tokenparser.c:1167: warning: ‘input’ defined but not used
	* [r4755] src/lassert.h: Fix splint error
	  src/pcsc-wirecheck-dist.c:19:164: Body of if clause of if
	  statement is empty
	* [r4754] src/hotplug_libhal.c: HPAddDevice(): fix a memory leak
	* [r4753] src/readerfactory.c: RFRemoveReader(): simplify/factorise
	  the resources deallocation

2010-02-10  Ludovic Rousseau

	* [r4751] etc/update-reader.conf.in: use @sysconfdir@ instead of
	  (the now removed) @confdir@
	  
	  Thanks to Sébastien Lorquet for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q1/0098.html

2010-02-09  Ludovic Rousseau

	* [r4744] src/readerfactory.c, src/readerfactory.h: use a dynamic
	  instead of static allocation for lpcDevice
	* [r4743] src/readerfactory.c: RFAddReader(): allocate an int
	  instead of a DWORD for pFeeds
	  
	  The patch in revision 4741 was not complete
	* [r4742] src/readerfactory.c, src/readerfactory.h: In struct
	  ReaderContext rename pdwMutex to pMutex and change type from
	  PDWORD to int *
	* [r4741] src/readerfactory.c, src/readerfactory.h: In struct
	  ReaderContext rename pdwFeeds to pFeeds and change type from
	  PDWORD to int *
	* [r4740] src/readerfactory.c, src/readerfactory.h: In struct
	  ReaderContext remove the now useless dwBlockStatus field
	* [r4739] src/eventhandler.c, src/ifdwrapper.c,
	  src/readerfactory.c, src/readerfactory.h, src/winscard.c: In
	  struct ReaderContext rename dwSlot to slot and change type from
	  DWORD to int
	* [r4738] src/ifdwrapper.c, src/readerfactory.c,
	  src/readerfactory.h, src/winscard.c: In struct ReaderContext
	  rename dwVersion to version and change type from DWORD to int
	* [r4737] src/ifdwrapper.c, src/readerfactory.c,
	  src/readerfactory.h: In struct ReaderContext change dwPort from
	  DWORD to int and rename it to port
	  
	  Fix a compiler warning readerfactory.c: In function
	  ‘RFReCheckReaderConf’: readerfactory.c:1393: warning: comparison
	  between signed and unsigned
	* [r4736] src/tokenparser.l: Fix compiler warning
	  
	  tokenparser.l: In function ‘tperrorCheck’: tokenparser.l:102:
	  warning: unused parameter ‘token_error’
	* [r4735] src/configfile.l, src/readerfactory.c,
	  src/readerfactory.h: In struct SerialReader rename dwChannelId in
	  channelId since it is an int and no more a DWORD
	* [r4734] src/eventhandler.c: Fix a compiler warning
	  
	  eventhandler.c: In function ‘EHStatusHandlerThread’:
	  eventhandler.c:494: warning: comparison between signed and
	  unsigned
	* [r4733] src/winscard_clnt.c: do not use the uint32_t rv structure
	  field but copy it into rv first to avoid a compiler warning
	  
	  winscard_clnt.c: In function ?SCardReconnect?:
	  winscard_clnt.c:1035: warning: comparison between signed and
	  unsigned winscard_clnt.c: In function ?SCardBeginTransaction?:
	  winscard_clnt.c:1254: warning: comparison between signed and
	  unsigned winscard_clnt.c: In function ?SCardStatus?:
	  winscard_clnt.c:1657: warning: comparison between signed and
	  unsigned winscard_clnt.c: In function ?SCardTransmit?:
	  winscard_clnt.c:2939: warning: comparison between signed and
	  unsigned
	* [r4732] src/PCSC/pcsclite.h.in: force the return codes SCARD_* to
	  be long since the SCard* functions return a LONG type
	* [r4731] src/eventhandler.c, src/readerfactory.c,
	  src/readerfactory.h, src/winscard.c, src/winscard_svc.c: In
	  struct ReaderContext dwLockId is used to store a SCARDHANDLE so
	  change its type from DWORD to SCARDHANDLE and rename the field to
	  hLockId
	  
	  Fix 2 compiler warning: winscard.c: In function
	  'SCardDisconnect': winscard.c:847: warning: comparison between
	  signed and unsigned winscard_svc.c: In function
	  'MSGRemoveContext': winscard_svc.c:807: warning: comparison
	  between signed and unsigned
	* [r4730] src/winscard_msg.c: fix a compilation warning
	  
	  winscard_msg.c: In function ‘SHMMessageReceive’:
	  winscard_msg.c:252: warning: unused parameter ‘command’
	* [r4729] src/winscard_svc.c: fix 2 compilation warnings
	  
	  winscard_svc.c: In function ‘MSGRemoveContext’:
	  winscard_svc.c:776: warning: comparison between signed and
	  unsigned winscard_svc.c: In function ‘MSGAddHandle’:
	  winscard_svc.c:848: warning: comparison between signed and
	  unsigned
	* [r4728] src/eventhandler.h, src/winscard_clnt.c: Use READER_STATE
	  * instead of PREADER_STATE to make it explicit it is a pointer
	* [r4727] src/eventhandler.c, src/eventhandler.h, src/ifdwrapper.c,
	  src/ifdwrapper.h, src/readerfactory.c, src/readerfactory.h,
	  src/winscard.c, src/winscard_svc.c: Use READER_CONTEXT * instead
	  of PREADER_CONTEXT to make it explicit it is a pointer
	* [r4726] src/readerfactory.c: Fix a compilation warning
	  
	  readerfactory.c: In function ‘RFAddReaderHandle’:
	  readerfactory.c:1125: warning: comparison between signed and
	  unsigned
	* [r4725] src/eventhandler.c, src/readerfactory.c,
	  src/readerfactory.h, src/winscard.c: In struct ReaderContext
	  rename "dwContexts" to "contexts" since it is no more a DWORD but
	  a int32_t
	* [r4724] src/winscard_clnt.c: Fix a compilation warning
	  
	  winscard_clnt.c: In function ‘SCardListReaderGroups’:
	  winscard_clnt.c:3258: warning: comparison between signed and
	  unsigned
	* [r4723] src/pcscd.h.in, src/readerfactory.c, src/readerfactory.h:
	  Use dynamic instead of static allocation for the driver library
	  filename. The filename is no more limited to 100 characters.
	  
	  Closes: [#312332] MAX_LIBNAME too short?
	* [r4722] src/pcscdaemon.c, src/winscard_svc.c, src/winscard_svc.h:
	  use int instead of unsigned int for customMaxThreadCounter,
	  customMaxReaderHandles and customMaxThreadCardHandles since
	  list_size() returns an int and we compare the two values (avoid
	  sign mismatch)
	* [r4721] src/winscard_svc.c: fix 2 compilation warnings
	  
	  winscard_svc.c: In function ‘CreateContextThread’:
	  winscard_svc.c:146: warning: comparison between signed and
	  unsigned winscard_svc.c: In function ‘MSGAddHandle’:
	  winscard_svc.c:856: warning: comparison between signed and
	  unsigned

2010-02-08  Ludovic Rousseau

	* [r4720] src/winscard_clnt.c: SCardGetStatusChange(): fix 4
	  compilation warnings
	  
	  winscard_clnt.c: In function ‘SCardGetStatusChange’:
	  winscard_clnt.c:1864: warning: comparison between signed and
	  unsigned winscard_clnt.c:1875: warning: comparison between signed
	  and unsigned winscard_clnt.c:1911: warning: comparison between
	  signed and unsigned winscard_clnt.c:2189: warning: comparison
	  between signed and unsigned
	* [r4719] src/winscard_clnt.c: Make SCardReconnect(), SCardStatus()
	  and SCardTransmit() block instead of returning
	  SCARD_E_SHARING_VIOLATION immediately. These functions will then
	  behave like on Windows.
	  
	  This can happen if these functions are called when the reader is
	  locked by a PCSC transaction
	  (SCardBeginTransaction/SCardEndTransaction).
	  
	  You can define the environment variable PCSCLITE_NO_BLOCKING to
	  use the old behavior.
	  
	  Thanks to Jean-Luc Giraud for the patch.
	  http://archives.neohapsis.com/archives/dev/muscle/2010-q1/0041.html
	* [r4718] src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_svc.c: add a command parameter
	  to SHMMessageReceive() to be able log the ongoing command in case
	  of problem

2010-02-05  Ludovic Rousseau

	* [r4717] UnitaryTests/SCardExclusiveBehaviour.py: Check the return
	  value of SCardConnect() on a reader already used in
	  SCARD_SHARE_EXCLUSIVE mode
	* [r4716] src/winscard.c: fix a bug introduced by the previous
	  revision
	* [r4715] src/winscard.c: SCardGetAttrib(): check for buffer
	  overflow with SCARD_ATTR_DEVICE_FRIENDLY_NAME
	  
	  Thanks to Jean-Luc Giraud for complete
	  SCARD_ATTR_DEVICE_FRIENDLY_NAME patch

2010-02-04  Ludovic Rousseau

	* [r4710] src/PCSC/pcsclite.h.in, src/winscard_clnt.c: add a
	  copyright for Martin Paljak

2010-02-03  Ludovic Rousseau

	* [r4708] configure.in, src/pcscd.h.in: Use the standard
	  --sysconfdir=DIR ($prefix/etc by default) instead of
	  --enable-confdir=DIR for defining the directory containing
	  reader.conf
	* [r4707] configure.in: sysconfdir_exp is a configuration directory
	  not configuration file

2010-02-02  Ludovic Rousseau

	* [r4705] src/winscard.c: SCardStatus(): returns
	  SCARD_E_SHARING_VIOLATION if the reader is already used More
	  conform to Windows
	* [r4704] UnitaryTests/SCardBlockingBehaviourTest.py: allow to use
	  any reader and not just the first one
	* [r4703] src/testpcsc.c: test SCARD_ATTR_DEVICE_FRIENDLY_NAME
	* [r4702] src/winscard.c: SCardGetAttrib(): add support of
	  SCARD_ATTR_DEVICE_FRIENDLY_NAME as it is better implemented in
	  pcscd (it knows the friendly name)
	* [r4701] src/winscard_clnt.c: SCardEstablishContext(): set
	  PCSCLITE_PCSCD_ARGS with the argument you want to pass to pcscd
	  in autostart Only one argument is passed. The space character is
	  not a separator. example: export PCSCLITE_PCSCD_ARGS=-dfa
	* [r4700] src/pcscd.h.in, src/pcscdaemon.c, src/winscard_clnt.c,
	  src/winscard_svc.c: pcscd will suicide itself after 60 seconds of
	  inactivity if it is started using --auto-exit This is the default
	  behavior when pcscd is started by libpcsclite
	* [r4699] src/pcscdaemon.c: do not ignore the SIGALRM signal any
	  more since we need it for the auto exit feature

2010-01-22  Ludovic Rousseau

	* [r4685] configure.in: add $host to the PCSCLITE_FEATURES
	  definition (available with "pcscd -v") to display the CPU
	  architecture host is something like x86_64-unknown-linux-gnu
	* [r4683] configure.in: use LT_INIT(disable-static) instead of the
	  deprecated AM_DISABLE_STATIC
	  
	  Thanks to Roumen Petrov

2010-01-21  Ludovic Rousseau

	* [r4682] UnitaryTests/MCT_ReaderDirect.py,
	  UnitaryTests/control_get_firmware.py,
	  UnitaryTests/control_switch_interface.py: do not try to reset the
	  card on exit. We are talking to the reader. A card may NOT be
	  present.
	* [r4681] configure.in, src/Makefile.am: Do not completely disable
	  building the static version of the library but just disable it by
	  default
	  
	  Use AM_DISABLE_STATIC in configure.in instead of -shared in
	  Makefile.am

2010-01-16  Ludovic Rousseau

	* [r4674] UnitaryTests/SCardBlockingBehaviourTest.py: Check the
	  behavior of PCSC functions when a PCSC transaction is ongoing
	  
	  Thanks to Jean-Luc Giraud for the original code
	* [r4673] src/Makefile.am: use -shared to only provide a shared
	  library. If you need to use the static .a library you just need
	  to remove -shared

2010-01-15  Ludovic Rousseau

	* [r4672] UnitaryTests/control_switch_interface.py: parse error
	  code
	* [r4671] UnitaryTests/control_switch_interface.py: improve
	  documentation and output
	* [r4670] src/winscard_clnt.c: Only call SCardCheckSameProcess() if
	  DO_CHECK_SAME_PROCESS is defined (default is not defined).
	  
	  Some thread libraries (on embedded systems for example) have a
	  different pid for each thread of a same process. So the check
	  using getpid() is wrong and handles are invalidated when they
	  should not. The PC/SC function returned SCARD_E_INVALID_HANDLE
	* [r4669] src/winscard_clnt.c: define and use the
	  CHECK_SAME_PROCESS macro instead of calling
	  SCardCheckSameProcess() directly

2010-01-14  Ludovic Rousseau

	* [r4668] src/winscard_clnt.c: Doxygen: update
	  SCardGetStatusChange() doc. The function returns on any events,
	  not just those specified in dwCurrentState
	* [r4667] TODO: For embedded/constained systems
	  
	  - remove as much text messages (logs) as possible to limit the
	  size of the binaries (pcscd and libpcsclite)
	  
	  - use static driver instead of reader polling and dynamic driver
	  loading

2010-01-08  Ludovic Rousseau

	* [r4646] src/readerfactory.c: RFInitializeReader(): do not
	  dynamically load the driver if PCSCLITE_STATIC_DRIVER is defined
	* [r4645] src/ifdwrapper.c: better support of
	  PCSCLITE_STATIC_DRIVER.
	  
	  This is used to statically link the reader driver to pcscd. Since
	  the link is static you must define the IFDHandler API version at
	  compilation time. Either define IFDHANDLERv1, IFDHANDLERv2 or
	  IFDHANDLERv3
	* [r4644] src/dyn_unix.c: fix a warning when compiling with
	  PCSCLITE_STATIC_DRIVER defined
	  
	  dyn_unix.c: In function ‘DYN_CloseLibrary’: dyn_unix.c:47:
	  warning: unused variable ‘ret’

2010-01-03  Ludovic Rousseau

	* [r4635] src/hotplug_macosx.c: hotplug_macosx.c: In function
	  ‘HPDeviceAppeared’: hotplug_macosx.c:70: warning: unused
	  parameter ‘refCon’ hotplug_macosx.c: In function
	  ‘HPDeviceDisappeared’: hotplug_macosx.c:85: warning: unused
	  parameter ‘refCon’

2010-01-02  Ludovic Rousseau

	* [r4634] src/simclist.c: fix a compilation warning
	  simclist.c:1335: warning: unused parameter ‘el’
	* [r4633] src/error.c: pcsc_stringify_error(): spelling error
	  (detected by lintian(1))

2010-01-01  Ludovic Rousseau

	* [r4630] src/ifdwrapper.c: add #include <unistd.h> to declare the
	  timeval structure
	  
	  In file included from ifdwrapper.c:31: utils.h:26: warning:
	  ‘struct timeval’ declared inside parameter list utils.h:26:
	  warning: its scope is only this definition or declaration, which
	  is probably not what you want
	* [r4629] src/dyn_unix.c, src/ifdwrapper.c, src/pcscdaemon.c:
	  better handling of PCSCLITE_STATIC_DRIVER as can be used on
	  plateforms using µClinux (without dynamic loader)
	  
	  Thanks to Guo Wenxue for a proto-patch
	* [r4628] src/hotplug_generic.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c: ReCheckSerialReaders variable is not used
	  anymore
	* [r4627] src/winscard_msg_srv.c: ReCheckSerialReaders variable
	  from hotplug_* is not used anymore

2009-12-18  Ludovic Rousseau

	* [r4621] src/winscard_svc.c: typo in log message

2009-12-15  Ludovic Rousseau

	* [r4616] src/atrhandler.c: ATRDecodeAtr(): reformat
	* [r4615] src/atrhandler.c: ATRDecodeAtr(): check for TA2 (specific
	  mode) even if TD2 is not present "3F 80 10 01" was not parsed
	  correctly for example and T=0 was used instead of T=1 (specific
	  mode)
	* [r4613] UnitaryTests/MCT_ReaderDirect.py: rename
	  FEATURE_MCT_READERDIRECT in FEATURE_MCT_READER_DIRECT
	* [r4612] src/PCSC/reader.h.in: rename FEATURE_MCT_READERDIRECT in
	  FEATURE_MCT_READER_DIRECT to be conform with ch. 2.3 of PCSC v2
	  part 10

2009-12-14  Ludovic Rousseau

	* [r4611] UnitaryTests/SCard_fork.py: Unitary Test for fork()
	  detection

2009-12-11  Ludovic Rousseau

	* [r4608] src/winscard_clnt.c: Doxygen: add missing error codes
	* [r4607] src/winscard_svc.c: ContextThread(): SCARD_CANCEL return
	  SCARD_E_INVALID_HANDLE instead of SCARD_E_INVALID_VALUE if the
	  handle is invalid
	* [r4606] src/winscard_clnt.c: Doxygen: document 2 missing
	  SCARD_F_COMM_ERROR possible return values
	* [r4605] src/winscard_clnt.c: Doxygen: document 3 missing error
	  codes for SCardConnect()
	* [r4604] src/PCSC/pcsclite.h.in: reformat
	* [r4603] src/winscard_clnt.c: use sizeof(SCARD_IO_REQUEST) instead
	  of 8 for the .cbPciLength field This is the correct value on
	  64-bit system.
	* [r4602] src/pcscdaemon.c, src/winscard.c: g_rgSCard*Pci are not
	  used on the server side
	* [r4601] src/pcscdaemon.c: SIGHUP signal has already been set to
	  SIG_IGN. No need to quit on SIGHUP.
	* [r4600] src/pcscdaemon.c: revert revision 4599 and remove the
	  second call to signal() instead of the first one. We need to
	  clean-up as soon as we created the files.
	* [r4599] src/pcscdaemon.c: remove duplicate calls to signal()

2009-12-03  Ludovic Rousseau

	* [r4587] src/winscard_clnt.c: Doxygen: SCardConnect() value 0 for
	  dwPreferredProtocols valid only if dwShareMode is
	  SCARD_SHARE_DIRECT
	* [r4585] src/winscard_clnt.c: use the more efficient
	  SCardCheckSameProcess() instead of SCardCheckDaemonAvailability()
	  to detect use of the API after a fork()

2009-12-02  Ludovic Rousseau

	* [r4583] src/winscard_clnt.c: Doxygen: SCardEstablishContext()
	  Each thread of an application shall use its own SCARDCONTEXT. On
	  Windows the same SCARDCONTEXT can be shared by different threads
	  of same application.

2009-11-27  Ludovic Rousseau

	* [r4580] src/winscard_clnt.c: SCardEstablishContext(): try to
	  start the pcscd daemon if not already running
	* [r4579] configure.in: define PCSCD_BINARY
	* [r4577] src/pcscdaemon.c: improve the checking of an already
	  running pcscd
	* [r4576] src/winscard_clnt.c: Doxygen: For historical reasons the
	  value of SCARD_E_UNSUPPORTED_FEATURE is 0x8010001F in pcsc-lite
	  but 0x80100022 in Windows WinSCard
	* [r4575] src/PCSC/pcsclite.h.in: SCARD_E_UNSUPPORTED_FEATURE is
	  not a PC/SC Lite specific extension, but its numerical value is
	  different on Windows

2009-11-26  Ludovic Rousseau

	* [r4574] src/PCSC/pcsclite.h.in, src/error.c: remove pcsc-lite
	  specific SCARD_W_INSERTED_CARD code
	  
	  SCARD_W_INSERTED_CARD value 0x8010006A was also in collision with
	  SCARD_W_SECURITY_VIOLATION
	* [r4573] src/error.c: reorder error codes

2009-11-24  Ludovic Rousseau

	* [r4570] src/winscard_clnt.c: do not declare the SCardUnload()
	  function removed in revision 4435
	* [r4569] src/winscard_clnt.c: create a SCardInvalidateHandles()
	  function from SCardCheckDaemonAvailability() code
	* [r4568] src/winscard_clnt.c: SCardCheckDaemonAvailability(): do
	  not delete the context since it is already done by
	  SCardCleanContext()
	* [r4567] src/winscard_clnt.c: SCardCleanContext(): deallocate the
	  context memory

2009-11-23  Ludovic Rousseau

	* [r4566] src/winscard_clnt.c: Doxygen: update SCardControl() list
	  of possible error codes partly revert revision 4558
	  
	  Thanks to Martin Paljak for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2009-q4/0079.html

2009-11-19  Ludovic Rousseau

	* [r4562] src/eventhandler.c, src/readerfactory.c,
	  src/winscard_clnt.c, src/winscard_svc.c: use list_delete()
	  instead of list_locate() + list_delete_at()
	* [r4561] src/simclist.c, src/simclist.h: add list_delete()
	  "expunge the first found given element from the list"

2009-11-18  Ludovic Rousseau

	* [r4560] UnitaryTests/MCT_ReaderDirect.py,
	  UnitaryTests/SCardBeginTransaction_Disconnect.py,
	  UnitaryTests/SCardCancel.py, UnitaryTests/SCardConnect_DIRECT.py,
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange.py,
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange_PnP.py,
	  UnitaryTests/SCardReconnect.py,
	  UnitaryTests/control_get_firmware.py,
	  UnitaryTests/control_switch_interface.py: reformat to make
	  pep8(1) happy
	* [r4559] src/winscard_clnt.c: Doxygen improvement
	* [r4558] src/winscard_clnt.c: Doxygen: update SCardControl() list
	  of possible error codes
	* [r4554] src/readerfactory.c, src/winscard_clnt.c,
	  src/winscard_svc.c: add Jean-Luc Giraud in copyright holders
	  because of his patch in revision 4553

2009-11-17  Ludovic Rousseau

	* [r4553] src/Makefile.am, src/pcscd.h.in, src/pcscdaemon.c,
	  src/readerfactory.c, src/readerfactory.h, src/winscard_clnt.c,
	  src/winscard_svc.c, src/winscard_svc.h: Use lists instead of
	  fixed size arrays to store handles.
	  
	  It is now possible to have: - 200 simultaneous PC/SC clients
	  instead of 16 - 200 SCardConnect per client instead of 16 - 200
	  clients per reader instead of 16
	  
	  The default value of 200 can be changed by giving an argument to
	  pcscd --max-thread --max-card-handle-per-thread
	  --max-card-handle-per-reader
	  
	  Thanks to Jean-Luc Giraud for the big patch
	* [r4552] src/readerfactory.c: RFCreateReaderHandle(): add a
	  comment that a 16-bit random is not secure enough

2009-11-16  Ludovic Rousseau

	* [r4549] UnitaryTests/SCardReconnect.py: SCardReconnect() should
	  block instead of returning SCARD_E_SHARING_VIOLATION
	* [r4548] UnitaryTests/SCardConnect_DIRECT.py: typo in text
	* [r4547] src/winscard_svc.c: remove printf() for debug from
	  READ_BODY() macro

2009-11-12  Ludovic Rousseau

	* [r4544] UnitaryTests/BufferOverflow.c, src/PCSC/ifdhandler.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/reader.h.in,
	  src/PCSC/winscard.h, src/PCSC/wintypes.h, src/atrhandler.c,
	  src/atrhandler.h, src/configfile.h, src/configfile.l,
	  src/debug.c, src/debug.h, src/debuglog.c, src/dyn_generic.h,
	  src/dyn_hpux.c, src/dyn_unix.c, src/error.c, src/eventhandler.c,
	  src/eventhandler.h, src/hotplug.h, src/hotplug_libhal.c,
	  src/hotplug_libusb.c, src/hotplug_linux.c, src/ifdwrapper.c,
	  src/ifdwrapper.h, src/lassert.h, src/misc.h, src/parser.h,
	  src/pcsc-wirecheck-gen.c, src/pcscd.h.in, src/pcscdaemon.c,
	  src/powermgt_generic.c, src/readerfactory.c, src/readerfactory.h,
	  src/strlcpycat.h, src/sys_generic.h, src/sys_unix.c,
	  src/thread_generic.h, src/thread_unix.c, src/tokenparser.l,
	  src/utils.c, src/utils.h, src/utils/formaticc.c,
	  src/utils/installifd.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_msg.h, src/winscard_msg_srv.c,
	  src/winscard_svc.c, src/winscard_svc.h: update copyright dates

2009-11-07  Ludovic Rousseau

	* [r4540] src/winscard_svc.c: remove ducplicate READ_BODY() and
	  WRITE_BODY() macros

2009-11-06  Ludovic Rousseau

	* [r4538] src/winscard_clnt.c: remove useless PCHANNEL_MAP type
	  definition
	* [r4537] src/winscard_clnt.c: remove extra spaces at end of line
	* [r4536] src/hotplug_libusb.c: reindent
	* [r4535] src/hotplug_linux.c: reindent
	* [r4534] src/ifdwrapper.c: reindent
	* [r4533] src/readerfactory.c: RFAddReader(): make comment more
	  clear for TAG_IFD_SLOT_THREAD_SAFE
	* [r4532] src/readerfactory.c: RFAddReader(): make comment more
	  clear for TAG_IFD_THREAD_SAFE

2009-11-05  Ludovic Rousseau

	* [r4531] src/winscard_msg.c, src/winscard_msg_srv.c: use PF_*
	  instead of AF_* for socket(2) argument
	  
	  Thanks to Sébastien Lorquet for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2009-q4/0039.html
	* [r4530] src/winscard_msg.c, src/winscard_msg_srv.c: Revert change
	  in revision 4395. Solaris does not have (Posix) AF_LOCAL
	  
	  Thanks to Douglas E. Engert for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2009-q4/0038.html

2009-11-03  Ludovic Rousseau

	* [r4529] src/readerfactory.h: remove useless pointer types

2009-11-02  Ludovic Rousseau

	* [r4528] src/winscard_clnt.c: SCardConnect(), SCardDisconnect() &
	  SCardReleaseContext(): correctly handle error cases profiling

2009-10-28  Ludovic Rousseau

	* [r4527] src/readerfactory.h, src/thread_generic.h,
	  src/thread_unix.c, src/winscard_clnt.c: remove the type
	  PCSCLITE_MUTEX_T and use an explicit pointer type (PCSCLITE_MUTEX
	  *) instead
	  
	  This should avoid bugs like the one corrected in revision 4525
	* [r4525] src/eventhandler.c: correctly use the lock API for
	  ClientsWaitingForEvent_lock
	* [r4524] src/pcscdaemon.c, src/readerfactory.c,
	  src/readerfactory.h: call exit() in SVCServiceRunLoop() instead
	  of RFCleanupReaders() and remove the RFCleanupReaders() parameter
	* [r4523] src/readerfactory.c: use return() instead of exit() if
	  DYN_GetAddress() fails
	* [r4522] src/eventhandler.c: explicitly use (void)fct() to ignore
	  the returned value

2009-10-27  Ludovic Rousseau

	* [r4520] src/eventhandler.c: EHStatusHandlerThread(): call
	  EHSignalEventToClients() _after_ logging "Card inserted into ..."
	* [r4519] src/winscard_svc.c: ContextThread(): add the client ID to
	  the command log message
	* [r4518] src/winscard_clnt.c: SCardGetStatusChange(): use
	  SCARD_*_CONTEXT constants instead of numerical values
	* [r4517] src/eventhandler.h, src/winscard.c: move SCARD_*_CONTEXT
	  from winscard.c to eventhandler.h
	* [r4516] src/winscard.c: remove useless SCARD_NO_LOCK define
	* [r4515] src/eventhandler.c: update comment
	* [r4514] src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_svc.c: SHMMessageReceive() now returns -2 in case of
	  timeout and -1 in case of other error
	  
	  This is used to correctly handle timeouts in
	  SCardGetStatusChange()
	* [r4513] src/winscard_svc.c: ContextThread(): when a client dies
	  call EHTryToUnregisterClientForEvent() to unregister it if needed
	* [r4512] src/eventhandler.c, src/eventhandler.h: add
	  EHTryToUnregisterClientForEvent()

2009-10-18  Ludovic Rousseau

	* [r4497] src/winscard_msg.c: SHMMessageSend(): document the use of
	  MSG_NOSIGNAL to ignore SIGPIPE signal

2009-10-13  Ludovic Rousseau

	* [r4491] src/Makefile.am: do not use PCSC_CLIENT_SRC variable
	  anymore since SCF support has been removed
	* [r4490] src/Makefile.am: libpcsclite does not need to have
	  dyn_hpux.c, dyn_macosx.c or dyn_unix.c. These files define
	  DYN_LoadLibrary/DYN_CloseLibrary/DYN_GetAddress
	* [r4489] pbx, pcsc.pbproj: remove Xcode files. Apple has its own
	  version of pcsc-lite for Mac OS X
	* [r4488] src/winscard_clnt.c: Doxygen(): better documentation for
	  SCardCheckDaemonAvailability()
	* [r4487] src/winscard_clnt.c: revert changeset 4485.
	  SCardCheckDaemonAvailability() is also used to invalidate the
	  PC/SC handles after a fork or a pcscd restart
	* [r4486] configure.in, src/Makefile.am, src/winscard_scf.c: remove
	  SCF support (PC/SC over Smart Card Framework). I never used this
	  feature and SCF is now dead and replaced by JSR 268
	  (javax.smartcardio)

2009-10-12  Ludovic Rousseau

	* [r4485] src/winscard_clnt.c: SCardReleaseContext(),
	  SCardConnect(), SCardReconnect(), SCardDisconnect(),
	  SCardBeginTransaction(), SCardEndTransaction(),
	  SCardCancelTransaction(), SCardStatus(), SCardGetStatusChange(),
	  SCardControl(), SCardGetSetAttrib(), SCardTransmit(),
	  SCardListReaders(), SCardFreeMemory()SCardListReaderGroups(),
	  SCardIsValidContext(): do not SCardCheckDaemonAvailability()
	  since we will try to talk to the server later. Any communication
	  problem will be reported by SHMMessageSendWithHeader()
	* [r4484] src/winscard_clnt.c: SCardDisconnect(): factorize exit
	  code
	* [r4483] src/winscard_clnt.c: SCardReconnect(): factorize exit
	  code
	* [r4482] src/winscard_clnt.c: SCardConnect(): factorize exit code
	* [r4481] src/winscard_clnt.c: SCardReleaseContext(): release
	  context even if communication with the server fails
	* [r4480] src/winscard_msg.c: SHMMessageSend(): use send(...,
	  MSG_NOSIGNAL) instead of write(...) to avoid receiving a SIGPIPE
	  signal if pcscd has exited. We just get EPIPE as return value
	* [r4479] src/winscard_clnt.c: SCardReconnect(),
	  SCardBeginTransaction(), SCardEndTransaction(),
	  SCardCancelTransaction(), SCardControl(), SCardGetSetAttrib() and
	  SCardTransmit(): do not "synchronize reader states with daemon"
	  since reader availability checks are done on the server side.

2009-10-09  Ludovic Rousseau

	* [r4476] src/winscard_clnt.c: Doxygen improvement
	* [r4474] src/PCSC/ifdhandler.h: Doxygen: define an IFDHandler
	  group
	* [r4473] src/PCSC/ifdhandler.h: Add Doxygen documentation of the
	  IFD Handler API
	* [r4472] src/PCSC/ifdhandler.h: remove IFD_Handler 1.0 functions
	  prototypes
	* [r4471] src/winscard_clnt.c: Doxygen: use @param[in,out] for in
	  and out parameters

2009-10-08  Ludovic Rousseau

	* [r4468] doc/example/pcsc_demo.c: cleanly exits in case of unknown
	  protocol
	* [r4467] doc/example/pcsc_demo.c: use SCARD_AUTOALLOCATE for
	  SCardListReaders()
	* [r4466] src/simclist.c, src/simclist.h: remove svn:executable
	  property on source files
	* [r4465] src/sys_generic.h, src/sys_unix.c: Define SYS_Fork() only
	  if used (if HAVE_DAEMON is not set)
	* [r4464] src/sys_generic.h, src/sys_unix.c: Remove useless
	  SYS_GetPageSize(), SYS_MemoryMap(), SYS_PublicMemoryMap(),
	  SYS_PublicMemoryUnmap() and SYS_MMapSynchronize()
	* [r4463] src/sys_generic.h, src/sys_unix.c: Remove useless
	  SYS_ReadFile()
	* [r4462] src/sys_generic.h, src/sys_unix.c: Remove useless
	  SYS_SeekFile()
	* [r4461] src/sys_generic.h: Remove SYS_ChangePermissions()
	  prototype (the function is NOT defined anywhere)
	* [r4460] src/sys_generic.h, src/sys_unix.c: Remove useless
	  SYS_GetUID() & SYS_GetGID()
	* [r4459] src/sys_generic.h, src/sys_unix.c: Remove useless
	  SYS_GetPID()
	* [r4458] src/sys_generic.h, src/sys_unix.c, src/winscard_clnt.c:
	  SYS_Initialize() does nothing. Remove it.
	* [r4457] src/readerfactory.c: Comment out RFSuspendAllReaders()
	  and RFAwakeAllReaders(). We do not yet support suspend/resume on
	  Linux
	* [r4456] src/readerfactory.c, src/readerfactory.h: remove useless
	  RFListReaders()
	* [r4455] src/readerfactory.c, src/readerfactory.h: remove useless
	  RFUnblockContext()
	* [r4454] src/readerfactory.c, src/readerfactory.h, src/winscard.c:
	  remove useless RFUnblockReader()
	* [r4453] src/pcscd.h.in, src/readerfactory.c, src/winscard_clnt.c:
	  do not use contextBlockStatus tpo block/unblock a context. We now
	  use SCardCancel() on the server side to unblock
	  SCardGetStatusChange()
	* [r4452] doc/Makefile.am, doc/pcsc-lite.bib, doc/pcsc-lite.tex:
	  The .tex documentation is no more maintained. The reference
	  WinSCard API documentation is from Doxygen now.
	* [r4451] UnitaryTests/SCardConnect_DIRECT.py: add documentation
	* [r4447] src/ifdwrapper.c: IFDControl(): return
	  SCARD_E_INSUFFICIENT_BUFFER if the driver returns
	  IFD_ERROR_INSUFFICIENT_BUFFER
	* [r4445] src/winscard.c: SCardGetAttrib(): return
	  SCARD_E_INSUFFICIENT_BUFFER if the driver returns
	  IFD_ERROR_INSUFFICIENT_BUFFER
	  
	  Thanks to Emmanuel Deloget for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2009-q4/0003.html
	* [r4444] src/PCSC/ifdhandler.h: add IFD_ERROR_INSUFFICIENT_BUFFER
	* [r4443] src/winscard.c: SCardReconnect(): log the selected
	  protocol (as done in SCardConnect())
	* [r4442] src/winscard_clnt.c: SCardReconnect(): return
	  SCARD_E_SHARING_VIOLATION instead of blocking if the reader
	  cannot be shared.
	  
	  This change was made in revision 2475 but I don't remember why.
	  
	  Thanks to Paul Klissner for the bug report
	  http://archives.neohapsis.com/archives/dev/muscle/2009-q3/0106.html

2009-10-06  Ludovic Rousseau

	* [r4438] src/winscard_clnt.c, src/winscard_msg.h: remove typedefs
	  and explicitly use struct for structures
	* [r4437] src/pcsc-wirecheck-gen.c: update to the new client/server
	  ABI
	* [r4436] src/utils.c, src/utils.h: remove now useless
	  StatSynchronize() and StatSynchronizeContext()
	* [r4435] src/winscard_clnt.c: remove now useless SCardUnload()
	* [r4434] src/eventhandler.c, src/pcscd.h.in, src/pcscdaemon.c,
	  src/readerfactory.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_msg.h, src/winscard_msg_srv.c,
	  src/winscard_svc.c: redesign the client/server communication: -
	  no more shared memory used (allow pcscd and libpcsclite1.so to be
	  on different computer and talk over a network) - no more
	  difference between short and extended APDU - no more use of a
	  /var/run/pcscd/pcscd.events/ directory. events are sent through
	  the socket - simpler command format between client and server
	  
	  The side effect is that you are not able to mix an old pcscd with
	  a new libpcsclite1.so or the reverse. SCardEstablishContext()
	  will fail unless you update both sides of the communication.
	* [r4433] src/winscard_msg.c: reformat comment
	* [r4432] src/winscard_svc.c, src/winscard_svc.h: add
	  MSGSignalClient()
	* [r4431] src/winscard_msg.h: add struct wait_reader_state_change
	* [r4430] src/pcscd.h.in: add PCSCLITE_WRITE_TIMEOUT and
	  PCSCLITE_READ_TIMEOUT
	* [r4429] src/winscard_msg.c: reformat comments
	* [r4428] src/eventhandler.c, src/eventhandler.h: add
	  EHRegisterClientForEvent(), EHUnregisterClientForEvent() and
	  EHSignalEventToClients()
	* [r4427] src/Makefile.am: add simclist.{c,h} to pcscd dependencies
	* [r4426] src/simclist.c, src/simclist.h: Library to manage lists
	  Fetched from http://mij.oltrelinux.com/devel/simclist/

2009-10-05  Ludovic Rousseau

	* [r4425] UnitaryTests/SCardCancel.py: display return values even
	  if no error returned

2009-10-03  Ludovic Rousseau

	* [r4419] src/winscard_clnt.c: Doxygen document SCardConnect()
	  difference with Windows for SCARD_SHARE_DIRECT

2009-10-02  Ludovic Rousseau

	* [r4418] src/winscard_clnt.c: add Doxygen section: Known
	  differences with Microsoft Windows WinSCard implementation

2009-09-29  Ludovic Rousseau

	* [r4408] src/pcscdaemon.c: main(): check RFAllocateReaderSpace()
	  returned value
	* [r4407] src/winscard_clnt.c: SCardGetStatusChange(): Calling with
	  cReaders == 0 will now just return SCARD_S_SUCCESS
	  
	  Use the special reader name "\\?PnP?\Notification" to wait for a
	  reader event notification
	* [r4406] src/pcscd.h.in: remove comment about PCSCLITE_MAX_READERS
	* [r4405] src/pcscd.h.in: remove useless PCSCLITE_MAX_THREADS
	  definition
	* [r4404] src/pcscd.h.in: remove useless
	  PCSCLITE_TRANSACTION_TIMEOUT definition
	* [r4403] src/utils.c, src/utils.h, src/winscard.c,
	  src/winscard_clnt.c: move time_sub() in utils.c
	* [r4402] src/pcsc-wirecheck-gen.c, src/pcscd.h.in,
	  src/winscard_msg.c, src/winscard_msg.h: remove useless
	  key[PCSCLITE_MSG_KEY_LEN] field

2009-09-28  Ludovic Rousseau

	* [r4400] src/winscard.c: SCardTransmit(): do not limit the minimum
	  size of an APDU to 4 bytes. non ISO 7816-4 compliant cards (like
	  Mifare DESFIRE) may use shorter commands
	  
	  Thanks to Björn Kupfer for the bug report
	* [r4399] src/winscard.c: SCardTransmit(): call IFDControl_v2
	  instead of IFDTransmit only if dwProtocol == SCARD_PROTOCOL_RAW
	  _and_ ifdhandler is v2.0
	  
	  Thanks to Björn Kupfer for the patch

2009-09-23  Ludovic Rousseau

	* [r4395] src/winscard_msg.c, src/winscard_msg_srv.c: use the POSIX
	  name AF_LOCAL instead of AF_UNIX

2009-09-21  Ludovic Rousseau

	* [r4388] src/pcscd.h.in: remove unsuned #define
	  PCSCLITE_RW_ATTEMPTS

2009-09-17  Ludovic Rousseau

	* [r4387] src/winscard_clnt.c: typo in Doxygen comment

2009-09-15  Ludovic Rousseau

	* [r4386] src/winscard_clnt.c: SCardReleaseContext(),
	  SCardControl(), SCardTransmit() and SCardListReaders(): add a
	  call to PROFILE_END() before exiting with SCARD_E_INVALID_HANDLE
	  error code to have a better profiling output
	* [r4385] src/winscard.c:
	  SCardEstablishContext()/SCardReleaseContext(): log context value
	  in hexadecimal instead of decimal
	* [r4384] src/winscard_msg.c: rename argument blockAmount in
	  timeOut to better reflect its function

2009-09-08  Ludovic Rousseau

	* [r4378] src/PCSC/reader.h.in: update sruct
	  PIN_PROPERTIES_STRUCTURE to be conform with Revision 2.02.06,
	  April 2009 of PCSCv2 part 10
	  
	  Fields wLcdMaxCharacters and wLcdMaxLines have been removed

2009-09-01  Ludovic Rousseau

	* [r4375] src/pcscdaemon.c: signal_reload(): reenable the signal
	  handler. This is needed on Solaris and HPUX.
	  
	  Thanks to Douglas E. Engert for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2009-q3/0061.html

2009-08-31  Ludovic Rousseau

	* [r4374] src/ifdwrapper.c, src/winscard.c: typo in comments

2009-08-28  Ludovic Rousseau

	* [r4371] src/hotplug_libhal.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c, src/pcscdaemon.c: move definition of
	  usbNotifierMutex in the underlying layers where it is used

2009-08-27  Ludovic Rousseau

	* [r4367] src/ifdwrapper.c: IFDControl(): return
	  SCARD_E_UNSUPPORTED_FEATURE if the driver returned
	  IFD_ERROR_NOT_SUPPORTED or IFD_NOT_SUPPORTED
	  
	  This is used to separate an unsupported value of ControlCode from
	  a general error

2009-07-31  Ludovic Rousseau

	* [r4359] UnitaryTests/control_switch_interface.py: switch
	  interface on the GemProx DU
	* [r4357] UnitaryTests/control_get_firmware.py: get firmware
	  version of Gemalto readers

2009-07-30  Ludovic Rousseau

	* [r4354] src/ifdwrapper.c: remove extra spaces at end of line
	* [r4353] src/configfile.l: reformat
	* [r4352] src/configfile.l: remove extra spaces

2009-07-28  Ludovic Rousseau

	* [r4349] ChangeLog, configure.in: release 1.5.5
	* [r4344] src/atrhandler.c: remove empty last list

2009-07-21  Ludovic Rousseau

	* [r4334] src/winscard_svc.c: MSGFunctionDemarshall(): correctly
	  check for buffer overflow in case of SCardControl()
	  
	  Bug introduced in revision 4208 included in pcsc-lite 1.5.4
	* [r4333] src/winscard_clnt.c: SCardConnect(): document
	  SCARD_SHARE_DIRECT access mode
	* [r4332] src/winscard.c: SCardConnect() and SCardReconnect(): set
	  pdwActiveProtocol to SCARD_PROTOCOL_UNDEFINED if
	  SCARD_SHARE_DIRECT is used (conform to MSDN)
	* [r4331] UnitaryTests/SCardConnect_DIRECT.py: Unitary test for
	  SCardConnect in DIRECT mode

2009-07-20  Ludovic Rousseau

	* [r4328] src/testpcsc.c: support SCARD_PROTOCOL_RAW
	* [r4327] src/testpcsc.c: use test_rv() to check SCardTransmit()
	  result
	* [r4326] src/winscard.c: SCardTransmit(): if the lower level call
	  fails then return the error code instead of always
	  SCARD_E_NOT_TRANSACTED
	  
	  For example SCARD_E_UNSUPPORTED_FEATURE is returned if
	  SCARD_PROTOCOL_RAW is not supported

2009-07-17  Ludovic Rousseau

	* [r4321] src/pcsc-wirecheck-gen.c, src/winscard_clnt.c,
	  src/winscard_msg.h, src/winscard_svc.c: remove the p in the
	  structure field names pioSendPciProtocol, pioSendPciLength,
	  pioRecvPciProtocol and pioRecvPciLength since they are not
	  pointers
	* [r4320] src/pcsc-wirecheck-gen.c, src/winscard_clnt.c,
	  src/winscard_msg.h, src/winscard_svc.c: remove the p in the
	  structure field names pdwActiveProtocol, pdwState, pdwProtocol,
	  pdwBytesReturned since they are not pointers
	* [r4319] src/pcsc-wirecheck-gen.c, src/winscard_clnt.c,
	  src/winscard_msg.h, src/winscard_svc.c: rename structure fields
	  phCard and phContext into hCard and hContext since they are not
	  pointers

2009-07-16  Ludovic Rousseau

	* [r4316] src/PCSC/pcsclite.h.in: #define SCARD_P_SHUTDOWN

2009-07-03  Ludovic Rousseau

	* [r4299] UnitaryTests/SCardCancel.py: do not raise an exception if
	  the return code is the expected SCARD_E_CANCELLED
	* [r4298] src/pcscdaemon.c: clean_temp_files(): give some time to
	  clients to remove their event files before removing the event
	  directory
	* [r4297] src/hotplug_libhal.c, src/readerfactory.c: do not try to
	  open a device using the libusb scheme if opening it with the
	  libhal scheme returns IFD_NO_SUCH_DEVICE
	  
	  The device may be composite and the interface found is not CCID
	  (HID for example). Just skip this interface and try the next one.
	* [r4296] src/hotplug_libhal.c: HPAddDevice(): add the reader
	  interface name if provided by the device
	* [r4294] src/tokenparser.l: LTPBundleFindValueWithKey(): do not
	  log an error if no more values are found
	* [r4293] src/tokenparser.l: use '\0' instead of 0

2009-07-01  Ludovic Rousseau

	* [r4291] src/atrhandler.h: use int instead of DWORD for Length and
	  HistoryLength in _ATR structure to gain 12 bytes on _ATR (and 16
	  bytes on _SMARTCARD_EXTENSION). Thanks to pahole(1)
	* [r4290] src/atrhandler.h: reorder fields in the _ATR structure of
	  _SMARTCARD_EXTENSION Structure is now 8 bytes shorter on 64-bits
	  CPU Thanks to pahole(1)
	* [r4289] src/readerfactory.h: reorder ReaderContext fields to
	  avoid padding holes in the strucutre Structure size is now 8
	  bytes smaller on 64-bits CPU

2009-06-26  Ludovic Rousseau

	* [r4283] UnitaryTests/MCT_ReaderDirect.py: test secoder support
	  (using FEATURE_MCT_READERDIRECT)

2009-06-24  Ludovic Rousseau

	* [r4272] ChangeLog, configure.in: release 1.5.4

2009-06-23  Ludovic Rousseau

	* [r4271] src/winscard_clnt.c: SCardGetStatusChange(): fix in
	  revision r4269 was not correct.
	  
	  Thanks (again) to Toon Claes for the bug report
	* [r4270] src/winscard_clnt.c: SCardGetStatusChange(): add debug to
	  know why the function returns

2009-06-22  Ludovic Rousseau

	* [r4269] src/winscard_clnt.c: SCardGetStatusChange(): only check
	  the event counter if current state is not SCARD_STATE_EMPTY
	  
	  Closes [#311772] "SCardGetStatusChange only works the first time
	  after starting pcscd"

2009-06-11  Ludovic Rousseau

	* [r4252] UnitaryTests/Makefile: add a clean rule

2009-06-05  Ludovic Rousseau

	* [r4249] src/hotplug.h, src/hotplug_libhal.c: give a higher
	  priority to a specific driver over the CCID Class driver
	* [r4248] src/parser.h, src/tokenparser.l: add
	  LTPBundleFindOptionalValueWithKey() to look for an optional key
	  No error is logged if the key is not found

2009-06-02  Ludovic Rousseau

	* [r4241] src/debuglog.c: log APDU and SW (--apdu) even if --debug
	  is not used
	* [r4240] src/hotplug_libhal.c: HPAddDevice(): use NULL instead of
	  an libhal error field since we do not use the error value
	* [r4239] src/hotplug_libhal.c: if RFAddReader() fails with the
	  libhal scheme then we try with the (old) libusb scheme.
	  
	  This patch should allow proprietary drivers to work even if
	  pcsc-lite is compiled with libhal support.
	* [r4238] src/winscard_clnt.c: WaitForPcscdEvent(): check mkfifo(3)
	  succeeds
	  
	  Thanks to Steve Grubb for the bug report

2009-06-01  Ludovic Rousseau

	* [r4237] src/pcscdaemon.c: main(): create the PCSCLITE_EVENTS_DIR
	  directory with the sticky bit so only root or the owner of the
	  file can remove it
	  
	  Thanks to Tomas Mraz for the bug report
	* [r4236] src/utils.c: StatSynchronizeContext(): do not call
	  mkfifo(3) since the fifo file is already created by another
	  thread.

2009-05-28  Ludovic Rousseau

	* [r4234] src/winscard_clnt.c, src/winscard_msg.h,
	  src/winscard_svc.c: use a union to avoid "warning: dereferencing
	  pointer 'veStr' does break strict-aliasing rules" warnings with
	  gcc 4.4
	  
	  Thanks to Stanislav Brabec for the patch
	* [r4233] src/testpcsc.c: use a union of fields with different
	  types instead of casts to avoid testpcsc.c:313: warning:
	  dereferencing type-punned pointer will break strict-aliasing
	  rules testpcsc.c:323: warning: dereferencing type-punned pointer
	  will break strict-aliasing rules
	  
	  Thanks to Stanislav Brabec for the patch
	* [r4232] NEWS: fix musclecard URL
	  
	  Thanks to Stanislav Brabec for the patch

2009-05-25  Ludovic Rousseau

	* [r4223] Makefile.am, configure.in: generate a .bz2 archive only

2009-05-22  Ludovic Rousseau

	* [r4222] src/ifdwrapper.c: IFDControl(): use %LX instead of %Lx in
	  a log format

2009-05-19  Ludovic Rousseau

	* [r4213] src/pcscdaemon.c: main(): force access rights on
	  /var/run/pcscd to be sure it can be used by a libpcsclite client
	  without privileges
	  
	  Thanks to Sébastien Lorquet for the bug report

2009-05-15  Ludovic Rousseau

	* [r4211] UnitaryTests/BufferOverflow.c, UnitaryTests/Makefile,
	  UnitaryTests/SCardBeginTransaction.c: port to Mac OS X

2009-05-14  Ludovic Rousseau

	* [r4210] src/PCSC/reader.h.in: add Doxygen documentation
	* [r4209] UnitaryTests/BufferOverflow.c, UnitaryTests/Makefile,
	  UnitaryTests/SCardBeginTransaction.c: new files
	* [r4208] src/winscard_svc.c: MSGFunctionDemarshall(): detect
	  buffer overflows
	  
	  Thanks to Sebastian Krahmer for the bug report
	* [r4207] src/winscard_clnt.c: SCardGetAttrib() & SCardSetAttrib():
	  debug Doxygen examples

2009-05-13  Ludovic Rousseau

	* [r4206] src/pcscdaemon.c: main(): wrong mode file comment

2009-05-12  Ludovic Rousseau

	* [r4201] src/utils/formaticc.c: cppcheck: (error) Resource leak:
	  fp
	* [r4200] src/utils/formaticc.c: cppcheck: (error) Resource leak:
	  fp

2009-05-08  Ludovic Rousseau

	* [r3499] src/winscard_clnt.c: SCardEstablishContext(): Doxygen:
	  each thread of an application shall use its own SCARDCONTEXT.

2009-04-29  Ludovic Rousseau

	* [r3470] ChangeLog, configure.in: release 1.5.3

2009-04-27  Ludovic Rousseau

	* [r3469] UnitaryTests/SCardBeginTransaction_Disconnect.py: A bug
	  has been corrected in revision 3467 The problem occurs if
	  SCardBeginTransaction() are made without corresponding
	  SCardEndTransaction(). OpenSC "pkcs11-tool -I" exhibits such a
	  behavior.
	* [r3467] src/winscard.c: CardDisconnect(): call
	  RFUnlockAllSharing() instead of RFUnlockSharing() to release all
	  nested locks. The problem occurs if SCardBeginTransaction() are
	  made without corresponding SCardEndTransaction(). OpenSC
	  "pkcs11-tool -I" exhibits such a behavior.
	  
	  Thanks to Marc Rios Valles for the bug report
	* [r3466] src/readerfactory.c, src/readerfactory.h: add
	  RFUnlockAllSharing()
	* [r3465] src/debuglog.c: change default log level from
	  PCSC_LOG_INFO to PCSC_LOG_ERROR to limit syslog pollution

2009-04-17  Ludovic Rousseau

	* [r3457] UnitaryTests/SCardCancel.py: use SCARD_S_SUCCESS instead
	  of 0

2009-04-14  Ludovic Rousseau

	* [r3450] src/utils.c: StatSynchronize(): remove event fifo files
	  only if they are 60 seconds old. The normal case is for the
	  client to remove its one event file after use. The daemon sould
	  only remove files from dead clients.
	* [r3449] src/utils.c: StatSynchronize(): use S_ISFIFO() macro
	* [r3448] UnitaryTests/SCardCancel.py: DeprecationWarning: raising
	  a string exception is deprecated
	* [r3447] UnitaryTests/SCardCancel.py,
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange.py,
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange_PnP.py:
	  add license information
	* [r3446] src/winscard_clnt.c: WaitForPcscdEvent(): avoid a
	  possible crash due to a race condition
	  
	  Thanks to Matheus Ribeiro for the patch
	* [r3445] src/readerfactory.c: #include "utils.h"
	* [r3444] src/readerfactory.c: RFRemoveReader(): call
	  StatSynchronize() after a reader removal to signal the event to
	  clients

2009-04-07  Ludovic Rousseau

	* [r3412] src/Makefile.am, src/powermgt_generic.c,
	  src/powermgt_macosx.c: remove powermgt_macosx.c since it is using
	  APSL version 1.1 instead of the BSD-like licence like the other
	  files
	  
	  Thanks to Stanislav Brabec for the bug report

2009-03-21  Ludovic Rousseau

	* [r3355] src/PCSC/reader.h.in: add PIN_PROPERTIES_STRUCTURE
	  structure and FEATURE_IFD_PIN_PROPERTIES
	  
	  Thanks to Martin Paljak for the patch

2009-03-20  Ludovic Rousseau

	* [r3352] src/PCSC/pcsclite.h.in: add URL of the error code
	  reference (MSDN)

2009-03-02  Ludovic Rousseau

	* [r3334] src/PCSC/pcsclite.h.in, src/PCSC/wintypes.h, src/debug.c,
	  src/debuglog.c, src/thread_generic.h: remove support of WIN32
	* [r3333] src/PCSC/pcsclite.h.in: add URL of error codes origines
	  (MSDN)

2009-03-01  Ludovic Rousseau

	* [r3332] src/PCSC/pcsclite.h.in: do not use /* inside a comment
	* [r3331] src/PCSC/pcsclite.h.in: add missing defines according to
	  http://msdn.microsoft.com/en-us/library/aa924526.aspx

2009-02-09  Ludovic Rousseau

	* [r3314] src/winscard_clnt.c: Comment revision 3313 patch
	* [r3313] src/winscard_clnt.c: SCardEstablishContextTH(): check we
	  do not reuse an already allocated hContext
	  
	  Thanks to Daniel Nobs for the bug report and patch Closes:
	  [#311455] Error in SCardEstablishContext

2009-02-06  Ludovic Rousseau

	* [r3306] ChangeLog, configure.in: release 1.5.2
	* [r3305] src/eventhandler.c: EHStatusHandlerThread(): call
	  StatSynchronize() before exiting the thread. Without this
	  SCardGetStatusChange() may not return.
	  
	  Thanks to Roberto Rizza for the bug report and patch.
	* [r3304] src/hotplug_libhal.c, src/pcsc-wirecheck-gen.c,
	  src/pcsc-wirecheck-main.c, src/pcscdaemon.c, src/readerfactory.c,
	  src/testpcsc.c, src/winscard.c, src/winscard_clnt.c: use
	  (void)param; for unused function parameters to avoid compiler
	  warnings

2009-02-05  Ludovic Rousseau

	* [r3303] src/readerfactory.c: reformat comments

2009-02-04  Ludovic Rousseau

	* [r3298] TODO: do not open the reader USB device if no client is
	  using the reader

2009-01-29  Ludovic Rousseau

	* [r3295] src/readerfactory.c: RFLockSharing() & RFUnlockSharing():
	  add a mutex to avoid a race condition
	  
	  Closes: [#311377] Race condition in SCardBeginTransaction

2009-01-28  Ludovic Rousseau

	* [r3294] src/ifdwrapper.c: log TxBuffer and RxBuffer if the
	  SCardControl() command failed.
	  
	  Closes: [#311376] PCSC_LOG_VERBOSE via -dd; print details of
	  "Card not transacted"

2009-01-24  Ludovic Rousseau

	* [r3291] src/utils.c: StatSynchronizeContext() is used for a
	  specific client. Correct the comment.

2009-01-22  Ludovic Rousseau

	* [r3290] doc/ifdhandler-3.tex: mark IFD_GENERATE_HOTPLUG as
	  deprecated. HAL now solves the hotplug problem for us.

2009-01-20  Ludovic Rousseau

	* [r3288] src/winscard_clnt.c: SCardCancel(): use
	  StatSynchronizeContext() to send an event to the waiting/blocked
	  thread
	  
	  Closes: [#311342] SCardCancel does not cancel an outstanding
	  SCardGetStatusChange
	* [r3287] src/utils.c, src/utils.h: add StatSynchronizeContext() to
	  send an asynchronous event to a specific context This function
	  can be used from libpcsclite. Using StatSynchronize() does not
	  work since the directory pcscd.events/ is not readable by group
	  and other for security reasons
	* [r3286] src/winscard_clnt.c: WaitForPcscdEvent(): use hContext
	  instead of a random to name the event file
	* [r3285] UnitaryTests/SCardCancel.py: improved version

2009-01-13  Ludovic Rousseau

	* [r3279] UnitaryTests/SCardCancel.py: SCardCancel sample
	* [r3278] src/winscard_clnt.c: SCardGetStatusChange(): return if
	  the state of the reader changed since the previous call.
	  
	  Thanks to Thomas Harning for the patch Closes: [#311341]
	  SCardGetStatusChange does not return CHANGED+EMPTY and
	  CHANGED+PRESENT sequence for remove-insert between calls

2009-01-12  Ludovic Rousseau

	* [r3277] UnitaryTests/SCardGetStatusChange,
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange.py,
	  UnitaryTests/SCardGetStatusChange/SCardGetStatusChange_PnP.py:
	  test SCardGetStatusChange
	* [r3276] UnitaryTests: directory to store Unitary Tests

2009-01-09  Ludovic Rousseau

	* [r3274] src/winscard_clnt.c: rename variable fd in profile_fd to
	  avoid winscard_clnt.c:1717: attention : declaration of ‘fd’
	  shadows a global declaration

2009-01-07  Ludovic Rousseau

	* [r3273] ChangeLog, configure.in: release 1.5.1

2009-01-05  Ludovic Rousseau

	* [r3267] src/winscard_svc.c: use
	  offsetof(transmit_struct_extended, data) instead of
	  sizeof(*treStr) since from revision 2146 the data[] array has one
	  element to be compilable by Sun Studio 11
	  
	  The side effect is that extended APDU were corrupted by 4 zero
	  bytes between the two consecutive blocks
	* [r3266] src/readerfactory.c: use snprintf() to avoid a possible
	  buffer overflow
	* [r3265] src/hotplug_libhal.c: avoid a memory leak in case of DBus
	  error
	* [r3264] splint.sh: script to call splint
	* [r3263] src/pcscdaemon.c: explicitly cast result in void when not
	  used (reported by the splint tool)
	* [r3262] src/utils/formaticc.c: free mszReaders before returning
	* [r3261] src/utils/formaticc.c: do not cast malloc()

2009-01-02  Ludovic Rousseau

	* [r3260] src/PCSC/winscard.h, src/atrhandler.h, src/configfile.h,
	  src/dyn_generic.h, src/ifdwrapper.c, src/ifdwrapper.h,
	  src/parser.h, src/readerfactory.h, src/sys_generic.h,
	  src/winscard_clnt.c, src/winscard_msg.h, src/winscard_msg_srv.c:
	  tag output parameters with /*@out@*/
	* [r3259] src/PCSC/winscard.h, src/eventhandler.h,
	  src/hotplug_libhal.c, src/sys_unix.c, src/thread_generic.h,
	  src/utils.h: tag potentially NULL paramater or returned value as
	  /*@null@*/
	* [r3258] src/pcscdaemon.c: declare functions static where possible
	* [r3257] src/pcscdaemon.c: remove unused SVCClientCleanup()
	  function
	* [r3256] src/pcscdaemon.c: mark unused parameter as /*@unused@*/
	  (reported by splint tool)
	* [r3255] src/pcscdaemon.c: no need to #include <syslog.h>
	* [r3254] src/atrhandler.c: not need to #include <syslog.h>
	* [r3253] src/eventhandler.c, src/testpcsc.c, src/winscard_svc.c:
	  declare functions static where possible
	* [r3252] src/hotplug_libhal.c, src/pcsc-wirecheck-gen.c,
	  src/pcsc-wirecheck-main.c, src/readerfactory.c, src/testpcsc.c,
	  src/utils/formaticc.c, src/utils/installifd.c, src/winscard.c,
	  src/winscard_clnt.c: mark unused parameter as /*@unused@*/
	  (reported by splint tool)
	* [r3251] src/pcscdaemon.c, src/winscard_msg.h,
	  src/winscard_msg_srv.c, src/winscard_svc.c: remove blocktime
	  parameter from SHMProcessEventsContext() and
	  SHMProcessEventsServer() since this parameter is not used
	* [r3250] src/winscard_msg.c: correct return types of
	  SHMMessageSend() and SHMMessageReceive() to match declaration in
	  winscard_msg.h (reported by splint tool)
	* [r3249] src/winscard_msg_srv.c: SHMInitializeCommonSegment(): use
	  correct return type as defined in winscard_msg.h (reported by
	  splint tool)
	* [r3248] src/readerfactory.c: reformat
	* [r3247] src/configfile.l, src/debug.c, src/dyn_unix.c,
	  src/error.c, src/eventhandler.c, src/hotplug_libhal.c,
	  src/ifdwrapper.c, src/readerfactory.c, src/sys_unix.c,
	  src/testpcsc.c, src/thread_unix.c, src/tokenparser.l,
	  src/utils.c, src/utils/formaticc.c, src/utils/installifd.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg_srv.c, src/winscard_svc.c: explicitly cast
	  result in void when not used (reported by the splint tool)
	* [r3246] c.sh: CFLAGS is now defined in ~/.bash_profile
	* [r3245] src/sys_unix.c: SYS_RandomInt(): replace a cast to
	  (float) by an explicit conversion using +0.0

2008-12-19  Ludovic Rousseau

	* [r3244] src/winscard_clnt.c: SCardGetAttrib(): avoid a possible
	  memory leak (detected by the cppcheck tool)

2008-12-18  Ludovic Rousseau

	* [r3241] src/winscard_clnt.c: typo in a comment

2008-12-17  Ludovic Rousseau

	* [r3239] src/lassert.h, src/pcsc-wirecheck-gen.c,
	  src/pcsc-wirecheck-main.c: add some log to pcsc-wirecheck

2008-12-13  Ludovic Rousseau

	* [r3235] doc/example/pcsc_demo.c: update FSF address

2008-11-18  Ludovic Rousseau

	* [r3216] ChangeLog: typo
	* [r3212] doc/ifdhandler-3.tex: document libhal scheme
	* [r3211] doc/ifdhandler-3.tex: document libhal scheme
	* [r3209] ChangeLog, configure.in: release 1.5.0

2008-11-10  Ludovic Rousseau

	* [r3200] src/readerfactory.c: RFRemoveReader(): symplify a test
	* [r3197] src/hotplug_libusb.c: HPAddHotPluggable(): correctly
	  handle bogus reader with corrupted iSerialNumber.
	  
	  Thanks to Ludovic LANGE for the patch. Closes: [#311215] Fix for
	  libusb hotplug garbage when serial number is empty

2008-10-31  Ludovic Rousseau

	* [r3190] src/winscard_clnt.c: SCardGetStatusChange(): use |=
	  instead of = to set SCARD_STATE_CHANGED bit in case (dwState &
	  SCARD_UNKNOWN)

2008-10-28  Ludovic Rousseau

	* [r3184] Makefile.am: add --reparagraph to svn2cl arguments

2008-10-27  Ludovic Rousseau

	* [r3180] src/winscard_clnt.c: move definition of time_sub() before
	  its first use

2008-10-24  Ludovic Rousseau

	* [r3179] src/ifdwrapper.c: reformat lock/unlock comments

2008-10-23  Ludovic Rousseau

	* [r3178] src/ifdwrapper.c, src/winscard.c: move locking from
	  IFDSetPTS() to 2 levels above in SCardConnect() and
	  SCardReconnect(). The value of
	  rContext->readerState->cardProtocol is then checked and modified
	  in an atomic transaction
	  
	  This avoids to renegociate the protocol and confuse the card if
	  two applications perform a SCardConnect() at the same time (after
	  they are both blocked by SCardGetStatusChange() and a card is
	  inserted for example)
	  
	  Error returned by CCID driver is: CCID_Receive Procedure byte
	  conflict

2008-10-16  Ludovic Rousseau

	* [r3171] src/winscard.c: #include "utils.h"
	  
	  winscard.c:497: attention : implicit declaration of function
	  ‘StatSynchronize’

2008-10-10  Ludovic Rousseau

	* [r3160] src/utils.c: SendHotplugSignal(): wait for 1 second after
	  send the signal to avoid a busy loop if the device died by HAL
	  did not noticed
	* [r3159] c.sh: remove --disable-libhal
	* [r3158] src/eventhandler.c: EHStatusHandlerThread(): remove
	  commented and never used code to restart a reader after 10
	  IFDStatusICC() errors

2008-10-07  Ludovic Rousseau

	* [r3157] src/hotplug_libhal.c, src/hotplug_libusb.c: call
	  CheckForOpenCT() if RFAddReader() fails.
	  
	  The first cause of pcsc-lite failure is that OpenCT is installed
	  and running and has already claimed the USB device. In that case
	  RFAddReader() fails and I get a user support request
	* [r3156] src/utils.c, src/utils.h: add CheckForOpenCT()

2008-09-24  Ludovic Rousseau

	* [r3146] src/ifdwrapper.c: IFDCloseIFD(): give up to 500 ms to the
	  mutex to be free if the lock failed. Maybe a polling thread is
	  still using the device on another slot.
	* [r3145] src/utils.c: StatSynchronize(): log and return if
	  opendir() fails
	  
	  Avoids a crash when started without root privileges

2008-09-21  Ludovic Rousseau

	* [r3142] src/hotplug_libhal.c: HPAddDevice(): remove a debug
	  printf()

2008-09-11  Ludovic Rousseau

	* [r3125] src/winscard_clnt.c: SCardStatus(): allow NULL for
	  pcchReaderLen and pcbAtrLen
	  
	  You can then use SCardStatus(hCard, pcReaders, &dwReaderLen,
	  NULL, NULL, NULL, NULL) to only get the reader name or
	  SCardStatus(hCard, NULL, NULL, NULL, NULL, pbAtr, &dwAtrLen) to
	  only get the card ATR or even SCardStatus(hCard, NULL, NULL,
	  NULL, NULL, NULL, NULL) to get nothing except SCARD_S_SUCCESS
	* [r3124] src/winscard_clnt.c: SCardStatus(), SCardGetAttrib(),
	  SCardListReaders(), SCardListReaderGroups(): check that the
	  pointer argument used to store the allocated memory in case of
	  SCARD_AUTOALLOCATE is not NULL.
	  
	  return SCARD_E_INVALID_PARAMETER instead of crashing

2008-09-10  Ludovic Rousseau

	* [r3123] src/winscard_clnt.c: Doxygen: reformat a line
	* [r3121] c.sh: expand a tab

2008-09-09  Ludovic Rousseau

	* [r3120] src/winscard.c, src/winscard_clnt.c: SCardTransmit():
	  correctly pass the pioRecvPci parameter
	  
	  Thanks to David L. Markowitz for the bug report
	* [r3119] src/utils.c: StatSynchronize(): log with level DEBUG
	  instead of ERROR if errno is ENXIO "No such device or address"
	  since it is a normal error if the client is no more listening the
	  pipe
	* [r3118] src/winscard_clnt.c: SCardGetStatusChange(): move "Event
	  Loop End" log after the end label so the log is displayed
	* [r3117] src/winscard_clnt.c: WaitForPcscdEvent(): remove the
	  waiting for event file after use
	* [r3116] src/hotplug_libhal.c: HPAddDevice(): the device serial is
	  "usb.serial" instead of "usb_device.serial" and it is a C-string
	  instead of an int

2008-09-05  Ludovic Rousseau

	* [r3112] src/winscard_clnt.c: Doxygen: move SCardSetTimeout (back)
	  in the API group so the detailed documentation does not appear in
	  the winscard.h page
	* [r3111] src/PCSC/pcsclite.h.in: Doxygen: document
	  SCARD_IO_REQUEST structure
	* [r3110] src/PCSC/pcsclite.h.in: remove useless struct
	  _SCARD_IO_REQUEST name
	* [r3109] src/winscard_clnt.c: Doxygen: SCardTransmit() can use
	  SCARD_PCI_RAW for pioSendPci
	* [r3108] src/winscard_clnt.c: Doxygen: document g_rgSCard*Pci
	  values
	* [r3107] src/winscard_clnt.c: move WaitForPcscdEvent() before
	  doxygen doc of SCardGetStatusChange()

2008-08-28  Ludovic Rousseau

	* [r3104] src/winscard_msg_srv.c: SHMProcessEventsContext(): do not
	  timeout every 1 second on Linux.
	  
	  We do timeout only on *BSD like in SHMProcessEventsServer()

2008-08-26  Ludovic Rousseau

	* [r3103] src/eventhandler.c, src/winscard.c, src/winscard_clnt.c:
	  use asynchronous events instead of polling for
	  SCardGetStatusChange()
	  
	  on client side use WaitForPcscdEvent() instead of
	  SYS_USleep(PCSCLITE_STATUS_WAIT)
	  
	  on server side use StatSynchronize() instead of
	  SYS_MMapSynchronize()
	* [r3102] src/winscard_clnt.c: SCardGetStatusChange(): use k
	  instead of i warning: declaration of 'i' shadows a previous local
	* [r3101] src/winscard_clnt.c: move time_sub() outside of #ifdef
	  DO_PROFILE
	* [r3100] src/pcscd.h.in: define PCSCLITE_EVENTS_DIR
	* [r3099] src/pcscdaemon.c: main(): create PCSCLITE_EVENTS_DIR
	  directory clean_temp_files(): purge & remove PCSCLITE_EVENTS_DIR
	  directory
	* [r3098] src/utils.c, src/utils.h: add StatSynchronize() "Sends an
	  asynchronous event to any waiting client"

2008-08-12  Ludovic Rousseau

	* [r3088] src/winscard_msg_srv.c: SHMProcessEventsContext(): also
	  log the received command not just the client ID

2008-08-11  Ludovic Rousseau

	* [r3087] src/pcscdaemon.c, src/winscard_msg.c,
	  src/winscard_msg_srv.c: use SYS_RemoveFile() instead of
	  SYS_Unlink()
	* [r3086] src/sys_generic.h, src/sys_unix.c: remove SYS_Unlink()
	  since it duplicates SYS_RemoveFile()

2008-08-07  Ludovic Rousseau

	* [r3083] src/eventhandler.c: reorder two lines
	* [r3082] src/eventhandler.c, src/pcscdaemon.c: call SYS_Chmod()
	  for PCSCLITE_RUN_PID and PCSCLITE_PUBSHM_FILE to force the file
	  access mode in case umask is too restrictive

2008-08-06  Ludovic Rousseau

	* [r3081] src/readerfactory.h: #include "pcscd.h" to get
	  definitions MAX_LIBNAME, MAX_DEVICENAME,
	  PCSCLITE_MAX_READER_CONTEXT_CHANNELS
	* [r3080] src/pcscdaemon.c: main(): call SYS_OpenFile() with the
	  modes used by SYS_Chmod() and remove useless SYS_Chmod() call
	* [r3079] src/eventhandler.c: EHInitializeEventStructures(): call
	  SYS_OpenFile() with the modes used by SYS_Chmod() and remove
	  useless SYS_Chmod() call
	* [r3078] src/eventhandler.c: EHInitializeEventStructures(): use
	  POSIX instead of Unix V7 permissions names

2008-07-30  Ludovic Rousseau

	* [r3077] src/winscard_clnt.c: Doxygen: typo
	* [r3076] src/winscard_clnt.c: Doxygen: document the use of
	  SCARD_AUTOALLOCATE with SCardGetAttrib()
	* [r3075] src/PCSC/debuglog.h, src/debug.h, src/error.c,
	  src/winscard_clnt.c: Doxygen: do not create a useless @test group
	* [r3074] src/winscard_clnt.c: Doxygen: document use of
	  SCARD_AUTOALLOCATE for SCardStatus()
	* [r3073] src/PCSC/winscard.h: SCardStatus(): rename parameter
	  mszReaderNames -> mszReaderName
	* [r3072] src/winscard_clnt.c: Doxygen: remove SCardSetTimeout()
	  from the API doc since it is deprecated
	* [r3071] src/winscard_clnt.c: SCardStatus(): factorize code using
	  goto end;
	* [r3070] src/winscard_clnt.c: SCardStatus(): rename parameter
	  mszReaderNames in mszReaderName since it is the name of one
	  reader only
	* [r3069] src/testpcsc.c: test SCARD_AUTOALLOCATE in SCardStatus()
	* [r3068] src/winscard_clnt.c: SCardStatus(): add support of
	  SCARD_AUTOALLOCATE for pcchReaderLen and pcbAtrLen
	* [r3067] src/testpcsc.c: use buf[] and dwBufLen for an temporary
	  buffer instead of pbAtr[] and dwAtrLen

2008-07-29  Ludovic Rousseau

	* [r3062] src/winscard_clnt.c: SCardStatus(): set *pdwState and
	  *pdwProtocol to 0 before checking pcchReaderLen and pcbAtrLen
	  
	  Should avoid the use of SUN libregression.c for some buggy
	  applications

2008-07-07  Ludovic Rousseau

	* [r3058] src/winscard_clnt.c: SCardGetStatusChange(): Doxygen
	  document the use of "\\?PnP?\Notification"
	* [r3057] src/winscard_clnt.c: Doxygen document the use of
	  SCARD_AUTOALLOCATE for SCardListReaders() and
	  SCardListReaderGroups()
	* [r3056] src/error.c, src/winscard_clnt.c: improve Doxygen
	  documentation
	* [r3055] doc/doxygen.conf.in: exclude src/winscard_scf.c since it
	  is a duplicate of winscard_clnt.c and causes some Doxygen links
	  to be wrong
	* [r3054] src/winscard_clnt.c: typos in Doxygen comments

2008-07-04  Ludovic Rousseau

	* [r3053] src/testpcsc.c: when the reader is disconnected during
	  SCardGetStatusChange() SCARD_STATE_UNKNOWN bit is set in
	  .dwEventState
	* [r3052] src/testpcsc.c: test SCardGetStatusChange() with reader
	  name \\?PnP?\Notification to detect new reader
	* [r3051] src/winscard_clnt.c: SCardGetStatusChange(): if a reader
	  disappear also set SCARD_STATE_UNAVAILABLE in dwEventState (more
	  conform to Windows XP)
	* [r3050] src/winscard_clnt.c: SCardGetStatusChange(): add support
	  of reader name \\?PnP?\Notification to detect reader
	  insertion/removal (conform to Windows XP)o
	  
	  Closes: [#310780] Support for undocumented \\?PnP?\Notification
	  'virtual' reader
	  
	  Using a cReaders == 0 is now deprecated
	* [r3049] src/winscard_clnt.c: SCardGetStatusChange(): simplify
	  SCARD_SWALLOWED check
	* [r3048] src/winscard_clnt.c: SCardGetStatusChange(): reformat
	  comments
	* [r3047] src/winscard_clnt.c: SCardGetStatusChange(): simplify bad
	  state check
	* [r3046] src/winscard_clnt.c: SCardGetStatusChange(): simplify
	  unknown reader case
	* [r3045] src/winscard_clnt.c: SCardGetStatusChange(): factorize
	  exit code using goto end;
	* [r3044] src/winscard_clnt.c: SCardGetStatusChange(): return
	  SCARD_E_TIMEOUT instead of SCARD_S_SUCCESS if dwTimeout == 0
	  (conform to Windows XP)
	* [r3043] src/winscard_clnt.c: SCardGetStatusChange(): move check
	  for break conditions code
	* [r3042] src/winscard_clnt.c: SCardGetStatusChange(): move and
	  simplify the check the integrity of the reader states structures
	  routine
	* [r3041] src/winscard_clnt.c: SCardGetStatusChange(): return if
	  all readers are SCARD_STATE_IGNORE
	* [r3040] src/winscard_clnt.c: SCardGetStatusChange(): do not even
	  change dwEventState for SCARD_STATE_IGNORE readers
	* [r3039] src/winscard_clnt.c: SCardGetStatusChange(): simplify the
	  Clear the event state for all readers loop
	* [r3038] src/winscard_clnt.c: SCardGetStatusChange(): maximal
	  value for cReaders is PCSCLITE_MAX_READERS_CONTEXTS not
	  PCSCLITE_MAX_READERS_CONTEXTS-1
	* [r3037] src/winscard_clnt.c: SCardGetStatusChange(): move check
	  for cReaders >= PCSCLITE_MAX_READERS_CONTEXTS

2008-06-27  Ludovic Rousseau

	* [r3032] ChangeLog, configure.in: release 1.4.102
	* [r3031] src/winscard_svc.c: ContextsInitialize(): use a long
	  instead of int winscard_svc.c:100: warning: cast to pointer from
	  integer of different size

2008-06-26  Ludovic Rousseau

	* [r3030] src/eventhandler.c: EHDestroyEventHandler(): kill the
	  polling thread only if the driver supports it (declared using
	  TAG_IFD_POLLING_THREAD_KILLABLE)
	  
	  libusb 1.0 does not support it so it is disabled in the ccid
	  driver
	* [r3029] src/PCSC/ifdhandler.h: #define
	  TAG_IFD_POLLING_THREAD_KILLABLE
	* [r3028] src/eventhandler.c: EHStatusHandlerThread(): lower the
	  log level when the polling thread is dying

2008-06-24  Ludovic Rousseau

	* [r3021] src/testpcsc.c: test SCardGetAttrib() with
	  SCARD_AUTOALLOCATE
	* [r3020] src/winscard_clnt.c: SCardGetAttrib(): add support of
	  SCARD_AUTOALLOCATE
	* [r3019] src/winscard_clnt.c: SCardListReaders(): always set the
	  pcchReaders even if SCARD_E_INSUFFICIENT_BUFFER is returned
	* [r3018] src/winscard_clnt.c: SCardListReaderGroups(): check for
	  SCARD_E_INSUFFICIENT_BUFFER only if mszGroups is non-null
	* [r3017] src/testpcsc.c: test SCardListReaderGroups() with
	  USE_AUTOALLOCATE
	* [r3016] src/winscard_clnt.c: SCardListReaderGroups(): add support
	  of SCARD_AUTOALLOCATE

2008-06-23  Ludovic Rousseau

	* [r3015] src/testpcsc.c: use NULL instead of 0 for mszGroups
	  argument of SCardListReaderGroups()

2008-06-19  Ludovic Rousseau

	* [r3014] src/testpcsc.c: test SCardListReaders(..
	  SCARD_AUTOALLOCATE ..)
	* [r3013] src/PCSC/pcsclite.h.in, src/PCSC/winscard.h,
	  src/winscard_clnt.c: add support of SCARD_AUTOALLOCATE for
	  SCardListReaders() add SCardFreeMemory()
	* [r3012] src/testpcsc.c: use NULL instead of 0 for mszReaders
	  argument of SCardListReaders()
	* [r3011] src/winscard_clnt.c: SCardListReaders(): correctly return
	  SCARD_E_INSUFFICIENT_BUFFER if *pcchReaders is too small

2008-06-07  Ludovic Rousseau

	* [r2980] m4/acx_pthread.m4: update (correct a problem under
	  Solaris)
	  
	  Thanks to David L. Markowitz for the bug report

2008-05-29  Ludovic Rousseau

	* [r2975] src/readerfactory.c: RFAddReader(): try to use the reader
	  polling thread also for the other slots on a multi-slots reader

2008-05-23  Ludovic Rousseau

	* [r2967] doc/pcsc-lite.tex: add spaces around =

2008-05-16  Ludovic Rousseau

	* [r2963] src/winscard_clnt.c: SCardReconnect(), SCardDisconnect(),
	  SCardBeginTransaction(), SCardEndTransaction(),
	  SCardCancelTransaction(), SCardStatus(), SCardControl(),
	  SCardGetSetAttrib(), SCardTransmit(): check that the card handle
	  is still valid after we (should) hold the lock
	  
	  The context may have been closed by another thread using
	  SCardReleaseContext() on the same context
	  
	  [#300849] problems in multithreading environment (segmentation
	  faults, SCardCancel does not work)
	* [r2962] src/thread_unix.c: SYS_Mutex*(): check that the mMutex
	  parameter is non NULL to avoid a crash
	  
	  related to [#300849] problems in multithreading environment
	  (segmentation faults, SCardCancel does not work)
	* [r2961] src/eventhandler.c, src/pcsc-wirecheck-gen.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_msg_srv.c,
	  src/winscard_svc.c: remove spaces at end of lines
	* [r2960] src/winscard_clnt.c: SCardReleaseContext(),
	  SCardConnect(), SCardGetStatusChange(), SCardListReaders() and
	  SCardListReaderGroups: check that the context is still opened
	  after we (should) hold the lock
	  
	  The context may have been closed by another thread using
	  SCardReleaseContext() on the same context
	  
	  [#300849] problems in multithreading environment (segmentation
	  faults, SCardCancel does not work)
	* [r2959] src/winscard.c: remove an empty line
	* [r2958] Makefile.am, configure.in, win32: do not include the
	  (useless) win32 directory any more

2008-05-15  Ludovic Rousseau

	* [r2957] src/winscard.c: SCardConnect(), SCardReconnect(): do not
	  check the parameter dwPreferredProtocols if dwShareMode ==
	  SCARD_SHARE_DIRECT
	  
	  This is used on contactless readers to talk to the reader without
	  any card and "random" value of dwPreferredProtocols
	  
	  Thanks to Philippe BOURGAULT for reporting the bug
	* [r2956] src/winscard_clnt.c: SCardEstablishContextTH(),
	  SCardConnect(), SCardReconnect(), SCardDisconnect(),
	  SCardEndTransaction(): do not check parameters for
	  SCARD_E_INVALID_VALUE since these tests are also done on the
	  server side. Do not duplicate code
	* [r2955] src/pcscdaemon.c: SVCServiceRunLoop(): return if
	  HPSearchHotPluggables() fails
	* [r2954] src/pcscdaemon.c: SVCServiceRunLoop(): return if
	  HPRegisterForHotplugEvents() fails
	* [r2953] src/winscard_svc.c: CreateContextThread(): update to the
	  new SYS_ThreadCreate() API

2008-05-13  Ludovic Rousseau

	* [r2952] src/eventhandler.c: EHDestroyEventHandler(): log the
	  error message of SYS_ThreadJoin() and SYS_ThreadCreate() if any
	* [r2951] src/eventhandler.c: EHSpawnEventHandler(): do not create
	  the card polling thread using THREAD_ATTR_DETACHED since that
	  will prevent SYS_ThreadJoin() from working
	* [r2950] src/eventhandler.c: EHStatusHandlerThread(): do not call
	  SYS_ThreadDetach() since that will prevent SYS_ThreadJoin() from
	  working.
	* [r2949] src/thread_unix.c: update copyright date
	* [r2948] src/thread_unix.c: forward the return value from the low
	  level thread library and not just FALSE or TRUE The upper layer
	  can then use strerror()
	* [r2947] src/Makefile.am, src/dyn_win32.c, src/thread_win32.c: do
	  not distribute win32 files anymore. win32 is not a supported
	  platform
	* [r2946] configure.in, src/pcscdaemon.c: pcscd -v now displays the
	  enabled features
	  
	  Thanks to Alon Bar-Lev for the suggestion
	* [r2945] src/pcscdaemon.c: update email for bug reports

2008-05-12  Ludovic Rousseau

	* [r2944] src/ifdwrapper.c: IFDCloseIFD(): use SYS_MutexTryLock()
	  instead of SYS_MutexLock() since the mutex may be hold by a now
	  dead polling thread
	* [r2943] src/thread_generic.h, src/thread_unix.c: add
	  SYS_MutexTryLock()
	* [r2942] src/readerfactory.c: typo in comment

2008-05-11  Ludovic Rousseau

	* [r2941] Makefile.am: add AUTOMAKE_OPTIONS = dist-bzip2 so that
	  make dist alsa generates a .tar.bz2 archive

2008-05-09  Ludovic Rousseau

	* [r2939] src/readerfactory.c: RFAddReader(): in case of error call
	  RFRemoveReader() to free all resources instead of duplicating
	  part of the needed code.
	* [r2938] src/readerfactory.c: RFAddReader(): call RFRemoveReader()
	  to free resources if EHSpawnEventHandler() fails

2008-05-06  Ludovic Rousseau

	* [r2928] INSTALL: do not store in subversion since it is installed
	  by autoconf

2008-04-30  Ludovic Rousseau

	* [r2927] src/winscard_clnt.c: doxygen: SCardCancelTransaction()
	  add return values SCARD_W_REMOVED_CARD and SCARD_W_RESET_CARD
	* [r2926] ChangeLog, configure.in: release 1.4.101
	* [r2918] src/hotplug_libusb.c, src/winscard_msg_srv.c: Add support
	  for DragonFly BSD
	  
	  Thanks to Hasso Tepper for the patch

2008-04-29  Ludovic Rousseau

	* [r2917] src/eventhandler.c: EHStatusHandlerThread(): do not set
	  card state to SCARD_RESET when a card is inserted. Keep the state
	  to SCARD_REMOVED
	  
	  See
	  http://www.opensc-project.org/pipermail/opensc-devel/2008-April/011121.html

2008-04-28  Ludovic Rousseau

	* [r2915] src/winscard_clnt.c: return the returned value of
	  SCardCheckDaemonAvailability() instead of always
	  SCARD_E_NO_SERVICE in case of error (may also be
	  SCARD_E_INVALID_HANDLE)
	* [r2914] src/winscard_clnt.c: SCardCheckDaemonAvailability():
	  return SCARD_E_INVALID_HANDLE instead of SCARD_E_NO_SERVICE is
	  pcscd has been restarted
	  
	  Thanks to Alon Bar-Lev for the patch

2008-04-25  Ludovic Rousseau

	* [r2913] src/winscard_clnt.c: SCardEstablishContext(): correcly
	  handle a call from a forked child (do not fail)
	  
	  Thanks to Alon Bar-Lev for bug report

2008-04-24  Ludovic Rousseau

	* [r2910] src/winscard_clnt.c: SCardCheckDaemonAvailability():
	  invalidate all handles if the application has forked and we are
	  in the child. The child must call SCardEstablishContext() to get
	  his own handle.
	  
	  Thanks to Alon Bar-Lev for the bug report and the patch
	* [r2909] src/testpcsc.c: better management of corner cases
	* [r2908] src/winscard_clnt.c: doxygen: use /**< instead of /** to
	  correctly identify identify fields
	* [r2907] src/winscard_svc.c: ContextThread(): call
	  SHMClientCloseSession() instead of SYS_CloseFile() to respect
	  namespace
	* [r2906] src/winscard_svc.c: typo in comment

2008-04-22  Ludovic Rousseau

	* [r2905] doc/doxygen.conf.in: doxygen: WARN_NO_PARAMDOC = YES
	* [r2904] doc/doxygen.conf.in: doxygen: update conf from version
	  1.4.2 to 1.5.5 file using doxygen -u
	* [r2903] doc/doxygen.conf.in: ENUM_VALUES_PER_LINE = 1 (instead of
	  4)
	* [r2902] src/winscard_clnt.c: doxygen: remove two unused </ul>
	* [r2901] src/winscard_clnt.c: doxygen: add SCardReleaseContext()
	  and SCardEndTransaction() in API group even if they are
	  deprecated
	* [r2900] src/readerfactory.h, src/winscard_msg.h: doxygen: add
	  comments
	* [r2899] src/winscard_svc.c: ContextThread(): check the return
	  value of MSGFunctionDemarshall() and correctly exists in case of
	  error. This happens when MSGCheckHandleAssociation() fails
	  
	  Thanks to Alon Bar-Lev for the bug report
	* [r2898] src/winscard_msg.h, src/winscard_msg_srv.c,
	  src/winscard_svc.c: SHMProcessEventsContext(): use uint32_t
	  dwClientID parameter instead of uint32_t *pdwClientID since we do
	  not need the address of the value but the value itself
	* [r2897] src/hotplug_libusb.c: doxygen: convert C comments in
	  doxygen comments
	* [r2896] src/debuglog.c, src/hotplug_libhal.c,
	  src/hotplug_linux.c, src/ifdwrapper.c, src/pcscdaemon.c,
	  src/powermgt_generic.h, src/prothandler.c, src/winscard_scf.c,
	  src/winscard_svc.c: doxygen: convert C comments in doxygen
	  comments

2008-04-21  Ludovic Rousseau

	* [r2895] src/debug.c: declare log_init() static to avoid the
	  prototype declaration
	* [r2894] src/debug.c: correct LogLevel comment to be accurate
	* [r2893] src/debug.c: doxygen: convert C comments in doxygen
	  comments
	* [r2892] src/PCSC/ifdhandler.h: doxygen: convert C comments in
	  doxygen comments
	* [r2891] src/atrhandler.c, src/atrhandler.h: removed unused TO and
	  T1 struct from CardCapabilities struct
	* [r2890] src/atrhandler.h: removed unused PtsData struct from
	  CardCapabilities struct
	* [r2889] src/readerfactory.h: doxygen: convert C comments in
	  doxygen comments
	* [r2888] src/readerfactory.h: remove unused RdrCapabilities and
	  ProtOptions structures
	* [r2887] src/readerfactory.h: doxygen: document struct
	  SerialReader fields
	* [r2886] src/winscard_clnt.c: doxygen: wrap long lines
	* [r2885] src/error.c, src/winscard_clnt.c: doxygen: create an API
	  group
	* [r2884] src/winscard.c, src/winscard_clnt.c: doxygen: use -
	  instead of <li>
	* [r2883] src/winscard_msg.h: doxygen: document SCARD_* commands
	  and \ref them from struct doc
	* [r2882] src/readerfactory.c: RFAddReader(): log if we are using
	  pcscd or reader polling thread

2008-04-20  Ludovic Rousseau

	* [r2881] TODO: remove "use a callback from IFD handler to pcscd
	  instead of polling to get the card status" since this feature is
	  now available using TAG_IFD_POLLING_THREAD when the driver is
	  collaborating
	* [r2880] src/testpcsc.c: improve colorization
	* [r2879] TODO: start pcscd as an normal user daemon

2008-04-10  Ludovic Rousseau

	* [r2878] src/hotplug_libhal.c: HPRegisterForHotplugEvents():
	  correctly check if no bundle files in pcsc drivers directory
	* [r2877] c.sh: expand a tab

2008-04-07  Ludovic Rousseau

	* [r2868] c.sh: revert previous patch
	* [r2867] TODO, c.sh: start pcscd only when a reader is connected.

2008-04-04  Ludovic Rousseau

	* [r2866] c.sh: add --sysconfdir=/etc
	* [r2865] etc/pcscd.init.in: update Should-Start: and Should-Stop:
	  (see Debian bug #474238)

2008-03-23  Ludovic Rousseau

	* [r2852] ChangeLog, configure.in: release 1.4.100

2008-03-14  Ludovic Rousseau

	* [r2851] etc/pcscd.init.in: typo pscsd -> pcscd
	* [r2850] src/winscard_clnt.c: SCardCheckDaemonAvailability():
	  lower the priority of the log message in case of "PCSC restarted"
	  so that nothing is logged by default. PCSCLITE_DEBUG can be
	  defined to see the message.
	  
	  See also revision 2731

2008-03-04  Ludovic Rousseau

	* [r2845] src/winscard_clnt.c: SCardReleaseContext(): remove the
	  local context at the end like before revision 2833 (since we use
	  the psContextMap[dwContextIndex].mMutex) or if
	  SCardCheckDaemonAvailability() fails

2008-02-21  Ludovic Rousseau

	* [r2839] src/winscard_clnt.c: SCardReleaseContext(): revert
	  revision 2834 since we need to get the value of dwContextIndex
	* [r2838] src/pcscdaemon.c: pcscdaemon.c:394:34: warning: "/*"
	  within comment

2008-02-19  Ludovic Rousseau

	* [r2835] src/winscard_clnt.c: reformat
	* [r2834] src/winscard_clnt.c: SCardReleaseContext(): do not call
	  SCardGetContextIndice() since SCardRemoveContext() will call it
	  internally
	* [r2833] src/winscard_clnt.c: SCardReleaseContext(): release the
	  local resource even if the daemon does not respond
	  
	  Thanks to Eric Walter for the bug report

2008-02-16  Ludovic Rousseau

	* [r2830] src/pcscdaemon.c: do not create the PCSCLITE_IPC_DIR
	  (/var/run/pcscd) directory with the sticky bit
	* [r2829] src/pcscdaemon.c: change a comment from /tmp/pcsc to
	  /var/run/pcscd/
	* [r2828] src/pcscdaemon.c: update comments /var/run/ is now
	  /var/run/pcscd/ by default

2008-02-14  Ludovic Rousseau

	* [r2817] src/hotplug_libhal.c: set svn:keywords Id
	* [r2816] c.sh: add --enable-twinserial
	* [r2814] src/PCSC/wintypes.h: move types unused by pcsc-lite at
	  the end

2008-02-09  Ludovic Rousseau

	* [r2812] configure.in: display sysconfdir_exp instead of
	  sysconfdir
	* [r2811] configure.in: set default value of confdir

2008-02-04  Ludovic Rousseau

	* [r2787] src/readerfactory.c: RFAddReader(): also check returned
	  value of dwGetSize
	* [r2785] configure.in: improve configuration display
	* [r2784] c.sh: add set -x

2008-02-01  Ludovic Rousseau

	* [r2780] src/eventhandler.c, src/eventhandler.h,
	  src/readerfactory.c, src/readerfactory.h: add support of
	  TAG_IFD_POLLING_THREAD to use an asynchronous card movements
	  detection instead of an active polling
	* [r2779] src/PCSC/ifdhandler.h: add TAG_IFD_POLLING_THREAD
	* [r2778] src/sys_unix.c: SYS_GetPageSize(): cache the result of
	  getpagesize() to improve performances

2008-01-30  Ludovic Rousseau

	* [r2775] src/winscard_clnt.c: SCardCheckDaemonAvailability(): log
	  the system error message in case PCSC Not Running

2008-01-29  Ludovic Rousseau

	* [r2770] src/winscard_clnt.c: SCardListReaders(): returns
	  SCARD_E_NO_READERS_AVAILABLE when no reader are available.
	  
	  Thanks to Thomas Harning for the bug report
	* [r2769] src/error.c: pcsc_stringify_error(): add support of
	  SCARD_E_NO_READERS_AVAILABLE
	* [r2768] src/winscard_clnt.c: SCardListReaders(): factorize code

2008-01-24  Ludovic Rousseau

	* [r2767] src/winscard.c: SCardConnect(), SCardReconnect(),
	  SCardDisconnect(): replace SYS_USleep(PCSCLITE_STATUS_POLL_RATE +
	  10) by SYS_MMapSynchronize() calls to gain performances.
	  
	  Thanks to Sean Wykes for the patch
	* [r2766] src/hotplug_libhal.c: use $Id$
	* [r2765] src/hotplug_libhal.c: HPAddDevice(): remove the device
	  from readerTracker[] if RFAddReader() fails
	* [r2761] configure.in: document what do do if pkg module hal is
	  not found

2008-01-22  Ludovic Rousseau

	* [r2760] configure.in: revert libhal -> LIBHAL
	* [r2759] configure.in: rename LIBHAL -> libhal

2008-01-21  Ludovic Rousseau

	* [r2750] src/thread_generic.h, src/thread_unix.c: first argument
	  of SYS_ThreadJoin() is now a PCSCLITE_THREAD_T instead of
	  PCSCLITE_THREAD_T *
	* [r2749] src/thread_generic.h, src/thread_unix.c: add
	  SYS_ThreadSetCancelType()
	* [r2748] configure.in, src/Makefile.am, src/hotplug_generic.c,
	  src/hotplug_libhal.c, src/hotplug_linux.c: add libhal support to
	  avoid polling the USB bus. libusb is still supported but libhal
	  is now the default
	* [r2747] src/hotplug_libusb.c: Patch in revision 2743 was wrong.
	  We need to hold the lock before traversing the reader list

2008-01-17  Ludovic Rousseau

	* [r2745] src/debuglog.c: do not display dela times of more than
	  100 seconds to avoid overflows. The magic value 99999999 is used
	  instead
	* [r2744] doc/ifdhandler-3.tex: more details about deviceName
	  argument of IFDHCreateChannelByName()

2008-01-15  Ludovic Rousseau

	* [r2743] src/hotplug_libusb.c: HPAddHotPluggable(): lock the mutex
	  _after_ every possible return. (May cause a deadlock)
	* [r2742] src/ifdwrapper.c: #include "utils.h" instead of
	  "hotplug.h"
	* [r2741] src/utils.h: #include <sys/types.h>
	* [r2740] src/utils.h: revert previous patch
	* [r2739] src/utils.h: remove wrong comment
	* [r2738] src/hotplug.h, src/pcscdaemon.c, src/utils.c,
	  src/utils.h: move SendHotplugSignal() from pcscdaemon.c to
	  utils.c
	* [r2737] src/hotplug_libusb.c: HPRescanUsbBus() and
	  HPEstablishUSBNotifications() are static functions
	* [r2736] src/hotplug_linux.c: add a prototype for
	  HPEstablishUSBNotifications() and make it static
	* [r2735] src/hotplug_libusb.c, src/hotplug_linux.c: declare local
	  functions as static

2008-01-14  Ludovic Rousseau

	* [r2733] src/dyn_macosx.c: DYN_LoadLibrary(): log an error message
	  in case of failure

2008-01-12  Ludovic Rousseau

	* [r2732] src/debug.c: default log level is PCSC_LOG_CRITICAL+1 so
	  that NO log is sent to stderr by default. You need to explicitely
	  set PCSCLITE_DEBUG to have logs. (in a library stderr(2) can be
	  any file opened with fd=2 so should not be used)

2008-01-11  Ludovic Rousseau

	* [r2731] src/winscard_clnt.c: CardCheckDaemonAvailability(): lower
	  the priority of the log message in case of "PCSC Not Running" so
	  that nothing is logged by default. PCSCLITE_DEBUG can be defined
	  to see the message.
	  
	  Programs linked with libpcsclite will not display anything if
	  pcscd is not running. Solves Red Hat bug 428299.
	* [r2730] src/pcscdaemon.c: add a \n after the pid number in
	  PCSCLITE_RUN_PID so that cat(1) works correctly
	* [r2729] src/winscard_msg.c: Log the socket name in case of error
	* [r2728] src/winscard_clnt.c: SCardEstablishContextTH(): also
	  display the system error message if a system call fails (can't
	  open PCSCLITE_PUBSHM_FILE)

2008-01-09  Ludovic Rousseau

	* [r2726] ChangeLog: release 1.4.99

2008-01-03  Ludovic Rousseau

	* [r2721] src/libpcsclite.pc.in: more @PTHREAD_LIBS@ from Libs: to
	  Libs.private:
	* [r2720] src/pcscdaemon.c: add type for ExitValue
	* [r2719] src/pcscdaemon.c: return EXIT_SUCCESS (instead of
	  EXIT_SUCCESS) if parsing /etc/reader.conf fails.
	  
	  Closes Debian bug #457665
	* [r2718] src/configfile.l: improve detection of wrong format in
	  reader.conf file

2007-12-13  Ludovic Rousseau

	* [r2714] src/eventhandler.c: EHStatusHandlerThread(): remove an
	  unneeded SYS_USleep() before powering a card when its presence is
	  detected.
	  
	  Thanks to Sean Michael Wykes for the patch

2007-11-23  Ludovic Rousseau

	* [r2710] doc/doxygen.conf.in: include call graphs
	* [r2709] src/PCSC/pcsclite.h.in, src/PCSC/reader.h.in,
	  src/winscard_clnt.c: add missing Doxygen comments

2007-11-22  Ludovic Rousseau

	* [r2708] src/winscard_clnt.c: improve Doxygen documentation

2007-11-17  Ludovic Rousseau

	* [r2707] src/winscard_msg.h: use uint32_t instead of int32_t for
	  rv type
	* [r2706] src/testpcsc.c: use LONG instead of int for rv in
	  test_rv() The type was wrong on amd64 since the sign was extended
	* [r2705] src/testpcsc.c: only display the result of SCardControl()
	  if it succeeded

2007-11-09  Ludovic Rousseau

	* [r2681] src/winscard_msg.c: typo

2007-11-08  Ludovic Rousseau

	* [r2680] src/pcscdaemon.c: 2 typos

2007-11-01  Ludovic Rousseau

	* [r2678] src/pcscdaemon.c: main(): create PCSCLITE_IPC_DIR
	  _before_ writing PCSCLITE_RUN_PID

2007-10-18  Ludovic Rousseau

	* [r2663] src/pcscdaemon.c: main(): do not create the
	  PCSCLITE_IPC_DIR directory with write permission for group and
	  other
	* [r2662] c.sh: check more prototypes
	* [r2661] src/winscard.c: winscard.c:660: warning: declaration of
	  'dwAtrLen' shadows a previous local
	* [r2660] src/PCSC/ifdhandler.h, src/ifdwrapper.c: use (void)
	  instead of () for function declaration
	* [r2659] src/PCSC/pcsclite.h.in, src/error.c:
	  pcsc_stringify_error(): argument is const
	* [r2658] src: ignore pcsc-wirecheck, pcsc-wirecheck-dist.c,
	  pcsc-wirecheck-gen and tags
	* [r2657] c.sh: call ./configure with nice arguments

2007-10-16  Ludovic Rousseau

	* [r2654] src/thread_generic.h, src/thread_unix.c:
	  SYS_ThreadCancel() arg is a PCSCLITE_THREAD_T instead of a
	  PCSCLITE_THREAD_T *

2007-10-11  Ludovic Rousseau

	* [r2647] TODO: the SCardReconnect performance problem has been
	  (partly) solved in revision 2385
	* [r2646] TODO: update date
	* [r2645] TODO, configure.in: bug #303790 is now solved
	* [r2644] doc/pcscd.8.in: use @ipcdir@ instead of @runpid@
	* [r2643] configure.in: remove --enable-runpid=FILE option since it
	  was not supported to NOT use a runpid file
	* [r2642] src/pcscdaemon.c, src/utils.c: use PCSCLITE_RUN_PID
	  instead of USE_RUN_PID
	* [r2641] src/pcscd.h.in: define PCSCLITE_RUN_PID as
	  PCSCLITE_IPC_DIR "/pcscd.pid"
	* [r2640] configure.in: default ipcdir is /var/run/pcscd instead of
	  /var/run so the directory can be shared locally between 32/64
	  bits systems on chroots
	* [r2639] src/eventhandler.h: iREADER_STATE: remove the unused
	  dummy field
	* [r2638] src/testpcsc.c: increase readername len from 50 to 100
	  since we now support longer reader names
	* [r2637] src/PCSC/pcsclite.h.in: increase MAX_READERNAME from 52
	  to 100
	  
	  Closes bug [#304481] increase MAX_READERNAME from 52 to 100
	* [r2636] src/readerfactory.c: RFAddReader(): also count the length
	  of " 00 00" in the reader name when rejectecting reader names too
	  long

2007-10-09  Ludovic Rousseau

	* [r2635] src/Makefile.am, src/eventhandler.c, src/eventhandler.h,
	  src/lassert.h, src/pcsc-wirecheck-gen.c,
	  src/pcsc-wirecheck-main.c, src/pcscdaemon.c, src/readerfactory.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_msg_srv.c, src/winscard_svc.c,
	  src/winscard_svc.h: add support of mix 32/64 bits platforms.
	  Closes bug [#303790] pcscd protocol depends on word size; breaks
	  32-bit clients with 64-bit server
	  
	  Thanks to Jacob Berkman for the big patch
	* [r2634] src/testpcsc.c: remove an extra space

2007-10-03  Ludovic Rousseau

	* [r2633] src/debuglog.c: display time delta between two lines of
	  logs when printed to stderr

2007-09-17  Ludovic Rousseau

	* [r2625] src/testpcsc.c: use NULL instead of 0 for a char *

2007-08-26  Ludovic Rousseau

	* [r2623] .: rename ChangeLog.cvs in ChangeLog.svn
	* [r2622] src/PCSC: ignore reader.h
	* [r2621] src: ignore pcscd.h
	* [r2620] doc: ignore doxygen.conf, api & update-reader.conf.8

2007-08-22  Ludovic Rousseau

	* [r2618] src/readerfactory.c: RFLoadReader(): change the log
	  message from a scary "Warning" to a more informative one

2007-08-20  Ludovic Rousseau

	* [r2615] src/thread_unix.c: SYS_ThreadCreate(): call
	  pthread_attr_destroy() to free memory allocated by
	  pthread_attr_init()
	  
	  Thanks to Paul Klissner for the bug report

2007-08-14  Ludovic Rousseau

	* [r2614] ChangeLog, configure.in: release 1.4.4

2007-08-13  Ludovic Rousseau

	* [r2613] src/atrhandler.c, src/eventhandler.c, src/winscard.c: use
	  SCARD_PROTOCOL_UNDEFINED instead of SCARD_PROTOCOL_UNSET
	* [r2612] src/PCSC/pcsclite.h.in: rename SCARD_PROTOCOL_UNSET to
	  SCARD_PROTOCOL_UNDEFINED to reflect the Windows winscard API
	  SCARD_PROTOCOL_UNSET is still defined for backward compatibility

2007-08-08  Ludovic Rousseau

	* [r2611] src/hotplug_libusb.c: HPEstablishUSBNotifications(): make
	  the log message more explicit when the driver does not support
	  IFD_GENERATE_HOTPLUG (it is not an error)

2007-08-02  Ludovic Rousseau

	* [r2601] doc/ifdhandler-3.tex: update IFDHPowerICC() documentation

2007-07-05  Ludovic Rousseau

	* [r2598] src/hotplug_libusb.c, src/pcscdaemon.c: do not call a Log
	  function in a signal handler and do hotplug synchronously. See
	  Debian bug #430492
	  
	  Thanks to Russell Stuart for the bug report and patch

2007-07-03  Ludovic Rousseau

	* [r2595] ChangeLog: correct version number for 1.4.3

2007-07-02  Ludovic Rousseau

	* [r2594] doc/example/pcsc_demo.c: use PCSC_ERROR() also for the
	  second SCardListReaders()
	* [r2589] doc/example/pcsc_demo.c: update version
	* [r2588] doc/example/pcsc_demo.c: use PCSC_ERROR() for
	  SCardListReaders() call
	* [r2587] doc/example/pcsc_demo.c: update copyright date
	* [r2586] doc/example/pcsc_demo.c: do not free unallocated
	  resources

2007-06-25  Ludovic Rousseau

	* [r2580] etc/pcscd.init.in: Add LSB comment block See
	  http://refspecs.freestandards.org/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/initscrcomconv.html
	  
	  Thanks to Ville Skyttä for the patch

2007-06-23  Ludovic Rousseau

	* [r2578] configure.in, doc/update-reader.conf.8.in: dynamically
	  generate update-reader.conf.8 by ./configure
	  
	  Thanks to Klaus Heinz. Closes: [#304518] update-reader.conf.8
	  should be created from update-reader.conf.8.in
	* [r2577] doc/Makefile.am: distribute update-reader.conf.8.in
	  instead of update-reader.conf.8
	* [r2576] doc/update-reader.conf.8, doc/update-reader.conf.8.in:
	  rename doc/update-reader.conf.8 in doc/update-reader.conf.8.in
	  since ./configure with generate doc/update-reader.conf.8
	* [r2575] configure.in: remove 3 unused
	  AC_PATH_PROG(TEST_MINUS_S_SH, *) lines
	  
	  Thanks to Klaus Heinz. Closes: [#304517] Check for bash/ksh/sh
	  and variable TEST_MINUS_S_SH not necessary anymore

2007-06-21  Ludovic Rousseau

	* [r2574] src/utils/formaticc.c: replace 0 by NULL
	* [r2573] configure.in: add AM_PROG_CC_C_O as requested by:
	  doc/example/Makefile.am:4: compiling `pcsc_demo.c' with
	  per-target flags requires `AM_PROG_CC_C_O' in `configure.in'

2007-06-20  Ludovic Rousseau

	* [r2572] src/PCSC/reader.h.in: Solaris, like Max OS X, does not
	  support pack(push, 1). Use pack(1) instead
	  
	  Thanks to David Markowitz

2007-06-19  Ludovic Rousseau

	* [r2570] ChangeLog, configure.in: release 1.4.3
	* [r2569] src/winscard_clnt.c: move definitions of
	  SCardLockThread() and SCardUnlockThread() at the beginning of
	  file and remove their declarations
	* [r2568] src/pcscdaemon.c: SVCServiceRunLoop(): do not exit is
	  CreateContextThread() fails. Avoids a denial of service.
	  
	  Thanks to Joshua J. Drake

2007-06-18  Ludovic Rousseau

	* [r2567] src/winscard.c: SCardStatus(): check for hCard == 0
	  
	  Thanks to Joshua J. Drake for the bug report

2007-06-17  Ludovic Rousseau

	* [r2565] src/winscard_msg.c: replace PCSCLITE_MAX_MESSAGE_SIZE by
	  sizeof(msgStruct.data)
	* [r2564] src/winscard_msg.c: patch in revision 2535 was not
	  correct for exteneded APDU. It generated a buffer overflow.
	* [r2563] doc/example/pcsc_demo.c: use EXIT_FAILURE instead of 1
	* [r2562] doc/pcsc-lite.tex: typo

2007-06-13  Ludovic Rousseau

	* [r2561] src/hotplug_libusb.c, src/pcscdaemon.c,
	  src/readerfactory.c: use NULL instead of 0 for pointers (detected
	  by sparse)
	* [r2560] src/winscard_clnt.c: do not use inline for
	  SCardLockThread() and SCardUnlockThread() declaration but only
	  for definition (detected by parse)
	* [r2559] src/thread_generic.h: add a missing #include <wintypes.h>
	  (detected by sparse)
	* [r2558] src/eventhandler.c: EHStatusHandlerThread(): use
	  SYS_ThreadExit(NULL) instead of SYS_ThreadExit(0) (detected by
	  sparse)

2007-06-05  Ludovic Rousseau

	* [r2556] src/readerfactory.c: RFLoadReader(): use INFO instead of
	  ERROR log level is the same driver library is use twice. It is
	  not an error.
	  
	  Thanks to Nils Larsch for the patch

2007-05-30  Ludovic Rousseau

	* [r2555] src/debuglog.c: declare prototypes of debug_msg() and
	  debug_xxd() to avoid debuglog.c:265: warning: no previous
	  prototype for ‘debug_msg’
	* [r2554] src/hotplug_libusb.c: HPRemoveHotPluggable(): rename
	  index to reader_index to avoid warning: declaration of ‘index’
	  shadows a global declaration /usr/include/string.h:304: warning:
	  shadowed declaration is here
	* [r2553] src/winscard_clnt.c: change prototype of SCardAddHandle()
	  to remove an explicit cast
	* [r2552] src/winscard_clnt.c: SCardEstablishContextTH(): remove a
	  local declaration of msgStruct to avoid warning: declaration of
	  'msgStruct' shadows a previous local

2007-05-29  Ludovic Rousseau

	* [r2551] src/pcscdaemon.c: set the permission on USE_RUN_PID so
	  that the file is world readable. The file is used by libpcsclite
	  to check the availability of pcscd
	* [r2550] src/utils.c, src/utils.h: move definition of
	  PID_ASCII_SIZE from utils.c to utils.h

2007-05-24  Ludovic Rousseau

	* [r2549] src/readerfactory.c: RFSetReaderEventState(): unlock the
	  card on removal. This will unlock any waiting SCardConnect() and
	  SCardReconnect()
	* [r2548] src/winscard.c: SCardConnect()/SCardDisconnect(): the
	  reader may be removed while we are waiting after a lock. fix a
	  crash of pcscd

2007-05-23  Ludovic Rousseau

	* [r2546] ChangeLog, configure.in: release 1.4.2
	* [r2545] src/winscard.c: SCardDisconnect(): do not block if
	  dwDisposition == SCARD_LEAVE_CARD.
	  
	  We block only for SCARD_UNPOWER_CARD, SCARD_RESET_CARD and
	  SCARD_EJECT_CARD since that would impact other running
	  transactions
	* [r2544] src/eventhandler.c, src/eventhandler.h,
	  src/readerfactory.c: lockState field of READER_STATE was not
	  used. Remove it and the associated dead code
	* [r2543] src/readerfactory.c, src/readerfactory.h: add a Lock
	  counter so that SCardBeginTransaction/SCardEndTransaction can be
	  nested
	* [r2542] src/winscard_clnt.c: SCardTransmit(): adjust size of data
	  to send to pcscd. Avoid a valgrind warnings.
	* [r2541] src/testpcsc.c: no need to initialise pioRecvPci. It is a
	  out only variable
	* [r2540] src/winscard_clnt.c: SCardTransmit(): we do not need to
	  correctly initialize scTransmitStruct.pioRecvPci since it is only
	  a out variable
	* [r2539] src/winscard_msg.c: #include "utils.h" since we use
	  SCardCheckDaemonAvailability()
	* [r2538] src/utils.h, src/winscard_clnt.c: move declaration of
	  SCardCheckDaemonAvailability() from winscard_clnt.c to utils.h

2007-05-22  Ludovic Rousseau

	* [r2537] src/PCSC/wintypes.h: LPTSTR and LPCTSTR types are no more
	  deprecated since they are found in many applications. And using
	  them is not a problem.
	* [r2536] src/testpcsc.c: initialise pioRecvPci before using it
	* [r2535] src/winscard_clnt.c, src/winscard_msg.c: Initialize
	  memory to avoid valgrind warnings: Syscall param write(buf)
	  points to uninitialised byte(s)
	* [r2534] src/winscard.c: use sizeof() instead of a constant

2007-05-16  Ludovic Rousseau

	* [r2530] ChangeLog: typo
	* [r2529] ChangeLog, configure.in: release 1.4.1

2007-05-15  Ludovic Rousseau

	* [r2528] src/winscard_msg.c: SHMMessageReceive(): on the client
	  side, if the daemon does not respond after 2 minutes
	  (PCSCLITE_CLIENT_ATTEMPTS) we call SCardCheckDaemonAvailability()
	  to be sure the daemon is still there and continue waiting.
	  
	  Thanks to Harsh Sangal for the bug report
	* [r2527] src/winscard_clnt.c: export
	  SCardCheckDaemonAvailability()

2007-05-10  Ludovic Rousseau

	* [r2525] doc/Makefile.am: do not build and include the pdf
	  documentation files in the archive. The html online versions
	  should be enough.

2007-05-07  Ludovic Rousseau

	* [r2513] TODO: "poll the reader only if an application is using
	  this reader"
	* [r2512] TODO: "do not use an active polling in hotplug_libusb.c"
	  solved using IFD_GENERATE_HOTPLUG

2007-04-21  Ludovic Rousseau

	* [r2507] src/pcscd.h.in: USE_IPCDIR is always defined. The default
	  value is set by ./configure
	* [r2506] configure.in: use $ipcdir/pcscd.pid as the default value
	  for so that the use of --enable-runpid=FILE is not mandatory

2007-04-12  Ludovic Rousseau

	* [r2505] src/pcscdaemon.c: update copyright dates

2007-04-04  Ludovic Rousseau

	* [r2504] configure.in, src/pcscdaemon.c: use of
	  --enable-runpid=FILE is now mandatory
	* [r2503] src/testpcsc.c: add a prototype for test_rv() to avoir a
	  compiler warning: no previous prototype for ‘test_rv’
	* [r2502] src/Makefile.am: client and server use utils.c
	* [r2501] src/winscard_clnt.c: SCardCheckDaemonAvailability(): when
	  the _first_ reader is connected _after_ pcscd has started the
	  ctime of PCSCLITE_PUBSHM_FILE changes (no idea why)
	  
	  So to be sure a new pcscd is running we also check the pcscd pid
	  available from USE_RUN_PID
	* [r2500] src/pcscdaemon.c, src/utils.c, src/utils.h: move
	  GetDaemonPid() in utils.c so we can also use it elsewhere

2007-03-29  Ludovic Rousseau

	* [r2499] src/winscard_clnt.c: SCardGetStatusChange(): do not
	  release the mutex if it does not exist anymore after a pcscd
	  restart

2007-03-28  Ludovic Rousseau

	* [r2497] src/winscard_clnt.c: SCardGetStatusChange(): do not check
	  for SCARD_STATE_ATRMATCH, SCARD_STATE_EXCLUSIVE or
	  SCARD_STATE_INUSE bits when the card is not present.
	  
	  Thanks to Matheus Ribeiro for the bug report
	* [r2496] src/eventhandler.c, src/winscard_clnt.c:
	  SCardGetStatusChange(): add a counter in the upper word of
	  dwEventState so it is possible to detect a card movement betweeen
	  two calls to SCardGetStatusChange()
	  
	  Thanks to Matheus Ribeiro for the patch

2007-03-27  Ludovic Rousseau

	* [r2495] src/hotplug_linux.c: use pcscd.h
	* [r2494] src/hotplug_macosx.c, src/powermgt_macosx.c: use pcscd.h
	  when needed.
	  
	  Thanks to Yziquel Guillaume for the bug report

2007-03-22  Ludovic Rousseau

	* [r2490] doc/pcsc-lite.tex: typo

2007-03-18  Ludovic Rousseau

	* [r2486] doc/example/pcsc_demo.c: print sent & received APDU

2007-03-15  Ludovic Rousseau

	* [r2482] src/winscard_msg.c: WrapSHMWrite(): clean the data buffer
	  for SCardTransmit() to clean the APDU buffer to remove any
	  possible PIN or secret value
	  
	  Thanks to Nils Larsch for the patch
	* [r2481] src/misc.h, src/winscard_clnt.c: move definition of min()
	  from winscard_clnt.c to misc.h

2007-03-13  Ludovic Rousseau

	* [r2479] src/winscard_clnt.c: profiling: more explicit warning in
	  case of thread
	* [r2478] src/winscard_clnt.c: profiling: the mechanism does not
	  work correctly when threads are used. Display warnings in that
	  case.
	* [r2477] src/winscard_clnt.c: profiling: detect missing
	  PROFILE_END calls
	* [r2476] src/winscard_clnt.c: profiling: display the return value
	  if different from SCARD_S_SUCCESS
	* [r2475] src/winscard_clnt.c: SCardReconnect(): block instead of
	  returning SCARD_E_SHARING_VIOLATION

2007-03-12  Ludovic Rousseau

	* [r2474] src/PCSC/ifdhandler.h: define RESPONSECODE type only if
	  RESPONSECODE_DEFINED_IN_WINTYPES_H is not defined (needed to
	  compile the driver with an old pcsc-lite)

2007-03-06  Ludovic Rousseau

	* [r2467] src/winscard_svc.c: CreateContextThread(): avoid a buffer
	  overflow if no more context available
	  
	  thanks to Petr Gajdos for the patch
	* [r2466] src/winscard.c: improve Doxygen
	* [r2465] src/testpcsc.c: when we are waiting for a card insertion
	  a reader may be connected/disconnected so SCardGetStatusChange()
	  will return but a card is not inserted
	* [r2464] src/winscard_clnt.c: SCardCheckDaemonAvailability(): if
	  the daemon is restarted we invalidate all the existing handles so
	  SCard functions returns SCARD_E_INVALID_HANDLE
	* [r2463] src/winscard_clnt.c: add prototype for SCardUnload()
	* [r2462] src/winscard_clnt.c: move code from SCardRemoveContext()
	  to a new function SCardCleanContext() and call it from
	  SCardRemoveContext()
	* [r2461] src/winscard_clnt.c: move call to
	  SCardCheckDaemonAvailability() from SCardEstablishContextTH() to
	  SCardEstablishContext() to move it oustide of
	  SCardLockThread()/SCardUnlockThread() since
	  SCardCheckDaemonAvailability() may also lock (and then deadlock)
	* [r2460] src/pcscd.h: Oops. pcscd.h.in is already in SVN
	* [r2459] src/pcscd.h: new file

2007-03-05  Ludovic Rousseau

	* [r2458] src/winscard_clnt.c: SCardIsValidContext(): return
	  SCARD_E_INVALID_HANDLE if the daemon has been restarted
	* [r2457] src/winscard_clnt.c: SCardCheckDaemonAvailability():
	  detects if pcscd has been restarted and returns
	  SCARD_E_NO_SERVICE in that case

2007-02-26  Ludovic Rousseau

	* [r2449] src/winscard_clnt.c: SCardEstablishContextTH(): call
	  fcntl(mapAddr, F_SETFD, FD_CLOEXEC); to close on exec the file
	  descriptor on /var/run/pcscd.pub so that child processes do not
	  inherits it. The child process will call SCardEstablishContext()
	  if needed.

2007-02-25  Ludovic Rousseau

	* [r2447] src/PCSC/wintypes.h: the comment about LPTSTR was wrong

2007-02-21  Ludovic Rousseau

	* [r2419] src/hotplug_libusb.c: reformat
	* [r2418] src/hotplug_libusb.c: HPReadBundleValues(): ignore driver
	  with readerName == NULL (non-ASCII readerName in Info.plist for
	  example)

2007-02-19  Ludovic Rousseau

	* [r2403] src/sys_unix.c: SYS_USleep(): use select() instead of
	  usleep() if nanosleep() can't be used. usleep() is not thread
	  safe on some old Solaris systems.
	  
	  Thanks to Nils Larsch for the patch

2007-02-17  Ludovic Rousseau

	* [r2401] doc/Makefile.am: support --docdir=... to install
	  documentation files
	  
	  Thanks to Alon Bar-Lev for the patch
	* [r2400] src/debuglog.c: add a log_line() function and use it form
	  log_msg() and log_xxd() to also have colors in log_xxd()

2007-02-13  Ludovic Rousseau

	* [r2397] ChangeLog, configure.in: release 1.4.0
	* [r2394] configure.in: only check for foo.h file when HAVE_FOO_H
	  is really used in the code

2007-02-05  Ludovic Rousseau

	* [r2388] src/utils/formaticc.c: use SCARD_SCOPE_USER instead of
	  the pcsc-lite specific SCARD_SCOPE_GLOBAL
	* [r2386] Makefile.am: ChangeLog.svn: use svn2cl instead of
	  svn2cl.sh
	* [r2385] src/winscard.c: SCardReconnect(): call SYS_USleep() to
	  "allow the status thread to convey information" only if the
	  application requests SCARD_RESET_CARD or SCARD_UNPOWER_CARD. We
	  do not wait if the application requests SCARD_LEAVE_CARD.
	* [r2384] src/winscard.c: SCardDisconnect(): call SYS_USleep() to
	  "allow the status thread to convey information" only if the
	  application requests SCARD_RESET_CARD or SCARD_UNPOWER_CARD. We
	  do not wait if the application requests SCARD_LEAVE_CARD.
	* [r2383] doc/example/pcsc_demo.c: use unsigned int i; instead of
	  int i; to avoid a compiler warning
	* [r2382] doc/example/pcsc_demo.c: add SCardBeginTransaction() &
	  SCardEndTransaction
	* [r2381] doc/example/pcsc_demo.c: use SCARD_SHARE_SHARED instead
	  of SCARD_SHARE_EXCLUSIVE
	* [r2380] src/Makefile.am: add pcscd.h and pcscd.h.in to
	  pcscd_SOURCES:
	* [r2379] src/winscard.c: SCardBeginTransaction(): document the
	  SYS_USleep() call
	* [r2378] src/pcscd.h.in, src/winscard.c: define and use
	  PCSCLITE_LOCK_POLL_RATE as SYS_USleep() argument when waiting
	  after a lock
	* [r2377] src/configfile.l, src/eventhandler.c,
	  src/hotplug_libusb.c, src/ifdwrapper.c, src/pcscdaemon.c,
	  src/prothandler.c, src/readerfactory.c, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_msg_srv.c,
	  src/winscard_svc.c: use pcscd.h instead of pcsclite.h
	* [r2376] configure.in: generate src/pcscd.h from src/pcscd.h.in
	* [r2375] src/PCSC/pcsclite.h.in, src/pcscd.h.in: move pcscd
	  internal constants from pcsclite.h to pcscd.h so they are no more
	  available in /usr/include/pcsclite.h
	* [r2374] src/winscard.c, src/winscard_clnt.c:
	  SCardBeginTransaction() client and server side: call SYS_USleep()
	  on the server side insead of client side and only if needed.
	  SCardBeginTransaction() will be much faster
	* [r2373] src/winscard_clnt.c: profile_end(): call fflush() to sync
	  the profile file
	* [r2372] src/winscard.c: SCardBeginTransaction(),
	  SCardEndTransaction() and SCardCancelTransaction(): display PC/SC
	  return value in hex instead of decimal
	* [r2371] src/winscard_clnt.c: profile_start(): use a different
	  profile file name for each user so two users can use profiling at
	  the same time

2007-01-31  Ludovic Rousseau

	* [r2370] src/hotplug_libusb.c: HPEstablishUSBNotifications(): do
	  not overwrite the value specified with --force-reader-polling=val
	* [r2369] src/hotplug_libusb.c: HPEstablishUSBNotifications(): USB
	  polling was not active even if a driver does not support
	  IFD_GENERATE_HOTPLUG
	* [r2368] src/winscard.c: add profiling framework on the server
	  side
	* [r2367] src/readerfactory.c: RFInitializeReader(): add debug logs

2007-01-23  Ludovic Rousseau

	* [r2354] doc/Makefile.am: do not install formaticc.1 manpage since
	  the binary is no more installed
	* [r2353] src/sys_unix.c: SYS_USleep(): also work for a duration
	  greater than 1 sec
	* [r2352] src/pcscdaemon.c, src/winscard_msg_srv.c: FreeBSD needs
	  to timeout in select() to get the Ctrl-C signal Revert revision
	  2148 and 2149 for *BSD
	  
	  Thanks to Tilman Linneweh for the bug report

2007-01-20  Ludovic Rousseau

	* [r2350] src/eventhandler.c: EHStatusHandlerThread(): also display
	  the hexa value of the return code if power up fails
	* [r2349] src/winscard.c: SCardConnect(): return
	  SCARD_W_UNPOWERED_CARD if the card is mute instead of returning
	  SCARD_E_PROTO_MISMATCH because the requested protocol is not
	  supported by the (mute) card
	* [r2348] src/PCSC/ifdhandler.h, src/PCSC/wintypes.h: move
	  RESPONSECODE definition from wintypes.h to ifdhandler.h since it
	  should only be used as return type of IFDHandler functions
	* [r2347] src/ifdwrapper.c: use IFD_SUCCESS instead of 0 as initial
	  value

2007-01-19  Ludovic Rousseau

	* [r2343] ChangeLog: release 1.3.3
	* [r2341] doc/Makefile.am: use the default Doxygen CSS file instead
	  of a (bad) local one

2007-01-18  Ludovic Rousseau

	* [r2340] doc/pcscd.8.in: do not reference formaticc since this
	  tool is deprecated and no more installed
	* [r2339] doc/pcscd.8.in: document --hotplug option

2007-01-11  Ludovic Rousseau

	* [r2335] src/pcscdaemon.c: document --force-reader-polling in the
	  online help
	* [r2334] src/hotplug_libusb.c, src/pcscdaemon.c: add
	  --force-reader-polling command line option to force the bus
	  polling even if the drivers says they support
	  IFD_GENERATE_HOTPLUG
	  
	  Thanks to Alon Bar-Lev for the suggestion
	* [r2333] src/pcscdaemon.c: define OPT_STRING to avoid duplicating
	  the getopt option string
	* [r2332] src/pcscdaemon.c: newReaderConfig is a char * so use NULL
	  instead of 0
	* [r2331] src/configfile.h, src/configfile.l: DBGetReaderList()
	  prototype: use const char *readerconf instead of char *
	* [r2330] src/readerfactory.c, src/readerfactory.h:
	  RFStartSerialReaders(): use const char * instead of char *

2007-01-10  Ludovic Rousseau

	* [r2327] src/pcscdaemon.c: log "pcscd was not configured with
	  --enable-runpid=FILE" if pcscd --hotplug is called but can't be
	  used because no pidfile is available.
	  
	  Thanks to Alon Bar-Lev for the idea.
	* [r2325] doc/example/pcsc_demo.c: improve code to be able to also
	  use T=1 cards
	* [r2324] doc/ifdhandler-3.tex: add IFD_GENERATE_HOTPLUG
	  documentation
	* [r2323] doc/pcsc-lite.tex: add SCardIsValidContext()
	  documentation

2007-01-09  Ludovic Rousseau

	* [r2321] src/winscard_msg.c: Doxygen: correct parameter names
	* [r2320] src/testpcsc.c: test for SCardIsValidContext()
	* [r2319] src/PCSC/winscard.h, src/winscard_clnt.c: implement
	  SCardIsValidContext()

2007-01-06  Ludovic Rousseau

	* [r2310] src/hotplug.h, src/hotplug_libusb.c: add support for
	  IFD_GENERATE_HOTPLUG bit in driver Info.plist ifdCapabilities
	* [r2309] src/tokenparser.l: correct a warning: assignment discards
	  qualifiers from pointer target type
	* [r2308] src/winscard_msg.c, src/winscard_msg.h: change prototype
	  of SHMCleanupSharedSegment() from (..., char *pcFilePath) to
	  (..., const char *pcFilePath) to avoid: warning: passing argument
	  2 of 'SHMCleanupSharedSegment' discards qualifiers from pointer
	  target type
	* [r2307] src/readerfactory.c: use f1 instead of f to avoid:
	  warning: declaration of ‘f’ shadows a previous local
	* [r2306] src/pcscdaemon.c: define GetDaemonPid() prototype
	* [r2305] src/hotplug_libusb.c: define prototypes for
	  HPRescanUsbBus() and HPEstablishUSBNotifications()
	* [r2304] src/tokenparser.l: tpevalToken(): use unsigned int to
	  avoid: tokenparser.l:74: warning: comparison between signed and
	  unsigned tokenparser.l:90: warning: comparison between signed and
	  unsigned
	* [r2303] src/parser.h, src/tokenparser.l: change prototype of
	  LTPBundleFindValueWithKey() from "char *fileName, char *tokenKey,
	  ..." to "const char *fileName, const char *tokenKey, ..."
	* [r2302] src/debuglog.c: DebugLogSetLogType(): use unsigned int to
	  avoid: debuglog.c:182: warning: comparison between signed and
	  unsigned
	* [r2301] src/configfile.l: evaluatetoken(): use unsigned int to
	  avoid the warning: configfile.l:80: warning: comparison between
	  signed and unsigned
	* [r2300] src/debug.c, src/hotplug_libusb.c: use unsigned int to
	  solve the warning: debug.c:60: warning: comparison between signed
	  and unsigned

2006-12-25  Ludovic Rousseau

	* [r2286] doc/ifdhandler-3.tex: IOCTL_SMARTCARD_VENDOR_VERIFY_PIN
	  is deprecated. Use CM_IOCTL_GET_FEATURE_REQUEST instead
	* [r2284] src/ifdwrapper.c: IFDStatusICC(): correctly set card
	  status to SCARD_UNKNOWN. patch in revision 2283 was bogus
	* [r2283] src/ifdwrapper.c: IFDStatusICC(): if IFDHICCPresence()
	  set card status to SCARD_UNKNOWN instead of an uninitialised
	  value
	* [r2282] src/readerfactory.c: RFAddReader(): fails if
	  RFSetReaderName() fails (too many readers for the same driver for
	  example)
	* [r2281] src/readerfactory.c: RFSetReaderName(): fails if the
	  number of readers exceeds the number of supported readers by the
	  driver.
	  
	  If the driver does not implement TAG_IFD_SIMULTANEOUS_ACCESS it
	  is assumed to only support 1 reader.
	* [r2279] src/pcscdaemon.c: signal_reload(): disable hotplug when
	  shutdown is on going

2006-12-12  Ludovic Rousseau

	* [r2274] src/winscard.c: SCardGetAttrib()/SCardSetAttrib(): if the
	  driver returns IFD_ERROR_TAG we return
	  SCARD_E_UNSUPPORTED_FEATURE instead of the generic error code
	  SCARD_E_NOT_TRANSACTED

2006-12-11  Ludovic Rousseau

	* [r2272] configure.in: add PKG_PROG_PKG_CONFIG

2006-12-05  Ludovic Rousseau

	* [r2267] src/winscard_clnt.c: SCardStatus(): move an
	  initialization outside of a for() loop (improve speed)
	* [r2266] src/winscard_clnt.c: SCardGetIndicesFromHandle(): check
	  that hCard is non null (used as marker for unused entry)

2006-12-03  Ludovic Rousseau

	* [r2265] src/dyn_generic.h, src/dyn_hpux.c, src/dyn_macosx.c,
	  src/dyn_unix.c, src/dyn_win32.c: pcFunction argument of
	  DYN_GetAddress is "const char *" instead of "char *"
	* [r2264] src/sys_generic.h, src/sys_unix.c: use "const char *"
	  instead of "char *" when needed
	* [r2263] src/debug.c: warning: no previous prototype for
	  'log_init'

2006-12-02  Ludovic Rousseau

	* [r2262] src/strlcat.c: #include "strlcpycat.h"
	* [r2261] src/powermgt_generic.c: #include "powermgt_generic.h"
	* [r2259] src/strlcpy.c: #include "strlcpycat.h"

2006-11-30  Ludovic Rousseau

	* [r2250] src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_svc.c: add support of "extended"
	  SCardControl()
	* [r2249] src/winscard_clnt.c: SCardEstablishContextTH(): return
	  the error code if the connection to the server fails (wrong
	  protocol version for example)
	* [r2248] src/winscard_svc.c: ContextThread(): check that the
	  client protocol version is not newer than the protocol version of
	  the server or returns SCARD_E_NO_SERVICE otherwise.
	* [r2247] src/winscard_msg.c: use "char *" variables instead of
	  "void *" when arithmetic is done (typically ptr+offset).
	  
	  Avoids: warning: pointer of type 'void *' used in arithmetic
	* [r2246] src/sys_unix.c: warning: C++ style comments are not
	  allowed in ISO C90
	* [r2245] src/winscard_clnt.c: warning: C++ style comments are not
	  allowed in ISO C90
	* [r2244] src/winscard.c: SCardControl(): do not limit cbSendLength
	  to MAX_BUFFER_SIZE bytes since we now transparently support up to
	  MAX_BUFFER_SIZE_EXTENDED bytes.
	  
	  Thanks to Martin Führlinger for the bug report

2006-11-29  Ludovic Rousseau

	* [r2243] src/pcscdaemon.c: do not define GetDaemonPid if
	  USE_RUN_PID is NOT defined
	* [r2242] src/pcscdaemon.c: SendHotplugSignal() does nothing if
	  USE_RUN_PID is NOT defined
	* [r2241] src/hotplug_libusb.c: HPRescanUsbBus(): replace .driver
	  by .fullName also for *BSD systems

2006-11-23  Ludovic Rousseau

	* [r2236] TODO: Allow connection from a 32-bits and 64-bits client
	  to the same pcscd server. This is part of the Apple patches and
	  improvements. see Alioth bug #303790

2006-11-21  Ludovic Rousseau

	* [r2233] src/atrhandler.c: Doxygen ATRDecodeAtr()
	* [r2232] src/hotplug_libusb.c: remove the driver field from struct
	  readerTracker use the fullName field to check if the reader entry
	  is valid or not
	* [r2231] src/pcscdaemon.c: signal_reload(): log the End reload
	  serial configuration
	* [r2230] src/hotplug_libusb.c: HPRescanUsbBus(): setenv
	  USB_DEVFS_PATH to /proc/bus/usb
	  
	  libusb default is /dev/bus/usb but the devices are not yet
	  visible there when a hotplug is requeste
	* [r2229] src/winscard.c, src/winscard_clnt.c: add Doxygen
	  cross-references to #define values
	* [r2228] src/PCSC/pcsclite.h.in: reorder SCARD_E_* codes in
	  increasing order
	* [r2227] src/PCSC/pcsclite.h.in: add Doxygen documentation for
	  SCARD_E_* error codes (text reused from MSDN)
	* [r2226] src/PCSC/pcsclite.h.in: add SCARD_E_NO_READERS_AVAILABLE

2006-11-15  Ludovic Rousseau

	* [r2209] configure.in: version 1.3.3
	* [r2204] src/ifdwrapper.c: if a driver command returns
	  IFD_NO_SUCH_DEVICE we call SendHotplugSignal() to rescan the
	  USB/serial/etc. readers and purge the removed readers from the
	  reader list
	* [r2203] src/hotplug.h: add SendHotplugSignal() prototype
	* [r2202] src/pcscdaemon.c: reorganise code to create
	  GetDaemonPid() and SendHotplugSignal() functions
	* [r2201] src/PCSC/ifdhandler.h: add IFD_NO_SUCH_DEVICE return
	  value
	* [r2200] src/testpcsc.c: use fgets() instead of scanf() to also
	  consume the carriage return
	* [r2199] src/testpcsc.c: use tabulations for alignment instead of
	  spaces
	* [r2198] src/testpcsc.c: test for SCARD_ATTR_MAXINPUT (only
	  supported by my CCID driver for now)

2006-11-10  Ludovic Rousseau

	* [r2196] configure.in, src/Makefile.am: do not include src/utils/
	  since the tools installifd and formaticc are now completly
	  outdated and should not be used anymore.

2006-10-31  Ludovic Rousseau

	* [r2194] src/PCSC/winscard.h: remove SCardUnload() since it is not
	  in the PC/SC API

2006-10-29  Ludovic Rousseau

	* [r2193] src/hotplug_libusb.c, src/pcscdaemon.c: check for rescan
	  ongoing in pcscdaemon.c:signal_reload() instead of
	  hotplug_libusb.c:HPReCheckSerialReaders() since the code is not
	  specific to libusb

2006-10-23  Ludovic Rousseau

	* [r2192] src/hotplug_libusb.c: move code of
	  HPEstablishUSBNotifications() into a new function
	  HPRescanUsbBus()
	  
	  HPRescanUsbBus() is called: - periodically from
	  HPEstablishUSBNotifications() if USB_POLLING is defined - by
	  HPReCheckSerialReaders() when a SIGUSR1 signal is received so we
	  can use udev hotplug events to rescan the USB bus instead of
	  polling
	* [r2191] src/pcscdaemon.c: removed unused external reference to
	  ReCheckSerialReaders
	* [r2190] src/pcscdaemon.c, src/winscard_msg_srv.c:
	  SHMProcessEventsServer(): returns -2 in case of syscall
	  interrupted (EINTR) and -1 for other errors.
	  
	  SVCServiceRunLoop(): do not log an error message in case of -2
	  since it happens when SIGUSR1 (reload) or SIGINT (Ctrl-C) is
	  received. We just try again
	* [r2189] src/pcscdaemon.c: main(): fail if hotplug is requested
	  but no pcscd is running

2006-10-19  Ludovic Rousseau

	* [r2188] src/misc.h: do not use visibility("default") for gcc
	  versions <= 3.3
	  
	  Thanks to Hemanth Kumar for the bug report and Karsten Ohme for
	  the patch
	* [r2187] src/pcscdaemon.c: main(): do not use USE_RUN_PID in a Log
	  message if it is not defined

2006-10-11  Ludovic Rousseau

	* [r2185] src/winscard.c: SCardConnect(): add some debug output in
	  the "waiting for release of lock"
	* [r2184] src/winscard.c: SCardDisconnect(): wait for the lock to
	  be released only if it held by someone else (and not just by
	  ourself).
	* [r2183] src/winscard_svc.c: MSGRemoveContext(): do not reset the
	  card if it is locked by by someone else but simulate a card
	  removal instead
	* [r2182] src/readerfactory.c: RFUnlockSharing(): small rewrite

2006-10-05  Ludovic Rousseau

	* [r2181] doc/Makefile.am, doc/update-reader.conf.8: add
	  update-reader.conf.8 manpage.
	  
	  Thanks to Florian Schmaus for the bug report

2006-09-27  Ludovic Rousseau

	* [r2180] src/winscard_svc.c: MSGRemoveContext(): Unlock the
	  sharing so we do not get blocked in SCardDisconnect() waiting
	  forever
	* [r2179] src/winscard.c: SCardConnect()/SCardDisconnect(): use a
	  loop of 0.1 second instead of 0.1 millisecond to wait until the
	  sharing is over

2006-09-26  Ludovic Rousseau

	* [r2178] src/winscard.c: SCardConnect() & SCardDisconnect(): wait
	  until any transaction finishes before going on. This avoids the
	  possibility to reset a card in the middle of a transaction
	  
	  Thanks to Martin Paljak for the bug report
	* [r2177] src/testpcsc.c: factor the return value test code and add
	  some color

2006-09-20  Ludovic Rousseau

	* [r2169] src/testpcsc.c: test SCARD_ATTR_VENDOR_NAME tag for
	  SCardGetAttrib
	* [r2167] src/testpcsc.c: add a test for SCardGetAttrib(...
	  SCARD_ATTR_VENDOR_IFD_VERSION...)
	* [r2164] src/error.c: pcsc_stringify_error(): correct a off-by-one
	  buffer overflow. Closes #303836 "pcsc-lite-1.3.2: array subscript
	  out of range"
	  
	  Thanks to David Binderman for the bug report and patch.

2006-09-13  Ludovic Rousseau

	* [r2160] src/winscard_clnt.c: change dwContextIndex type from
	  DWORD to LONG since we compare it to -1
	  
	  Thanks to -Wextra for the potential bug report
	* [r2159] src/testpcsc.c: correct some variable types to avoid
	  compiler warning: comparison between signed and unsigned
	* [r2158] src/winscard_clnt.c: reformat
	* [r2157] src/pcscdaemon.c: add -H --hotplug argument to ask the
	  daemon to rescan the avaiable readers

2006-09-06  Ludovic Rousseau

	* [r2151] COPYING, ChangeLog, HELP, NEWS, README, SECURITY,
	  bootstrap, doc/README.DAEMON, doc/doxygen.conf.in,
	  doc/doxygen.css, doc/formaticc.1, doc/ifdhandler-3.tex,
	  doc/pcscd.8.in, doc/reader.conf.5.in, src/PCSC/debuglog.h,
	  src/PCSC/ifdhandler.h, src/README_INTERNALS.txt,
	  src/atrhandler.c, src/atrhandler.h, src/configfile.l,
	  src/debug.c, src/debuglog.c, src/dyn_macosx.c, src/dyn_win32.c,
	  src/error.c, src/eventhandler.c, src/eventhandler.h,
	  src/hotplug_libusb.c, src/hotplug_macosx.c, src/ifdwrapper.c,
	  src/ifdwrapper.h, src/libpcsclite.pc.in, src/misc.h,
	  src/pcscdaemon.c, src/powermgt_generic.h, src/powermgt_macosx.c,
	  src/prothandler.c, src/readerfactory.c, src/readerfactory.h,
	  src/strlcat.c, src/strlcpy.c, src/sys_unix.c, src/testpcsc.c,
	  src/thread_unix.c, src/utils/formaticc.c, src/utils/installifd.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg.h, src/winscard_msg_srv.c, src/winscard_scf.c,
	  src/winscard_svc.c, win32/pthread.h, win32/sched.h: remove
	  trailing spaces at end of lines

2006-09-05  Ludovic Rousseau

	* [r2149] src/pcscdaemon.c: SVCServiceRunLoop():
	  SHMProcessEventsServer() will not timeout anymore so remove the
	  managenemt code (which did nothing)
	* [r2148] src/winscard_msg_srv.c: SHMProcessEventsServer(): do not
	  use a 1 second timeout in select() to catch Ctrl-C since SIGINT
	  will cause select() to return with EINTR
	  
	  See https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=205182
	  for the bug report
	* [r2147] TODO: add "do not use an active polling in
	  hotplug_libusb.c"

2006-08-31  Ludovic Rousseau

	* [r2146] src/winscard_msg.h: struct transmit_struct_extended: use
	  BYTE data[1]; instead of BYTE data[0]; since Sun Studio 11 does
	  not like 0-sized arrays.
	  
	  Thanks to Iain MacDonnell for the bug report
	* [r2145] src/readerfactory.h: struct ReaderContext: use int32_t
	  instead of DWORD for dwContexts since we also use negative values
	  (SCARD_EXCLUSIVE_CONTEXT defined as -1)
	  
	  Thanks to -Wextra for the bug report
	* [r2144] src/winscard.c: SCardStatus(): do not check for negative
	  value of rContext->readerState->cardAtrLength since it is a DWORD
	  (unsigned)
	  
	  Thanks to -Wextra for the bug report
	* [r2143] src/winscard_msg.c: SHMClientSetupSession(): store the
	  returned value of socket() in an int instead of a DWORD
	  (unsigned) so we can check for negative values
	  
	  Thanks to -Wextra for the bug report
	* [r2142] src/winscard_clnt.c: SCardGetStatusChange(): do not test
	  for (cReaders < 0) since cReaders is a DWORD and a DWORD is
	  unsigned.
	  
	  Thanks to -Wextra for the bug report

2006-08-15  Ludovic Rousseau

	* [r2141] TODO: add manage power suspend/resume

2006-08-13  Ludovic Rousseau

	* [r2139] src/sys_generic.h, src/sys_unix.c: remove unused
	  functions. SYS_Mknod() could not be compiled using tcc

2006-08-11  Ludovic Rousseau

	* [r2138] ChangeLog, configure.in: release 1.3.2
	* [r2137] doc/Makefile.am: do not fail to remove api when the
	  directory is not there

2006-08-09  Ludovic Rousseau

	* [r2129] src/hotplug_libusb.c: Revert patch in revision 2127. The
	  problematic to try a second driver start if the first one fails
	  has to be in the driver itself, not in pcscd.

2006-08-08  Ludovic Rousseau

	* [r2128] src/winscard_svc.c: CreateContextThread(): log an error
	  message in case of failuer since the pcscd daemon will die
	  shortly after that
	* [r2127] src/hotplug_libusb.c: HPAddHotPluggable(): if a reader
	  fails to start we try to start it a second time

2006-08-07  Ludovic Rousseau

	* [r2126] doc/pcsc-lite.tex: in SCardStatus subsection, the
	  argument is pdwProtocol and not dwPreferredProtocols
	* [r2125] src/PCSC/reader.h.in: Transform C comments into Doxygen
	  comments
	* [r2124] src/PCSC/pcsclite.h.in: Transform C comments into Doxygen
	  comments

2006-07-31  Ludovic Rousseau

	* [r2115] src/strlcat.c, src/strlcpy.c: #include "config.h" and
	  define strlcpy/strlcat only if they are not already provided by
	  the OS (test HAVE_STRLCPY)
	* [r2114] src/configfile.l, src/readerfactory.c, src/testpcsc.c,
	  src/winscard_clnt.c: do not cast malloc() return value
	* [r2113] src/PCSC/reader.h.in: document that the 4 bytes field
	  value in PCSC_TLV_STRUCTURE is always in big endian as documented
	  in PCSC v2 part 10 ch 2.2 page 2. You can use ntohl() to convert
	  the value.
	  
	  Thanks to Ulrich Vogl for the bug report

2006-07-10  Ludovic Rousseau

	* [r2102] src/winscard_clnt.c: SCardCheckDaemonAvailability(): test
	  the presence of PCSCLITE_PUBSHM_FILE (/var/run/pcscd.pub) instead
	  of PCSCLITE_IPC_DIR (/var/run) to detect the presence of pcscd
	  
	  Thanks to Geoff Elgey for the bug report

2006-06-15  Ludovic Rousseau

	* [r2080] src/testpcsc.c: revert the last change. It was a
	  manipulation error.
	* [r2079] src/error.c, src/testpcsc.c: This file is dual licenced:
	  - BSD-like, see the COPYING file - GNU Lesser General Licence 2.1
	  or (at your option) any later version.

2006-06-07  Ludovic Rousseau

	* [r2077] src/winscard_clnt.c: SCardUnload(): use
	  SYS_PublicMemoryUnmap() to free the memory mapped segment.
	  
	  Thanks to Stefan Schuermans for the bug report and patch
	* [r2076] src/sys_generic.h, src/sys_unix.c: implement
	  SYS_PublicMemoryUnmap()
	  
	  Thanks to Stefan Schuermans for the patch
	* [r2075] src/sys_unix.c: SYS_PublicMemoryMap(): check the value
	  returned by mmap() to detect a memory exhaustion

2006-06-06  Ludovic Rousseau

	* [r2074] src/winscard_msg.c: document the parameters changes for
	  SHMMessageSend() and SHMMessageReceive() for Doxygen
	* [r2073] doc/pcsc-lite.tex, src/readerfactory.c,
	  src/winscard_clnt.c: do not cast malloc() return value.
	* [r2072] doc/example/pcsc_demo.c, doc/pcsc-lite.tex,
	  src/PCSC/ifdhandler.h, src/PCSC/winscard.h, src/eventhandler.c,
	  src/ifdwrapper.c, src/readerfactory.c, src/readerfactory.h,
	  src/utils/formaticc.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_scf.c: replace LPTSTR and LPCTSTR by LPSTR and
	  LPCSTR
	* [r2071] src/PCSC/wintypes.h: use LPCSTR and LPSTR instead of
	  LPCTSTR and LPTSTR.
	  
	  LPCTSTR is either LPCSTR or LPCWSTR depending on the value of
	  UNICODE under Windows. So this type name should not be used
	  directly.
	  
	  See
	  http://archives.neohapsis.com/archives/dev/muscle/2006-q2/0149.html

2006-05-26  Ludovic Rousseau

	* [r2068] src/PCSC/pcsclite.h.in: define MAX_BUFFER_SIZE_EXTENDED
	  to contain up to 64KB of data instead of just 32KB
	* [r2067] src/winscard_svc.c: MSGFunctionDemarshall(): remove two
	  debug messages

2006-05-25  Ludovic Rousseau

	* [r2066] TODO: remove "allow the use of extended APDU without
	  breaking libpcsclite ABI" since it is implemented now
	* [r2065] README: do not document --enable-extendedapdu any more
	* [r2064] configure.in: remove --enable-extendedapdu since it is
	  useless now
	* [r2063] src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_svc.c: add support of extended APDU as a new command
	  so we do not need to compile pcsc-lite with or without extended
	  APDU
	* [r2062] src/winscard.c: SCardTransmit(): do not check if
	  cbSendLength or dwRxLength are > MAX_BUFFER_SIZE since this is
	  done by the client already
	* [r2061] src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_msg_srv.c, src/winscard_svc.c: use new
	  SHMMessageReceive/SHMMessageSend API
	* [r2060] src/winscard_msg.c, src/winscard_msg.h: SHMMessageSend()
	  and SHMMessageReceive() use "void *buffer, size_t buffer_size"
	  instead of psharedSegmentMsg msgStruct with a fixed size
	* [r2059] src/winscard_msg.h: add SCARD_TRANSMIT_EXTENDED in
	  pcsc_msg_commands and transmit_struct_extended structure
	* [r2058] src/winscard_msg.h: PROTOCOL_VERSION_MINOR changed from 0
	  to 1
	* [r2057] src/PCSC/pcsclite.h.in: #define MAX_BUFFER_SIZE_EXTENDED
	  and remove the @extended_apdu@ management
	* [r2056] src/winscard_svc.c: MSGFunctionDemarshall(): log an error
	  if pcscd receives an unknown command
	* [r2054] src/debug.c: log_init(): remove a "pouet" printf() debug
	  message

2006-05-24  Ludovic Rousseau

	* [r2053] src/Makefile.am: move the .h file in the *_SOURCES
	  targets so that "make ctags" include them

2006-05-23  Ludovic Rousseau

	* [r2052] src/README_INTERNALS.txt: correct typos
	* [r2051] src/README_INTERNALS.txt: update the list of source
	  filesfor pcscd and libpcsclite.la

2006-05-20  Ludovic Rousseau

	* [r2050] src/debuglog.c: log_xxd(): replace strlen(c) by 3 since
	  the string length is constant (gain a few CPU cycles)
	* [r2049] src/debuglog.c: log_xxd(): if the buffer is too small
	  then end it with "..."

2006-05-12  Ludovic Rousseau

	* [r2042] src/debug.c, src/debuglog.c: improve the @brief comment
	  to differentiate between debug for pcsclite and debug for pcscd

2006-05-09  Ludovic Rousseau

	* [r2040] src/readerfactory.c: RFInitializeReader(): display the
	  name of the driver used in addition to the name of the reader

2006-05-02  Ludovic Rousseau

	* [r2030] src/strlcat.c, src/strlcpy.3, src/strlcpy.c: update to
	  the latest version available from OpenBSD (2005/08/06)
	* [r2029] src/eventhandler.c: EHInitializeEventStructures(): check
	  against MAP_FAILED instead of 0 for the returned value of
	  SYS_MemoryMap().
	  
	  Thanks to Davide Rizzo for the bug report and patch
	* [r2028] src/sys_generic.h: #include <sys/mman.h> so that
	  MAP_FAILED is defined (value returned by SYS_MemoryMap() in case
	  of error)
	* [r2027] src/sys_unix.c: SYS_MemoryMap(): document in Doxygen that
	  the function returns MAP_FAILED in case of error

2006-04-22  Ludovic Rousseau

	* [r2025] ChangeLog, configure.in: release 1.3.1
	* [r2024] src/readerfactory.c: RFLoadReader(): change the way
	  DYN_GetAddress() is used to have a simpler code and avoid a
	  warning: dereferencing type-punned pointer will break
	  strict-aliasing rules

2006-04-20  Ludovic Rousseau

	* [r2018] src/PCSC/ifdhandler.h: do not use EXTERNAL to export the
	  symbols (revert the previous patch)

2006-04-19  Ludovic Rousseau

	* [r2015] README: Add a comment regarding the use of
	  LDFLAGS="-lpthread"

2006-04-18  Ludovic Rousseau

	* [r2010] doc/ifdhandler-3.tex, src/parser.h: do not export
	  LTPBundleFindValueWithKey() to the drivers anymore
	* [r2009] src/PCSC/ifdhandler.h: tag the functions of the API as
	  EXTERNAL. This can be used to export only those symbols from the
	  driver library.
	* [r2008] src/misc.h: EXTERNAL is a synonym for PCSC_API but more
	  anonymous

2006-04-11  Ludovic Rousseau

	* [r1998] src/winscard_svc.c: CreateContextThread(): do not use a
	  pointer to the argument but the argument itself to avoid using
	  the same value for two consecutive threads
	  
	  Thanks to Fabien Merlet for the bug report. See
	  http://archives.neohapsis.com/archives/dev/muscle/2006-q2/0038.html

2006-03-31  Ludovic Rousseau

	* [r1991] doc/ifdhandler-3.tex: use \texttt{} instead of \file{}
	  (it works with latex2html but not with pdflatex)
	* [r1990] src/misc.h: use __misc_h__ instead of __local_h__ since
	  the file name is misc.h
	* [r1989] doc/ifdhandler-3.tex: log_msg: document that you should
	  use the macros defined in <debuglog.h>

2006-03-30  Ludovic Rousseau

	* [r1988] doc/pcsc-lite.tex: log_msg and log_xxd are only available
	  for pcscd drivers. These functions are no more provided by
	  libpcsclite

2006-03-27  Ludovic Rousseau

	* [r1980] configure.in: use use_libusb="${use_libusb-yes}" so that
	  use_libusb is defined to yes only if it was not previously
	  defined
	  
	  libusb is not used by default on Mac OS X and use_libusb=no is
	  already used in that case a few lines above in the script
	* [r1979] src/hotplug_macosx.c: compile only on Apple and if libusb
	  is not used
	* [r1978] src/Makefile.am: add $(LIBUSB_CFLAGS) to pcscd_CFLAGS
	* [r1975] doc/pcsc-lite.tex: SCardConnect(): the paramater name is
	  dwShareMode instead of dwScope

2006-03-23  Ludovic Rousseau

	* [r1970] src/hotplug_libusb.c: HPAddHotPluggable(): add the USB
	  serial number only if ADD_SERIAL_NUMBER is defined (default).
	  just #undef the macro if you do not like the serial number
	  addition.

2006-03-21  Ludovic Rousseau

	* [r1964] src/Makefile.am: add -DLIBPCSCLITE to
	  libpcsclite_la_CFLAGS (used in debug.c)
	* [r1963] src/Makefile.am: add debug.c to libpcsclite_la_SOURCES
	* [r1962] src/debug.c: provice log_msg() and log_xxd()
	  implementation for the client side
	* [r1961] src/debug.h: use log_msg() instead of fprintf() for
	  Logx() macro used in libpcsclite so we can manage priority and
	  color
	* [r1960] src/tokenparser.l: use debug.h instead of debuglog.h
	* [r1959] src/Makefile.am: do not use libpcsclite-core anymore
	  since the same source code generates two different object files
	  (depending on the presence of -DPCSCD)
	* [r1958] src/winscard_clnt.c: do not use MUSCLECARD_DEBUG
	  environment variable anymore to activate the logs
	* [r1957] src/dyn_hpux.c, src/dyn_macosx.c, src/dyn_unix.c,
	  src/dyn_win32.c, src/sys_unix.c, src/winscard_msg.c,
	  src/winscard_scf.c: #include "debug.h" instead of "debuglog.h" to
	  use fprintf() or syslog() depending if the file is used for pcscd
	  (if PCSCD is defined) or for libpcsclite
	* [r1956] src/debug.h: define Logx() functions for use in
	  libpcsclite (just a fprintf(stderr, ...))
	* [r1955] src/PCSC/debuglog.h: do not declare
	  pcsc_stringify_error() here since it is already declared in
	  PCSC/pcsclite.h
	* [r1954] src/readerfactory.c: do not use pcsc_stringify_error()
	  since I don't want this code in the daemon just for _one_
	  function
	* [r1953] src/debuglog.c, src/error.c: move pcsc_stringify_error()
	  in its own file
	* [r1952] src/PCSC/debuglog.h: remove duplicate Log3() definition

2006-03-20  Ludovic Rousseau

	* [r1948] doc/pcsc-lite.tex: document log_msg and log_xxd
	* [r1947] doc/pcsc-lite.bib, doc/pcsc-lite.tex: document VERIFY_PIN
	  and MODIFY_PIN commands using PCSCv2 part 10 instead of the
	  "proprietary" mechanism now unsupported
	* [r1946] doc/pcsc-lite.tex: upgrade sample code for
	  IOCTL_SMARTCARD_VENDOR_IFD_EXCHANGE

2006-03-17  Ludovic Rousseau

	* [r1937] doc/ifdhandler-3.tex: add IFD_NOT_SUPPORTED in the
	  possible return values for IFDHSetProtocolParameters()
	* [r1936] doc/ifdhandler-3.tex: document the possible values for
	  Protocol argument in IFDHSetProtocolParameters()
	  
	  Closes bug [ #303238 ] IFDHSetProtocolParameters is called with
	  Protocol=1 even though debug log says T=0

2006-03-16  Ludovic Rousseau

	* [r1935] src/misc.h: do not use #define INTERNAL __hidden on
	  Solaris since the linker can't use symbol declared __hidden in
	  the file it is declared.
	  
	  See
	  http://archives.neohapsis.com/archives/dev/muscle/2006-q1/0144.html
	  Thanks to Iain MacDonnell for the bug report

2006-03-15  Ludovic Rousseau

	* [r1933] configure.in: document --disable-libusb instead of
	  --enable-libusb since libusb is used by default.
	  
	  Thanks to Shawn Willden for the bug report

2006-03-08  Ludovic Rousseau

	* [r1931] configure.in: Add support of Solaris

2006-03-07  Ludovic Rousseau

	* [r1929] README: remove documentation on
	  --enable-muscledropdir=DIR since this option moved to
	  libmusclecard now
	  
	  Thanks to Ville Skyttä for the patch
	* [r1928] configure.in: remove a useless AC_SUBST(muscledropdir)

2006-03-03  Ludovic Rousseau

	* [r1906] ChangeLog, configure.in: release 1.3.0

2006-02-28  Ludovic Rousseau

	* [r1902] README: the correct path is /usr/local/lib instead of
	  /usr/local/pcsc/lib
	* [r1894] Makefile.am: ChangeLog.svn rule: search and replace
	  David Corcoran before corcoran
	* [r1893] Makefile.am: remove libmusclecard directory
	* [r1892] configure.in: remove libmusclecard code
	* [r1885] libmusclecard: move PCSC/libmusclecard in its own package

2006-02-27  Ludovic Rousseau

	* [r1884] src/testpcsc.c: add a call to SCardTransmit()

2006-02-24  Ludovic Rousseau

	* [r1882] src/winscard_clnt.c: automatically call SCardUnload()
	  when the libpcsclite library is unloaded
	  
	  Thanks to Najam Siddiqui. See
	  http://archives.neohapsis.com/archives/dev/muscle/2006-q1/0177.html
	* [r1881] src/winscard.c: SCardTransmit(): use 0x%08lX instead of
	  %ld since the return codes are defined in hex in PCSC/pcsclite.h

2006-02-23  Ludovic Rousseau

	* [r1880] configure.in: correctly detect the use of --enable-libusb
	  (--enable-libusb has the same effect as --disable-libusb)
	  
	  Thanks to Iain MacDonnell for the bug report

2006-02-22  Ludovic Rousseau

	* [r1879] src/winscard_clnt.c: SCardReleaseContext(): do not check
	  that the thread releasing the context is the one that established
	  it. This check is not performed on Windows and creates
	  portability problems
	  
	  See
	  http://archives.neohapsis.com/archives/dev/muscle/2006-q1/0134.html
	* [r1878] libmusclecard/src/musclecard.c, src/misc.h: We can't use
	  a # inside a #define so it is not possible to use #define
	  CONSTRUCTOR_DECLARATION(x) #pragma init (x)
	  
	  The #pragma is used directly where needed
	* [r1877] README: update the available ./configure options
	  
	  Thanks to Shawn Willden for the bug report

2006-02-21  Ludovic Rousseau

	* [r1871] Makefile.am: correct the Perl regexp in ChangeLog.svn
	  rule
	* [r1868] Makefile.am: add subversion revision in ChangeLog.svn

2006-02-03  Ludovic Rousseau

	* [r1852] src/Makefile.am: remove $(LIBUSB_LIBS) from
	  libpcsclite_la_LIBADD
	* [r1851] ChangeLog, configure.in: release 1.2.9-beta10
	* [r1850] Makefile.am: use ChangeLog.svn instead of ChangeLog.cvs

2006-01-31  Ludovic Rousseau

	* [r1849] src/hotplug_libusb.c: if the USB reader defines a serial
	  number then include it in the reader name (between parenthesis)
	  
	  Thanks to Achraf Karray for the patch

2006-01-30  Ludovic Rousseau

	* [r1848] libmusclecard/src/Makefile.am: use libmusclecard.la
	  instead of $(top_builddir)/libmusclecard/src/libmusclecard.la so
	  that "make -j2" works. Closes bug "[ #302971 ] 'make -j2' fails"
	* [r1847] src/Makefile.am: add $(LIBUSB_CFLAGS) and $(LIBUSB_LIBS)
	  where needed
	* [r1844] configure.in: use xyes instead of xtrue in x$use_libusb
	  test
	* [r1843] configure.in: reuse libusb detection code from my CCID
	  driver

2006-01-25  Ludovic Rousseau

	* [r1838] libmusclecard/src/musclecard.c: MSCEstablishConnection():
	  avoids a segfault
	  
	  Thanks to Shawn Willden for the patch
	  http://archives.neohapsis.com/archives/dev/muscle/2006-q1/0057.html
	* [r1837] libmusclecard/src/Makefile.am, src/Makefile.am: use
	  $(SYMBOL_VISIBILITY) instead of -fvisibility=hidden
	* [r1836] configure.in: check if the compiler supports
	  -fvisibility=hidden and define SYMBOL_VISIBILITY accordingly
	  
	  Only GCC 4.0 support it AFAIK
	* [r1835] src/PCSC/debuglog.h: #define PCSC_API as no-op if not
	  already defined (needed when included by a driver)

2006-01-24  Ludovic Rousseau

	* [r1830] libmusclecard/src/Makefile.am, src/Makefile.am: Compile
	  with -fvisibility=hidden to hide all symbols by default. The
	  export of symbol must now be explicit. That only works for the
	  ELF format.
	* [r1829] src/readerfactory.c: #include "misc.h to get the
	  definition of PCSC_API
	* [r1828] src/winscard_clnt.c: export variables g_rgSCardT0Pci,
	  g_rgSCardT1Pci and g_rgSCardRawPci
	* [r1827] libmusclecard/src/musclecard.c,
	  libmusclecard/src/tokenfactory.c, src/atrhandler.c,
	  src/configfile.l, src/debuglog.c, src/dyn_macosx.c,
	  src/dyn_unix.c, src/eventhandler.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c, src/hotplug_macosx.c, src/ifdwrapper.c,
	  src/pcscdaemon.c, src/powermgt_macosx.c, src/prothandler.c,
	  src/sys_unix.c, src/thread_generic.h, src/tokenparser.l,
	  src/winscard_msg.c, src/winscard_msg_srv.c: #include "misc.h to
	  get the definition of PCSC_API
	* [r1826] src/PCSC/debuglog.h: declare log_msg(), log_xxd(),
	  DebugLogSetLevel() and pcsc_stringify_error() as exported symbols
	  since they are used by libmusclecard or some applications
	* [r1825] src/PCSC/winscard.h: declare the symbols as exported
	  using PCSC_API macro
	* [r1824] src/parser.h: declare LTPBundleFindValueWithKey as an
	  exported symbol (used by the pcscd drivers)
	* [r1823] src/misc.h: define PCSC_API as a way to export a symbol
	* [r1822] src/misc.h: use __GNUC__ instead of __GCC__
	  
	  see
	  http://gcc.gnu.org/onlinedocs/gcc-3.3.5/cpp/Common-Predefined-Macros.html
	* [r1821] win32/PCSC.h: reformat comment

2006-01-18  Ludovic Rousseau

	* [r1817] src/winscard_clnt.c: add speed profiling code
	* [r1816] src/winscard_clnt.c: SCardTransmit(): code simplification
	* [r1813] src/Makefile.am: explicitely add $(PTHREAD_CFLAGS)
	  $(PTHREAD_LIBS) to libpcsclite_la_LIBADD and pcscd_LDADD
	* [r1812] src/Makefile.am: use $(FOO) instead of @FOO@ to not
	  replace the values but the variables
	* [r1811] configure.in: do not globaly add $PTHREAD_* to LIBS and
	  CFLAGS

2006-01-03  Ludovic Rousseau

	* [r1786] src/hotplug_generic.c: Add missing ReCheckSerialReaders
	  and HPReCheckSerialReaders() so pcsc-lite can compile on FreeBSD
	  and others

2005-12-15  Ludovic Rousseau

	* [r1783] TODO: allow to have pcscd and libpcsclite on two
	  different machines.

2005-12-12  Ludovic Rousseau

	* [r1781] configure.in: use $prefix/pcsc/services instead of
	  $prefix/services when --prefix= is used but
	  --enable-muscledropdir= is not. Same code as for
	  --enable-usbdropdir=

2005-12-01  Ludovic Rousseau

	* [r1777] src/winscard.c: remove a duplicated comment line

2005-11-29  Ludovic Rousseau

	* [r1772] TODO: typo corrected

2005-11-27  Ludovic Rousseau

	* [r1757] ChangeLog: release 1.2.9-beta9

2005-11-25  Ludovic Rousseau

	* [r1756] libmusclecard/src/Makefile.am: libmusclecard needs
	  tokenparser.l but I do not want to provide it through libpcsclite
	  so libmusclecard uses it directly

2005-11-24  Ludovic Rousseau

	* [r1753] configure.in: version 1.2.9-beta9
	* [r1748] src/PCSC/reader.h.in: Apple gcc does not support #pragma
	  pack(push, 1) but only #pragma pack(1)
	  powerpc-apple-darwin8-gcc-4.0.0 (GCC) 4.0.0 20041026 (Apple
	  Computer, Inc. build 4061)
	* [r1744] src/winscard.c: SCardConnect(): do not print an error
	  ""Active Protocol: unknown 0" when we are connecting in direct
	  mode. The card is not supposed to be used at this time.
	* [r1741] src/PCSC/reader.h.in: use uint8_t instead of int8_t since
	  the fields are defined as BYTE, USHORT and ULONG in PC/SC v2 part
	  10 specification
	  
	  This avoids a "warning: overflow in implicit constant conversion"
	  when using values bigger than 127
	* [r1736] src/Makefile.am: tokenparser.l is used by pcscd only and
	  not by libpcsclite
	* [r1732] configure.in, src/Makefile.am: we need to provide
	  LTPBundleFindValueWithKey for all plateforms. This function is
	  NOT provided by Mac OS X. The bug I wanted to correct yesterday
	  is in the CCID driver instead. patch reverted.
	* [r1731] doc/doxygen.css: do not use smaller fonts for functions
	  names so it looks nice with Safari

2005-11-21  Ludovic Rousseau

	* [r1728] configure.in: replace dnl by # for comments
	* [r1727] configure.in, src/Makefile.am: we need tokenparser.l
	  (LTPBundleFindValueWithKey) only on non Mac OS X plateforms. So
	  we avoid linking with tokenparser.o and a possible "multiple
	  definitions of symbol _LTPBundleFindValueWithKey" ldd error
	* [r1726] src/hotplug_macosx.c: HPSearchHotPluggables(): fill a
	  "usb:%04x/%04x" string as deviceName[] so it is possible to
	  differentiate two non-identical readers
	* [r1725] src/powermgt_macosx.c: PMRegisterForPowerEvents(): use
	  (PCSCLITE_THREAD_FUNCTION( )) instead of (LPVOID) to cast the
	  function pointer passed to SYS_ThreadCreate()
	* [r1724] src/powermgt_macosx.c: PMRegisterForPowerEvents(): use
	  THREAD_ATTR_DEFAULT instead of NULL in SYS_ThreadCreate()
	* [r1723] src/powermgt_macosx.c: PMPowerRegistrationThread(): use 0
	  instead of NULL since IORegisterForSystemPower() returns a number
	  and not a pointer
	* [r1722] src/readerfactory.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_scf.c: use NULL instead of 0 for pointers
	* [r1721] src/readerfactory.c: RFAddReader(): initialize the
	  pdwMutex field of a new reader. The bug resulted in a crash on
	  pcscd exit on Mac OS X
	* [r1720] src/debuglog.c: DebugLogSetLogType(): add support for
	  "xterm-color" used by Mac OS X Terminal

2005-11-16  Ludovic Rousseau

	* [r1719] Makefile.am: remove "PCSC/" from filenames in the
	  generated ChangeLog.cvs
	* [r1718] configure.in: do not use `pkg-config libpcsclite
	  --variable=libdir` since we _are_ installing libpcsclite. This
	  code was ok when libmusclecard was separate from libpcsclite.

2005-10-29  Ludovic Rousseau

	* [r1698] doc/Makefile.am, doc/doxygen.css: use a customized CSS
	  file for Doxygen
	* [r1697] doc/Makefile.am: add a rule to generate Doxygen
	  documentation
	* [r1696] configure.in, doc/Makefile.am, doc/doxygen.conf.in: add
	  doc/doxygen.conf.in and generation of doxygen.conf
	* [r1695] src/tokenparser.l, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_msg.h, src/winscard_msg_srv.c,
	  src/winscard_svc.c: correct some Doxygen warnings
	* [r1694] TODO: todo list

2005-10-21  Ludovic Rousseau

	* [r1693] src/sys_unix.c: SYS_Daemon(): manually detatch from
	  terminal on Solaris in case daemon(3) does not exist

2005-10-18  Ludovic Rousseau

	* [r1690] configure.in: do not try to find yywrap() since we use
	  %option noyywrap now
	  
	  pcsc-lite can now be compiled without (f)lex installed.
	* [r1689] src/Makefile.am: do not link pcscd with @LIBFL@
	* [r1688] src/configfile.l, src/tokenparser.l: use %option noyywrap
	  so we do not use yywrap() and do have to link with flex lib See
	  http://www.gnu.org/software/flex/manual/html_node/flex_17.html
	  
	  Thanks to Toni Andjelkovic for the patch
	* [r1687] src/winscard_scf.c: PCSC_SCF_Initialize(): use
	  PCSC_Initialized instead of PCSC_SCF_Initialized (typo)
	  
	  thanks to Najam Siddiqui for the patch

2005-10-12  Ludovic Rousseau

	* [r1684] src/winscard_scf.c: EventCallback() &
	  PCSC_SCF_Initialize(): Fix issue where SCardGetStatusChange()
	  returns incorrect status when it is called right after
	  SCardEstablishContext() the first time after the libpcsclite.so
	  is loaded in memory, the fix is to make PCSC_Initialize() wait
	  till OCF has been initialized and the internal states are
	  consistent.
	  
	  Thanks to Najam Siddiqui for the patch
	* [r1683] src/winscard_scf.c: add function isActiveContextPresent()
	  missing from my previous commit
	* [r1682] src/winscard_scf.c: SCardUnload(): add cleanup code
	  
	  Thanks to Najam Siddiqui for the patch
	* [r1681] src/winscard_scf.c: SCardGetStatusChange(): Context index
	  was being used instead of Reader index, it worked only when there
	  was just one context.
	  
	  Thanks to Najam Siddiqui for the bug report

2005-09-28  Ludovic Rousseau

	* [r1680] src/eventhandler.c: EHStatusHandlerThread(): Solaris 10
	  IFDhandler expect to have CardAtrLength set to a sensible value.
	  So add an initialisation before calling IFDPowerICC()
	  
	  Thanks to Douglas E. Engert for the patch
	* [r1679] src/prothandler.c: PHSetProtocol(): Solaris 10 IFDhandler
	  returns IFD_PROTOCOL_NOT_SUPPORTED if the protocol is not
	  supported
	  
	  Thanks to Douglas E. Engert for the patch
	* [r1678] src/eventhandler.c: EHStatusHandlerThread(): log the
	  error code in case of "Error powering up card."
	  
	  Thanks to Douglas E. Engert for the patch

2005-09-26  Ludovic Rousseau

	* [r1673] src/winscard_clnt.c: SCardGetStatusChange(): exists if
	  the list of readers changed (one reader added) so that the
	  application can update its list of readers
	  
	  Thanks to Najam Siddiqui for a preliminary patch.

2005-09-19  Ludovic Rousseau

	* [r1664] libmusclecard/src/musclecard.c: use
	  CONSTRUCTOR_DECLARATION() and DESTRUCTOR_DECLARATION() to support
	  SUN C compiler
	* [r1663] src/misc.h: add support of SUN C compiler (using
	  __SUNPRO_C)
	  
	  Thanks to Heiko Nardmann for the info
	* [r1662] src/debuglog.c: add rxvt-unicode to the terminals with
	  color support
	* [r1661] src/PCSC/reader.h.in: use #pragma pack instead of GCC
	  specific __attribute__
	  
	  Thanks to Heiko Nardmann for the bug report
	* [r1660] libmusclecard/src/musclecard.c: use CONSTRUCTOR &
	  DESTRUCTOR macros instead of GCC specific __attribute__ ...
	* [r1659] src/misc.h: define CONSTRUCTOR and DESTRUCTOR
	* [r1658] src/misc.h: use __attribute__ ... only for GCC

2005-09-15  Ludovic Rousseau

	* [r1656] configure.in, src/PCSC/reader.h.in: define
	  HOST_TO_CCID_16() and HOST_TO_CCID_32 instead of just
	  HOST_TO_CCID()
	* [r1655] doc/Makefile.am: muscle-api-1.3.0.pdf is already present
	  in libmusclecard/doc/
	* [r1654] doc/muscle-api-1.3.0.pdf: this document is already
	  present in libmusclecard/doc/
	* [r1653] src/Makefile.am: install PCSC/reader.h and
	  PCSC/pcsclite.h but do not distribute them
	* [r1652] Makefile.am: add --stdout argument to svn2cl.sh so we
	  don't have to patch the svn2cl.sh anymore. The feature is now
	  included in svn2cl v0.3
	* [r1651] src/Makefile.am, src/PCSC/dyn_generic.h,
	  src/PCSC/parser.h, src/PCSC/sys_generic.h,
	  src/PCSC/thread_generic.h, src/dyn_generic.h, src/parser.h,
	  src/sys_generic.h, src/thread_generic.h: move some header files
	  from src/PCSC to src and do not distribute them in
	  /usr/include/PCSC

2005-09-14  Ludovic Rousseau

	* [r1650] doc/example/Makefile.am, libmusclecard/src/Makefile.am,
	  libmusclecard/utils/bundleTool/Makefile.am, src/Makefile.am,
	  src/utils/Makefile.am: add -I$(top_builddir)/src/PCSC to find the
	  generated files (pcsclite.h)
	* [r1649] src/Makefile.am: do not include PCSC/pcsclite.h in the
	  tar.gz since it is generated from PCSC/pcsclite.h.in
	* [r1648] doc/Makefile.am: include muscle-api-1.3.0.pdf
	* [r1647] doc/muscle-api-1.3.0.pdf: copy from rel-1_2_9-beta7

2005-09-08  Ludovic Rousseau

	* [r1646] Makefile.am: do not fail if svn2cl fails (command not
	  installed for example)
	* [r1645] doc/Makefile.am: do not fail if $(PDFLATEX) fails
	  (command not installed for example)

2005-09-07  Ludovic Rousseau

	* [r1644] Makefile.am: svn2cl --group-by-day

2005-09-06  Ludovic Rousseau

	* [r1642] ChangeLog: release 1.2.9-beta8

2005-09-01  Ludovic Rousseau

	* [r1637] src/winscard_clnt.c: use [...].mMutex = NULL; instead of
	  [...].mMutex = 0; since it is a pointer
	* [r1636] src/winscard_clnt.c: SCardCancel(): do not synchronise
	  using .mMutex since it may be hold by another thread blocked for
	  a very long time in SCardGetStatusChange()
	  
	  Thanks to Roland van Rijswijk for a preliminary patch
	* [r1629] src/readerfactory.c: RFAddReader(): correct max length
	  tests for reader, library and device I was too pessimistic

2005-08-31  Ludovic Rousseau

	* [r1628] src/readerfactory.c: RFAddReader(): do not silently
	  truncate the reader, library or device name if they are too long
	  
	  Thanks to Ribamar Santarosa de Sousa for the bug report
	* [r1627] src/readerfactory.c: RFAddReader(): return in error if
	  lpcDevice == NULL

2005-08-23  Ludovic Rousseau

	* [r1624] Makefile.am: use svn2cl instead of rcs2log
	* [r1623] src/winscard_clnt.c: SCardEstablishContextTH() and
	  SCardReleaseContext(): initialize rv field of
	  scEstablishStruct/scReleaseStruct structures to avoid a valgrind
	  warning

2005-08-17  Ludovic Rousseau

	* [r1621] src/PCSC/reader.h.in: Pack the complete structures
	  instead of just the 16-bits fields This syntax is more readable
	* [r1620] src/PCSC/reader.h.in: use __attribute__ ((__packed__))
	  for 16-bits fields since they are not aligned on word boundaries

2005-08-16  Ludovic Rousseau

	* [r1619] .cvsignore, doc/.cvsignore, doc/example/.cvsignore,
	  etc/.cvsignore, libmusclecard/.cvsignore,
	  libmusclecard/doc/.cvsignore, libmusclecard/src/.cvsignore,
	  libmusclecard/utils/.cvsignore,
	  libmusclecard/utils/bundleTool/.cvsignore, m4/.cvsignore,
	  src/.cvsignore, src/PCSC/.cvsignore, src/utils/.cvsignore,
	  win32/.cvsignore: removed since we use SVN and not CVS anymore
	  
	  Thanks to Martin Paljak for the idea

2005-08-15  Ludovic Rousseau

	* [r1615] doc/formaticc.1, doc/pcscd.8.in, doc/reader.conf.5.in:
	  update

2005-08-08  Ludovic Rousseau

	* [r1607] configure.in: remove AM_CONDITIONAL(PCSC_USE_LIBUSB...)
	  since it is not used anymore
	* [r1606] configure.in: disable libusb on Darwin (MacOS X) since
	  native usb layer is preferred
	* [r1605] src/Makefile.am: use libtool's "-export-dynamic" instead
	  of gcc's "-rdynamic"
	  
	  see http://www.gnu.org/software/libtool/manual.html#Link-mode

2005-08-04  Ludovic Rousseau

	* [r1603] src/PCSC/reader.h.in: include definitions of: -
	  HOST_TO_CCID() macro - PIN_VERIFY_STRUCTURE structure -
	  PIN_MODIFY_STRUCTURE structure
	* [r1602] src/PCSC/reader.h.in: use inttypes.h instead of stdint.h
	  (stdint.h does not exist on Solaris)
	* [r1601] configure.in: check is the plateform is big or little
	  endian and generate the corresponding HOST_TO_CCID() macro in
	  PCSC/reader.h

2005-08-03  Ludovic Rousseau

	* [r1599] src/hotplug_libusb.c: HPAddHotPluggable(): off by 1
	  buffer overflow. The last character of a string is
	  "sizeof(string) -1" and not "sizeof(string)".
	  
	  Thanks to Amira Solomovici for the bug report. A crash occured on
	  Fedora Core 4.
	* [r1598] src/hotplug_libusb.c: HPAddHotPluggable(): use sizeof()
	  instead of BUS_DEVICE_STRSIZE to be less error prone

2005-08-02  Ludovic Rousseau

	* [r1597] src/hotplug_libusb.c: HPSearchHotPluggables(): start the
	  HPEstablishUSBNotifications thread only if HPReadBundleValues()
	  returns TRUE (some USB drivers are found)
	* [r1596] src/hotplug_libusb.c: HPReadBundleValues(): return TRUE
	  only if some USB drivers are found
	* [r1595] src/hotplug_libusb.c: HPEstablishUSBNotifications(): free
	  data allocated for driverTracker[] on exit

2005-08-01  Ludovic Rousseau

	* [r1582] src/winscard.c: SCardReconnect(): remove duplicate
	  checking code

2005-07-27  Ludovic Rousseau

	* [r1580] src/hotplug_libusb.c: HPReadBundleValues(): clean the
	  newly allocated entries when driverTracker[] is enlarged
	* [r1578] src/winscard_clnt.c: SCardCancelTransaction(): Doxygen
	  documented deprecation
	* [r1576] src/winscard_clnt.c: move the Doxygen for SCardCancel()
	  to the correct function (it was attached to
	  SCardCancelTransaction())
	* [r1574] src/winscard_clnt.c: typos in doxygen documentation
	* [r1573] src/sys_unix.c, src/winscard.c: typos in doxygen
	  documentation

2005-07-06  Ludovic Rousseau

	* [r1572] src/PCSC/reader.h.in: use ISO C99 integer types in
	  PCSC_TLV_STRUCTURE instead of __int*

2005-07-04  Ludovic Rousseau

	* [r1571] src/PCSC/reader.h.in: add PCSC_TLV_STRUCTURE structure

2005-06-27  Ludovic Rousseau

	* [r1565] src/pcscdaemon.c: add option -e -C so that systems
	  without getopt_long() can use them. remove code to parse the long
	  options.
	  
	  Solaris does not have getopt_long(). Thanks to Heiko Nardmann for
	  the bug report.

2005-06-16  Ludovic Rousseau

	* [r1564] src/configfile.l: DBGetReaderList(): *caller_reader_list
	  = NULL by default

2005-06-15  Ludovic Rousseau

	* [r1554] src/hotplug_libusb.c: HPRegisterForHotplugEvents(): void
	  function so remove return 0;
	* [r1553] src/winscard.c: SCardTransmit(): initialise
	  sSendPci.Protocol to T=0 by default (avoids a compiler warning)
	* [r1552] src/readerfactory.c: #include "configfile.h" to define
	  DBGetReaderList()
	* [r1551] src/configfile.l: #include "configfile.h" to check the
	  function prototype
	* [r1550] src/configfile.h: correct function prototype according to
	  configfile.l new version

2005-06-04  Ludovic Rousseau

	* [r1549] src/hotplug_linux.c: HPReadBundleValues(): use >= instead
	  of > to check if too many readers are declared in the previous
	  patch
	* [r1548] src/hotplug_linux.c: HPReadBundleValues(): exit early if
	  too many readers are declared since the array to store them is
	  static (PCSCLITE_MAX_READERS_CONTEXTS)

2005-05-26  Ludovic Rousseau

	* [r1544] configure.in: 1.2.9-beta8
	* [r1543] src/hotplug_macosx.c: HPRegisterForHotplugEvents(): use
	  THREAD_ATTR_DEFAULT instead of NULL and
	  (PCSCLITE_THREAD_FUNCTION( )) instead of (LPVOID)
	* [r1542] src/hotplug_macosx.c: replace NULL by 0 in the 4th
	  argument of IORegistryEntryCreateCFProperty()
	* [r1541] src/hotplug_macosx.c: define char ReCheckSerialReaders
	  and HPReCheckSerialReaders()
	* [r1540] src/hotplug_linux.c: define an empty
	  HPReCheckSerialReaders()
	* [r1539] src/hotplug_linux.c: define char ReCheckSerialReaders
	  used by pcscdaemon.c and winscard_msg_srv.c
	* [r1538] src/hotplug.h: add HPReCheckSerialReaders()
	* [r1537] src/winscard_msg.h: do not declare
	  SHMProcessCommonChannelRequest() since it is a static function in
	  winscard_msg_srv.c never used elsewhere
	* [r1536] src/pcscdaemon.c, src/winscard_msg_srv.c: do not log an
	  error if select() is interrupted because of a manual hotplug
	  signal (SIGUSR1)
	* [r1535] src/pcscdaemon.c: call signal_reload() when a SIGUSR1
	  signal is received
	  
	  This provides a manual serial hotplug
	* [r1534] src/pcscdaemon.c: call RFStartSerialReaders() instead of
	  DBUpdateReaders()
	* [r1533] src/hotplug_libusb.c: implement HPReCheckSerialReaders()
	  to set ReCheckSerialReaders flag if ReCheckSerialReaders flag is
	  set we call RFReCheckReaderConf()
	  
	  This code has nothing to do with libusb or USB but is a serial
	  hotplug so should be in a hotplug loop
	* [r1532] src/readerfactory.c: implement RFStartSerialReaders() to
	  start (serial) readers described in the configuration file
	  (/etc/reader.conf)
	  
	  implement RFReCheckReaderConf() to stop or start readers
	  described in the configuration file. This allows a serial
	  hotplug.
	* [r1531] src/configfile.h, src/configfile.l: rename
	  DBUpdateReaders() in DBGetReaderList() The function now just
	  returns a list of readers described in the configuration file
	  (/etc/reader.conf by default)
	* [r1530] src/readerfactory.h: add struct SerialReader,
	  RFStartSerialReaders() and RFReCheckReaderConf() declarations
	* [r1529] src/winscard.c: remove #include "configfile.h"

2005-05-25  Ludovic Rousseau

	* [r1528] src/debuglog.c: DebugLogSetLevel(): do not print anything
	  if the level is critical or error in order to not "pollute" logs
	  in normal cases.
	* [r1527] src/pcscdaemon.c, src/winscard_msg_srv.c: Do not log a
	  critical or error debug message if pcscd is stopped using Ctrl-C
	  or SIGQUIT Closes Debian bug 306061
	* [r1526] src/Makefile.am: link pcscd with winscard_msg_srv.c
	* [r1525] src/winscard_msg.c, src/winscard_msg_srv.c: move the
	  functions only use by the server part from winscard_msg.c to
	  winscard_msg_srv.c
	* [r1524] src/debuglog.c: check if we should use color logs in
	  DebugLogSetLogType() and not only the first time in log_msg()

2005-05-18  Ludovic Rousseau

	* [r1519] src/testpcsc.c: #include "reader.h" to use
	  SCARD_CTL_CODE() macro
	* [r1518] src/Makefile.am: distribute PCSC/reader.h
	* [r1517] src/PCSC/pcsclite.h.in, src/PCSC/reader.h.in: reader.h
	  now contains the #defines shared between the driver and the
	  application
	* [r1516] src/PCSC/pcsclite.h.in: #define SCARD_CTL_CODE(code) and
	  some TeleTrust Class 2 reader tags
	  
	  Thanks to Martin Paljak for the patch
	* [r1515] src/winscard_clnt.c: SCardControl(): a 0 byte long
	  pbSendBuffer is no more rejected since the command is in
	  dwControlCode
	  
	  Thanks to Martin Paljak for the patch

2005-05-03  Ludovic Rousseau

	* [r1502] src/winscard_clnt.c: add @endcode in
	  SCardGetStatusChange() doxygen doc
	* [r1501] src/winscard.c: minor corrections in doxygen doc
	* [r1500] src/winscard.c: reformat doxygen pargraphs to 79 colunms
	* [r1499] src/eventhandler.h: remove @typedef. It is useless and
	  makes doxygen crash

2005-05-02  Ludovic Rousseau

	* [r1498] src/Makefile.am: do not build pcscd if SCF is used since
	  the library talks directly to ocfserv and pcscd is not used.
	  
	  Thanks to Jeffrey Hutzelman for the patch.
	* [r1497] src/winscard_scf.c: add SCardGetAttrib()/SCardSetAttrib()
	  even if they return SCARD_E_NOT_TRANSACTED for now. testpcsc can
	  now link when SCF is used.
	  
	  Thanks to Jeffrey Hutzelman for the patch.

2005-04-27  Ludovic Rousseau

	* [r1466] Makefile.am: add libmusclecard in SUBDIRS
	* [r1465] configure.in: add --enable-muscledropdir=DIR and
	  --enable-musclecarddebug for libmusclecard support
	* [r1464] libmusclecard, libmusclecard/.cvsignore,
	  libmusclecard/src, libmusclecard/src/.cvsignore: update the files
	  to ignore
	* [r1463] libmusclecard/utils/bundleTool/Makefile.am: use the
	  headers from pcsclite in $(top_srcdir)/src/PCSC
	* [r1462] libmusclecard/src/Makefile.am: use the header and sources
	  files from pcsclite (in $(top_srcdir)/src/)
	* [r1461] libmusclecard/Makefile.am: new file
	* [r1457] src/PCSC/wintypes.h: only use "__attribute__
	  ((deprecated))" if __GNUC__ is defined. Otherwise it does not
	  compile with Solaris C compiler.
	  
	  Thanks to Jeffrey Hutzelman for the patch
	* [r1456] src/winscard_scf.c: SCardControl(): use the new API (with
	  DWORD dwControlCode added)
	  
	  Thanks to Jeffrey Hutzelman for the patch
	* [r1455] src/sys_unix.c: SYS_Daemon(): add the missing priority
	  argument to Log2()
	  
	  Thanks to Jeffrey Hutzelman for the patch

2005-04-21  Ludovic Rousseau

	* [r1432] libmusclecard/src/musclecard.c: release the context when
	  the library is unloaded.
	  
	  Thanks to Karsten Ohme for the patch
	* [r1431] libmusclecard/src/Makefile.am: also distribute misc.h,
	  dyn_hpux.c, dyn_macosx.c, dyn_unix.c, dyn_win32.c
	* [r1430] libmusclecard/src/musclecard.c: do not perform a windows
	  specific treatment for PCSC_MCARD_mutex
	  declaration/initialisation
	  
	  Thanks to Karsten Ohme for the patch
	* [r1429] libmusclecard/src/tokenfactory.c: add a missing \ in
	  "%s\\%s\Contents\\Win32\\%s"
	  
	  Thanks to Karsten Ohme for the patch
	* [r1428] libmusclecard/src/PCSC/musclecard.h: add some #define
	  
	  Thanks to Karsten Ohme

2005-04-13  Ludovic Rousseau

	* [r1424] src/debuglog.c: use "signed char" instead of "char" for
	  LogDoColor since we use the value -1 and on some platforms (like
	  PowerPC) char is unsigned bu default.

2005-04-12  Ludovic Rousseau

	* [r1423] src/Makefile.am: add misc.h in libpcsclite_la_SOURCES
	* [r1421] src/PCSC/debuglog.h, src/PCSC/dyn_generic.h,
	  src/PCSC/ifdhandler.h, src/PCSC/parser.h, src/PCSC/pcsclite.h.in,
	  src/PCSC/sys_generic.h, src/PCSC/thread_generic.h,
	  src/PCSC/winscard.h, src/PCSC/wintypes.h, src/atrhandler.c,
	  src/atrhandler.h, src/debuglog.c, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/dyn_win32.c,
	  src/eventhandler.c, src/eventhandler.h, src/hotplug.h,
	  src/hotplug_generic.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/ifdwrapper.c, src/ifdwrapper.h,
	  src/pcscdaemon.c, src/powermgt_generic.c, src/powermgt_generic.h,
	  src/prothandler.c, src/prothandler.h, src/readerfactory.c,
	  src/readerfactory.h, src/strlcpycat.h, src/sys_unix.c,
	  src/testpcsc.c, src/thread_unix.c, src/thread_win32.c,
	  src/utils/formaticc.c, src/utils/installifd.c, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_msg.h,
	  src/winscard_scf.c, src/winscard_svc.c, src/winscard_svc.h: add
	  (some) Doxygen documentation
	  
	  Thanks to Luiz Reuter Silva Torro for the patch
	* [r1420] src/debuglog.c: DebugLogSuppress(), debug_msg() and
	  debug_xxd are defined only for pcscd and not for libpcsclite.so
	* [r1419] src/debuglog.c, src/dyn_unix.c, src/strlcat.c,
	  src/strlcpy.c, src/sys_unix.c, src/thread_unix.c,
	  src/winscard_msg.c: define some/most functions as INTERNAL (see
	  misc.h) so the function symbols are not visible in libpcsclite.so
	  
	  This will prevent function names collision with homonym functions
	  defined in a library or program linked with libpcsclite.so
	* [r1418] src/Makefile.am: remove debuglog.c from
	  libpcsclite_core_la_SOURCES so the same source file can be
	  compiled with different -D arguments for libpcsclite_la_SOURCES
	  and pcscd_SOURCES
	* [r1417] src/misc.h: #define INTERNAL

2005-04-06  Ludovic Rousseau

	* [r1416] libmusclecard/src/musclecard.c: MSCReleaseConnection():
	  call SCardReleaseContext()
	  
	  Thanks to Karsten Ohme for the patch

2005-03-22  Ludovic Rousseau

	* [r1415] src/pcscdaemon.c: main(): print usage and exit if a
	  unknown parameter is passed

2005-03-21  Ludovic Rousseau

	* [r1414] doc/pcscd.8.in: remove libmusclecard documentation since
	  it is now in a separate package
	* [r1413] doc/pcscd.8.in: update documentation of --debug, --info,
	  --error, --critical and --foreground
	* [r1412] doc/Makefile.am: DISTCLEANFILES = ifdhandler-3.pdf
	  pcsc-lite.pdf The two PDF files are only removed by "make
	  distclean" so normal users will not have to (re)build them after
	  a "make clean"

2005-03-17  Ludovic Rousseau

	* [r1403] src/debuglog.c: add colorization of the logs when sent to
	  stderr. The color depends on the priority level: - critical:
	  bright red - error: magenta - info: blue - debug: black
	  
	  A correct implementation should use ncurses to be portable but I
	  don't want to add a dependency on pcscd.
	  
	  The code and idea is greatly inspired from OpenSC.
	* [r1402] src/debuglog.c: change global variable names to use a
	  capital first letter

2005-03-02  Ludovic Rousseau

	* [r1389] ChangeLog: release 1.2.9-beta7
	* [r1388] src/readerfactory.c: RFAddReader(): revert the previous
	  patch.
	  
	  The wait delay is moved to SCardGetStatusChange()/winscard_clnt.c
	* [r1387] src/winscard_clnt.c: SCardEstablishContextTH(): if
	  MUSCLECARD_DEBUG environment variable is defined we use the more
	  verbose debug level
	* [r1386] src/winscard_clnt.c: SCardGetStatusChange(): if the card
	  is present but not yet powered up we give some time to the status
	  thread to do his job

2005-03-01  Ludovic Rousseau

	* [r1385] src/readerfactory.c: RFAddReader(): give some time to
	  EHStatusHandlerThread() to asynchronously power the card.
	  
	  The problem was that the reader was initialised but the card in
	  the reader was not powered up immediately. So if you are fast
	  enough to call SCardConnect() it would fail with a wrong protocol
	  (since the card ATR is not yet known).
	* [r1384] src/winscard.c: SCardConnect(): use "Attempting Connect
	  to %s using protocol: %d" instead of "Attempting Connect to %s
	  %d"
	* [r1383] src/atrhandler.c: use Logx() instead of debug_msg()
	* [r1382] src/PCSC/debuglog.h: add Log9()
	* [r1381] src/PCSC/debuglog.h: add () after the function name

2005-02-28  Ludovic Rousseau

	* [r1380] src/PCSC/debuglog.h: #define Log0()
	* [r1379] src/debuglog.c: typo: "Reader/s" -> "Reader"
	* [r1378] src/winscard.c: SCardControl(): rContext was used before
	  initialisation (segmentation fault)
	* [r1377] src/debuglog.c: DebugLogSetLogType(): do not modify
	  dbgtype argument since it is "const"
	* [r1376] doc/example/Makefile.am: use pcsc_demo_CFLAGS instead of
	  AM_CPPFLAGS
	* [r1375] doc/example/pcsc_demo.c: use "%lX" instead of "%X" for
	  rgReaderStates[0].dwEventState field
	* [r1374] doc/pcsc-lite.tex: improve SCardGetStatusChange()
	  documentation
	* [r1373] doc/example/pcsc_demo.c: add SCardGetStatusChange() code
	  sample
	* [r1372] src/debuglog.c: update copyright
	* [r1371] src/debuglog.c: simplify the debug output switch
	* [r1370] src/debuglog.c: DebugLogSetLogType(): check the log type
	  argument value
	* [r1369] src/debuglog.c: DebugLogSetLevel(): display the unknown
	  level value
	* [r1366] configure.in: remove --enable-threadsafe since it is now
	  useless
	* [r1365] src/winscard_scf.c: code cleanup
	* [r1364] src/winscard_scf.c: code reindentation
	* [r1363] src/winscard_scf.c: remove #ifdef USE_THREAD_SAFETY since
	  it _must_ be defined for the file to compile
	* [r1362] configure.in: remove --enable-debug since it is not used
	  anymore (log level is no dynamic at execution time)

2005-02-27  Antti Tapaninen

	* [r1357] pbx/config.h, pcsc.pbproj/project.pbxproj: - Upgrade
	  Xcode project related files a bit, compiles yet untested
	  otherwise.

2005-02-24  Ludovic Rousseau

	* [r1348] src/winscard.c: SCardControl(): check if the pbSendBuffer
	  is NULL or no bytes are sent for API v2 only. With API v3 we can
	  use dwControlCode as the only data to send.

2005-02-23  Ludovic Rousseau

	* [r1347] configure.in, src/Makefile.am, src/strlcat.c,
	  src/strlcpy.c: simplify the detection and use of strlcpy and
	  strlcat
	* [r1345] src/PCSC/debuglog.h, src/debuglog.c: remove
	  DEBUGLOG_STDOUT_DEBUG case since it is never used
	* [r1344] src/debuglog.c: use "const int" instead of "int" for
	  priority
	* [r1340] src/PCSC/debuglog.h: update copyright date
	* [r1339] src/PCSC/debuglog.h: document Log1() instead of
	  DebugLogA() in comments
	* [r1338] src/PCSC/debuglog.h: use "const int" instead of "int" for
	  priority
	* [r1337] doc/ifdhandler-3.tex: document log_msg() and log_xxd()

2005-02-22  Ludovic Rousseau

	* [r1336] doc/ifdhandler-3.tex: add a complete Info.plist
	  configuration file
	* [r1335] libmusclecard/src/musclecard.c,
	  libmusclecard/src/tokenfactory.c: use dynamic debug level: LogX()
	  instead of DebugLogX()
	* [r1334] src/atrhandler.c, src/configfile.l, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/dyn_win32.c,
	  src/eventhandler.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/ifdwrapper.c, src/powermgt_macosx.c,
	  src/prothandler.c, src/readerfactory.c, src/sys_unix.c,
	  src/tokenparser.l, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_svc.c: Use dynamic level logging
	  using LogX() instead of DebugLogX()
	* [r1333] src/pcscdaemon.c: Implement the dynamic level logging
	  
	  The new command line options are: -d, --debug display lower level
	  debug messages --info display info level debug messages (default
	  level) --error display error level debug messages --critical
	  display critical only level debug messages
	* [r1332] src/debuglog.c: implement log with priority level.
	  
	  debug_msg() is still provided for backward object code
	  compatibility
	* [r1331] src/PCSC/debuglog.h: use Log1(priority, fmt) instead of
	  DebugLogA(fmt) to add a priority level so that pcscd log
	  verbosity is dynamic
	  
	  We define DebugLogA(a) as Log1(PCSC_LOG_INFO, a) for backward
	  source code compatibility

2005-01-16  Ludovic Rousseau

	* [r1315] Makefile.am, bootstrap, configure.in: move *.m4 files
	  from aclocal/ to m4/

2005-01-11  Ludovic Rousseau

	* [r1308] bootstrap: add autotools version used
	* [r1307] src/readerfactory.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_scf.c: use SYS_RandomInt() instead of SYS_Random()
	  to improve performances.
	  
	  Thanks to Philipp Marek for the patch
	* [r1306] src/PCSC/sys_generic.h, src/sys_unix.c: convert
	  SYS_Random() into SYS_RandomInt() to improve performances.
	  
	  Thanks to Philipp Marek for the patch
	* [r1305] src/winscard_msg.c: WrapSHMWrite(): eliminate a
	  valgrind/memcheck-warning
	  
	  Thanks to Philipp Marek for the patch
	* [r1304] src/winscard_clnt.c: SCardEstablishContextTH(): eliminate
	  a valgrind/memcheck-warning
	  
	  Thanks to Philipp Marek for the patch
	* [r1303] src/sys_unix.c: SYS_Random(): improve performances
	  
	  Thanks to Philipp Marek for the patch

2004-12-02  Ludovic Rousseau

	* [r1296] src/winscard_clnt.c: CardGetStatusChange(): do not sleep
	  at each reader check but only once per cycle. Before the change
	  the total sleep time was cReaders * PCSCLITE_STATUS_WAIT
	  
	  Thanks to Oivind H. Danielsen for the three patches
	* [r1295] src/winscard_clnt.c: SCardGetStatusChange(): move timeout
	  check after other checks so we do not exit with timeout if the
	  timeout is less than 200 ms (PCSCLITE_STATUS_WAIT)
	* [r1294] src/winscard_clnt.c: SCardGetStatusChange(): do not sleep
	  if dwCurrentState = SCARD_STATE_UNAWARE

2004-11-23  Ludovic Rousseau

	* [r1293] doc/pcsc-lite.tex: SCardStatus: document that pcbAtrLen
	  will contain the necessary size if it is too small

2004-10-20  Ludovic Rousseau

	* [r1291] src/debuglog.c: pcsc_stringify_error(): differentiate the
	  error messages for SCARD_F_INTERNAL_ERROR and
	  SCARD_F_UNKNOWN_ERROR

2004-10-06  Ludovic Rousseau

	* [r1274] libmusclecard/doc/Makefile.am,
	  libmusclecard/src/Makefile.am, libmusclecard/utils/Makefile.am,
	  libmusclecard/utils/bundleTool/Makefile.am: new build
	  infrastructure. Patch from Toni Andjelkovic
	* [r1273] libmusclecard/src/libmusclecard.pc.in: do not force the
	  libpcsclite version to use since the two packages are now
	  independents
	* [r1272] libmusclecard/src/musclecard.c,
	  libmusclecard/src/tokenfactory.c: use < > instead of " " for the
	  include files provided by pcsc-lite (and already installed in the
	  system)
	* [r1271] libmusclecard/src/tokenfactory.c: use MSC_ARCH instead of
	  PCSC_ARCH
	* [r1270] libmusclecard, libmusclecard/.cvsignore,
	  libmusclecard/doc, libmusclecard/doc/.cvsignore,
	  libmusclecard/src, libmusclecard/src/.cvsignore,
	  libmusclecard/utils, libmusclecard/utils/.cvsignore,
	  libmusclecard/utils/bundleTool,
	  libmusclecard/utils/bundleTool/.cvsignore: list of files to
	  ignore
	* [r1269] libmusclecard/src/musclecard.c,
	  libmusclecard/src/muscletest.c,
	  libmusclecard/utils/bundleTool/bundleTool.c: patch from Toni
	  Andjelkovic for the pcsc-lite/libmusclecard separation
	* [r1268] configure.in: 1.2.9-beta7
	* [r1267] etc/Makefile.am: install reader.conf in reader.conf.d/
	  instead of just creating an empty directory

2004-10-04  Ludovic Rousseau

	* [r1266] configure.in, doc/Makefile.am, src/Makefile.am,
	  src/utils/Makefile.am: move libmusclecard from pcsc-lite to its
	  own archive/package

2004-10-03  Ludovic Rousseau

	* [r1264] doc/example/pcsc_demo.c, src/testpcsc.c: add "THIS
	  PROGRAM IS NOT DESIGNED AS A TESTING TOOL FOR END USERS!"

2004-09-29  Ludovic Rousseau

	* [r1255] libmusclecard/src/tokenfactory.c:
	  TPSearchBundlesForAtr(): revert the previous patch.
	  
	  Thanks to Toni Andjelkovic for his patch patch :-)
	* [r1250] libmusclecard/src/tokenfactory.c:
	  TPSearchBundlesForAtr(): initialise tokenInfo so that it contains
	  safe default values when no pcsc/services/ directory is found.
	  
	  Thanks to Toni Andjelkovic for the patch

2004-09-22  Ludovic Rousseau

	* [r1249] src/testpcsc.c: fflush(stdout) so that "Please insert a
	  working reader : " is displayed

2004-09-21  Ludovic Rousseau

	* [r1248] src/configfile.l, src/tokenparser.l: use "%option
	  nounput" to avoid the "warning: `yyunput' defined but not used"

2004-09-17  David Corcoran

	* [r1242] libmusclecard/src/musclecard.c: rewrite of
	  mscreadallocateobject
	* [r1241] libmusclecard/src/musclecard.c: initialized more vars in
	  ListTokens

2004-09-14  Ludovic Rousseau

	* [r1239] src/ifdwrapper.c, src/winscard.c: add "Card not
	  transacted" error messages. Thanks to Bruce Barnett for the
	  patch.
	* [r1238] src/tokenparser.l: LTPBundleFindValueWithKey():
	  sizeof(tokenValue) is not what we want since tokenValue is a char
	  * and not a char []
	* [r1237] src/tokenparser.l: use strlcpy and simplify the code
	* [r1236] src/configfile.l: remove PCSC/ from the #include path
	* [r1235] src/winscard_clnt.c: SCardListReaders(): simplify the
	  code
	* [r1234] src/winscard_clnt.c: SCardListReaders(): simplify the
	  multi-string creation
	* [r1233] src/readerfactory.c: comment out unsused function
	  RFListReaders()
	* [r1232] libmusclecard/src/tokenfactory.c, src/eventhandler.c,
	  src/readerfactory.c: use strlcpy() instead of strcpy()
	* [r1231] libmusclecard/src/muscletest.c: use strlcpy() insted of
	  strcpy()

2004-09-11  Ludovic Rousseau

	* [r1230] src/eventhandler.c: EHDestroyEventHandler(): do not try
	  to stop a not started thread (for a reader that failed
	  initialisation and never started)
	* [r1229] src/readerfactory.c: RFAddReader(): stop if
	  EHSpawnEventHandler() returns an error. This occurs if the
	  initial reader check (IFDStatusICC) fails.

2004-09-07  Ludovic Rousseau

	* [r1224] libmusclecard/src/musclecard.c: convert
	  MSC_INCORRECT_P1/P2 to the corresponding text error message
	  (instead of "Unknown SW").
	  
	  Thanks to Bruce Barnett for the patch.
	* [r1223] src/debuglog.c: use strlcpy/strlcat instead of
	  strncpy/strncat
	* [r1222] src/Makefile.am: use internal strlcpy.c and strlcat.c if
	  these functions are not provided by the OS
	* [r1221] configure.in: check if strlcpy/strlcat are provided by
	  the OS (OpenBSD and some others)
	* [r1220] src/strlcpycat.h: prototypes of strlcpy/strlcat
	* [r1219] src/strlcat.c, src/strlcpy.3, src/strlcpy.c: imported
	  from ftp://ftp.openbsd.org/pub/OpenBSD/src/lib/libc/string/
	* [r1218] src/testpcsc.c: update copyright: add my name
	* [r1217] src/testpcsc.c: add a test for SCardReconnect()
	* [r1216] src/eventhandler.c: EHStatusHandlerThread(): remove
	  comment from call to RFSetReaderEventState(rContext,
	  SCARD_RESET); The comment is present from the initial CVS
	  version. I don't know why is was ever needed.
	  
	  This is needed so that SCardReconnect() works after a card
	  movement. Otherwise SCardReconnect() returns "Card was removed"
	  even if the new card is reseted.
	  
	  Note: the comment was present from the initial CVS version
	  (2002/03/30). I don't know why is was ever needed.

2004-09-03  Ludovic Rousseau

	* [r1215] src/winscard.c: SCardConnect()/SCardReconnect(): do not
	  set rContext->readerState->cardProtocol if PHSetProtocol()
	  returns an error.
	  
	  This will avoid having a protocol set to -2
	  (SET_PROTOCOL_PPS_FAILED)
	* [r1214] src/prothandler.c: PHSetProtocol(): add the error code
	  returned by the driver in case of PTS failure in the debug
	  message

2004-09-01  Ludovic Rousseau

	* [r1211] configure.in: use $prefix value instead of /usr/local/ in
	  usbdropdir and muscledropdir
	* [r1210] src/testpcsc.c: test SCardGetAttrib() with a NULL pbAttr
	  paraleter
	* [r1209] src/winscard_clnt.c: add support of SCardGetAttrib() with
	  a NULL pbAttr parameter to only get the needed lenth in
	  pcbAttrLen

2004-08-24  Ludovic Rousseau

	* [r1207] doc, doc/.cvsignore: ignore ifdhandler-3,
	  ifdhandler-3.bbl and ifdhandler-3.blg
	* [r1206] src/PCSC/pcsclite.h.in: always use @confdir_exp@ instead
	  of #ifndef USE_READER_CONF ...
	* [r1205] configure.in: do not define USE_READER_CONF but expand
	  $confdir in confdir_exp
	* [r1204] configure.in: generate etc/update-reader.conf from
	  etc/update-reader.conf.in
	* [r1203] etc/pcscd.init.in: call update-reader.conf to update
	  /etc/reader.conf before starting the daemon
	* [r1202] etc/Makefile.am: use $(mkinstalldirs) instead of
	  $(mkdir_p)
	* [r1201] etc/Makefile.am: - distribute update-reader.conf - create
	  /etc/reader.conf.d/ during installation
	* [r1200] etc, etc/.cvsignore: ignore update-reader.conf
	* [r1199] etc/update-reader.conf.in: use update-reader.conf to
	  regenerate /etc/reader.conf from files in /etc/reader.conf.d/
	  (thanks to Ville Skytt�)
	* [r1198] src/tokenparser.l: LTPBundleFindValueWithKey(): also
	  print the configuration filename if the key is not found
	* [r1197] src/winscard_clnt.c: SCardStatus(): pdwState and
	  pdwProtocol parameters may be NULL (mimic Windows)

2004-08-23  Ludovic Rousseau

	* [r1192] src/PCSC/pcsclite.h.in: add SCARD_STATE_UNPOWERED.
	  
	  This #define is not (yet) used by pcsc-lite but is defined by
	  Windows PC/SC and may be used by Windows applications

2004-08-18  Ludovic Rousseau

	* [r1191] src/winscard.c, src/winscard_clnt.c: define and use an
	  internal SCARD_PROTOCOL_ANY_OLD for backward compatibility for
	  applications compiled with the old SCARD_PROTOCOL_ANY definition.
	* [r1190] src/PCSC/pcsclite.h.in: correctly define
	  SCARD_PROTOCOL_ANY as (SCARD_PROTOCOL_T0|SCARD_PROTOCOL_T1)

2004-08-16  Ludovic Rousseau

	* [r1188] src/ifdwrapper.c: forgot to remove 4 DebugLogA("POUET");
	  debug statements. Thanks Damien Sauveron for noticing :-)

2004-08-15  Ludovic Rousseau

	* [r1181] ChangeLog: release 1.2.9-beta6 (real one)

2004-08-13  Ludovic Rousseau

	* [r1180] doc/formaticc.1: libpcsclite0 -> libpcsclite1
	* [r1179] src/readerfactory.c, src/readerfactory.h: remove unused
	  fields in FctMap_V1 structure
	* [r1178] src/ifdwrapper.c, src/readerfactory.c: use the new
	  psFunctions C union
	* [r1177] src/readerfactory.h: psFunctions field is now a C union
	  with three structures for the 3 API. - each structure has
	  complete functions prototypes - only the needed functions are in
	  each structure (some bytes saved :-)
	* [r1176] src/atrhandler.c: remove #define SCARD_PROTOCOL_UNSET
	  0x00 since it is already defined in PCSC/pcsclite.h.in. Thanks to
	  Toni Andjelkovic

2004-08-10  Ludovic Rousseau

	* [r1175] doc/pcscd.8.in: replace an empty line by @HAVE_RUNPID@ to
	  avoid having two empty lines when --enable-runpid is not used
	* [r1174] etc/Makefile.am: do not distribute pcscd.init since it
	  will be generated from pcscd.init.in
	* [r1173] src/utils/installifd.c: remove a call to free() of a
	  pointer that was not malloc()ed and caused a segmentation fault
	* [r1172] src/utils/installifd.c: define DEVICENAME as /dev/null
	  instead of GEN_SMART_RDR
	* [r1171] configure.in, doc/pcscd.8.in: document runpid file
	  depending on the ./configue options
	* [r1170] doc/reader.conf.5.in: typos
	* [r1169] configure.in: generate etc/pcscd.init with the correct
	  paths
	* [r1168] m4/Makefile.am: distribute as-ac-expand.m4
	* [r1167] etc, etc/.cvsignore, etc/Makefile.am, etc/pcscd.init.in,
	  etc/pcscd.startup: pcscd.startup is replaced by pcscd.init
	  generated from pcscd.init.in
	* [r1166] m4/as-ac-expand.m4: provides a AC_SUBST-like macro
	  (AS_AC_EXPAND) but using expanded variables. From the autostars
	  project (http://sf.net/projects/autostars/)
	* [r1164] ChangeLog: release 1.2.9-beta6
	* [r1163] configure.in: 1.2.9-beta6
	* [r1162] etc/pcscd.startup: updated to reflect the RPM version
	  from Ville Skytt� & Fritz Elfert
	* [r1161] doc/example/GPL-2, doc/example/Makefile.am: add and
	  distribute the full text of the GNU General Public License used
	  by pcsc_demo.c

2004-08-06  Ludovic Rousseau

	* [r1159] doc/example/Makefile.am, src/Makefile.am,
	  src/utils/Makefile.am: use AM_CPPFLAGS = -I$(top_srcdir)/src/PCSC
	  to find the header files
	* [r1158] libmusclecard/src/PCSC/mscdefines.h,
	  libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/muscletest.c,
	  libmusclecard/src/tokenfactory.c,
	  libmusclecard/src/tokenfactory.h, src/PCSC/ifdhandler.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/winscard.h, src/atrhandler.c,
	  src/debuglog.c, src/dyn_hpux.c, src/dyn_macosx.c, src/dyn_unix.c,
	  src/eventhandler.c, src/hotplug_generic.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c, src/hotplug_macosx.c, src/ifdwrapper.c,
	  src/pcscdaemon.c, src/powermgt_generic.c, src/powermgt_macosx.c,
	  src/prothandler.c, src/readerfactory.c, src/sys_unix.c,
	  src/testpcsc.c, src/thread_unix.c, src/utils/formaticc.c,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.c,
	  src/winscard_scf.c, src/winscard_svc.c: remove PCSC/ from the
	  header files path since the path is given by pkg-config --cflags
	  libpcsclite or the correct -I directive

2004-08-03  Ludovic Rousseau

	* [r1137] src/winscard_svc.c: MSGCleanupClient(): always reset all
	  the fields. Thanks to Michael Gold for the patch. Closes: [
	  #300863 ] Clear dwClientID in MSGCleanupClient

2004-08-02  Ludovic Rousseau

	* [r1136] src/eventhandler.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c: use THREAD_ATTR_DETACHED in
	  SYS_ThreadCreate() to automatically deallocate resources
	  allocated by the thread when the thread exits (because the thread
	  is not joined with SYS_ThreadJoin())
	* [r1135] doc/example/pcsc_demo.c: remove useless call to
	  undocumented function SCardUnload()
	* [r1134] libmusclecard/src/musclecard.c: use THREAD_ATTR_DEFAULT
	  argument in SYS_ThreadCreate()
	* [r1133] src/winscard_svc.c: CreateContextThread(): use
	  THREAD_ATTR_DETACHED in SYS_ThreadCreate() so that the resources
	  allocated by pcscd are deallocated when the client die.
	  
	  Closes [ #300862 ] Don't create threads as joinable
	* [r1132] src/eventhandler.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c: use THREAD_ATTR_DEFAULT argument in
	  SYS_ThreadCreate()
	* [r1131] src/thread_win32.c: update SYS_ThreadCreate() API but do
	  not modify the code
	* [r1130] src/thread_unix.c: SYS_ThreadCreate(): set the thread
	  state: joinable or detached default is joinable
	* [r1129] src/PCSC/thread_generic.h: the second argument of
	  SYS_ThreadCreate if no more LPVOID pthAttr but int attributes so
	  that attributes can be passed in a portable way.
	  
	  /* thread attributes */ #define THREAD_ATTR_DEFAULT 0 #define
	  THREAD_ATTR_DETACHED 1
	* [r1128] src/testpcsc.c: use "%ld bytes" instead of "%lx" for ATR
	  Size
	* [r1127] src/testpcsc.c: use "T=%ld" instead of "%lx" for Reader
	  Protocol
	* [r1126] src/testpcsc.c: use "0x%.4lx" instead of "%lx" for Reader
	  State
	* [r1125] doc/example/pcsc_demo.c: add SCardTransmit() code sample
	* [r1124] src/winscard.c: perform a PPS (PHSetProtocol()) only if
	  the current protocol is SCARD_PROTOCOL_UNSET otherwise only check
	  that the requested protocol is available.
	  
	  This will avoid generating a PPS request that would not be just
	  after a power up. The previous code worked only when the card was
	  reseted at SCardDisconnect() but not when SCARD_LEAVE_CARD was
	  used.
	* [r1123] src/winscard.c: ...->cardProtocol = SCARD_PROTOCOL_UNSET;
	  after a power up so that the next SCardConnect() with perform a
	  PPS with the desired protocol
	* [r1122] src/winscard.c: ...->cardProtocol = SCARD_PROTOCOL_UNSET;
	  after a power up so that the next SCardConnect() with perform a
	  PPS with the desired protocol
	* [r1121] src/winscard.c: set ..->cardProtocol = SCARD_PROTOCOL_RAW
	  instead of -1
	* [r1120] src/eventhandler.c: ...->cardProtocol =
	  SCARD_PROTOCOL_UNSET; after a power up so that the next
	  SCardConnect() with perform a PPS with the desired protocol
	* [r1119] src/eventhandler.c: use ..->cardProtocol =
	  SCARD_PROTOCOL_UNSET instead of ..->cardProtocol = 0
	* [r1118] src/PCSC/pcsclite.h.in: #define SCARD_PROTOCOL_UNSET
	  0x0000 /* protocol not set */

2004-08-01  Ludovic Rousseau

	* [r1117] src/configfile.l: if the file referenced by DEVICENAME
	  can't be use (because it is not a correct filename) we now
	  display: You should use 'DEVICENAME /dev/null' if your driver
	  does not use this field
	* [r1116] src/readerfactory.c: initialise dwSlot field for the new
	  reader slot
	* [r1115] src/readerfactory.c: initialise the lpcDevice field of
	  the new slot and not of the main reader
	* [r1114] src/readerfactory.c: typo in comment (empty spot -> empty
	  slot)

2004-07-29  Ludovic Rousseau

	* [r1113] libmusclecard/src/musclecard.c,
	  libmusclecard/src/tokenfactory.c: replace #ifdef MSC_DEBUG by
	  #ifndef NO_MSC_DEBUG
	* [r1112] configure.in: define NO_PCSC_DEBUG and NO_MSC_DEBUG if
	  debug is set to NO instead of defining PCSC_DEBUG and MSC_DEBUG
	  when debug is selected. The debug messages are now displayed by
	  default.
	* [r1111] src/PCSC/debuglog.h: use NO_PCSC_DEBUG instead of
	  PCSC_DEBUG.
	  
	  The debug messages are now displayed by default (no need to
	  #include "config.h" in PCSC/debuglog.h)

2004-07-28  Ludovic Rousseau

	* [r1110] doc/ifdhandler-3.tex: typo: verions -> versions
	* [r1109] doc/ifdhandler-3.tex: add documentation for
	  IFDHGetCapabilities(..., TAG_IFD_THREAD_SAFE, ...),
	  IFDHGetCapabilities(..., TAG_IFD_SLOT_THREAD_SAFE, ...) and
	  IFDHSetCapabilities(..., TAG_IFD_SLOTNUM, ...)
	* [r1108] doc/pcsc-lite.tex: the function SCardSetTimeout() is
	  deprecated and does nothing

2004-07-24  Ludovic Rousseau

	* [r1100] src/testpcsc.c: add a "(don't panic)" after a
	  "Transaction failed." if it is not a critical failure.

2004-07-22  Ludovic Rousseau

	* [r1099] src/readerfactory.c: RFBindFunctions(): replace the code
	  replication by macros definition and use (FctMap' fields were
	  renamed for this to be easy)
	* [r1098] src/ifdwrapper.c: use new FctMap' fields names
	* [r1097] src/readerfactory.h: rename some FctMap' fields so the
	  field name is the same as in the function name of V3.0 IFDHandler
	  API

2004-07-16  Ludovic Rousseau

	* [r1081] ChangeLog: release 1.2.9-beta5
	* [r1080] configure.in: 1.2.9-beta5

2004-07-08  Ludovic Rousseau

	* [r1041] libmusclecard/src/tokenfactory.c:
	  TPSearchBundlesForAtr(): use "%s/%s" insead of "%s%s" when
	  generating the MuscleCard bundle name on MacOSX

2004-07-06  Ludovic Rousseau

	* [r1040] src/PCSC/wintypes.h: add type LPSTR (again) so that "old"
	  drivers and applications can compile but mark it deprecated.
	  
	  See
	  http://gcc.gnu.org/onlinedocs/gcc-3.1/gcc/Type-Attributes.html
	* [r1039] doc/Makefile.am: 'make clean' also removes the LaTeX
	  temporary files
	* [r1038] doc/ifdhandler-3.tex: IFDHGetCapabilities(): document the
	  flags SCARD_ATTR_ATR_STRING and IOCTL_SMARTCARD_VENDOR_VERIFY_PIN
	* [r1037] src/winscard.c: SCardControl() (new API) can now be used
	  with a IFDHandler v2.0 or v3.0. The previous code was broken and
	  only worked with an IFDHandler v3.0 (crashed with a v2.0).
	* [r1036] src/PCSC/ifdhandler.h: IFDHControl(): use PUCHAR instead
	  of LPCVOID and LPVOID so the driver can use TxBuffer[x] without
	  needing a cast.
	* [r1035] src/PCSC/ifdhandler.h: it is now possible to compile a
	  IFDHandler v2.0 with this include file. Just #define IFDHANDLERv2
	  in your source code before #include <ifdhandler.h>
	  
	  By default it is setup for for most recent version of the API
	  (V3.0)
	* [r1034] src/ifdwrapper.c: IFDControl_v2() is supported by
	  IFD_HVERSION_2_0 drivers (not IFD_HVERSION_1_0)
	* [r1033] doc/pcsc-lite.bib: add an entry from pcsc-lite
	  documentation

2004-07-04  Damien Sauveron

	* [r1032] doc/pcsc-lite.tex: IFDHControl(): correct the types of
	  pbSendBuffer and pbRecvBuffer.

2004-07-03  Ludovic Rousseau

	* [r1031] doc/ifdhandler-3.tex: IFDHControl(): RxLength is a DWORD
	  not a PDWORD
	* [r1029] configure.in: 1.2.9-beta4
	* [r1028] ChangeLog: release 1.2.9-beta4
	* [r1027] src/libpcsclite.pc.in: add @PTHREAD_CFLAGS@ to Cflags:
	  and @PTHREAD_LIBS@ to Libs: so that the compiler and linker do
	  the "right" thing. Thanks to Ville Skytt� for the patch.
	* [r1026] libmusclecard/src/libmusclecard.pc.in: use "Requires:
	  libpcsclite = @VERSION@" instead of just "-lpcsclite" Thanks to
	  Ville Skytt� for the patch
	* [r1025] src/libpcsclite.pc.in: add /PCSC to includedir instead of
	  Cflags:
	* [r1024] libmusclecard/src/libmusclecard.pc.in: includedir is now
	  @includedir@/PCSC

2004-06-30  Ludovic Rousseau

	* [r983] ChangeLog: release 1.2.9-beta3

2004-06-29  Ludovic Rousseau

	* [r982] src/libpcsclite.pc.in: the include directory is now
	  ${includedir}/PCSC.
	  
	  If your application Makefile uses CFLAGS=`pkg-config libpcsclite
	  --cflags` you have nothing to change and the migration of the
	  include files in /usr/include/PCSC/ will be painless.
	* [r981] src/ifdwrapper.c: IFDControl_v2(): if the driver version
	  is != IFD_HVERSION_1_0 we _return_ SCARD_E_UNSUPPORTED_FEATURE
	  (not just set the return value)
	  
	  IFDControl(): if the driver version is < IFD_HVERSION_3_0 we
	  _return_ SCARD_E_UNSUPPORTED_FEATURE (not just set the return
	  value)
	* [r980] src/winscard.c: SCardReconnect(): if the reset fails it
	  may be either because: - the card is unresponsive
	  (SCARD_W_UNRESPONSIVE_CARD) or - no card is present
	  (SCARD_E_NO_SMARTCARD) and the SCardConnect() was successfull
	  with SCARD_SHARE_DIRECT (no need for a card)
	* [r979] src/winscard.c: in SCardConnect() and SCardReconnect(),
	  returns SCARD_W_UNRESPONSIVE_CARD if PHSetProtocol() fails with
	  SET_PROTOCOL_PPS_FAILED
	* [r978] src/prothandler.h: define the constant
	  SET_PROTOCOL_WRONG_ARGUMENT and SET_PROTOCOL_PPS_FAILED
	* [r977] src/prothandler.c: PHSetProtocol(): returns
	  SET_PROTOCOL_PPS_FAILED if IFDSetPTS() is supported but fails:
	  ISO 7816-3:1997 ch. 7.2 PPS protocol page 14 - If the PPS
	  exchange is unsuccessful, then the interface device shall either
	  reset or reject the card.

2004-06-25  Ludovic Rousseau

	* [r976] src/atrhandler.c: do not #undef ATR_DEBUG since it may be
	  defined in config.h with ./configure --enable-debugatr

2004-06-23  Ludovic Rousseau

	* [r974] src/PCSC/pcsclite.h.in: add definition of
	  SCARD_PROTOCOL_T15
	* [r973] src/atrhandler.c: - set SCARD_PROTOCOL_T15 in
	  CardCapabilities.AvailableProtocols if T=15 is defined (not yet
	  used) - in specific mode CardCapabilities.AvailableProtocols
	  shall also be set the the specified protocol

2004-06-22  Ludovic Rousseau

	* [r968] src/winscard_clnt.c: remove the hack introduced in version
	  1.28. It is no more needed since the changes in version 1.32 of
	  winscard.c
	* [r967] src/prothandler.c: PHSetProtocol(): only try to use
	  protocols that are available

2004-06-21  Ludovic Rousseau

	* [r963] src/atrhandler.c, src/dyn_hpux.c, src/dyn_unix.c,
	  src/ifdwrapper.c, src/readerfactory.c, src/winscard.c,
	  src/winscard_clnt.c: local variables reorganisations: - remove
	  unused variables - remove useless initialisations - move
	  declaration in the inner block the variable is used

2004-06-18  Ludovic Rousseau

	* [r962] src/winscard.c: rewrite the parts managing the protocol in
	  SCardConnect() and SCardReconnect() to use the new
	  PHSetProtocol() prototype and simplify the code
	* [r961] src/prothandler.c, src/prothandler.h: PHSetProtocol(): -
	  add a ucDefault argument as the default protocol to use -
	  completely redesign the function so that IFDSetPTS() is always
	  called to tell the driver which protocol to use and to initialise
	  its internal state
	* [r960] src/winscard.c: the protocol number in the "Send
	  Protocol:" debug message was wrong
	* [r959] src/eventhandler.c, src/prothandler.c,
	  src/readerfactory.c, src/winscard.c: update the code to use the
	  new READER_CONTEXT structure with the struct pubReaderStatesList
	  *readerState field
	* [r958] src/readerfactory.h: in the structure READER_CONTEXT
	  remove: UCHAR ucAtr[MAX_ATR_SIZE]; DWORD dwAtrLen; DWORD
	  dwProtocol; DWORD dwStatus; DWORD dwPublicID; and replace them by
	  a link to the reader structure: struct pubReaderStatesList
	  *readerState;
	  
	  The fields (ATR, procotol, state) were duplicated in both
	  structures PREADER_STATE and READER_CONTEXT. It was useless and
	  misleading.
	  
	  It was uneasy to change the ATR or the card protocol after the
	  card was powered on. A protocol change may occur if the card
	  supports both T=0 and T=1 and the SCardConnect() does not select
	  the default protocol.
	* [r957] src/ifdwrapper.c, src/ifdwrapper.h: in IFDStatusICC() the
	  argument pdwProtocol was set as: *pdwProtocol =
	  rContext->dwProtocol; and rContext was an input argument.
	  
	  So IFDStatusICC() had _no_ action on pdwProtocol expect make a
	  copy form an IN parameter to an OUT parameter. This was useless
	  and misleading. PDWORD pdwProtocol is now removed.
	* [r956] src/README_INTERNALS.txt: add a chapter "Memory
	  structures"

2004-06-17  Ludovic Rousseau

	* [r955] src/eventhandler.h: put back the structure name
	* [r954] src/pcscdaemon.c, src/readerfactory.c,
	  src/readerfactory.h: do not use a dwAllocNum argument in
	  RFAllocateReaderSpace() since the number of contexts is _fixed_
	  by the declaration of sReadersContexts[].
	  
	  It may be interpreted as a (false) possibility of dynamicity and
	  will then cause a buffer overflow if dwAllocNum >
	  PCSCLITE_MAX_READERS_CONTEXTS
	* [r953] src/ifdwrapper.c, src/readerfactory.c: psFunctions.pvf*
	  fields are function pointers so NULL is more appropriate than 0
	* [r952] src/readerfactory.c: correct a bug introduced in version
	  1.47 that occurs if a reader is muti-slot and no more
	  sReadersContexts[] entries are available: RFRemoveReader() was
	  called with a NULL lpcReader
	* [r951] src/readerfactory.c: move declaration of dwContextB in the
	  block it is used
	* [r950] src/readerfactory.c: move the lpcStripReader[] declaration
	  in the block it is used.
	* [r949] src/eventhandler.c, src/eventhandler.h,
	  src/winscard_clnt.c, src/winscard_scf.c: rename the structure
	  READER_STATES in READER_STATE (singular) since the structure
	  stores only the state of ONE reader
	* [r948] src/PCSC/sys_generic.h, src/PCSC/thread_generic.h,
	  src/eventhandler.c, src/eventhandler.h, src/hotplug_libusb.c,
	  src/hotplug_linux.c, src/pcscdaemon.c, src/powermgt_generic.c,
	  src/powermgt_generic.h, src/sys_unix.c, src/thread_unix.c,
	  src/tokenparser.l, src/winscard_msg.h, src/winscard_scf.c,
	  src/winscard_svc.c, src/winscard_svc.h: correct foobar();
	  prototypes in foobar(void);
	* [r947] src/readerfactory.c, src/readerfactory.h: complete the
	  prototypes of RFSuspendAllReaders() and RFAwakeAllReaders()
	* [r946] src/readerfactory.h: psCapabilites and psProtOptions
	  fields are not used in struct ReaderContext so "#if 0" them

2004-06-16  Ludovic Rousseau

	* [r945] src/prothandler.c: PHSetProtocol() correctly return the
	  selected protocol
	* [r944] src/winscard.c: print the Send Protocol in T=? format
	  instead of internal representation value.

2004-06-15  Ludovic Rousseau

	* [r943] src/winscard.c: improve my previous patch: correctly print
	  an unknown Active Protocol if it happens
	* [r942] ., .cvsignore: add ChangeLog.cvs
	* [r941] src/winscard.c: print the "real" active protocol in the
	  format T=? instead of the internal representation of that value
	  (T=0 is coded as 1)

2004-06-11  Ludovic Rousseau

	* [r939] configure.in: 1.2.9-beta3
	* [r938] Makefile.am: ChangeLog.cvs is not a .PHONY target but a
	  real file
	* [r937] doc/ifdhandler-3.tex: - add documentation for
	  LTPBundleFindValueWithKey, debug_msg and debug_xxd - ifdhandler.h
	  moved in PCSC/ifdhandler.h

2004-06-10  Ludovic Rousseau

	* [r936] m4/acx_pthread.m4: version 1.9 to add support of GNU Pth
	  (http://www.gnu.org/software/pth/)
	* [r935] src, src/.cvsignore, src/PCSC, src/PCSC/.cvsignore:
	  pcsclite.h moved from src/ to src/PCSC/
	* [r934] libmusclecard/src/PCSC/mscdefines.h,
	  libmusclecard/src/PCSC/musclecard.h, src/PCSC/pcsclite.h.in,
	  src/PCSC/winscard.h: simplify: #if defined(__APPLE__) #include
	  <PCSC/wintypes.h> #else #include <wintypes.h> #endif since we now
	  use PCSC/ for all Unix platforms
	* [r933] src/PCSC/ifdhandler.h: include PCSC/pcsclite.h instead of
	  pcsclite.h
	* [r932] configure.in, src/Makefile.am: src/pcsclite.h moved in
	  src/PCSC/pcsclite.h
	* [r931] doc/example/pcsc_demo.c, libmusclecard/src/musclecard.c,
	  libmusclecard/src/muscletest.c, libmusclecard/src/tokenfactory.c,
	  libmusclecard/src/tokenfactory.h,
	  libmusclecard/utils/bundleTool/bundleTool.c, src/atrhandler.c,
	  src/configfile.l, src/debuglog.c, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/eventhandler.c,
	  src/hotplug_generic.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/ifdwrapper.c, src/pcscdaemon.c,
	  src/powermgt_generic.c, src/powermgt_macosx.c, src/prothandler.c,
	  src/readerfactory.c, src/sys_unix.c, src/testpcsc.c,
	  src/thread_unix.c, src/tokenparser.l, src/utils/formaticc.c,
	  src/utils/installifd.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_scf.c, src/winscard_svc.c: use
	  the new PCSC/ location for header files
	* [r930] src/Makefile.am: install the exported header files in
	  ../include/PCSC/ to avoid name polution in ../include/ also
	  install parser.h
	* [r929] src/PCSC/pcsclite.h.in: use /* */ instead of // for
	  comments
	* [r928] src/readerfactory.c: rework RFSetReaderName() to simply
	  the code and always start with the lowest number available (like
	  in previous pcsc-lite version)

2004-06-09  Ludovic Rousseau

	* [r926] src/hotplug_libusb.c: use a dynamic array for available
	  USB drivers: - avoid a buffer overflow (argh!) - allow to use
	  more than 16 drivers/supported readers
	* [r925] doc/example/pcsc_demo.c: replace SCARD_PROTOCOL_ANY by
	  SCARD_PROTOCOL_T0 | SCARD_PROTOCOL_T1 since SCARD_PROTOCOL_ANY is
	  _not_ defined by Microsoft PC/SC and is not equals to
	  SCARD_PROTOCOL_T0 | SCARD_PROTOCOL_T1
	  
	  SCARD_PROTOCOL_ANY is deprecated and should not be used!
	* [r924] src/prothandler.c: improve debug messages and comments
	* [r923] src/winscard.c: remove useless ' ' at the end of some
	  lines
	* [r922] src/atrhandler.c: - add support of specific mode by the
	  presence of TA2 (protocol not negociable) - improve debug
	  messages
	* [r921] src/atrhandler.c: code reindentation and remove useless
	  blank and { } lines
	* [r920] src/atrhandler.c: make debug messages work when ATR_DEBUG
	  is set

2004-06-08  Ludovic Rousseau

	* [r919] src/PCSC/ifdhandler.h: add #include <pcsclite.h>

2004-06-07  Ludovic Rousseau

	* [r918] src/thread_unix.c: remove two unused #define
	* [r917] configure.in: a lexer library (lex or flex) is mandatory
	  to parse /etc/reader.conf so exit ./configure if none is found
	* [r916] configure.in, src/Makefile.am: the libpcsclite library
	  does not compile and work without a thread library even with
	  --disable-threadsafe

2004-06-05  Damien Sauveron

	* [r915] src/utils/formaticc.c: Change the names of the types
	  LPCSTR to LPCTSTR and LPSTR to LPTSTR to be compliant with the
	  Microsoft SCard API
	* [r914] src/tokenparser.l: Add the include needed <errno.h>
	* [r913] src/winscard_scf.c: Add a note about 2 unused functions in
	  the SCF part.
	* [r912] doc/example/pcsc_demo.c, doc/pcsc-lite.tex,
	  src/PCSC/ifdhandler.h, src/PCSC/winscard.h, src/PCSC/wintypes.h,
	  src/eventhandler.c, src/ifdwrapper.c, src/readerfactory.c,
	  src/readerfactory.h, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_scf.c: Change the names of the types LPCSTR to
	  LPCTSTR and LPSTR to LPTSTR to be compliant with the Microsoft
	  SCard API
	* [r911] src/winscard_clnt.c: Add the two inline in the
	  declarations to avoid warning

2004-05-30  Ludovic Rousseau

	* [r909] src/tokenparser.l: display the error message (errno) if
	  the bundle file cannot be opened

2004-05-26  Ludovic Rousseau

	* [r908] src/winscard_clnt.c: declare internal only function as
	  "static" (and two one-line functions as "inline")
	* [r907] src/PCSC/thread_generic.h, src/eventhandler.c,
	  src/hotplug_libusb.c, src/winscard_svc.c: add a ' ' argument in
	  PCSCLITE_THREAD_FUNCTION( ) so that old gcc (gcc-2.95) does not
	  comply with "macro `PCSCLITE_THREAD_FUNCTION' used without args"
	  any more.
	* [r902] doc/pcsc-lite.tex: add "Some SCardControl commands"
	  section (IFD_EXCHANGE and VERIFY_PIN)
	* [r901] doc/pcsc-lite.bib: add CCID spec reference

2004-05-25  Ludovic Rousseau

	* [r899] doc/example/pcsc_demo.c: signedness issue detected by gcc
	  -pedantic
	* [r898] src/thread_unix.c: remove useless { } and simplify the
	  code
	* [r897] libmusclecard/src/muscletest.c, src/PCSC/debuglog.h,
	  src/PCSC/thread_generic.h, src/debuglog.c, src/dyn_macosx.c,
	  src/eventhandler.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/powermgt_macosx.c, src/testpcsc.c,
	  src/thread_unix.c, src/utils/formaticc.c, src/winscard_msg.c,
	  src/winscard_svc.c: recompile using -pedantic and correct lots of
	  cast "problems"

2004-05-24  Ludovic Rousseau

	* [r884] src/configfile.l: - allow ':' in DEVICENAME - use ':' to
	  indicate a non-real device (do not test for its existence as a
	  file). You can use this in something like "net://1.2.3.4/foobar"
	  to indicate a reader on a remote machine like an X11 terminal.

2004-05-19  Ludovic Rousseau

	* [r883] doc/pcsc-lite.tex: for SCardConnect() -
	  dwPreferredProtocols is a bit mask of acceptable protocols -
	  SCARD_SHARE_DIRECT can be used to talk to the reader without a
	  card inserted

2004-05-13  Ludovic Rousseau

	* [r870] doc/example/Makefile.am: do not install pcsc_demo since it
	  is just a sample code for developpers that is not supposed (the
	  code) to do anything useful
	* [r869] ., .cvsignore: ignore autom4te.cache directory
	* [r868] src, src/.cvsignore: ignore pcsclite.h since it is
	  generated from pcsclite.h.in
	* [r867] ChangeLog, DRIVERS, README, SECURITY, doc/formaticc.1,
	  doc/pcsc-lite.tex, doc/pcscd.8.in, doc/reader.conf.5.in,
	  etc/SmartcardServices, etc/StartupParameters.plist,
	  etc/pcscd.startup, src/README_INTERNALS.txt: Typos. thanks to
	  Ville Skytt� for the patches
	* [r866] src/Makefile.am: install ifdhandler.h so drivers can use
	  it for compilation. Patch by Ville Skytt�

2004-05-12  Ludovic Rousseau

	* [r865] etc/Makefile.am: remove reader.conf from EXTRA_DIST since
	  it is already in sysconf_DATA
	* [r864] etc/reader.conf.in: comment the configuration lines since
	  they are not valid and will prevent the start of pcscd if they
	  are not modified
	* [r859] configure.in: use the modern form for AC_INIT() instead of
	  the deprecated one.
	* [r858] src/PCSC/pcsclite.h.in: use @VERSION@ for
	  PCSCLITE_VERSION_NUMBER instead of a manual value. Thanks to
	  Damien Sauveron for the idea.
	* [r857] src/utils/Makefile.am: install bundleTool and installifd
	  in ../sbin/ instead of ../bin/

2004-05-11  Ludovic Rousseau

	* [r855] ChangeLog: release 1.2.9-beta2
	* [r854] configure.in, src/PCSC/pcsclite.h.in: beta2 version
	* [r853] src/Makefile.am: change libmusclecard current version to 1
	  so that old libmusclecard0 and new libmusclecard1 can cohabitate
	  on the same system and will not break existing programs during
	  upgrades.
	  
	  This is because libmusclecard is provided in the same
	  distrib/package as libpcsclite. If we want two libpcsclite to
	  cohabitate we must also ensure that the two libmusclecard can
	  also cohabitate.
	* [r852] doc/Makefile.am: generate local icons for the latex2html
	  generated pages
	* [r851] DRIVERS: add a / at the end of URLs and directory names
	* [r850] src/pcscdaemon.c: print pcsc-lite version number during
	  startup

2004-05-10  Ludovic Rousseau

	* [r849] src/Makefile.am: install pcsclite.h instead of
	  pcsclite.h.in
	* [r848] doc/pcsc-lite.tex: add the chapter "Multithreading and
	  contexts"
	* [r847] doc, doc/.cvsignore: ignore ifdhandler-3 temporary files
	* [r846] doc/pcscd.8.in: some rewrite
	* [r845] doc/formaticc.1: caracters -> characters
	* [r844] libmusclecard/utils/bundleTool/bundleTool.8.in,
	  libmusclecard/utils/bundleTool/bundleTool.c: approprate ->
	  appropriate
	* [r843] ChangeLog, HELP, NEWS, README, configure.in,
	  doc/formaticc.1, doc/pcsc-lite.tex, doc/pcscd.8.in,
	  etc/SmartcardServices, etc/StartupParameters.plist,
	  libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/muscletest.c,
	  libmusclecard/utils/bundleTool/bundleTool.8.in, src/debuglog.c,
	  src/utils/formaticc.c: smartcard -> smart card, musclecard ->
	  MuscleCard
	* [r842] doc/Makefile.am: add ifdhandler-3.tex ifdhandler-3.pdf
	* [r841] doc/ifdhandler-3.tex: IFD Handler API in LaTeX format
	* [r839] src/winscard.c: in SCardReconnect(), SCardDisconnect() and
	  SCardEndTransaction() SCARD_UNPOWER_CARD is "Power down the card
	  and reset it (Cold Reset)" so we really power down _and_ then
	  power up the card.

2004-05-07  Ludovic Rousseau

	* [r838] configure.in: the comment for --enable-extendedapdu was
	  wrong. The maximum APDU size is 32KB and not 128KB. Thanks to
	  Damien Sauveron.

2004-05-06  Ludovic Rousseau

	* [r834] ChangeLog: release 1.2.9-beta1
	* [r833] configure.in, src/PCSC/pcsclite.h.in: version 1.2.9-beta1
	* [r832] src/ifdwrapper.c: in IFDControl_v2 and IFDControl test the
	  ifd handler version and possibly return before the critical
	  section (mutex)
	* [r831] src/ifdwrapper.c: in IFDControl_v2() and IFDControl(), do
	  not return between SYS_MutexLock and SYS_MutexUnLock but set rv
	  to the correct value. Otherwise the daemon is dead locked.
	* [r830] src/hotplug_generic.c, src/hotplug_macosx.c: add an empty
	  HPStopHotPluggables() function
	* [r829] libmusclecard/src/muscletest.c: use the local pcsclite.h
	  instead of the (old) one already installed
	  
	  This was problematic for MacOSX since winscard.h wanted to
	  include <PCSC/pcsclite.h> which is the old and incompatible one.
	* [r828] configure.in, src/Makefile.am, src/PCSC/pcsclite.h.in: add
	  support of --enable-extendedapdu argument to allow the use of big
	  APDUs (up to 128 KBytes)
	* [r827] src/winscard_msg.c: minor reindentations
	* [r826] src/winscard_svc.c: in SCardSetAttrib() the cbAttrLen is a
	  DWORD and not a LPDWORD so use gsStr->cbAttrLen instead of
	  &gsStr->cbAttrLen. Bad cut-n-paste here!

2004-05-03  Ludovic Rousseau

	* [r823] src/readerfactory.c: - rename dwFeeds and dwMutex to
	  pdwFeeds and pdwMutex since they are pointers - add a check to
	  avoid removing an aleady removed driver (closes bug [ #300684 ]
	  pcscd segfaults on 'if (*sContext->dwMutex == 1)')
	* [r822] src/readerfactory.h: rename dwFeeds and dwMutex to
	  pdwFeeds and pdwMutex since they are pointers

2004-04-27  Ludovic Rousseau

	* [r821] doc/pcsc-lite.tex: patch from Damien Sauveron to rectify
	  the source code examples.

2004-04-21  Ludovic Rousseau

	* [r820] doc/Makefile.am: do not stop if pcsc-lite does not exist
	  and is removed
	* [r819] doc/Makefile.am: distribute pcsc-lite.tex
	* [r818] doc/pcsc-lite.tex: - SCardControl new API - add
	  SCardGetAttrib()/SCardSetAttrib()
	* [r817] libmusclecard/src/tokenfactory.c, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/eventhandler.c,
	  src/pcscdaemon.c, src/powermgt_macosx.c, src/prothandler.c,
	  src/readerfactory.c, src/sys_unix.c, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_svc.c:
	  remove the function names from the debug messages
	* [r816] src/PCSC/debuglog.h: add __FUNCTION__ in the debug
	  messages

2004-04-19  Damien Sauveron

	* [r815] src/pcscdaemon.c: Typo in email address.

2004-04-19  Ludovic Rousseau

	* [r814] src/pcscdaemon.c: update copyright date
	* [r813] src/PCSC/pcsclite.h.in: add SCARD_ATTR_* tags for
	  SCardGetAttrib()
	* [r812] src/ifdwrapper.c: RxBuffer argument of IFDControl is
	  LPVOID and not LPCVOID
	* [r811] src/PCSC/ifdhandler.h: FDHControl() argument lpInBuffer
	  and lpOutBuffer are LPCVOID and LPVOID and not PUCHAR
	* [r810] src/testpcsc.c: add test for SCardSetAttrib()
	* [r809] src/PCSC/winscard.h, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.h, src/winscard_svc.c: add support for
	  SCardGetAttrib() and SCardSetAttrib()
	* [r803] src/testpcsc.c: do not ask for reader number if only one
	  reader is present
	* [r802] src/testpcsc.c: remove useless REPEAT_TEST conditional
	  code
	* [r801] src/testpcsc.c: test SCardGetAttrib()
	* [r800] src/ifdwrapper.h: lpOutBuffer argument is LPVOID not
	  LPCVOID in IFDControl

2004-04-16  Ludovic Rousseau

	* [r799] src/testpcsc.c: do not SCardReleaseContext() in case of
	  error in SCardControl test
	* [r798] src/PCSC/winscard.h, src/ifdwrapper.c, src/ifdwrapper.h,
	  src/winscard.c, src/winscard_clnt.c, src/winscard_msg.h,
	  src/winscard_svc.c: add support of the new IFDHControl() API
	* [r797] src/testpcsc.c: add a test for SCardControl()
	* [r796] src/PCSC/ifdhandler.h: rename IFDHControl() to
	  IFDHControl_v2() and add a new IFDHControl() with the new API

2004-04-15  Ludovic Rousseau

	* [r793] src/ifdwrapper.c: remove implicit/useless { }
	* [r792] src/README_INTERNALS.txt: document the SCardControl
	  migration
	* [r791] src/winscard_clnt.c, src/winscard_msg.h,
	  src/winscard_svc.c: pcscd and libpcsclite now exchange a protocol
	  version to know what API to use
	* [r790] src/Makefile.am: change library version to 1:0:0 since the
	  interface changed
	* [r789] doc, doc/.cvsignore: ignore LaTeX temporary files
	* [r788] doc/pcsc-lite.bib: bibliography in BibTeX format
	* [r787] doc/Makefile.am: - generate .pdf from .tex - distribute
	  the generated pcsc-lite.pdf
	* [r786] doc/pcsc-lite-0.8.7.pdf, doc/pcsc-lite.tex: the pcsc-lite
	  pdf documentation is now generated from a LaTeX document

2004-04-14  Ludovic Rousseau

	* [r785] src/pcscdaemon.c: document in the help text that
	  '--foreground' imply '--debug stderr'
	* [r784] src/winscard_msg.h: add a dummy field (to replace
	  request_id) in sharedSegmentMsg to have the same structure size
	  as in previous pcsc-lite versions so that a new pcscd can talk to
	  an old libpcsclite and vice-versa.
	* [r783] src/debuglog.c: add a default case in
	  pcsc_stringify_error()

2004-04-13  Ludovic Rousseau

	* [r782] src/testpcsc.c: test SCardListReaderGroups()

2004-04-06  Ludovic Rousseau

	* [r767] src/winscard.c: remove the code to map SCARD_UNPOWER_CARD
	  on IFD_RESET. SCARD_UNPOWER_CARD is power down and power up (cold
	  reset) => IFD_POWER_DOWN SCARD_RESET_CARD is just power up (warm
	  reset) => IFD_RESET

2004-04-05  Ludovic Rousseau

	* [r765] doc/example/pcsc_demo.c: initialize readers to NULL to
	  avoid a "`readers' might be used uninitialized" compilation
	  warning

2004-04-02  Ludovic Rousseau

	* [r761] configure.in, doc/Makefile.am: add support for
	  doc/reader.conf.5
	* [r760] doc/reader.conf.5.in: new manpage
	* [r759] libmusclecard/utils/bundleTool/bundleTool.8.in: typos
	* [r758] doc/example/pcsc_demo.c: add two missing free()

2004-04-01  Ludovic Rousseau

	* [r757] src/hotplug_libusb.c: do not try to restart a USB driver
	  if the first execution fails (because of a bug in the driver or
	  whatever) since the next execution of the driver will, with a
	  great probability, also fail. The user has to unplug/replug the
	  reader to restart the driver. This prevents to fill the system
	  logs with an error message every 1 second.
	* [r756] doc/example/pcsc_demo.c: remove a useless occurence of
	  PCSCLITE_MAX_READERS_CONTEXTS

2004-03-31  Ludovic Rousseau

	* [r754] src/readerfactory.c: use sizeof(lpcStripReader) instead of
	  MAX_READERNAME
	* [r753] libmusclecard/src/muscletest.c: also print tokenType field
	  as a number and string
	* [r752] libmusclecard/src/musclecard.c: Initialize
	  currentToken->tokenType in MSCListTokens(). Closes "[ #300607 ]
	  MSCListTokens should set tokenType to know state before OR
	  operation"
	* [r751] libmusclecard/src/musclecard.c: replace some 0 bu NULL for
	  pointers
	* [r750] libmusclecard/src/muscletest.c: - replace 0 by NULL -
	  remove some { } for one line blocks
	* [r749] doc/example/pcsc_demo.c: recode the readers enumeration to
	  avoid the use of PCSCLITE_MAX_READERS_CONTEXTS
	* [r748] libmusclecard/src/PCSC/mscdefines.h: use SCARDCONTEXT and
	  SCARDHANDLE instead of MSCLong32
	* [r747] src/PCSC/winscard.h: use SCARDCONTEXT, DWORD,
	  LPSCARDHANDLE, etc. instead of long, unsigned long, long *, etc.
	  to be more Windows PC/SC compliant
	* [r746] src/winscard_clnt.c: remove two "by najam" comments
	* [r745] src/PCSC/pcsclite.h.in: use MAX_ATR_SIZE instead of 33 in
	  the declaration of SCARD_READERSTATE_A
	* [r744] src/PCSC/pcsclite.h.in: proposed patch: define
	  PCSCLITE_MAX_READERS with a deprecated attribute

2004-03-30  Ludovic Rousseau

	* [r743] src/pcscdaemon.c: remove the warning if no
	  /etc/reader.conf is found. It is normal to not have an
	  /etc/reader.conf for USB readers only.
	* [r742] src/configfile.l: print a warning if the LIBPATH contains
	  ".bundle". USB drivers SHOULD NOT be declared in reader.conf
	* [r741] src/configfile.l: add strerror(errno) in the error
	  message.
	* [r740] src/configfile.l: use NULL instead of 0
	* [r739] src/configfile.l: code reindentation
	* [r735] etc, etc/.cvsignore: remove etc/ from filename
	* [r734] ., .cvsignore: remove PCSC/ from filenames
	* [r733] ., .cvsignore: files to ignore by CVS

2004-03-28  Ludovic Rousseau

	* [r732] src/readerfactory.c: simplify a bit an hex->decimal
	  conversion
	* [r731] src/readerfactory.c: left shift one bloc of code that was
	  in a isolated { }
	* [r730] src/readerfactory.c: remove { } for one instruction if ()
	  blocs
	* [r729] src/readerfactory.c: use a direct "DWORD
	  dwNumReadersContexts" instead of an indirect "DWORD
	  *dwNumReadersContexts". This will remove bugs like the one at
	  line 90: "if (dwNumReadersContexts != 0)" is not "if
	  (*dwNumReadersContexts != 0)"

2004-03-24  Ludovic Rousseau

	* [r728] libmusclecard/src/tokenfactory.c: correct atrString[]
	  buffer size. The ATR is in ASCII so it must be MAX_ATR_SIZE*2 +1

2004-03-23  Ludovic Rousseau

	* [r727] src/hotplug_libusb.c: add void argument in
	  HPStopHotPluggables()
	* [r726] src/readerfactory.c: initialize vHandle field to NULL in
	  RFAllocateReaderSpace() (caused a crash under MacOS X)
	* [r725] src/pcscdaemon.c: add the errno text message if specified
	  reader.conf file is not found
	* [r724] src/pcscdaemon.c: use PCSCLITE_READER_CONFIG instead of
	  reader.conf in debug message

2004-03-20  Ludovic Rousseau

	* [r721] src/hotplug_linux.c: add support for HPStopHotPluggables()

2004-03-19  Ludovic Rousseau

	* [r720] doc, doc/.cvsignore, doc/example, doc/example/.cvsignore,
	  etc, etc/.cvsignore, m4, m4/.cvsignore, src, src/.cvsignore,
	  src/utils, src/utils/.cvsignore, win32, win32/.cvsignore: new
	  files to ignore files not in CVS
	* [r719] src/winscard.c: really reset the card when asked to in
	  SCardReconnect()
	* [r718] src/winscard_clnt.c: This is hack to allow a change of ATR
	  at Reconnect without physically changing the card. This should
	  not happen in real life so should not be problematic and so is
	  active by default (ATR_CHANGE_AT_RECONNECT).
	* [r717] src/winscard_clnt.c: remove duplicated SYS_MutexUnLock()
	  in SCardStatus()

2004-03-18  Ludovic Rousseau

	* [r715] src/pcscdaemon.c: call HPStopHotPluggables() before
	  stopping the drivers to avoid a new reader detection/start by
	  hotplug when we want to stop everything
	* [r714] src/hotplug.h, src/hotplug_libusb.c: add
	  HPStopHotPluggables() to exit the hotplug thread
	* [r713] src/pcscdaemon.c: set AraKiri to TRUE instead of 1
	* [r712] doc/example/pcsc_demo.c: - add SCardReconnect() sample
	  code - allow to select the reader number instead of selecting
	  always the first one

2004-03-11  Ludovic Rousseau

	* [r711] src/PCSC/pcsclite.h.in: version 1.2.1

2004-03-02  Ludovic Rousseau

	* [r710] configure.in: version 1.2.1

2004-02-23  Ludovic Rousseau

	* [r705] src/hotplug_libusb.c: use deviceName defined as
	  usb:idVendor/idProduct:libusb:busname:filename in
	  HPAddHotPluggable(). This should avoid wrong USB enumeration when
	  used in IFDHCreateChannelByName()

2004-02-11  Ludovic Rousseau

	* [r684] ChangeLog: merge 1.2.0 final branch

2004-02-04  Ludovic Rousseau

	* [r675] src/hotplug_linux.c: DIR in --enable-usbdropdir=DIR may
	  not finish by / in (deprecated) hotplug_linux.c

2004-01-24  Ludovic Rousseau

	* [r646] etc/reader.conf.in: use "DEVICENAME
	  /dev/ttySx_not_configured" to make it (more) clear it should be
	  configured.
	* [r645] etc/reader.conf.in: reader.conf may also be needed for
	  PCMCIA readers and not olny serial.

2004-01-23  Ludovic Rousseau

	* [r644] etc/reader.conf.in: add a note: "This file has to be
	  configured for serial readers only."
	* [r643] src/winscard_clnt.c: check that
	  psContextMap[dwContextIndex].psChannelMap[dwChannelIndex].readerName
	  is non NULL before accessing it in strcmp()

2004-01-22  Antti Tapaninen

	* [r642] src/winscard_clnt.c, src/winscard_svc.c: - Simplify the
	  psContext/psContextMap declarations to fix build conflicts
	  against some operating systems headers.

2004-01-21  David Corcoran

	* [r639] src/debuglog.c: Changed unsigned char * to char * and did
	  some typecasting to get rid of warnings when building in 64bit
	  mode ...

2004-01-21  Damien Sauveron

	* [r638] src/thread_unix.c: Remove an useless include

2004-01-20  Ludovic Rousseau

	* [r637] src/hotplug_linux.c, src/hotplug_macosx.c: correct comment
	  about empty deviceName argument

2004-01-19  Damien Sauveron

	* [r636] src/ifdwrapper.c: Use the device name to create channel
	  only if defined.
	* [r635] src/hotplug_linux.c, src/hotplug_macosx.c: Add an empty
	  parameter for deviceName to allow the compilation.
	* [r634] src/winscard_msg.c: Remove the useless include of
	  sys/mman.h

2004-01-18  Damien Sauveron

	* [r633] src/debuglog.c: Remove unused function.

2004-01-16  Damien Sauveron

	* [r632] src/PCSC/ifdhandler.h, src/PCSC/thread_generic.h,
	  src/configfile.l, src/hotplug_libusb.c, src/ifdwrapper.c,
	  src/ifdwrapper.h, src/readerfactory.c, src/thread_unix.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_msg.h,
	  src/winscard_svc.c, src/winscard_svc.h: Update the copyright.
	* [r631] src/pcscdaemon.c: Add my name, my email and the copyright.
	* [r630] src/winscard_clnt.c: Remove the useless PID information
	  field. Also remove the WrapSHMWrite argument related to PID
	  information.
	* [r629] src/winscard_msg.c: Remove an useless information field of
	  the messages sent by the client to the server. Also remove in the
	  prototype of WrapSHMWrite the parameter related to the deleted
	  field.
	* [r628] src/winscard_msg.h: Remove a useless information field of
	  the messages sent by the client to the server. Also remove in the
	  prototype of WrapSHMWrite the parameter related to the deleted
	  field.
	* [r627] src/readerfactory.c: Correct the indentation of some lines
	  and add debug information.
	* [r626] src/winscard_svc.c: Cleanup the code.
	* [r625] src/powermgt_macosx.c: Modify the output of the debug
	  message.

2004-01-15  David Corcoran

	* [r624] src/utils/sample.in: Changed Co to C(ZERO) instead. The Oh
	  caused big problems with formaticc
	* [r623] src/testpcsc.c: Needed to define dwAtrLen so it would not
	  just pick up garbage for SCardStatus.
	* [r622] src/winscard_clnt.c: In SCardStatus some of the memcopy's
	  and strcpy's were occurring before bounds checking.
	* [r621] src/winscard_clnt.c: Changed error return from
	  SYS_OpenFile of PCSCLITE_PUBSHM_FILE from UNKNOWN to
	  SCARD_E_NO_SERVICE. Sorry for no diffs, I'll put them in next
	  time ...

2004-01-14  Ludovic Rousseau

	* [r605] AUTHORS: reformat and add Damien Sauveron and Antti
	  Tapaninen

2004-01-14  Damien Sauveron

	* [r604] src/ifdwrapper.c, src/readerfactory.c: Add the support of
	  IFDHandler interface v3
	* [r603] src/ifdwrapper.h: Modify the prototype of IFDOpenIFD.
	* [r602] src/readerfactory.h: Add the function's pointer for the
	  new function introduced in IFDHandler interface v3
	* [r601] src/PCSC/pcsclite.h.in: Define the length maximum of a
	  device name.
	* [r600] src/hotplug_libusb.c: Get the device name of the USB
	  device and give it to RFAddReader.
	* [r599] src/configfile.l: Give the device name to RFAddReader
	* [r598] src/readerfactory.h: Add a new parameter to the prototype
	  of RFAddReader according to the changes in readerfactory.c
	* [r597] src/readerfactory.c: Add a new parameter to RFAddReader to
	  get the device name
	* [r596] src/readerfactory.h: Add the device name
	* [r595] src/PCSC/ifdhandler.h: Add the prototype of the new
	  function introduced in the IFDHandler interface v3
	* [r594] src/configfile.l: Remove a line commited by error. Sorry.
	* [r593] src/configfile.l: Check that DEVICENAME and LIBPATH files
	  exist and if an error occurs during the parsing the reader is not
	  added.

2004-01-13  Ludovic Rousseau

	* [r592] src/hotplug_macosx.c: small code reorganisation for an
	  easier reading
	* [r591] src/configfile.l: use macro DebugLogB() instead of
	  debug_msg()

2004-01-13  Damien Sauveron

	* [r590] src/ifdwrapper.c, src/readerfactory.c: Modify tests in
	  order to be homogeneous with those for next IFDHandlers versions

2004-01-13  Ludovic Rousseau

	* [r589] Makefile.am: simplify the perl expression in ChangeLog.cvs
	  rule
	* [r588] make-dirs/README: reformat to 72 columns

2004-01-12  David Corcoran

	* [r587] make-dirs/Makefile.solaris, make-dirs/README,
	  make-dirs/config.h: Added README for Makefile directory and
	  sample config.h
	* [r586] make-dirs, make-dirs/Makefile.solaris: C Adding make-dirs
	  plus Makefiles for certain configurations when people don't want
	  to try and fix autoconf
	  
	  VS:
	  ----------------------------------------------------------------------

2004-01-12  Ludovic Rousseau

	* [r585] src/hotplug_libusb.c: correct the file header. It was a
	  cut-n-paste from hotplug_linux.c

2004-01-08  Ludovic Rousseau

	* [r583] src/hotplug_macosx.c: buffer overflow: the driver list was
	  not terminated and caused crashes.
	* [r582] src/pcscdaemon.c: correct my email address

2003-12-16  Ludovic Rousseau

	* [r577] src/winscard_svc.c: code reordering to make it a bit more
	  clear

2003-12-16  Damien Sauveron

	* [r576] src/winscard_msg.h, src/winscard_svc.h: Remove the old
	  functions and add the new functions
	* [r575] src/winscard_msg.c: Set up the new functions needed by the
	  thread handling the client connection/disconnection and needed by
	  the thread handling the requests in a context
	* [r574] src/winscard_svc.c: Design to handle all the requests in
	  the context
	* [r573] src/pcscdaemon.c: Change the design of pcscdaemon. It gets
	  the connection/disconnection from the client to the server
	  (create/destroy a context), creates a new thread and then this
	  thread will manage all the requests for this context
	* [r572] src/winscard_clnt.c: Add mutex for each context and remove
	  the global mutex except for some operations
	* [r571] src/PCSC/thread_generic.h, src/thread_unix.c: Add
	  functions for identify and compare threads

2003-12-11  David Corcoran

	* [r567] src/winscard_scf.c: Index: winscard_scf.c
	  ===================================================================
	  RCS file: /cvsroot/pcsclite/PCSC/src/winscard_scf.c,v retrieving
	  revision 1.8 diff -r1.8 winscard_scf.c 52c52 < BYTE bufferLength;
	  --- > LONG bufferLength;
	  
	  The byte buffer length would break any APDU over 255 bytes.

2003-12-08  Ludovic Rousseau

	* [r566] etc/pcscd.startup: use /etc/sysconfig/pscsd and correct
	  some typos

2003-11-20  Ludovic Rousseau

	* [r562] m4/acx_pthread.m4: new upstream version to avoid checking
	  for pthread.h which does not exist on *BSD

2003-11-18  Ludovic Rousseau

	* [r561] src/dyn_win32.c: revert test of return value from
	  FreeLibrary. Thanks to Peter Williams for the patch.
	  http://archives.neohapsis.com/archives/dev/muscle/2003-q4/0136.html

2003-11-09  Antti Tapaninen

	* [r560] pbx/config.h, pcsc.pbproj/project.pbxproj: - Upgrade MacOS
	  X project build files for XCode
	* [r559] doc/example/pcsc_demo.c: - Build fix
	* [r558] src/PCSC/pcsclite.h.in: - Cleanups
	* [r557] libmusclecard/utils/bundleTool/bundleTool.c,
	  src/PCSC/pcsclite.h.in: - Allow regular pcsclite.h to be used
	  under win32 platform

2003-11-05  Ludovic Rousseau

	* [r555] libmusclecard/src/libmusclecard.pc.in,
	  src/libpcsclite.pc.in: add muscledropdir (in libmusclecard) and
	  usbdropdir (in libpcsclite) so we can use `pkg-config libpcsclite
	  --variable=usbdropdir` to find the directory to use. Should be
	  used by drivers and plugins installation. Thanks to Ville Skytt�
	  for the patch.

2003-11-02  Ludovic Rousseau

	* [r546] libmusclecard/utils/bundleTool/bundleTool.c: port under
	  Win32 (patch from Peter Williams) and some code cleanup

2003-10-30  Ludovic Rousseau

	* [r540] src/PCSC/pcsclite.h.in: changed back
	  PCSCLITE_MAX_READERS_CONTEXTS from 256 to 16. 16 readers is
	  clearly enough for most users. The correct solution is to use a
	  list instead of an array.
	* [r539] src/PCSC/pcsclite.h.in: remove definition of
	  PCSCLITE_MAX_COMSIZE (Maximum arg size) now useless
	* [r538] src/pcscdaemon.c: - send debug to syslog by default - send
	  debug to stderr if --foreground|-f is used (no need to add
	  --debug stderr anymore) - use strcmp() instead of strncmp() in
	  --debug parsing since one argument has a fixed size anyway -
	  define and use TRUE/FALSE constants
	* [r537] src/PCSC/debuglog.h, src/debuglog.c: remove log to a file
	  service since it was not used.

2003-10-29  Damien Sauveron

	* [r527] src/pcscdaemon.c: Add the option [-a] to the usage of
	  pcscd
	* [r526] etc/pcscd.startup: Solve a problem of recognizition by
	  serviceconf (patch from Tommaso Cucinotta)

2003-10-23  Damien Sauveron

	* [r519] src/winscard_svc.c: Sorry I have done an error in the name
	  that I want! Now it is the good name for this structure
	* [r518] src/winscard_svc.c: Change the name of a structure to
	  better explain its usage

2003-10-22  Damien Sauveron

	* [r517] src/winscard_msg.c: Add a debug message when a client
	  disappears
	* [r516] src/pcscdaemon.c: Move a debug message in an other file to
	  have the good client number when it disappears

2003-10-21  Antti Tapaninen

	* [r515] src/PCSC/pcsclite.h.in, src/winscard_scf.c: - Potential
	  security fixes to SCF client
	* [r514] src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c: - More merging between the hotplug
	  implementations - Get rid of some internal limitation defines,
	  there seems to be more than enough of these things in pcsclite.h
	  already
	* [r513] libmusclecard/src/tokenfactory.c, src/PCSC/parser.h,
	  src/hotplug.h, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c: - Move all common hotplug defines into
	  hotplug.h - Remove extra LTPBundleFindValueWithKey declarations
	* [r512] src/pcscdaemon.c, src/readerfactory.c: - errno.h cleanups
	* [r511] win32/PCSC.dsp: - Forgot to commit
	* [r510] win32/Makefile.am, win32/win32_pcsclite.h: - Remove
	  win32_pcsclite.h, it's out of sync anyway and the one who wishes
	  to use pcsc-lite under win32 platform in any situation should
	  probably patch src/pcsclite.h and renew win32/config.h.

2003-10-20  Damien Sauveron

	* [r509] src/PCSC/pcsclite.h.in: Increase the max readers contexts
	  value
	* [r508] src/readerfactory.c: Support of 255 readers max
	* [r507] src/winscard_svc.c: Correct a bug introduce by me. Sorry.
	  It will be good in the future to improve this part
	* [r506] src/hotplug_libusb.c, src/hotplug_linux.c: Correct with
	  the goods concepts constants
	* [r505] src/readerfactory.c: Change variables names
	* [r504] src/winscard_clnt.c: Correct with the goods concepts
	  constants, correct some comments and variable name
	* [r503] src/winscard_svc.c: Correct with the goods concepts
	  constants
	* [r502] src/eventhandler.c, src/pcscdaemon.c, src/readerfactory.c,
	  src/readerfactory.h: Correct with the goods concepts constants
	* [r501] doc/example/pcsc_demo.c: Correct with the good concept
	* [r500] src/PCSC/pcsclite.h.in: Introduce the limitations about
	  the concepts
	* [r499] src/README_INTERNALS.txt: A clean up.
	* [r498] src/README_INTERNALS.txt: Add a description of PC/SC Lite
	  Concepts.

2003-10-18  Ludovic Rousseau

	* [r497] doc/example/pcsc_demo.c: put back the GNU GPL license
	  since it is not protected by the BSD license used by the other
	  files.

2003-10-18  Antti Tapaninen

	* [r496] src/configfile.l, src/tokenparser.l: - Unify the
	  copyright/description header part for most of the files
	* [r495] doc/example/pcsc_demo.c,
	  libmusclecard/src/PCSC/mscdefines.h,
	  libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/muscletest.c,
	  libmusclecard/src/tokenfactory.c,
	  libmusclecard/src/tokenfactory.h,
	  libmusclecard/utils/bundleTool/bundleTool.c, src/PCSC/debuglog.h,
	  src/PCSC/dyn_generic.h, src/PCSC/ifdhandler.h, src/PCSC/parser.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/sys_generic.h,
	  src/PCSC/thread_generic.h, src/PCSC/winscard.h,
	  src/PCSC/wintypes.h, src/atrhandler.c, src/atrhandler.h,
	  src/configfile.h, src/debuglog.c, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/dyn_win32.c,
	  src/eventhandler.c, src/eventhandler.h, src/hotplug.h,
	  src/hotplug_generic.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/ifdwrapper.c, src/ifdwrapper.h,
	  src/pcscdaemon.c, src/powermgt_generic.c, src/powermgt_generic.h,
	  src/prothandler.c, src/prothandler.h, src/readerfactory.c,
	  src/readerfactory.h, src/sys_unix.c, src/testpcsc.c,
	  src/thread_unix.c, src/thread_win32.c, src/utils/formaticc.c,
	  src/utils/installifd.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_msg.h, src/winscard_scf.c,
	  src/winscard_svc.c, src/winscard_svc.h, win32/win32_pcsclite.h: -
	  Unify the copyright/description header part for most of the files
	* [r494] src/hotplug_libusb.c, src/hotplug_linux.c: - Remove USB
	  bundle platform (Linux) hardcoding and replace it with PCSC_ARCH.

2003-10-15  Ludovic Rousseau

	* [r491] ChangeLog: the release number was wrong :-)
	* [r490] ChangeLog: release 1.2.0-rc3
	* [r489] Makefile.am: Antti Tapaninen and Damien Sauveron have now
	  their names in ChangeLog.cvs
	* [r488] libmusclecard/src/tokenfactory.c: correct a typo
	* [r487] src/winscard_msg.c: perform a round-robbin among clients
	  to avoid starvation under heavy load. Patch from Bettina
	  Martelli.

2003-10-15  Damien Sauveron

	* [r486] src/winscard_clnt.c: Verify the availabilty of the daemon
	  before to try a connection.

2003-10-13  Damien Sauveron

	* [r485] src/winscard_svc.c: Add a verification before to release a
	  context.

2003-10-04  Damien Sauveron

	* [r484] doc/pcscd.8.in: correct the typo

2003-09-30  Ludovic Rousseau

	* [r483] src/winscard_clnt.c: SCardEstablishContextTH: print the
	  shared file name if open fails
	* [r482] src/winscard_clnt.c: send debug to stdout only if the
	  environment variable MUSCLECARD_DEBUG is defined
	* [r481] libmusclecard/src/tokenfactory.c: having a trailing / in
	  MSC_SVC_DROPDIR (--enable-muscledropdir) is no more mandatory
	* [r480] libmusclecard/src/tokenfactory.c: print the directory name
	  with the error message if opendir failed

2003-09-29  Damien Sauveron

	* [r479] src/readerfactory.c: Clean up 2 memory leaks
	* [r478] src/readerfactory.c: Clean up the mutex when a reader is
	  removed if needed. This is a memory leak
	* [r477] src/readerfactory.h: Add a field needed for clean up the
	  mutex when a reader is removed. This is needed since the support
	  of simultaneous access to slots of a multi-slot reader or
	  identical reader using the same ifdhandler
	* [r476] src/readerfactory.c: Correct a bug introduced by me and
	  add a copyright.

2003-09-27  Ludovic Rousseau

	* [r474] configure.in, libmusclecard/src/libmusclecard.pc.in,
	  src/Makefile.am: add a new pkg-config file for application using
	  libmusclecard. Closes "[ #300102 ] Should the pkgconfig file of
	  1.2.0-rc2 have -lmusclecard?"

2003-09-24  Damien Sauveron

	* [r473] src/winscard_msg.c: Some clean up on the debug message and
	  indentation.
	* [r472] src/winscard_svc.c: Move some code to a better position.

2003-09-23  Damien Sauveron

	* [r471] src/winscard_msg.c: Some cleanups.

2003-09-23  Ludovic Rousseau

	* [r470] configure.in: --enable-libusb was not working correctly is
	  the lib is not installed in /usr or /usr/local

2003-09-23  Damien Sauveron

	* [r469] src/winscard_scf.c: Solve the problem of never exiting the
	  loop when a smartcard is already inserted in the reader, thus
	  blocking the application.

2003-09-22  Ludovic Rousseau

	* [r458] src/readerfactory.c: initialize valueLength just before
	  the call to IFDGetCapabilities().
	* [r457] src/readerfactory.c: initialize dwGetSize to the size of
	  the value buffer before calling IFDGetCapabilities().
	* [r456] src/debuglog.c: use a local output buffer instead of a
	  global one to be thread safe

2003-09-19  Ludovic Rousseau

	* [r454] configure.in: use AC_HELP_STRING() for a pretty look of
	  `configure --help'

2003-09-18  Damien Sauveron

	* [r452] src/readerfactory.c: Add the support of simultaneous
	  access on different slots of a reader if the handling is thread
	  safe.
	* [r451] src/PCSC/ifdhandler.h: Add the tag
	  TAG_IFD_SLOT_THREAD_SAFE for testing if the handling of the slots
	  is thread safe.

2003-09-17  Damien Sauveron

	* [r450] src/readerfactory.c: Add a full clean up when there is no
	  space for adding all the slots of a multi-slots reader.
	* [r449] src/readerfactory.c: Clean up in the RFRemoveReader.

2003-09-16  Antti Tapaninen

	* [r447] src/Makefile.am: Put back -rdynamic to pcscd linking
	  because of some IFD drivers. IMHO this is wrong, but what can you
	  do.
	* [r446] configure.in: Put back AC_PROG_CPP, it has nothing to do
	  with C++.

2003-09-16  Ludovic Rousseau

	* [r442] configure.in: remove useless AC_PROG_CPP (no C++ code in
	  pcsc-lite)
	* [r440] configure.in, src/PCSC/pcsclite.h.in: -rc3 version
	  (configure.in and src/pcsclite.h _shall_ be in sync)
	* [r439] configure.in, src/PCSC/pcsclite.h.in,
	  src/hotplug_libusb.c: remove / at the end of usbdropdir,
	  muscledropdir and ipcdir to be more homogeneous

2003-09-15  Damien Sauveron

	* [r435] src/readerfactory.c: Add the support of simultaneous
	  access on the thread safe IFD.
	* [r434] src/PCSC/ifdhandler.h: Add the tag TAG_IFD_THREAD_SAFE for
	  testing if the IFD is thread safe.

2003-09-15  Antti Tapaninen

	* [r433] README: Updates to requirements and tested platforms

2003-09-11  Damien Sauveron

	* [r432] src/ifdwrapper.c: Better explanation of a comment.
	* [r431] src/readerfactory.c: Cleanup a condition unused and undo
	  some of my previous changes.

2003-09-11  Antti Tapaninen

	* [r430] m4, m4/Makefile.am, m4/acx_pthread.m4, win32/Makefile.am:
	  Add new files needed by the new bootstrap
	* [r429] build: Remove build/ directory
	* [r428] Makefile.am, bootstrap, configure.in, reconf: - Simplify
	  the bootstrapping mechanism - Remove reconf
	* [r427] config.h.in: Remove config.h.in, doesn't belong to the
	  repository
	* [r426] win32/PCSC.dsp, win32/config.h, win32/win32_config.h:
	  Rename win32_config.h to config.h

2003-09-10  Damien Sauveron

	* [r419] src/readerfactory.c: Cleanup about variables already
	  initialized and indent of some comments
	* [r416] src/PCSC/debuglog.h: Add a comment about the usage of
	  DebugLogC

2003-09-08  Antti Tapaninen

	* [r401] src/hotplug_macosx.c: Warning fix for PCSCLITE_HP_DROPDIR
	  being already defined
	* [r400] src/dyn_unix.c: HP-UX build fix, add sanity checks to not
	  to use dlfcn if there's native dynamic loading interface
	  available, like HP-UX and MacOS X does.
	  
	  The other option would be just to merge all dynamic loading
	  routines into one file, a lot simpler solution.
	* [r399] config.h.in: Bootstrap update
	* [r398] configure.in: Finish SCF build support, add sanity checks
	* [r397] src/Makefile.am: Add winscard_scf.c to EXTRA_DIST
	* [r396] src/winscard_scf.c: Build fixes, add dummy SCardUnload()
	* [r395] config.h.in: Bootstrap update
	* [r394] configure.in, src/Makefile.am: - Make hotpluging / power
	  management to compile again - Add MacOS X build fixes
	* [r393] src/hotplug_generic.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c, src/hotplug_macosx.c,
	  src/powermgt_generic.c: Add necessary ifdef's
	* [r392] src/powermgt_macosx.c: Include hotplug.h to avoid warning
	  message
	* [r391] doc/example/pcsc_demo.c,
	  libmusclecard/utils/bundleTool/bundleTool.c,
	  src/utils/formaticc.c, src/utils/installifd.c: Build fix for
	  MacOS X, don't bother including from <PCSC/..>, use standard
	  header locations.
	* [r390] src/winscard_msg.c: Back out socklen_t change that I made
	* [r389] src/pcscdaemon.c: Very minor cleanups
	* [r388] src/thread_win32.c: Add missing config.h
	* [r387] configure.in: - Remove --with-common-dir and overly
	  complex libsocket, libresolv etc. probes that I added. Probe only
	  for socket() in libsocket. - Reorder --disable-threadsafe code,
	  needed to get over some libtool issues for various platforms.
	* [r386] src/Makefile.am: Fix --disable-threadsafe issues
	* [r385] README: Don't mention -lposix4 for Solaris, AFAIK it's not
	  needed anymore.
	* [r384] libmusclecard/src/musclecard.c: Fix compiler warning when
	  compiling with --disable-threadsafe
	* [r383] libmusclecard/src/tokenfactory.c, src/debuglog.c,
	  src/dyn_win32.c, src/hotplug_libusb.c, src/hotplug_linux.c,
	  src/ifdwrapper.c, src/pcscdaemon.c, src/testpcsc.c,
	  src/utils/formaticc.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_scf.c: AIX build fix, convert //
	  comments into /* */ blocks.

2003-09-07  Ludovic Rousseau

	* [r382] libmusclecard/src/musclecard.c,
	  libmusclecard/src/tokenfactory.c: remove useless \n in debug
	  message strings

2003-09-07  Antti Tapaninen

	* [r381] Makefile.am, configure.in, src/Makefile.am,
	  src/debuglog.c, src/dyn_hpux.c, src/dyn_macosx.c, src/dyn_unix.c,
	  src/dyn_win32.c, src/powermgt_generic.c, src/powermgt_macosx.c,
	  src/sys_unix.c, src/winscard_msg.c: Build fixes. The first
	  version that actually compiles for Linux, Solaris, Tru64 and AIX
	  after src/Makefile.am and configure.in modifications.
	  
	  - Untested - No hotplug/power management support - Untested for
	  *BSD, MacOS X and HP-UX, there's other things to do before even
	  trying to compile.
	* [r380] libmusclecard/src/PCSC/mscdefines.h,
	  libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/muscletest.c,
	  libmusclecard/src/tokenfactory.c,
	  libmusclecard/utils/bundleTool/bundleTool.c,
	  src/PCSC/pcsclite.h.in, src/PCSC/thread_generic.h,
	  src/PCSC/winscard.h, src/PCSC/wintypes.h, src/atrhandler.c,
	  src/atrhandler.h, src/debuglog.c, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/dyn_win32.c,
	  src/eventhandler.c, src/hotplug_generic.c, src/hotplug_libusb.c,
	  src/hotplug_linux.c, src/hotplug_macosx.c, src/powermgt_macosx.c,
	  src/prothandler.c, src/readerfactory.c, src/sys_unix.c,
	  src/testpcsc.c, src/thread_unix.c, src/tokenparser.l,
	  src/utils/formaticc.c, src/utils/installifd.c, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_scf.c,
	  src/winscard_svc.c: - Cleanups for #include logic and ordering,
	  it's better to include config.h first.
	* [r379] config.h.in, configure.in: Checkpoint commit + bootstrap
	  update
	* [r378] Makefile.am, doc/Makefile.am, doc/example/Makefile.am,
	  etc/Makefile.am, src/Makefile.am, src/utils/Makefile.am: - Polish
	  and unify Makefiles a bit - More work towards working
	  src/Makefile.am
	* [r377] config.h.in, configure.in, etc/Makefile.am,
	  libmusclecard/src/tokenfactory.c, pbx/config.h, src/Makefile.am,
	  src/hotplug_libusb.c, src/pcscdaemon.c, src/winscard_msg.c,
	  win32/win32_config.h: - Remove MSC/PCSC_TARGET_XYZ defines and
	  the massive use of unflexible automake conditionals. The main
	  reason why pcsc-lite requires "too much" work when porting to
	  another OS. Introduced define PCSC_ARCH, which uses 'uname' as an
	  input. Except Darwin->MacOS. - Removed --enable-usb - Preliminary
	  rewrite of src/Makefile.am, doesn't work yet. - Use gcc specific
	  compiler options only if gcc detected.
	* [r376] build/acx_pthread.m4: Merged some changes from OpenSC
	* [r375] src/Makefile.am, src/PCSC/sys_generic.h,
	  src/PCSC/thread_generic.h, src/dyn_bsd.c, src/dyn_unix.c,
	  src/dyn_win32.c, src/pcscdaemon.c, src/sys_hpux.c,
	  src/sys_solaris.c, src/sys_unix.c, src/thread_macosx.c,
	  src/thread_unix.c, src/thread_win32.c: - Removed most of the
	  duplicated code, replaced with the usage of config.h's defines
	  for portability issues: - Merged dyn_{bsd,unix}.c, left as
	  dyn_unix.c - Merged thread_{macosx,unix}.c, left as thread_unix.c
	  - Merged sys_{hpux,solaris,unix}.c, left as sys_unix.c - Removed
	  MSC_ thread API from generic / win32, they're not used.
	  
	  Starting from now, the source tree might be broken for a few
	  hours or even days. Sorry about that.

2003-09-05  Ludovic Rousseau

	* [r374] src/debuglog.c: add #include <unistd.h> to avoid an
	  "implicit declaration of function `getpid'"

2003-09-04  Ludovic Rousseau

	* [r372] ChangeLog, configure.in, src/PCSC/pcsclite.h.in: release
	  1.2.0-rc2
	* [r371] src/Makefile.am: add thread_win32.c in the distribution
	* [r370] configure.in, src/Makefile.am: remove a _stupid_ bug that
	  linked libpcsclite with libusb. Also generate libmusclecard and
	  remove musclecard code from libpcsclite.
	* [r369] src/configfile.c, src/tokenparser.c: removed since they
	  have nothing to do in CVS. They are generated from .l files
	* [r368] libmusclecard/src/muscletest.c: add #include <string.h>
	* [r367] src/PCSC/winscard.h: add prototype for SCardUnload()

2003-09-03  Ludovic Rousseau

	* [r358] doc/example/pcsc_demo.c: add a call to SCardUnload(). This
	  is not mandatory, just cleaner.
	* [r357] src/winscard_clnt.c: add SCardUnload() function to free
	  allocated resources. It is mandatory only if you use
	  dlopen/dlclose to often load/unload the library. Otherwise you
	  will exhaust the ressources available and get a crash. Thanks to
	  Guy Moreillon for the patch.

2003-09-02  Ludovic Rousseau

	* [r356] src/PCSC/debuglog.h: remove reference to USE_SYSLOG since
	  it is replaced by --debug command line argument

2003-08-31  Ludovic Rousseau

	* [r355] README: remove documentation about --enable-syslog since
	  it is not used anymore by ./configure
	* [r354] NEWS: refer to ChangeLog instead of containing the version
	  number

2003-08-29  David Corcoran

	* [r353] COPYING: Removed advertising clause

2003-08-28  Ludovic Rousseau

	* [r349] libmusclecard/src/muscletest.c: use CAPITAL hex, use
	  default PIN "Muscle00" when none is given, allow to use more than
	  one readers instead of using only the first one.
	* [r348] libmusclecard/src/musclecard.c: print SW (status word) in
	  hex instead of decimal
	* [r347] src/Makefile.am: add rules to build muscletest. testpcsc
	  is no more executed by make distcheck
	* [r346] doc/Makefile.am: do not distribute pcscd.8 bundleTool.8
	  since they are generated from the .in versions by ./configure
	* [r345] configure.in: to not set use_libusb=false in case the
	  argument is "" | "yes" | "YES"
	* [r344] Makefile.am: move ChangeLog.cvs to DISTCLEANFILES to avoid
	  an error with 'make distcheck'

2003-08-26  Ludovic Rousseau

	* [r337] ChangeLog: release 1.2.0-rc1
	* [r336] configure.in: move addition of -lusb since it is selected
	  by default.
	* [r334] src/hotplug_libusb.c: disable USB debug by default
	* [r333] README: add a note about deprecation of --enable-usb
	* [r332] configure.in: --enable-usb is deprecated and off by
	  default. Use --enable-libusb instead.
	* [r331] doc/Makefile.am: add example subdirectory
	* [r330] src/hotplug_libusb.c: complete redesign to support up to
	  PCSCLITE_MAX_READERS readers whatever the driver they use
	  (correct bug [ #300067 ] More than 4 Hotplug Readers in the same
	  time on Linux)
	* [r329] src/PCSC/pcsclite.h.in: define PCSCLITE_MAX_READERS as the
	  maximum number of readers

2003-08-25  Ludovic Rousseau

	* [r325] src/winscard.c: correct bug #300063: PCSCd reports card is
	  present when there is no card in the reader.
	* [r324] libmusclecard/src/musclecard.c: reindentation
	* [r323] libmusclecard/src/musclecard.c: free(evlist->tokenArray),
	  avoid a memory leak (Toni Andjelkovic)

2003-08-22  Ludovic Rousseau

	* [r320] doc/example, doc/example/Makefile.am,
	  doc/example/pcsc_demo.c: demo of a C program using the pcsc-lite
	  API

2003-08-21  Ludovic Rousseau

	* [r315] src/hotplug_libusb.c, src/hotplug_linux.c: typo in
	  comments

2003-08-20  Ludovic Rousseau

	* [r313] src/winscard_svc.c: Sometimes unknown APDUs were being
	  transmitted when 'SCardStatus' function was invoked (close
	  #300061)
	* [r312] src/winscard.c: return SCARD_E_INVALID_PARAMETER for APDU
	  of less than 4 bytes (close #300062)
	* [r311] libmusclecard/src/musclecard.c: initialise
	  pConnection->shareMode as early as possible (close #300064,
	  thanks to Wan-Teh Chang)
	* [r310] src/PCSC/wintypes.h: correct and remove unused types
	  (close bug #300071)
	* [r298] src/hotplug_macosx.c: Add support of reader aliases using
	  <array></array>
	* [r297] src/hotplug_libusb.c: add empty
	  HPRegisterForHotplugEvents() function

2003-08-19  Ludovic Rousseau

	* [r296] src/hotplug.h, src/hotplug_generic.c, src/hotplug_linux.c,
	  src/hotplug_macosx.c, src/pcscdaemon.c, src/powermgt_macosx.c:
	  Add support of PCMCIA for MacOS X and major redesign of the
	  hotplug support (thanks to Stephen M. Webb for the patch)
	* [r295] src/eventhandler.c: use <errno.h> instead of <sys/errno.h>

2003-08-18  Ludovic Rousseau

	* [r294] src/hotplug_libusb.c: use #ifdef DEBUG_USB_HOTPLUG for USB
	  debug messages
	* [r293] src/pcscdaemon.c: remove unneeded \n in debug messages
	* [r292] src/PCSC/pcsclite.h.in: #include <wintypes.h> even on
	  MacOS X
	* [r291] src/PCSC/winscard.h: do not look for PCSC/pcsclite.h but
	  pcsclite.h even on MacOS X
	* [r290] src/debuglog.c: add #include <sys/types.h> for FreeBSD
	  (thanks Toni Andjelkovic)

2003-08-15  Ludovic Rousseau

	* [r289] libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c: add void argument to the
	  MSCCallbackCancelEvent() prototype definition (thanks to Toni
	  Andjelkovic)
	* [r288] configure.in: use *linux* instead of linux-gnu (patch from
	  Toni Andjelkovic)
	* [r287] src/hotplug_libusb.c: conditionnaly print hotplug debug
	  messages. look for DEBUG_USB_HOTPLUG at the begining of the file.
	* [r286] src/hotplug_linux.c: use FILENAME_MAX instead of manually
	  defined values. Use snprintf() instead of sprintf() to fill
	  filenames.

2003-08-14  Ludovic Rousseau

	* [r285] Makefile.am: add s/corcoran-guest /David Corcoran /;
	* [r284] config.h.in: new generated version
	* [r283] bootstrap: do not remove build/aclocal.m4 anymore
	* [r282] src/Makefile.am: add parser.h in pcscd_SOURCES
	* [r281] src/utils/installifd.c: cast sizeof() with (int) to avoid
	  a warning under MacOS X
	* [r280] src/pcscdaemon.c: add "Copyright (C) 2001-2003 by Ludovic
	  Rousseau" for the version (-v) output.

2003-08-11  Ludovic Rousseau

	* [r267] src/tokenparser.c: regenerated but should not be in CVS
	* [r266] src/tokenparser.l: change filename in comment
	* [r265] src/PCSC/parser.h: add LTPBundleFindValueWithKey()
	  function prototype
	* [r264] src/PCSC/parser.h: use a size of 200 bytes instead of 256
	  otherwise it will break every drivers using the pcscd tokenparser
	  (buffer overflow in the driver).

2003-08-10  Ludovic Rousseau

	* [r263] README, configure.in, src/Makefile.am,
	  src/hotplug_libusb.c: add support of libusb
	* [r262] src/PCSC/parser.h, src/tokenparser.l: define maximum
	  buffer lengths and avoid possible buffer overflows

2003-08-08  Ludovic Rousseau

	* [r261] doc/formaticc.1: pcscd is in section 8 not 1

2003-07-04  Ludovic Rousseau

	* [r260] src/Makefile.am: Installation of the pkgconfig file did
	  not honor libdir. Thanks to Ville Skytt� for the patch (alioth
	  patch #300045)

2003-06-25  Ludovic Rousseau

	* [r259] src/configfile.c, src/tokenparser.c: #include stdint.h
	  only if HAVE_STDINT_H is defined since some platforms do not have
	  stdint.h (Windows, FreeBSD, etc.)

2003-06-05  David Corcoran

	* [r257] src/PCSC/thread_generic.h, src/thread_win32.c: fixed
	  MSC_Mutex functions to point to the SYS_Mutex functions

2003-06-04  David Corcoran

	* [r256] libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/tokenfactory.c,
	  src/PCSC/debuglog.h, src/PCSC/pcsclite.h.in,
	  src/PCSC/thread_generic.h, src/debuglog.c, src/thread_win32.c,
	  src/tokenparser.c, win32/PCSC.cpp: Commiting these files

2003-05-30  Ludovic Rousseau

	* [r254] ChangeLog: release 1.1.2beta5
	* [r253] bootstrap: remove $ac_aux_dir/aclocal.m4 after use to
	  limit the size of the .tar.gz
	* [r252] src/Makefile.am: remove winscard_msg.c from pcscd_SOURCES
	  since it is already included in libpcsclite_core_la_SOURCES used
	  by pcscd_LDADD
	* [r251] build/install-sh, build/missing, build/mkinstalldirs: new
	  version from automake 1.7.5
	* [r250] doc/Makefile.in: removed since generated from
	  doc/Makefile.am
	* [r249] Makefile.am: the CVS files are now on alioth.debian.org so
	  change the path to remove to generate the ChangeLog.cvs file
	* [r248] src/winscard_clnt.c: SCardStatusTH(): simplify code and
	  return correct results when buffers are too short or NULL is used
	* [r247] src/winscard.c: SCardStatus(): do not return before
	  filling buffers
	* [r246] libmusclecard/src/musclecard.c: small cleanup
	* [r245] doc/Makefile.in: removed from CVS since generated from
	  doc/Makefile.am
	* [r244] src/configfile.c, src/tokenparser.c: regenerated but they
	  should not be in CVS
	* [r243] src/tokenparser.l: define ret as int
	* [r242] src/Makefile.am: correct arguments order of ylwrap script
	* [r241] src/utils/installifd.c: replace gets() by fgets() to avoid
	  buffer overflow. Use sizeof() instead of constants. do not use
	  strdup() since it is useless. print error messages when needed.

2003-05-28  Ludovic Rousseau

	* [r240] src/libpcsclite.pc.in: used to generated a pkg-config
	  ".pc" file (thanks to Andreas Jellinghaus for the idea and the
	  patch)
	* [r239] Makefile.in, build/aclocal.m4, build/config.guess,
	  build/config.sub, build/ltmain.sh, configure, etc/Makefile.in,
	  src/Makefile.in, src/utils/Makefile.in: removed from CVS since
	  they are (re)generated by ./bootstrap
	* [r238] configure.in, src/Makefile.am, src/utils/installifd.c: use
	  directory names as use by ./configure

2003-05-27  Ludovic Rousseau

	* [r237] src/driverparser.c, src/driverparser.l: no more useful
	  since tokenparser.* does a better job
	* [r236] src/tokenparser.l: do not duplicate fclose/return lines

2003-05-25  Ludovic Rousseau

	* [r235] etc/reader.conf.in: include configured path appear in the
	  docs (thanks to Ville Skytt�)
	* [r234] doc/pcscd.8.in,
	  libmusclecard/utils/bundleTool/bundleTool.8.in: correct typos and
	  include configured path appear in the docs (thanks to Ville
	  Skytt�)

2003-05-05  Ludovic Rousseau

	* [r228] ChangeLog: release 1.1.2beta4
	* [r227] src/configfile.c: regenerated from src/configfile.c
	* [r226] Makefile.in, configure, doc/Makefile.in, etc/Makefile.in,
	  src/Makefile.in, src/utils/Makefile.in: regenerated
	* [r225] src/tokenparser.c: regeneration from src/tokenparser.l
	* [r224] src/tokenparser.l: code reindentation, use
	  DebugLogB()/DebugLogC with correct number of arguments
	* [r223] src/debuglog.c: avoid possible buffer overflow in
	  pcsc_stringify_error()
	* [r222] src/Makefile.am: add -pthread for xBSD, use AM_CFLAGS
	  instead of CFLAGS, driverparser.c no more exists
	* [r221] bootstrap: use automake 1.7.3
	* [r220] README: also tested on Debian 3.0 and OpenBSD 3.2

2003-04-07  Ludovic Rousseau

	* [r219] src/tokenparser.l: reindent, use DebugLogB instead of
	  DebugLogC, add indice number in debug message
	* [r218] src/hotplug_linux.c: support driver aliases in Info.plist
	* [r217] src/hotplug_linux.c: use LTPBundleFindValueWithKey(.., 0)
	  instead of LCFBundleFindValueWithKey()
	* [r216] src/hotplug_linux.c: reindent
	* [r215] src/hotplug_linux.c: code simplification
	* [r214] src/hotplug_linux.c: add directory name to error message

2003-01-09  Ludovic Rousseau

	* [r213] src/debuglog.c: the log output mode (syslog, stdout,
	  stderr) can't be combined. stderr had precedence (in the code)
	  over stdout that was _never_ used.

2002-12-08  Ludovic Rousseau

	* [r212] src/PCSC/pcsclite.h.in: use pcscd.* instead of pcsc.* to
	  be unoform with pcscd.pid

2002-12-07  Ludovic Rousseau

	* [r211] doc/Makefile.am: remove pcscd.startup since it is now in
	  etc/
	* [r209] ChangeLog: release 1.1.2beta3
	* [r208] Makefile.in, config.h.in, configure, doc/Makefile.in,
	  etc/Makefile.in: regenerated
	* [r207] src/Makefile.in, src/utils/Makefile.in: regenarated
	* [r206] src/pcscdaemon.c: create PCSCLITE_IPC_DIR if it does not
	  exist. For example when it is set to /tmp/pcsc/ (default now is
	  /var/run/)
	* [r205] src/PCSC/pcsclite.h.in: use pcsc.comm instead of pcsc.omm
	* [r204] doc/pcscd.startup: removed. The startup script is in etc/
	* [r203] src/eventhandler.c: small source code reformating
	* [r202] libmusclecard/src/musclecard.c,
	  libmusclecard/src/tokenfactory.c, src/tokenparser.c: use
	  DebugLogB() for logs with 2 parameters and not DebugLogC()
	* [r201] src/PCSC/debuglog.h: DebugLogC() uses 3 parameters not 2
	  (use DebugLogB() for that)
	* [r200] src/eventhandler.c: add filename and error message to
	  error logs for /var/run/pcsc.pub
	* [r199] src/PCSC/pcsclite.h.in, src/pcscdaemon.c: add support of
	  --enable-ipcdir=DIR
	* [r198] src/Makefile.am: reorganise conditionals to to have a
	  src/Makefile.in file 142 (yes 142) times smaller (33 KB instead
	  of 4.7 MB)
	* [r197] etc/Makefile.am: also distribute etc/pcscd.startup
	* [r196] configure.in: update to autoconf 2.56 (lot of changes).
	  add --enable-ipcdir=DIR option. Default is now /var/run/ instead
	  of /tmp/pcsc/
	* [r195] bootstrap: update for autoconf 2.57 and automake 1.6.3
	* [r194] Makefile.am: add win32/ files and some rework

2002-12-06  Ludovic Rousseau

	* [r193] src/winscard.c: accept pioRecvPci == NULL in
	  SCardTransmit()
	* [r192] src/winscard_clnt.c: source code reformating
	* [r191] src/winscard_clnt.c: correct an overflow in
	  SCardGetStatusChange() replace "if (cReaders >
	  PCSCLITE_MAX_CONTEXTS)" by "if (cReaders >=
	  PCSCLITE_MAX_CONTEXTS)". Thanks to Michael Nidd
	* [r190] src/winscard_clnt.c: init g_rgSCard??Pci variable at
	  compile time

2002-12-04  Ludovic Rousseau

	* [r189] ChangeLog: add Dmitry Djachenko pacthes

2002-12-02  David Corcoran

	* [r188] Makefile.in, build/aclocal.m4, config.h.in, configure,
	  configure.in, doc/Makefile.in, libmusclecard/src/musclecard.c,
	  libmusclecard/utils/bundleTool/bundleTool.c, src/Makefile.am,
	  src/Makefile.in, src/debuglog.c, src/pcscdaemon.c: Included
	  changes from Citrix - Support for AIX in configure.in and
	  Makefile.am - added ifdef for SNPRINTF and VSNPRINTF

2002-11-29  Ludovic Rousseau

	* [r187] src/winscard.c: code reformatting
	* [r186] src/winscard.c: initialise g_rgSCard??Pci globals at
	  compile time
	* [r185] src/winscard.c: SCardStatus(): set more return values
	* [r184] src/winscard.c: Check reader name and ATR size are correct
	  (no buffer oveflow)
	* [r183] src/winscard.c: check pioRecvPci is non NULL before
	  assignment
	* [r182] src/winscard.c: SCardReconnect() returns more interesting
	  error codes

2002-10-30  Ludovic Rousseau

	* [r181] src/prothandler.c, src/prothandler.h: PHSetProtocol()
	  returns a DWORD and not a UCHAR since rContext->dwProtocol is a
	  DWORD. Thanks to Oleg Makarenko.
	* [r180] src/atrhandler.c, src/eventhandler.c, src/prothandler.c,
	  src/winscard.c: include some missing .h files. Thanks to Oleg
	  Makarenko

2002-10-16  David Corcoran

	* [r179] etc/SmartcardServices, pbx/config.h: some changes for the
	  Mac

2002-10-15  David Corcoran

	* [r178] ChangeLog, Makefile.in, build/aclocal.m4, config.h.in,
	  configure, configure.in, doc/Makefile.in, etc/Makefile.in,
	  src/Makefile.am, src/Makefile.in, src/utils/Makefile.in: Some
	  changes to make SCF easier to use

2002-10-12  Ludovic Rousseau

	* [r176] bootstrap: use autoconf instead of autoreconf to not reuse
	  an old config
	* [r175] Makefile.in, build/aclocal.m4, configure, doc/Makefile.in,
	  etc/Makefile.in, src/Makefile.in, src/utils/Makefile.in: new
	  version of autoregenerating files
	* [r174] ChangeLog: release 1.1.2beta2

2002-10-08  Ludovic Rousseau

	* [r173] src/Makefile.am: do not link with -lpthread under bsd as
	  it breaks under OpenBSD and FreeBSD
	* [r172] configure.in: use "test x${usbdropdir} = xfalse" instead
	  of "test x${usbdropdir} == xfalse" since it generates an error
	  under FreeBSD (test: xfalse: unexpected operator). For a strange
	  reason the bug was not detected earlier.

2002-10-06  Ludovic Rousseau

	* [r171] src/Makefile.am: use -rdynamic instead of
	  -Wl,--export-dynamic since some systems (OpenBSD) did not support
	  it
	* [r170] src/pcscdaemon.c: add --apdu documentation in --help
	  message support -a argument even when HAVE_GETOPT_LONG not
	  supported
	* [r169] src/utils/formaticc.c: add a (char *) cast to avoid a
	  compilation warning

2002-10-06  Jean-Luc Giraud

	* [r168] etc/SmartcardServices: Added support for
	  start/stop/restart invocation parameters
	* [r167] pbx/config.h: Added #define for support of /var/run/pid.
	  pid file is /var/run/pcscd.pid

2002-10-06  Ludovic Rousseau

	* [r166] Makefile.in, build/aclocal.m4, config.h.in, configure,
	  doc/Makefile.in, etc/Makefile.in, src/Makefile.in,
	  src/utils/Makefile.in, stamp-h.in: new version of
	  autoregenerating files
	* [r165] src/Makefile.am: add -DPACKAGE and -DVERSION to
	  compilation flags. They are no more included in config.h
	* [r164] configure.in: change version from 1.1.2beta1 to 1.1.2
	* [r163] bootstrap: remove config.h.in to be sure to regenerate it

2002-10-05  Ludovic Rousseau

	* [r162] src/PCSC/pcsclite.h.in: change VERSION number from
	  1.1.2beta1 to 1.1.2
	* [r161] ChangeLog: print an error message if the --debug argument
	  is not known

2002-10-04  David Corcoran

	* [r160] src/winscard_scf.c: quick fix
	* [r159] src/winscard_scf.c: added scf compatibility
	* [r158] src/PCSC/wintypes.h: added helge's fix to WORD
	* [r157] src/powermgt_macosx.c: fix for osx deadlock on sleep

2002-10-03  David Corcoran

	* [r156] src/hotplug_linux.c: some changes to support multiplle usb
	  readers

2002-10-03  Ludovic Rousseau

	* [r155] src/hotplug_linux.c: close PCSCLITE_HP_DROPDIR
	  (/usr/local/pcsc/drivers/) after use

2002-10-03  David Corcoran

	* [r154] src/winscard.c: added fix by amira

2002-10-02  David Corcoran

	* [r153] libmusclecard/src/tokenfactory.c: added default dropdir
	* [r152] src/Makefile.in, src/winscard.c: added athena patch for
	  SCARD_PROTOCOL_ANY in SCardConnect
	* [r151] src/eventhandler.c, src/readerfactory.c: Fixed
	  multi-reader + sleep problem
	* [r150] Makefile.in, build/aclocal.m4, config.h.in, configure,
	  doc/Makefile.in, src/Makefile.in: Re-importing autoconf stuff

2002-10-02  Jean-Luc Giraud

	* [r149] pbx/config.h, src/readerfactory.c: Modified version number
	  from 1.1.0 to 1.1.1

2002-09-07  Ludovic Rousseau

	* [r147] src/pcscdaemon.c: Log to stderr by default. Print an error
	  message if --debug argument is not known.

2002-09-06  Ludovic Rousseau

	* [r145] configure.in, src/PCSC/pcsclite.h.in: release 1.1.2beta1
	* [r144] ChangeLog: forgot to add support of --enable-muscledropdir
	  in bundleTool.c
	* [r143] libmusclecard/utils/bundleTool/bundleTool.c: add support
	  for --enable-muscledropdir
	* [r142] configure.in, libmusclecard/src/tokenfactory.c: add
	  support for --enable-muscledropdir
	* [r141] build/aclocal.m4, build/config.guess, build/config.sub,
	  build/install-sh, build/ltmain.sh, build/missing,
	  build/mkinstalldirs, build/ylwrap: new versions
	* [r140] reconf: do not restart ./configure
	* [r139] bootstrap: test if a Makfile exists before make distclean
	* [r138] README: The licence file is COPYING and not LICENSE
	  (thanks to Juha Tuomala)

2002-08-18  Ludovic Rousseau

	* [r131] doc/Makefile.am, doc/Makefile.in, doc/formaticc.1: add
	  formaticc.1 from Debian

2002-08-16  Ludovic Rousseau

	* [r130] src/pcscdaemon.c: typo (add a space)

2002-08-15  Ludovic Rousseau

	* [r129] src/utils/formaticc.c: lots of debug and buffer overflow
	  removal
	* [r128] libmusclecard/utils/bundleTool/bundleTool.c: print usage
	  in cas of wrong arguments
	* [r127] doc/Makefile.am, doc/Makefile.in, doc/bundleTool.1,
	  libmusclecard/utils/bundleTool/bundleTool.8.in: update and rename
	  bundleTool.1

2002-08-13  Ludovic Rousseau

	* [r126] configure.in, src/PCSC/pcsclite.h.in: switch from version
	  1.1.1 to 1.1.2 for cvs snapshots
	* [r125] src/pcscdaemon.c: add support for --apdu, test if the
	  pcscd is still running before complaining that /tmp/pcsc is
	  present
	* [r124] src/ifdwrapper.c: add support for --apdu
	* [r123] src/eventhandler.c: typo
	* [r122] libmusclecard/src/musclecard.c: add a return NULL;
	* [r121] src/PCSC/debuglog.h, src/debuglog.c: add support for
	  --apdu and other same log messages
	* [r120] src/readerfactory.c: properly initialise rv
	* [r119] src/Makefile.am, src/Makefile.in: add -Wl,--export-dynamic
	  link option
	* [r118] doc/pcscd.8.in: add the -a|--apdu option + some cleaning
	* [r117] reconf: make distclean before autoreconf
	* [r116] reconf: *** empty log message ***
	* [r115] configure.in, src/hotplug_linux.c: set the
	  PCSCLITE_HP_DROPDIR as a ./configure option

2002-07-30  Ludovic Rousseau

	* [r114] libmusclecard/src/musclecard.c: add #ifdef
	  USE_THREAD_SAFETY otherwise it wont compile with
	  --disable-threadsafe

2002-07-01  David Corcoran

	* [r113] doc/pcscd.startup: readding
	* [r112] doc/pcscd.startup, etc/pcscd.startup: moved location

2002-06-27  David Corcoran

	* [r111] libmusclecard/src/musclecard.c,
	  libmusclecard/src/tokenfactory.c, win32/PCSC.dsp: Win32

2002-06-19  David Corcoran

	* [r107] src/readerfactory.c: removed printf

2002-06-18  David Corcoran

	* [r106] libmusclecard/src/PCSC/musclecard.h: MSCPUChar8 ->
	  MSCUChar8

2002-06-11  David Corcoran

	* [r105] libmusclecard/src/PCSC/musclecard.h: Added more
	  Initialization parameters ...

2002-06-05  David Corcoran

	* [r104] libmusclecard/src/musclecard.c: hello
	* [r103] libmusclecard/src/musclecard.c: ;lkj
	* [r102] libmusclecard/src/musclecard.c: bad if then
	* [r101] libmusclecard/src/musclecard.c: some changes
	* [r100] libmusclecard/src/musclecard.c, src/PCSC/thread_generic.h,
	  src/thread_macosx.c, src/thread_unix.c: Added generic thread
	  support to musclecard.c and added pthread_join
	* [r99] libmusclecard/src/musclecard.c: Added join to
	  cancelcallback
	* [r98] COPYING, ChangeLog, NEWS, README: Fixed problem with
	  MSC_SHARE_DIRECT connections Added changes to docs Cancel with
	  join
	* [r97] Makefile.in, build/aclocal.m4, configure, configure.in,
	  doc/Makefile.in, src/Makefile.in, src/PCSC/pcsclite.h.in: Changed
	  versioning
	* [r96] src/winscard_clnt.c: removed unused variable i
	* [r95] src/readerfactory.c: Fix for bug which wouldn't work with
	  multi-slot readers. Slots weren't managing the dwFeeds variable
	  in the structure so the library was closed prematurely.

2002-06-03  David Corcoran

	* [r94] src/readerfactory.h: replaced magic number with constant
	  16->PCSCLITE_MAX_CONTEXTS

2002-05-31  David Corcoran

	* [r93] src/winscard_clnt.c: Removed bug: line 1986
	  SCardCleanupClient would release the socket too early

2002-05-28  David Corcoran

	* [r92] libmusclecard/doc, libmusclecard/doc/muscle-api-1.3.0.pdf:
	  Added muscle-docs
	* [r91] AUTHORS, ChangeLog, Makefile.in, NEWS, README, SECURITY,
	  build/aclocal.m4, configure, configure.in, doc/Makefile.am,
	  doc/Makefile.in, doc/pcscd.startup, etc/SmartcardServices,
	  etc/StartupParameters.plist, src/Makefile.am, src/Makefile.in:
	  Finalizing for the release
	* [r90] src/utils/formaticc.c: Added wintypes.h
	* [r89] Makefile.in, build/aclocal.m4, build/ltmain.sh,
	  doc/Makefile.in, src/Makefile.am, src/Makefile.in: fixes for the
	  build

2002-05-28  phuang

	* [r88] src/dyn_hpux.c: hpux need <errno.h> to compile correctly

2002-05-21  Ludovic Rousseau

	* [r87] Makefile.am: patch the generated ChangeLog.cvs to have
	  correct file and author names

2002-05-10  Ludovic Rousseau

	* [r86] src/Makefile.am: added the .h files in the distibution but
	  they will not be installed by a 'make install' So now 'make test'
	  and 'make testcheck' should work again. Sorry Dave for my mistake
	  in v1.3 you corrected in v1.4. I hope it is OK this time.
	* [r85] doc/Makefile.am: add pcscd.startup in the distribution

2002-05-07  David Corcoran

	* [r84] Makefile.in, build/aclocal.m4, configure, configure.in,
	  doc/Makefile.in, etc/Makefile.in, src/Makefile.in,
	  src/utils/Makefile.in: Updated version to 1.1.0
	* [r83] Makefile.in, config.h.in, configure, configure.in,
	  doc/Makefile.in, etc/Makefile.in: Fixing so that
	  --disable-threadsafe works !!!
	* [r82] src/Makefile.am, src/Makefile.in, src/utils/Makefile.in:
	  Adding Makefile.am with -lpthread for PCSCD_INCLUDE_LIBS
	* [r81] src/dyn_win32.c: Added Win32 dynamic lib loading

2002-05-06  David Corcoran

	* [r80] libmusclecard/src/musclecard.c: Added real time card
	  reset/removed checking. Fixed bug which begin/end transaction
	  would not return this.
	* [r79] libmusclecard/src/PCSC/mscdefines.h,
	  libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/tokenfactory.c,
	  src/debuglog.c, src/thread_unix.c, src/tokenparser.c, win32,
	  win32/PCSC.cpp, win32/PCSC.dsp, win32/PCSC.h, win32/StdAfx.cpp,
	  win32/StdAfx.h, win32/pthread.h, win32/sched.h,
	  win32/win32_config.h, win32/win32_pcsclite.h: Added support for
	  Win32 based platforms for Muscle Framework.
	* [r78] pcsc.pbproj/project.pbxproj: Checking in new project file
	  for project builder

2002-04-27  David Corcoran

	* [r74] pcsc.pbproj/project.pbxproj, src/hotplug_macosx.c: Added
	  versioning to pbxproj file, updated config.h. Fixed
	  Plugin->PlugIn.h in hotplug

2002-04-26  David Corcoran

	* [r73] doc/pcscd.8.in: Updated the man page

2002-04-25  David Corcoran

	* [r72] pcsc.pbproj/project.pbxproj: Added bundle header
	  information for buildit
	* [r71] pbx/config.h, src/PCSC/pcsclite.h.in, src/pcscdaemon.c:
	  Added new version numbering
	* [r70] src/eventhandler.c, src/readerfactory.c: removed printf
	  debugging for release
	* [r69] src/hotplug_macosx.c, src/powermgt_macosx.c: Changes to the
	  power management behavior

2002-04-24  David Corcoran

	* [r68] pbx/PCSC.pbproj: Removal
	* [r67] pcsc.pbproj, pcsc.pbproj/project.pbxproj,
	  src/eventhandler.c, src/hotplug_macosx.c, src/powermgt_macosx.c,
	  src/readerfactory.c, src/readerfactory.h, src/winscard.c: moved
	  project builderstuff and removed some files
	* [r66] libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/muscletest.c,
	  pbx/PCSC.pbproj/project.pbxproj, src/powermgt_macosx.c: changes

2002-04-23  David Corcoran

	* [r65] pbx/PCSC.pbproj/project.pbxproj, src/eventhandler.c,
	  src/hotplug_macosx.c, src/pcscdaemon.c, src/powermgt_generic.h,
	  src/powermgt_macosx.c, src/readerfactory.c, src/readerfactory.h:
	  No changes, just time/date issues

2002-04-22  David Corcoran

	* [r64] libmusclecard/src/PCSC/mscdefines.h,
	  pbx/PCSC.pbproj/project.pbxproj, pbx/config.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/sys_generic.h,
	  src/PCSC/winscard.h, src/sys_hpux.c, src/sys_solaris.c,
	  src/sys_unix.c, src/winscard_msg.c, src/winscard_svc.c: config.h
	  -> added cvs to version project.pbx -> modified project builder
	  attributes pcsclite.h -> __APPLE__ mscdefines.h -> __APPLE__
	  sys_generic.h, sys_hpux.c sys_solaris.c sys_unix.c int SYS_Exit
	  to void SYS_Exit winscard_msg.c removed message in CommonSegment

2002-04-21  Carlos Prados

	* [r63] configure.in, src/pcscdaemon.c: Added autoconf check for
	  getopt.h header

2002-04-16  David Corcoran

	* [r62] src/pcscdaemon.c: Added #ifdef around #include <getopt.h>

2002-04-14  Carlos Prados

	* [r61] configure.in: Added getopt_long() check.
	* [r60] src/pcscdaemon.c: Added getopt and getopt_long support for
	  command line parsing.

2002-04-12  David Corcoran

	* [r59] libmusclecard/src/musclecard.c: Added wait for thread
	  return for the callback
	* [r58] libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c: Added BLOCKSTATUS defines and
	  checks in the Callbacks so that the race condition would go away.
	* [r57] libmusclecard/src/PCSC/musclecard.h: Removed MSCCertInfo

2002-04-11  David Corcoran

	* [r56] libmusclecard/src/PCSC/mscdefines.h: removed cert function
	  pointers
	* [r55] libmusclecard/src/tokenfactory.c: removed certificate
	  function pointers
	* [r54] libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c: Removed all certificate handling
	  functions

2002-04-10  David Corcoran

	* [r53] src/pcscdaemon.c: Added extern int errno - wouldn't build
	  on Solaris
	* [r52] src/winscard_clnt.c: Removed atexit() put cleanup code in
	  SCardReleaseContext
	* [r51] libmusclecard/src/musclecard.c: some modifications for
	  tabs.
	* [r50] src/ifdwrapper.c: Removed SetCapabilities -> put into 1.0
	  version for performance reasons
	* [r49] libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c: Removed extra Read/Write
	  functions

2002-04-09  David Corcoran

	* [r48] libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c: Added keyPartner to MSCImportKey.
	  Added keyMapping to MSCKeyInfo structure

2002-04-08  David Corcoran

	* [r47] Makefile.in, build/aclocal.m4, configure, src/Makefile.am,
	  src/Makefile.in, src/PCSC/pcsclite.h.in, src/pcscdaemon.c,
	  src/readerfactory.c, src/readerfactory.h, src/winscard_clnt.c,
	  src/winscard_svc.c: Fixed a security vulnerability in
	  winscard_svc.c. Removed /tmp/pcsc/.pcsctmp and replaced it with a
	  stat /tmp/pcsc on the client side. Modified Makefile.am to only
	  install needed include files to /usr/local/include

2002-04-08  Michael Gile

	* [r46] src/readerfactory.c: initialized return value to -1 in
	  RFSetReaderName

2002-04-07  Ludovic Rousseau

	* [r45] src/PCSC/pcsclite.h.in, src/pcscdaemon.c,
	  src/readerfactory.c: Allow pcscd to do bulk transfers for devices
	  with high speed:
	  
	  Enhanced messaging has been added to accomodate newer devices
	  which have more advanced capabilites, such as dedicated secure
	  co-processors which can stream and encrypt data over USB. In
	  order to used enhanced messaging you must define
	  PCSCLITE_ENHANCED_MESSAGING in the framework(library), the
	  daemon, and your application
	  
	  Thanks to Michael Gile <mgile@mac.com> for the patch

2002-04-06  Ludovic Rousseau

	* [r44] AUTHORS: Added my name as suggested by David
	* [r43] src/pcscdaemon.c: using -d1 (debug to stderr) or -d2 (debug
	  to stdout) also activate the -fg option (foreground). Otherwise
	  pcscd is started as a daemon (default) and stdout and stderr file
	  descriptors are closed and then debug is useless since sent to
	  /dev/null
	* [r42] configure.in, src/PCSC/pcsclite.h.in: renamed 1.0.2.beta5
	  to 1.0.2.cvs
	* [r41] Makefile.am: make the ChangeLog.cvs rule .PHONY
	* [r40] src/PCSC/sys_generic.h, src/pcscdaemon.c, src/sys_hpux.c,
	  src/sys_solaris.c, src/sys_unix.c, src/winscard_clnt.c,
	  src/winscard_msg.c: use SYS_CloseFile() instead of close() use
	  SYS_OpenFile() instead of open() use SYS_Chdir() instead of
	  chdir() use SYS_Daemon() instead of daemon() test return values
	  and print a debug message when necessary
	  
	  patch provided by Toni Andjelkovic <toni@soth.at>
	* [r39] Makefile.am: add a rule to create ChangeLog.cvs
	* [r38] libmusclecard/utils/bundleTool/bundleTool.c: #include
	  <stdlib.h> for malloc() declaration
	* [r37] src/pcscdaemon.c: add error code management for
	  SHMProcessEvents returned value

2002-04-05  Ludovic Rousseau

	* [r36] configure.in: correct text alignment
	* [r35] doc/Makefile.in, etc/Makefile.in, src/utils/Makefile.in:
	  removed since generated automatically by automake
	* [r34] src/atrhandler.c: USE_SYSLOG is no more used. code rewrote
	  with debug_msg()
	* [r33] src/debuglog.c: debug_xxd(): also use the debug_msg_type
	  way
	* [r32] config.h.in: removed since generated automatically from
	  configure.in by autoheader

2002-04-04  Ludovic Rousseau

	* [r31] Makefile.in, src/Makefile.in: removed since automatically
	  generated from Makefile.am
	* [r30] src/pcscdaemon.c, src/winscard_msg.c: src/winscard_msg.c:
	  SHMProcessEvents() timeout on the select and go back into
	  src/pcscdaemon.c: SVCServiceRunLoop() This is used to catch the
	  Ctrl-C signal (in SVCServiceRunLoop) at some time when nothing
	  else happens
	* [r29] src/dyn_unix.c: removed dlerror() from if tests since it is
	  not the best way to test for errors
	* [r28] src/dyn_bsd.c: DYN_GetAddress() now correctly handles
	  errors by not using dlerror() to know if an error occured since
	  the error may have occured in a previous call Also removed
	  dlerror() from if tests everywhere else
	* [r27] src/Makefile.am: add many .h files in include_HEADERS so
	  that 'make dist' include all the useful files add muscletest.c in
	  EXTRA_libpcsclite_core_la_SOURCES

2002-04-04  David Corcoran

	* [r26] libmusclecard/src/musclecard.c: Some event changes,
	  begin/end transaction. Added IdentifyToken

2002-04-04  Ludovic Rousseau

	* [r25] libmusclecard/utils/bundleTool/bundleTool.c: removed unused
	  variable char tempString[1024]; add a return 0 for main()
	* [r24] libmusclecard/src/PCSC/mscdefines.h,
	  libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/muscletest.c,
	  libmusclecard/src/tokenfactory.c,
	  libmusclecard/src/tokenfactory.h,
	  libmusclecard/utils/bundleTool/bundleTool.c, src/PCSC/debuglog.h,
	  src/PCSC/dyn_generic.h, src/PCSC/ifdhandler.h,
	  src/PCSC/pcsclite.h.in, src/PCSC/sys_generic.h,
	  src/PCSC/thread_generic.h, src/PCSC/winscard.h,
	  src/PCSC/wintypes.h, src/atrhandler.c, src/atrhandler.h,
	  src/configfile.c, src/configfile.h, src/debuglog.c,
	  src/driverparser.c, src/dyn_bsd.c, src/dyn_hpux.c,
	  src/dyn_macosx.c, src/dyn_unix.c, src/eventhandler.c,
	  src/eventhandler.h, src/hotplug.h, src/hotplug_generic.c,
	  src/hotplug_linux.c, src/hotplug_macosx.c, src/ifdwrapper.c,
	  src/ifdwrapper.h, src/pcscdaemon.c, src/powermgt_macosx.c,
	  src/prothandler.c, src/prothandler.h, src/readerfactory.c,
	  src/readerfactory.h, src/sys_hpux.c, src/sys_solaris.c,
	  src/sys_unix.c, src/testpcsc.c, src/thread_macosx.c,
	  src/thread_unix.c, src/tokenparser.c, src/utils/formaticc.c,
	  src/utils/installifd.c, src/winscard.c, src/winscard_clnt.c,
	  src/winscard_msg.c, src/winscard_msg.h, src/winscard_svc.c,
	  src/winscard_svc.h: complete and automatic reindentation of *.c
	  and *.h files
	* [r23] ChangeLog: test

2002-04-01  Jean-Luc Giraud

	* [r22] libmusclecard/src/PCSC/musclecard.h: musclecard: - replaced
	  PCSC_TARGET_OSX with __APPLE__ in #ifndef for mscdefines.h
	  inclusion pbproj: - no meaningful modifications

2002-03-31  Jean-Luc Giraud

	* [r21] pbx/PCSC.pbproj/project.pbxproj, src/readerfactory.c: Fix 1
	  issue in readerfactory.c - valueLength=sizeof(tagValue) in
	  RFSetReaderName to allow IFDHandlers to know how much space is
	  available
	  
	  Modified PB project to allow build in proper order and have
	  testpcsc used the new PCSC framework available in the build
	  folder.

2002-03-31  David Corcoran

	* [r20] src/configfile.c: Added this
	* [r19] src/configfile.l: Big Ass Error badError = 1 instead of ==

2002-03-30  David Corcoran

	* [r18] src/pcscdaemon.c: removed crap PCSC_DEBUG
	* [r17] src/PCSC/wintypes.h, src/readerfactory.c: Fixed
	  multi-reader bug, also fixed wintypes bug
	* [r16] build/aclocal.m4, config.h.in, configure, configure.in,
	  doc/Makefile.am, doc/Makefile.in, doc/bundleTool.1,
	  doc/pcscd.8.in, src/pcscdaemon.c, src/utils/Makefile.am,
	  src/utils/Makefile.in: added the man pages
	* [r15] src/Makefile.am, src/configfile.c, src/configfile.l,
	  src/pcscdaemon.c: Added some command line arguments.
	* [r14] src/PCSC/debuglog.h, src/PCSC/pcsclite.h.in,
	  src/debuglog.c, src/pcscdaemon.c, src/tokenparser.c: Added
	  command line debug options
	* [r11] ., AUTHORS, COPYING, ChangeLog, DRIVERS, HELP, INSTALL,
	  Makefile.am, Makefile.in, NEWS, README, SECURITY, bootstrap,
	  build, build/acinclude.m4, build/aclocal.m4,
	  build/acx_pthread.m4, build/config.guess, build/config.sub,
	  build/install-sh, build/ltconfig, build/ltmain.sh, build/missing,
	  build/mkinstalldirs, build/ylwrap, config.h.in, configure,
	  configure.in, doc, doc/Makefile.am, doc/Makefile.in,
	  doc/README.DAEMON, doc/bundleTool.1, doc/pcsc-lite-0.8.7.pdf,
	  doc/pcscd.8.in, doc/pcscd.startup, etc, etc/Makefile.am,
	  etc/Makefile.in, etc/SmartcardServices,
	  etc/StartupParameters.plist, etc/reader.conf.in, libmusclecard,
	  libmusclecard/src, libmusclecard/src/PCSC,
	  libmusclecard/src/PCSC/mscdefines.h,
	  libmusclecard/src/PCSC/musclecard.h,
	  libmusclecard/src/musclecard.c, libmusclecard/src/muscletest.c,
	  libmusclecard/src/tokenfactory.c,
	  libmusclecard/src/tokenfactory.h, libmusclecard/utils,
	  libmusclecard/utils/bundleTool,
	  libmusclecard/utils/bundleTool/bundleTool.c, pbx,
	  pbx/PCSC.pbproj, pbx/PCSC.pbproj/project.pbxproj, pbx/config.h,
	  reconf, src, src/Makefile.am, src/Makefile.in, src/PCSC,
	  src/PCSC/debuglog.h, src/PCSC/dyn_generic.h,
	  src/PCSC/ifdhandler.h, src/PCSC/pcsclite.h.in,
	  src/PCSC/sys_generic.h, src/PCSC/thread_generic.h,
	  src/PCSC/winscard.h, src/PCSC/wintypes.h,
	  src/README_INTERNALS.txt, src/atrhandler.c, src/atrhandler.h,
	  src/configfile.c, src/configfile.h, src/configfile.l,
	  src/debuglog.c, src/driverparser.c, src/driverparser.l,
	  src/dyn_bsd.c, src/dyn_hpux.c, src/dyn_macosx.c, src/dyn_unix.c,
	  src/eventhandler.c, src/eventhandler.h, src/hotplug.h,
	  src/hotplug_generic.c, src/hotplug_linux.c, src/hotplug_macosx.c,
	  src/ifdwrapper.c, src/ifdwrapper.h, src/pcscdaemon.c,
	  src/powermgt_macosx.c, src/prothandler.c, src/prothandler.h,
	  src/readerfactory.c, src/readerfactory.h, src/sys_hpux.c,
	  src/sys_solaris.c, src/sys_unix.c, src/testpcsc.c,
	  src/thread_macosx.c, src/thread_unix.c, src/tokenparser.c,
	  src/tokenparser.l, src/utils, src/utils/Makefile.am,
	  src/utils/Makefile.in, src/utils/README, src/utils/formaticc.c,
	  src/utils/installifd.c, src/utils/sample.ibm,
	  src/utils/sample.in, src/utils/sample.out, src/winscard.c,
	  src/winscard_clnt.c, src/winscard_msg.c, src/winscard_msg.h,
	  src/winscard_svc.c, src/winscard_svc.h, stamp-h.in: Initial
	  revision

